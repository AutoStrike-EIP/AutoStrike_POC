# Initial Access techniques - MITRE ATT&CK
# All techniques are safe/read-only (checking configurations, not gaining access)

- id: "T1078"
  name: "Valid Accounts"
  description: "Adversaries may obtain and abuse credentials of existing accounts as a means of gaining Initial Access."
  tactic: "initial-access"
  platforms:
    - "windows"
    - "linux"
  executors:
    - type: "cmd"
      command: "net user && net localgroup Administrators"
      platform: "windows"
      timeout: 60
    - type: "bash"
      command: "lastlog 2>/dev/null | head -20; last -n 10 2>/dev/null; cat /etc/passwd | grep -v nologin | grep -v false | cut -d: -f1"
      platform: "linux"
      timeout: 60
  detection:
    - source: "Authentication Logs"
      indicator: "Unusual login patterns or use of dormant accounts"
    - source: "Windows Event Log"
      indicator: "Event ID 4624/4625 - Successful/Failed logons"
  is_safe: true

- id: "T1133"
  name: "External Remote Services"
  description: "Adversaries may leverage external-facing remote services to initially access and/or persist within a network."
  tactic: "initial-access"
  platforms:
    - "windows"
    - "linux"
  executors:
    - type: "cmd"
      command: "netstat -an | findstr LISTENING"
      platform: "windows"
      timeout: 60
    - type: "powershell"
      command: "Get-NetTCPConnection -State Listen | Select-Object LocalAddress,LocalPort,OwningProcess | Sort-Object LocalPort"
      platform: "windows"
      timeout: 60
    - type: "bash"
      command: "ss -tlnp 2>/dev/null || netstat -tlnp 2>/dev/null"
      platform: "linux"
      timeout: 60
  detection:
    - source: "Network Traffic"
      indicator: "Inbound connections to remote services (RDP, VPN, SSH)"
    - source: "Authentication Logs"
      indicator: "Remote authentication from unusual sources"
  is_safe: true

- id: "T1190"
  name: "Exploit Public-Facing Application"
  description: "Adversaries may attempt to exploit a weakness in an Internet-facing host or system to initially access a network."
  tactic: "initial-access"
  platforms:
    - "windows"
    - "linux"
  executors:
    - type: "powershell"
      command: "Get-NetTCPConnection -State Listen | Where-Object { $_.LocalPort -in @(80,443,8080,8443,3000,5000) } | Select-Object LocalPort,OwningProcess; Get-Process -Id (Get-NetTCPConnection -State Listen | Where-Object { $_.LocalPort -in @(80,443,8080,8443) }).OwningProcess -ErrorAction SilentlyContinue | Select-Object Name,Id"
      platform: "windows"
      timeout: 60
    - type: "bash"
      command: "ss -tlnp 2>/dev/null | grep -E ':(80|443|8080|8443|3000|5000)\\s' || netstat -tlnp 2>/dev/null | grep -E ':(80|443|8080|8443|3000|5000)'"
      platform: "linux"
      timeout: 60
  detection:
    - source: "Web Application Logs"
      indicator: "Unusual HTTP requests, SQL injection attempts, or exploit payloads"
    - source: "IDS/IPS"
      indicator: "Known exploit signatures targeting web applications"
  is_safe: true
